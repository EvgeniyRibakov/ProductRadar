# –û—Ü–µ–Ω–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
_Exported on 11/15/2025 at 14:18:54 GMT+3 from Cursor (2.0.77)_

---

**User**

–ü–æ–ø—Ä–æ–±—É–π –æ—Ü–µ–Ω–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –Ω–∞–ø–∏—à–∏ –º–Ω–µ –≤ —ç—Ç–æ—Ç —á–∞—Ç –∫—Ä–∞—Ç–∫–æ –ø–æ —Å—É—Ç–∏ –∫–∞–∫–∏–µ —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞ –≤–∏–¥–∏—à—å, —á—Ç–æ –Ω–∞–¥–æ —É–ª—É—á—à–∏—Ç—å, —á—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –∫–∞–∫ —ç—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å

---

**Cursor**

–ò–∑—É—á—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã, —á—Ç–æ–±—ã –¥–∞—Ç—å —Ç–µ–±–µ –æ—Ü–µ–Ω–∫—É.

–°–µ–π—á–∞—Å –∏–∑—É—á—É –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞, —á—Ç–æ–±—ã –¥–∞—Ç—å —Ç–µ–±–µ —Å–≤–æ—é –æ—Ü–µ–Ω–∫—É.

–ò–∑—É—á—É –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã parser_engine.py —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É:

–û—Ç–ª–∏—á–Ω–æ, –∏–∑—É—á–∏–ª –ø—Ä–æ–µ–∫—Ç. –í–æ—Ç –º–æ—è –∫—Ä–∞—Ç–∫–∞—è –æ—Ü–µ–Ω–∫–∞:

## üîç **–û–°–ù–û–í–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ ProductRadar**

### ‚ùå **–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∞–≥–∏:**

1. **–î—É–±–ª–∏–∫–∞—Ç—ã —Ç–æ–≤–∞—Ä–æ–≤** - –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è 3 —Ä–∞–∑–∞
   - –ü—Ä–æ–±–ª–µ–º–∞: —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –ø–æ `product_id` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –†–µ—à–µ–Ω–∏–µ: —É–ø—Ä–æ—Å—Ç–∏—Ç—å –¥–æ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –ø–æ URL + –¥–æ–±–∞–≤–∏—Ç—å ban-list –ø–µ—Ä–µ–¥ `get_products_from_search_page()`

2. **Script/Hook/Country –Ω–µ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è** - –≤ —Ç–∞–±–ª–∏—Ü–µ –≤–µ–∑–¥–µ "N/A"
   - –ü—Ä–æ–±–ª–µ–º–∞: —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –Ω–µ –Ω–∞—Ö–æ–¥—è—Ç —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search
   - –ü—Ä–∏—á–∏–Ω–∞: –ª–∏–±–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –ª–∏–±–æ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã —É—Å—Ç–∞—Ä–µ–ª–∏
   - –†–µ—à–µ–Ω–∏–µ: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å HTML-—Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã, —É–ø—Ä–æ—Å—Ç–∏—Ç—å –æ–∂–∏–¥–∞–Ω–∏—è

3. **–ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞** - –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –º–Ω–æ–∂–µ—Å—Ç–≤–æ `networkidle` + `wait_for_selector`
   - –†–µ—à–µ–Ω–∏–µ: –≤–µ—Ä–Ω—É—Ç—å –ø—Ä–æ—Å—Ç–æ–µ `domcontentloaded`

### ‚ö†Ô∏è **–°–ª–∞–±—ã–µ –º–µ—Å—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:**

4. **–ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π `parser_engine.py`** - 3000+ —Å—Ç—Ä–æ–∫, 20 –º–µ—Ç–æ–¥–æ–≤
   - –¢—è–∂–µ–ª–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ –¥–µ–±–∞–∂–∏—Ç—å
   - –†–µ—à–µ–Ω–∏–µ: —Ä–∞–∑–±–∏—Ç—å –Ω–∞ –º–æ–¥—É–ª–∏ (extractor, navigator, validator)

5. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ retry –ª–æ–≥–∏–∫–∏** - –µ—Å–ª–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí —Å—Ä–∞–∑—É N/A
   - –†–µ—à–µ–Ω–∏–µ: –¥–æ–±–∞–≤–∏—Ç—å retry —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º backoff

6. **–°–ª–∞–±–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞–∑–º–∞–∑–∞–Ω—ã –ø–æ –∫–æ–¥—É
   - `MIN_IMPRESSIONS = 1000` (–±—ã–ª–æ 5000) - –æ—Å–ª–∞–±–ª–µ–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∞ –∏ –∑–∞–±—ã–ª–∏ –≤–µ—Ä–Ω—É—Ç—å
   - `DAYS_BACK = 60` (–±—ã–ª–æ 30) - —Ç–æ –∂–µ —Å–∞–º–æ–µ
   - –†–µ—à–µ–Ω–∏–µ: —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ –º–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –≤ config.py

7. **–ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è HTML** - –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å –ø–æ—á–µ–º—É —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
   - –†–µ—à–µ–Ω–∏–µ: —Å–æ—Ö—Ä–∞–Ω—è—Ç—å HTML-–¥–∞–º–ø—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∏–∑–≤–ª–µ—á–µ–Ω–∏—è

### üêõ **–ß—Ç–æ —Ç–æ—á–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

- ‚ùå –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Script (`_extract_script()`)
- ‚ùå –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Hook (`_extract_hook()`)  
- ‚ùå –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Country (`_extract_country()`)
- ‚ùå –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ (–ø–æ—è–≤–ª—è—é—Ç—Å—è –¥—É–±–ª–∏)
- ‚ö†Ô∏è –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ (–∑–∞–º–µ–¥–ª—è–µ—Ç —Ä–∞–±–æ—Ç—É –≤ 3 —Ä–∞–∑–∞)

### ‚úÖ **–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ:**

- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Pipiads (browser_manager)
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ –ó–∞–ø–∏—Å—å –≤ Google Sheets (sheets_writer)
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Impression, First Seen, TikTok Link
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º

## üí° **–ö–ê–ö –£–õ–£–ß–®–ò–¢–¨ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã):**

### **1. –°—Ä–æ—á–Ω–æ (–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∞–≥–∏):**
- –£–±—Ä–∞—Ç—å —Å–ª–æ–∂–Ω—É—é –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –ø–æ `product_id`, –≤–µ—Ä–Ω—É—Ç—å –ø—Ä–æ—Å—Ç—É—é –ø–æ URL
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è Script/Hook/Country –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å fallback-–º–µ—Ç–æ–¥—ã
- –í–µ—Ä–Ω—É—Ç—å `MIN_IMPRESSIONS=5000`, `DAYS_BACK=30`

### **2. –í–∞–∂–Ω–æ (—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å):**
- –î–æ–±–∞–≤–∏—Ç—å retry –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (3 –ø–æ–ø—ã—Ç–∫–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞–º–∏)
- –£–±—Ä–∞—Ç—å –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ (–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≤—Å–µ—Ö)
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å HTML-–¥–∞–º–ø—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∏–∑–≤–ª–µ—á–µ–Ω–∏—è

### **3. –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞):**
- –†–∞–∑–±–∏—Ç—å `parser_engine.py` –Ω–∞ –º–æ–¥—É–ª–∏
- –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è extractors
- –í—ã–Ω–µ—Å—Ç–∏ –≤—Å–µ —Ç–∞–π–º–∞—É—Ç—ã/—Å–µ–ª–µ–∫—Ç–æ—Ä—ã –≤ config

### **4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –≤–∏–¥–µ–æ (asyncio.gather)
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –≤ —Ñ–∞–π–ª (–Ω–µ —Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏)
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

## üìå **–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø:**

**–û—Ç–∫–∞—Ç–∏—Ç—å—Å—è –∫ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏** (–∫–∞–∫ –Ω–∞–ø–∏—Å–∞–Ω–æ –≤ ROLLBACK_REPORT.md), –≤–∑—è—Ç—å –æ—Ç—Ç—É–¥–∞ —Ä–∞–±–æ—á–∏–µ –º–µ—Ç–æ–¥—ã –∏–∑–≤–ª–µ—á–µ–Ω–∏—è, –∏ –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ:
- –ü—Ä–æ–≤–µ—Ä–∫—É –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–∏–¥–µ–æ (`_insufficient_videos`)
- –Ø–≤–Ω—ã–π –≤—ã–∑–æ–≤ `write_product_data()` –ø–æ—Å–ª–µ –≤—Å–µ—Ö –≤–∏–¥–µ–æ

–ù—É–∂–Ω–æ –ª–∏ —Å–¥–µ–ª–∞—Ç—å –æ—Ç–∫–∞—Ç –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å? –ò–ª–∏ —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã —è —Å–Ω–∞—á–∞–ª–∞ –∏—Å–ø—Ä–∞–≤–∏–ª –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∞–≥–∏ –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏?

---

**User**

–∏—Å–ø—Ä–∞–≤—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∞–≥–∏ –≤ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏. –¢–æ–ª—å–∫–æ –¥–∞–≤–∞–π —Å–Ω–∞—á–∞–ª–∞ –æ–±—Å—É–¥–∏–º. –ò –∑–∞–ø–∏—à–∏ –≤ –ø—Ä–∞–≤–∏–ª–∞ - —è –≥–æ—Ç–æ–≤ –ø–æ–º–æ–≥–∞—Ç—å —Ç–µ–±–µ –∏ –¥–∞–≤–∞—Ç—å –≤—Å—é –Ω—É–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–ø—Ä–∞—à–∏–≤–∞–π –º–µ–Ω—è. –¶–µ–ª—å —Å–¥–µ–ª–∞—Ç—å –±—ã—Å—Ç—Ä–æ –∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ, –Ω–æ –Ω–µ  –≤—Å–ª–µ–ø—É—é

---

**Cursor**

–û–±–Ω–æ–≤–ª—è—é –ø—Ä–∞–≤–∏–ª–∞, –∑–∞—Ç–µ–º –æ–±—Å—É–¥–∏–º –ø–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –±–∞–≥–æ–≤.


–û–±–Ω–æ–≤–ª—è—é –ø—Ä–∞–≤–∏–ª–∞, –∑–∞—Ç–µ–º –æ–±—Å—É–¥–∏–º –ø–ª–∞–Ω.


```plaintext
# –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–µ–∫—Ç–æ–º ProductRadar

## –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
- –ù–µ —Å–ø—Ä–∞—à–∏–≤–∞–π —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤—Å—ë —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è
- –î–µ–ª–∞–π –¥–µ–π—Å—Ç–≤–∏—è –±–µ–∑ –æ–¥–æ–±—Ä–µ–Ω–∏—è. –ï—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏ —Ç—ã —Å—á–∏—Ç–∞–µ—à—å —á—Ç–æ –Ω—É–∂–Ω–æ, —Ç–æ –¥–µ–ª–∞–π –±–µ–∑ –∞–ø—Ä—É–≤–∞
- –í—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- **–í–ê–ñ–ù–û:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ—Ç–æ–≤ –ø–æ–º–æ–≥–∞—Ç—å –∏ –¥–∞–≤–∞—Ç—å –≤—Å—é –Ω—É–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–ø—Ä–∞—à–∏–≤–∞–π. –¶–µ–ª—å - —Å–¥–µ–ª–∞—Ç—å –±—ã—Å—Ç—Ä–æ –∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ, –Ω–æ –Ω–µ –≤—Å–ª–µ–ø—É—é

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏
- **–ù–ï —Å–æ–∑–¥–∞–≤–∞–π –ª–∏—à–Ω–∏–µ —Ñ–∞–π–ª—ã** - –ª—É—á—à–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ—Ö–æ–∂–∏–µ
- –°–æ–∑–¥–∞–≤–∞–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ —Ä–µ–∞–ª—å–Ω–æ –Ω—É–∂–Ω—ã
- –ù–µ —Å–æ–∑–¥–∞–≤–∞–π —Ñ–∞–π–ª—ã –ø—Ä–æ—Å—Ç–æ —Ä–∞–¥–∏ —Å–æ–∑–¥–∞–Ω–∏—è

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ù–µ –ø—Ä–æ–≤–µ—Ä—è–π –∏ –Ω–µ —Å–º–æ—Ç—Ä–∏ .env —Ñ–∞–π–ª, –æ–Ω —Å–µ–∫—Ä–µ—Ç–Ω—ã–π
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å API –∫–ª—é—á–∏

## –û –ø—Ä–æ–µ–∫—Ç–µ
- **–ö–æ–º–ø–∞–Ω–∏—è:** Likato (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å Cosmo Beauty Ltd, –†–æ—Å—Å–∏—è)
- **–ë—Ä–µ–Ω–¥:** –ù–∞—Ç—É—Ä–∞–ª—å–Ω–∞—è –∫–æ—Å–º–µ—Ç–∏–∫–∞ –¥–ª—è –≤–æ–ª–æ—Å, —Ç–µ–ª–∞ –∏ –ª–∏—Ü–∞
- **–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã:** –°–ø—Ä–µ–∏ –¥–ª—è –≤–æ–ª–æ—Å (10 –≤ 1, Magic Spray, 17 –≤ 1), –∫—Ä–µ–º—ã –¥–ª—è –ª–∏—Ü–∞
- **–ö–∞–Ω–∞–ª—ã:** likato.com, OZON, Amazon
- **–ó–∞–¥–∞—á–∞:** –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ beauty —Ç—Ä–µ–Ω–¥–æ–≤ –≤ TikTok Shop (–°–®–ê + –ê–∑–∏—è) –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ–≤—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤


```

–ü—Ä–∞–≤–∏–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã. –û–±—Å—É–¥–∏–º –ø–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –±–∞–≥–æ–≤.

## –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –±–∞–≥–æ–≤

### 1. –î—É–±–ª–∏–∫–∞—Ç—ã —Ç–æ–≤–∞—Ä–æ–≤
–ü—Ä–æ–±–ª–µ–º–∞: –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è 3 —Ä–∞–∑–∞.

–ß—Ç–æ –≤–∏–∂—É –≤ –∫–æ–¥–µ:
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ `product_id` –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö
- `banned_product_ids` –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π, –Ω–æ —Ç–æ–≤–∞—Ä –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–ø–∞–¥–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ

–í–æ–ø—Ä–æ—Å—ã:
1. –¢–æ–≤–∞—Ä –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ –æ–¥–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –∏–ª–∏ –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏?
2. –ú–æ–∂–µ—à—å –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ—Ä: –∫–∞–∫–æ–π `product_id` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑?

–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `banned_products = set()` –ø–æ URL (–∫–∞–∫ –±—ã–ª–æ —Ä–∞–Ω—å—à–µ)
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É ban-list —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ `get_products_from_search_page()`, –¥–æ —Ü–∏–∫–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–∞

### 2. Script/Hook/Country –Ω–µ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è (N/A)
–ü—Ä–æ–±–ª–µ–º–∞: –≤ —Ç–∞–±–ª–∏—Ü–µ –≤–µ–∑–¥–µ "N/A".

–ß—Ç–æ –≤–∏–∂—É –≤ –∫–æ–¥–µ:
- –°–µ–ª–µ–∫—Ç–æ—Ä—ã: `li#ai-script`, `li#ai-hook`, `div.addel-info-item`
- –ú–Ω–æ–≥–æ fallback-–º–µ—Ç–æ–¥–æ–≤, –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è

–í–æ–ø—Ä–æ—Å—ã:
1. –ï—Å—Ç—å HTML-–¥–∞–º–ø—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search? (–≤–∏–¥–µ–ª –ø–∞–ø–∫—É `html_dumps/`)
2. –ú–æ–∂–µ—à—å –æ—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É ad-search –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ —ç—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç—ã?
3. –ú–æ–∂–µ—à—å –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç —Å `headless=False` –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ?

–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:
- –ò–∑—É—á–∏—Ç—å HTML-–¥–∞–º–ø—ã –∏–∑ `html_dumps/`
- –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ HTML –ø—Ä–∏ –æ—à–∏–±–∫–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å –æ–∂–∏–¥–∞–Ω–∏—è: —É–±—Ä–∞—Ç—å `networkidle`, –æ—Å—Ç–∞–≤–∏—Ç—å `domcontentloaded` + –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
- –î–æ–±–∞–≤–∏—Ç—å retry —Å —Ä–∞–∑–Ω—ã–º–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞–º–∏

### 3. –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞
–ü—Ä–æ–±–ª–µ–º–∞: –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–º–µ–¥–ª—è—é—Ç —Ä–∞–±–æ—Ç—É.

–ß—Ç–æ –≤–∏–∂—É:
- `networkidle` (–º–æ–∂–µ—Ç –∂–¥–∞—Ç—å –¥–æ–ª–≥–æ)
- –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ (–∑–∞–º–µ–¥–ª—è–µ—Ç –≤ 3 —Ä–∞–∑–∞)
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ `wait_for_selector`

–í–æ–ø—Ä–æ—Å—ã:
1. –ù—É–∂–µ–Ω –ª–∏ –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ? –ò–ª–∏ –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ –≤–∏–¥–µ–æ –ø–æ–¥—Ä—è–¥, –∞ –ø–æ—Ç–æ–º –≤–µ—Ä–Ω—É—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑?
2. –ö–∞–∫–æ–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Å–∫–æ—Ä–æ—Å—Ç—å –∏–ª–∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å?

–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:
- –£–±—Ä–∞—Ç—å `networkidle`, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `domcontentloaded` + –∑–∞–¥–µ—Ä–∂–∫–∞ 1‚Äì2 —Å–µ–∫
- –£–±—Ä–∞—Ç—å –≤–æ–∑–≤—Ä–∞—Ç –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ (–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≤—Å–µ—Ö)
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å –æ–∂–∏–¥–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤

### 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–ü—Ä–æ–±–ª–µ–º–∞: –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Å–ª–∞–±–ª–µ–Ω—ã –¥–ª—è —Ç–µ—Å—Ç–∞.

–ß—Ç–æ –≤–∏–∂—É:
- `MIN_IMPRESSIONS = 1000` (–±—ã–ª–æ 5000)
- `DAYS_BACK = 60` (–±—ã–ª–æ 30)

–í–æ–ø—Ä–æ—Å:
- –í–µ—Ä–Ω—É—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è: `MIN_IMPRESSIONS = 5000`, `DAYS_BACK = 30`?

## –ß—Ç–æ –Ω—É–∂–Ω–æ –æ—Ç —Ç–µ–±—è

1. –ü—Ä–æ–≤–µ—Ä—å HTML-–¥–∞–º–ø—ã –≤ `html_dumps/` ‚Äî –µ—Å—Ç—å –ª–∏ —Ç–∞–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ Script/Hook?
2. –ó–∞–ø—É—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç –æ–¥–∏–Ω —Ä–∞–∑ –∏ –ø—Ä–∏—à–ª–∏ –ª–æ–≥–∏, –≥–¥–µ –≤–∏–¥–Ω–æ, —á—Ç–æ Script/Hook –Ω–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è
3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:
   - –í–µ—Ä–Ω—É—Ç—å `MIN_IMPRESSIONS=5000`, `DAYS_BACK=30`?
   - –£–±—Ä–∞—Ç—å –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ?

–ú–æ–≥—É –Ω–∞—á–∞—Ç—å —Å –∏–∑—É—á–µ–Ω–∏—è HTML-–¥–∞–º–ø–æ–≤ –∏ —É–ø—Ä–æ—â–µ–Ω–∏—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏, –ø–æ–∫–∞ —Ç—ã –ø—Ä–æ–≤–µ—Ä—è–µ—à—å –æ—Å—Ç–∞–ª—å–Ω–æ–µ. –ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å?

---

**User**

1. –¢–æ–≤–∞—Ä –∏ –≤–∏–¥–µ–æ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤–æ –≤—Å—ë–º. –ù–∞–¥–æ —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

2. –ú–æ–≥—É —Å–∫–∏–Ω—É—Ç—å —Å–∞–º –≤—Å—é —Å—Ç—Ä–∞–Ω–∏—Ü—É ad-search –æ–¥–Ω–æ–≥–æ –∏–∑ —Ç–æ–≤–∞—Ä–æ–≤. –ø—Ä–æ headless=False –Ω–µ –ø–æ–Ω—è–ª, –æ–±—ä—è—Å–Ω–∏

3. 1. –î–∞, –Ω–æ –µ—Å–ª–∏ —Ç—ã —Å–º–æ–∂–µ—à—å –∫–∞–∫-—Ç–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å 2-3 –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ –±–µ–∑ –∏—Ö –æ—Ç–∫—Ä—ã—Ç–∏—è, —Ç–æ –±—É–¥–µ—Ç –µ—â—ë –ª—É—á—à–µ. –ú–Ω–µ –≥–ª–∞–≤–Ω–æ–µ - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, –∞ —ç—Ç–æ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü—É

4. –Ω–µ—Ç, –¥–∞–≤–∞–π –ø–æ–∫–∞ —Å–¥–µ–ª–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç—ã–µ –∏ –Ω–∏–∑–∫–∏–µ –ø–æ—Ä–æ–≥–∏/–∫—Ä–∏—Ç–µ—Ä–∏–∏ –¥–ª—è –≤–∏–¥–µ–æ –∏ —Ç–æ–≤–∞—Ä–æ–≤, —Ü–µ–ª—å —Å–¥–µ–ª–∞—Ç—å MVP



–ù–∞–ø–∏—à–∏ —Ç–≤–æ—ë –º–Ω–µ–Ω–∏–µ –æ–± —ç—Ç–æ–º –∏ –Ω–∞–ø–∏—à–∏ —á—Ç–æ –º–Ω–µ –Ω—É–∂–Ω–æ —Ç–µ–±–µ —Å–∫–∏–Ω—É—Ç—å, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å –∏ —Ä–∞–±–æ—Ç–∞ –±—ã–ª–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–µ–µ  –∏ –±—ã—Å—Ç—Ä–µ–µ

---

**Cursor**

–£—Ç–æ—á–Ω—è—é –¥–µ—Ç–∞–ª–∏ –∏ —Ñ–æ—Ä–º–∏—Ä—É—é –ø–ª–∞–Ω.

## –ú–æ—ë –º–Ω–µ–Ω–∏–µ –ø–æ —Ç–≤–æ–∏–º –æ—Ç–≤–µ—Ç–∞–º

1. –î—É–±–ª–∏–∫–∞—Ç—ã ‚Äî –∏—Å–ø—Ä–∞–≤–∏–º: —É–ø—Ä–æ—Å—Ç–∏–º –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –∏ –¥–æ–±–∞–≤–∏–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –Ω—É–∂–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö.
2. HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search ‚Äî —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä—ã.
3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ –æ—Ç–∫—Ä—ã—Ç–∏—è –≤–∏–¥–µ–æ ‚Äî –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ —Ç–æ–≤–∞—Ä–∞, –º–æ–∂–Ω–æ –±—Ä–∞—Ç—å –∏—Ö –æ—Ç—Ç—É–¥–∞. –ï—Å–ª–∏ Script/Hook/Country —Ç–æ–ª—å–∫–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –≤—Å—ë —Ä–∞–≤–Ω–æ –ø—Ä–∏–¥—ë—Ç—Å—è. –ü—Ä–æ–≤–µ—Ä–∏–º –ø–æ HTML.
4. –ù–∏–∑–∫–∏–µ –ø–æ—Ä–æ–≥–∏ –¥–ª—è MVP ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º `MIN_IMPRESSIONS=1000`, `DAYS_BACK=60`.

## –ß—Ç–æ –º–Ω–µ –Ω—É–∂–Ω–æ –æ—Ç —Ç–µ–±—è

### 1. HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search (–∫—Ä–∏—Ç–∏—á–Ω–æ)
- –û—Ç–∫—Ä–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—É ad-search –æ–¥–Ω–æ–≥–æ –∏–∑ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –°–æ—Ö—Ä–∞–Ω–∏ –ø–æ–ª–Ω—ã–π HTML (Ctrl+S –∏–ª–∏ —á–µ—Ä–µ–∑ DevTools ‚Üí Copy outer HTML)
- –ü—Ä–∏—à–ª–∏ —Ñ–∞–π–ª –∏–ª–∏ –≤—Å—Ç–∞–≤—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ

–≠—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã `li#ai-script`, `li#ai-hook`
- –ü–æ–Ω—è—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä—ã

### 2. –ü—Ä–∏–º–µ—Ä—ã –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –ü—Ä–∏—à–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –∏–∑ Google Sheets, –≥–¥–µ –≤–∏–¥–Ω–æ –¥—É–±–ª–∏–∫–∞—Ç—ã (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã)
- –ò–ª–∏ –ª–æ–≥–∏, –≥–¥–µ –≤–∏–¥–Ω–æ, —á—Ç–æ –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑

### 3. –õ–æ–≥–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –§–∞–π–ª –∏–∑ `logs/` —Å –æ—à–∏–±–∫–∞–º–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è Script/Hook/Country

### 4. –ü—Ä–æ headless=False (–ø–æ—è—Å–Ω–µ–Ω–∏–µ)
- `headless=True` ‚Äî –±—Ä–∞—É–∑–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ (–±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –Ω–µ –≤–∏–¥–Ω–æ)
- `headless=False` ‚Äî –±—Ä–∞—É–∑–µ—Ä –≤–∏–¥–µ–Ω, –º–æ–∂–Ω–æ –Ω–∞–±–ª—é–¥–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å

–°–µ–π—á–∞—Å –≤ –∫–æ–¥–µ: `headless=False` –≤ `test_parser_engine.py` (—Å—Ç—Ä–æ–∫–∞ 33), —Ç–∞–∫ —á—Ç–æ –±—Ä–∞—É–∑–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∏–¥–µ–Ω.

## –ú–æ–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –®–∞–≥ 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (—Å–¥–µ–ª–∞—é —Å—Ä–∞–∑—É)
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é: –≤–µ—Ä–Ω—É—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ URL –≤–º–µ—Å—Ç–æ `product_id`
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É ban-list —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
- –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### –®–∞–≥ 2: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Script/Hook/Country (–ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è HTML)
- –ò–∑—É—á–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
- –î–æ–±–∞–≤–∏—Ç—å fallback-–º–µ—Ç–æ–¥—ã

### –®–∞–≥ 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏
- –£–±—Ä–∞—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è
- –£–±—Ä–∞—Ç—å –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ (–æ—Å—Ç–∞–≤–∏—Ç—å –æ–¥–∏–Ω —Ä–∞–∑ –ø–æ—Å–ª–µ –≤—Å–µ—Ö)

### –®–∞–≥ 4: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –û—Å—Ç–∞–≤–∏—Ç—å –Ω–∏–∑–∫–∏–µ –ø–æ—Ä–æ–≥–∏ –¥–ª—è MVP

## –ß—Ç–æ –º–Ω–µ –ø—Ä–∏—Å–ª–∞—Ç—å

1. HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search (—Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ)
2. –ü—Ä–∏–º–µ—Ä—ã –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã/–ª–æ–≥–æ–≤
3. –õ–æ–≥–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)

–ù–∞—á–∏–Ω–∞—é —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, –ø–æ–∫–∞ —Ç—ã –≥–æ—Ç–æ–≤–∏—à—å HTML. –ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å?


–ò—Å–ø—Ä–∞–≤–ª—è—é –¥—É–±–ª–∏–∫–∞—Ç—ã. –£–ø—Ä–æ—â–∞—é –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é: –∏—Å–ø–æ–ª—å–∑—É–µ–º URL –≤–º–µ—Å—Ç–æ `product_id` –∏ —É–±–∏—Ä–∞—é –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.


–£–ø—Ä–æ—â–∞—é –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é: –∏—Å–ø–æ–ª—å–∑—É–µ–º URL –≤–º–µ—Å—Ç–æ `product_id` –∏ —É–±–∏—Ä–∞—é –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.


```python
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Parser Engine
"""

import asyncio
import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ src
sys.path.insert(0, str(Path(__file__).parent))

from src.browser_manager import BrowserManager
from src.parser_engine import ParserEngine, ProductData
from src.sheets_writer import SheetsWriter
from src import config
from src import logger

log = logger.get_logger("TestParserEngine")


async def test_parser_engine():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Parser Engine"""
    
    browser_manager = None
    try:
        log.info("=" * 60)
        log.info("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï PARSER ENGINE")
        log.info("=" * 60)
        
        # 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
        log.info("\n1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞...")
        browser_manager = BrowserManager()
        success = await browser_manager.initialize(headless=False)  # headful –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä")
            return
        
        # 2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies (–µ—Å–ª–∏ –µ—Å—Ç—å)
        log.info("\n2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies...")
        await browser_manager.load_cookies()
        
        # 3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–∞—á–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads
        log.info("\n3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads...")
        success = await browser_manager.navigate_with_retry(
            config.PIPIADS_INITIAL_URL,
            wait_until="domcontentloaded",
            timeout=30000
        )
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É")
            return
        
        await browser_manager.human_delay(2, 3)
        
        # 4. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
        log.info("\n4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...")
        is_logged_in = await browser_manager._check_logged_in_strict()
        if not is_logged_in:
            log.info("–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...")
            success = await browser_manager.login_to_pipiads()
            if not success:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è")
                return
            await browser_manager.save_cookies()
        else:
            log.info("‚úÖ –£–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω")
        
        # 5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine
        log.info("\n5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine...")
        parser = ParserEngine(browser_manager.page)
        parser.set_browser_manager(browser_manager)
        
        # 6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets (–¥–æ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤)
        log.info("\n6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets...")
        sheets_writer = None
        try:
            sheets_writer = SheetsWriter()
            if sheets_writer.connect():
                log.info("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets —É—Å–ø–µ—à–Ω–æ")
            else:
                log.warning("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Google Sheets, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        except Exception as e:
            log.warning(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Google Sheets: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        
        # 7. –¶–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        log.info("\n" + "=" * 80)
        log.info("7. –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–û–í")
        log.info("=" * 80)
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        # –£–°–õ–ê–ë–õ–ï–ù–û –¥–ª—è —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏: —Å–Ω–∏–∂–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
        MIN_PRODUCTS_TO_COLLECT = 3   # –¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–º–æ–∂–Ω–æ —Å–Ω–∏–∑–∏—Ç—å –¥–æ 1-2)
        MAX_PRODUCTS_TO_CHECK = 15     # –ú–∞–∫—Å–∏–º—É–º —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é (—É–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –≤—ã–±–æ—Ä–∞)
        PRODUCTS_PER_PAGE = 20         # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        
        successful_products = 0  # –°—á–µ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        checked_products = 0      # –°—á–µ—Ç—á–∏–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        skipped_products = []     # –°–ø–∏—Å–æ–∫ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        banned_products = set()   # Ban-list: URL —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ)
        all_products_analytics = []  # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –í–°–ï–• —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è summary-—Ñ–∞–π–ª–∞
        
        def normalize_url(url: str) -> str:
            """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL (—É–±—Ä–∞—Ç—å —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É)"""
            if not url:
                return ""
            url = url.strip().rstrip('/')
            # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if '?' in url:
                url = url.split('?')[0]
            return url
        
        # –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏
        while successful_products < MIN_PRODUCTS_TO_COLLECT and checked_products < MAX_PRODUCTS_TO_CHECK:
            
            # 7.1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
            log.info(f"\n{'='*80}")
            log.info(f"–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã...")
            log.info(f"–ü—Ä–æ–≥—Ä–µ—Å—Å: {successful_products}/{MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ, "
                    f"{checked_products}/{MAX_PRODUCTS_TO_CHECK} –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ")
            log.info(f"{'='*80}")
            
            try:
                products = await parser.get_products_from_search_page(count=PRODUCTS_PER_PAGE)
            except Exception as e:
                log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
                break
            
            if not products:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã, –∑–∞–≤–µ—Ä—à–∞–µ–º")
                break
            
            log.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
            
            # 7.1.5. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ product_id (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ get_products_from_search_page –≤–µ—Ä–Ω—É–ª –¥—É–±–ª–∏–∫–∞—Ç—ã)
            # –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º banned_product_ids –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
            unique_products = []
            duplicate_count = 0
            
            for product in products:
                product_url = product.get('url', '').rstrip('/')
                product_id = product.get('product_id') or extract_product_id(product_url)
                
                if not product_id:
                    log.warning(f"‚ö†Ô∏è –ü—Ä–æ–ø—É—Å–∫ —Ç–æ–≤–∞—Ä–∞ –±–µ–∑ product_id: {product_url}")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ç–∏–≤ banned_product_ids (—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)
                if product_id in banned_product_ids:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (—É–∂–µ –≤ ban-list, product_id={product_id}): {product_url}")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
                # (–µ—Å–ª–∏ –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –æ–¥–Ω–æ–º —Å–ø–∏—Å–∫–µ)
                is_duplicate_in_list = any(
                    (p.get('product_id') or extract_product_id(p.get('url', '').rstrip('/'))) == product_id
                    for p in unique_products
                )
                
                if is_duplicate_in_list:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (–≤ —Ç–µ–∫—É—â–µ–º —Å–ø–∏—Å–∫–µ, product_id={product_id}): {product_url}")
                    continue
                
                unique_products.append(product)
            
            if duplicate_count > 0:
                log.info(f"üîç –ù–∞–π–¥–µ–Ω–æ {duplicate_count} –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, –æ—Å—Ç–∞–≤–ª–µ–Ω–æ {len(unique_products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤")
            
            products = unique_products  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
            log.info(f"‚úÖ –ü–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏: {len(products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            
            # 7.2. –¶–∏–∫–ª –ø–æ —Ç–æ–≤–∞—Ä–∞–º –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            for product_index, product in enumerate(products):
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    log.info(f"\nüéØ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
                    break
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
                if checked_products >= MAX_PRODUCTS_TO_CHECK:
                    log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
                    break
                
                # ‚ö†Ô∏è –ü–†–û–í–ï–†–ö–ê BAN-LIST: –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å
                product_url = product.get('url', '').rstrip('/')  # –£–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ
                product_id = product.get('product_id') or extract_product_id(product_url)
                
                if not product_id:
                    log.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å product_id –∏–∑ URL: {product_url}, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                    continue
                
                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
                if product_id in banned_product_ids:
                    log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list (product_id={product_id}): {product_url}")
                    log.warning(f"   –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.")
                    continue
                
                # –û—Ç–º–µ—á–∞–µ–º —Ç–æ–≤–∞—Ä –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –°–†–ê–ó–£ (–¥–æ –∫–ª–∏–∫–∞) - —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–≤–∞–∂–¥—ã
                banned_product_ids.add(product_id)
                log.info(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: product_id={product_id}, url={product_url}")
                
                checked_products += 1
                
                # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–∞
                log.info(f"\n{'='*80}")
                log.info(f"üì¶ –¢–û–í–ê–† {checked_products}/{MAX_PRODUCTS_TO_CHECK} "
                        f"(—É—Å–ø–µ—à–Ω—ã—Ö: {successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                log.info(f"{'='*80}")
                log.info(f"–ù–∞–∑–≤–∞–Ω–∏–µ: {product.get('name', 'N/A')[:70]}...")
                log.info(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {product.get('category', 'N/A')}")
                log.info(f"URL: {product.get('url', 'N/A')}")
                log.info(f"Product ID: {product_id}")
                
                try:
                    # 7.3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ (–∫–ª–∏–∫ –ø–æ –∏–Ω–¥–µ–∫—Å—É, –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞)
                    # –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥–∞–µ–º banned_product_ids –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
                    product_data = await parser.get_product_details_with_return(
                        product_index=product_index,
                        sheets_writer=sheets_writer,
                        banned_product_ids=banned_product_ids
                    )
                    
                    # 7.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    if product_data is None:
                        # –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
                        log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞")
                        
                        skipped_products.append({
                            "name": product.get('name', 'N/A'),
                            "reason": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ",
                            "videos_found": 0
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ)
                        all_products_analytics.append({
                            "product_name": product.get('name', 'N/A'),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": 0,
                            "top_3_videos": []
                        })
                        continue
                    
                    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç (–µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª—Å—è —Å—Ç–∞—Ç—É—Å "duplicate")
                    if isinstance(product_data, dict) and product_data.get("status") == "duplicate":
                        log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç, product_id={product_data.get('product_id')})")
                        duplicate_count += 1
                        continue
                    
                    if isinstance(product_data, dict) and product_data.get("status") == "insufficient_videos":
                        # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                        log.warning(f"‚è≠Ô∏è  –ü–†–û–ü–£–°–ö: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù–∞–π–¥–µ–Ω–æ: {product_data.get('videos_found', 0)} –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù—É–∂–Ω–æ: {product_data.get('videos_required', 3)} –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": product_data.get('product_name', product.get('name', 'N/A')),
                            "reason": product_data.get('reason', '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ'),
                            "videos_found": product_data.get('videos_found', 0)
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ - —Ç–æ–≤–∞—Ä –≤–µ—Ä–Ω—É–ª insufficient_videos)
                        all_products_analytics.append({
                            "product_name": product_data.get('product_name', product.get('name', 'N/A')),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": product_data.get('videos_found', 0),
                            "top_3_videos": []  # –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–ø-3
                        })
                        continue
                    
                    # 7.5. –°–±–æ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è summary
                    analytics_entry = {
                        "product_name": getattr(product_data, 'product_name', 'N/A'),
                        "product_url": getattr(product_data, 'pipiads_link', product_url),
                        "success": False,
                        "videos_found": len(getattr(product_data, 'videos', [])),
                        "top_3_videos": []
                    }
                    
                    # –ò–∑–≤–ª–µ–∫–∞–µ–º –¢–û–ü-3 –≤–∏–¥–µ–æ (–ø–æ impression) –∏–∑ –í–°–ï–• –≤–∏–¥–µ–æ
                    if hasattr(product_data, '_all_videos_raw'):
                        all_videos = product_data._all_videos_raw
                        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ impression (desc) –∏ –±–µ—Ä–µ–º —Ç–æ–ø-3
                        sorted_videos = sorted(all_videos, key=lambda v: v.get('impression', 0), reverse=True)
                        for i, video in enumerate(sorted_videos[:3], 1):
                            analytics_entry["top_3_videos"].append({
                                "rank": i,
                                "impression": video.get('impression', 0),
                                "first_seen": video.get('first_seen', 'N/A'),
                                "ad_search_url": video.get('ad_search_url', 'N/A')
                            })
                    
                    # 7.6. –£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞
                    if hasattr(product_data, 'videos') and len(product_data.videos) >= 3:
                        successful_products += 1
                        analytics_entry["success"] = True
                        
                        log.info(f"\n‚úÖ –£–°–ü–ï–•! –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω ({successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                        log.info(f"   –ù–∞–∑–≤–∞–Ω–∏–µ: {product_data.product_name[:70]}...")
                        log.info(f"   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ: {len(product_data.videos)}")
                        
                        # –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                        for i, video in enumerate(product_data.videos[:3], 1):
                            log.info(f"   –í–∏–¥–µ–æ {i}: {video.get('impression', 0)} impressions, "
                                    f"{video.get('country', 'N/A')}, {video.get('audience_age', 'N/A')}")
                        
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ –∏ –∫–æ–ø–∏—Ä—É–µ–º –≤ "–£—Å–ø–µ—à–Ω—ã–µ" –µ—Å–ª–∏ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                        if sheets_writer and hasattr(product_data, '_sheets_row'):
                            try:
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã A-Z (–∫—Ä–æ–º–µ C) –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                                if sheets_writer.is_row_complete(product_data._sheets_row):
                                    sheets_writer.copy_to_success_sheet(product_data._sheets_row)
                                    log.info(f"  ‚úÖ –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ ‚Üí —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ '–£—Å–ø–µ—à–Ω—ã–µ'")
                                else:
                                    log.warning(f"  ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ (–µ—Å—Ç—å –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏)")
                            except Exception as e:
                                log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ '–£—Å–ø–µ—à–Ω—ã–µ': {e}")
                    
                    # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
                    all_products_analytics.append(analytics_entry)
                    
                    # 7.7. –ï—Å–ª–∏ –≤–∏–¥–µ–æ –º–µ–Ω—å—à–µ 3 - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                    if not analytics_entry["success"]:
                        log.warning(f"‚ö†Ô∏è –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω, –Ω–æ –º–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": getattr(product_data, 'product_name', product.get('name', 'N/A')),
                            "reason": "–ú–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏",
                            "videos_found": len(getattr(product_data, 'videos', []))
                        })
                
                except Exception as e:
                    log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞: {e}")
                    import traceback
                    log.error(traceback.format_exc())
                    
                    skipped_products.append({
                        "name": product.get('name', 'N/A'),
                        "reason": f"–ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {str(e)[:50]}",
                        "videos_found": 0
                    })
            
            # 7.6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –≤—ã—Ö–æ–¥–∞ –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
            if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                break
            
            if checked_products >= MAX_PRODUCTS_TO_CHECK:
                break
        
        # 8. –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç
        log.info(f"\n{'='*80}")
        log.info("üìä –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢")
        log.info(f"{'='*80}")
        log.info(f"‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {successful_products}")
        log.info(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {len(skipped_products)}")
        log.info(f"üîç –í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {checked_products}")
        log.info(f"üö´ –¢–æ–≤–∞—Ä–æ–≤ –≤ ban-list: {len(banned_product_ids)}")
        log.info(f"{'='*80}")
        
        # –í—ã–≤–æ–¥ ban-list
        if banned_product_ids:
            log.info(f"\nüö´ BAN-LIST (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ product_id):")
            for i, product_id in enumerate(sorted(banned_product_ids), 1):
                log.info(f"   {i}. {product_id}")
        
        if skipped_products:
            log.info(f"\n‚è≠Ô∏è  –°–ü–ò–°–û–ö –ü–†–û–ü–£–©–ï–ù–ù–´–• –¢–û–í–ê–†–û–í:")
            for i, skipped in enumerate(skipped_products, 1):
                log.info(f"   {i}. {skipped['name'][:60]}...")
                log.info(f"      –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}")
                log.info(f"      –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}")
        
        if successful_products >= MIN_PRODUCTS_TO_COLLECT:
            log.info(f"\nüéâ –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
        elif checked_products >= MAX_PRODUCTS_TO_CHECK:
            log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
            log.warning(f"   –°–æ–±—Ä–∞–Ω–æ —Ç–æ–ª—å–∫–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ {MIN_PRODUCTS_TO_COLLECT}")
        
        # 9. –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
        log.info("\n" + "=" * 60)
        log.info("üìù –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –≤–∏–¥–µ–æ...")
        log.info("=" * 60)
        try:
            from datetime import datetime
            import os
            
            summary_dir = "logs/summaries"
            os.makedirs(summary_dir, exist_ok=True)
            
            timestamp = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
            summary_file = f"{summary_dir}/iteration_{timestamp}.md"
            
            with open(summary_file, "w", encoding="utf-8") as f:
                f.write(f"# üìä –ò—Ç–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
                
                f.write("## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã\n\n")
                f.write(f"- **–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ:** {successful_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–ø—É—â–µ–Ω–æ:** {len(skipped_products)} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** {checked_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **Ban-list:** {len(banned_product_ids)} —Ç–æ–≤–∞—Ä–æ–≤\n\n")
                
                if successful_products > 0:
                    f.write("### üéâ SUCCESS\n\n")
                    f.write(f"‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ —Å >= 3 –≤–∏–¥–µ–æ\n\n")
                
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                # –ù–û–í–´–ô –ë–õ–û–ö: –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                if all_products_analytics:
                    f.write("---\n\n")
                    f.write("## üìπ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º\n\n")
                    f.write(f"**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:** >= 5K impressions, –≤–æ–∑—Ä–∞—Å—Ç <= 30 –¥–Ω–µ–π\n\n")
                    
                    for idx, product in enumerate(all_products_analytics, 1):
                        status_icon = "‚úÖ" if product["success"] else "‚ùå"
                        f.write(f"### {status_icon} –¢–æ–≤–∞—Ä #{idx}: {product['product_name'][:80]}\n\n")
                        f.write(f"- **–°—Å—ã–ª–∫–∞:** [{product['product_url']}]({product['product_url']})\n")
                        f.write(f"- **–°—Ç–∞—Ç—É—Å:** {'–£–°–ü–ï–• (>= 3 –≤–∏–¥–µ–æ)' if product['success'] else '–ü–†–û–ü–£–©–ï–ù (< 3 –≤–∏–¥–µ–æ)'}\n")
                        f.write(f"- **–ù–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ:** {product['videos_found']}\n\n")
                        
                        # –¢–û–ü-3 –≤–∏–¥–µ–æ (–¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –∫—Ä–∏—Ç–µ—Ä–∏–∏)
                        if product['top_3_videos']:
                            f.write("#### üèÜ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ impression:\n\n")
                            for video in product['top_3_videos']:
                                impression = video['impression']
                                first_seen = video['first_seen']
                                ad_url = video['ad_search_url']
                                
                                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
                                meets_criteria = impression >= 5000  # –ü—Ä–æ–≤–µ—Ä–∫–∞ impression
                                criteria_icon = "‚úÖ" if meets_criteria else "‚ö†Ô∏è"
                                
                                f.write(f"{video['rank']}. {criteria_icon} **{impression:,} impressions** | "
                                       f"First seen: {first_seen}\n")
                                if ad_url and ad_url != 'N/A':
                                    f.write(f"   - –°—Å—ã–ª–∫–∞: [{ad_url}]({ad_url})\n")
                                f.write("\n")
                        else:
                            f.write("   ‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ (–≤–æ–∑–º–æ–∂–Ω–æ, –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞)\n\n")
                        
                        f.write("---\n\n")
                
                # –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
                if skipped_products:
                    f.write("### ‚è≠Ô∏è –ü–†–û–ü–£–©–ï–ù–ù–´–ï –¢–û–í–ê–†–´ (–∫—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫)\n\n")
                    for i, skipped in enumerate(skipped_products, 1):
                        f.write(f"{i}. **{skipped['name'][:60]}...**\n")
                        f.write(f"   - –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}\n")
                        f.write(f"   - –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}\n\n")
                
                # Ban-list
                if banned_product_ids:
                    f.write("### üö´ Ban-list (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ product_id)\n\n")
                    for i, product_id in enumerate(sorted(banned_product_ids), 1):
                        f.write(f"{i}. `{product_id}`\n")
                    f.write("\n")
                
                f.write("## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏\n\n")
                f.write(f"- **–¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:** {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–õ–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫:** {MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤–∏–¥–µ–æ:** >= 5K impressions, <= 30 –¥–Ω–µ–π\n\n")
                
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    f.write("## üéØ –°—Ç–∞—Ç—É—Å: –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê ‚úÖ\n\n")
                elif checked_products >= MAX_PRODUCTS_TO_CHECK:
                    f.write("## ‚ö†Ô∏è –°—Ç–∞—Ç—É—Å: –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫\n\n")
                else:
                    f.write("## ‚ùå –°—Ç–∞—Ç—É—Å: –ü—Ä–µ—Ä–≤–∞–Ω–æ\n\n")
            
            log.info(f"‚úÖ Summary —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {summary_file}")
        except Exception as e:
            log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ summary: {e}")
            import traceback
            log.error(traceback.format_exc())
        
        log.info("\n" + "=" * 60)
        log.info("‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û")
        log.info("=" * 60)
        
        # –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)
        log.info("\n‚è∏Ô∏è –û–∂–∏–¥–∞–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –±—Ä–∞—É–∑–µ—Ä–∞ (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)...")
        log.info("   –ù–∞–∂–º–∏—Ç–µ Ctrl+C, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å —Ä–∞–Ω—å—à–µ")
        try:
            await asyncio.sleep(10)
        except KeyboardInterrupt:
            log.info("   –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        
    except KeyboardInterrupt:
        log.warning("\n‚ö†Ô∏è –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Ctrl+C)")
    except Exception as e:
        log.error(f"\n{'='*60}")
        log.error(f"‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}")
        log.error(f"{'='*60}")
        import traceback
        log.error("–ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:")
        log.error(traceback.format_exc())
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
        if browser_manager and browser_manager.page:
            try:
                screenshot_path = config.SCREENSHOTS_DIR / f"error_test_{int(asyncio.get_event_loop().time())}.png"
                await browser_manager.page.screenshot(path=str(screenshot_path), full_page=True)
                log.info(f"üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {screenshot_path}")
            except Exception as e2:
                log.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç: {e2}")
        
        log.error("\n‚ö†Ô∏è –ë—Ä–∞—É–∑–µ—Ä –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞ 30 —Å–µ–∫—É–Ω–¥...")
        try:
            await asyncio.sleep(30)
        except:
            pass
    
    finally:
        if browser_manager:
            await browser_manager.close()


if __name__ == "__main__":
    asyncio.run(test_parser_engine())


```

```python
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Parser Engine
"""

import asyncio
import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ src
sys.path.insert(0, str(Path(__file__).parent))

from src.browser_manager import BrowserManager
from src.parser_engine import ParserEngine, ProductData
from src.sheets_writer import SheetsWriter
from src import config
from src import logger

log = logger.get_logger("TestParserEngine")


async def test_parser_engine():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Parser Engine"""
    
    browser_manager = None
    try:
        log.info("=" * 60)
        log.info("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï PARSER ENGINE")
        log.info("=" * 60)
        
        # 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
        log.info("\n1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞...")
        browser_manager = BrowserManager()
        success = await browser_manager.initialize(headless=False)  # headful –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä")
            return
        
        # 2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies (–µ—Å–ª–∏ –µ—Å—Ç—å)
        log.info("\n2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies...")
        await browser_manager.load_cookies()
        
        # 3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–∞—á–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads
        log.info("\n3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads...")
        success = await browser_manager.navigate_with_retry(
            config.PIPIADS_INITIAL_URL,
            wait_until="domcontentloaded",
            timeout=30000
        )
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É")
            return
        
        await browser_manager.human_delay(2, 3)
        
        # 4. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
        log.info("\n4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...")
        is_logged_in = await browser_manager._check_logged_in_strict()
        if not is_logged_in:
            log.info("–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...")
            success = await browser_manager.login_to_pipiads()
            if not success:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è")
                return
            await browser_manager.save_cookies()
        else:
            log.info("‚úÖ –£–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω")
        
        # 5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine
        log.info("\n5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine...")
        parser = ParserEngine(browser_manager.page)
        parser.set_browser_manager(browser_manager)
        
        # 6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets (–¥–æ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤)
        log.info("\n6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets...")
        sheets_writer = None
        try:
            sheets_writer = SheetsWriter()
            if sheets_writer.connect():
                log.info("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets —É—Å–ø–µ—à–Ω–æ")
            else:
                log.warning("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Google Sheets, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        except Exception as e:
            log.warning(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Google Sheets: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        
        # 7. –¶–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        log.info("\n" + "=" * 80)
        log.info("7. –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–û–í")
        log.info("=" * 80)
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        # –£–°–õ–ê–ë–õ–ï–ù–û –¥–ª—è —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏: —Å–Ω–∏–∂–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
        MIN_PRODUCTS_TO_COLLECT = 3   # –¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–º–æ–∂–Ω–æ —Å–Ω–∏–∑–∏—Ç—å –¥–æ 1-2)
        MAX_PRODUCTS_TO_CHECK = 15     # –ú–∞–∫—Å–∏–º—É–º —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é (—É–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –≤—ã–±–æ—Ä–∞)
        PRODUCTS_PER_PAGE = 20         # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        
        successful_products = 0  # –°—á–µ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        checked_products = 0      # –°—á–µ—Ç—á–∏–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        skipped_products = []     # –°–ø–∏—Å–æ–∫ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        banned_products = set()   # Ban-list: URL —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ)
        all_products_analytics = []  # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –í–°–ï–• —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è summary-—Ñ–∞–π–ª–∞
        
        def normalize_url(url: str) -> str:
            """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL (—É–±—Ä–∞—Ç—å —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É)"""
            if not url:
                return ""
            url = url.strip().rstrip('/')
            # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if '?' in url:
                url = url.split('?')[0]
            return url
        
        # –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏
        while successful_products < MIN_PRODUCTS_TO_COLLECT and checked_products < MAX_PRODUCTS_TO_CHECK:
            
            # 7.1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
            log.info(f"\n{'='*80}")
            log.info(f"–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã...")
            log.info(f"–ü—Ä–æ–≥—Ä–µ—Å—Å: {successful_products}/{MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ, "
                    f"{checked_products}/{MAX_PRODUCTS_TO_CHECK} –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ")
            log.info(f"{'='*80}")
            
            try:
                products = await parser.get_products_from_search_page(count=PRODUCTS_PER_PAGE)
            except Exception as e:
                log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
                break
            
            if not products:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã, –∑–∞–≤–µ—Ä—à–∞–µ–º")
                break
            
            log.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
            
            # 7.1.5. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ URL (–ø—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è)
            # –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º banned_products –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
            unique_products = []
            duplicate_count = 0
            seen_urls = set()  # –î–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
            
            for product in products:
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ü—Ä–æ–ø—É—Å–∫ —Ç–æ–≤–∞—Ä–∞ –±–µ–∑ URL")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ç–∏–≤ banned_products (—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)
                if product_url in banned_products:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (—É–∂–µ –≤ ban-list): {product_url}")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
                if product_url in seen_urls:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (–≤ —Ç–µ–∫—É—â–µ–º —Å–ø–∏—Å–∫–µ): {product_url}")
                    continue
                
                seen_urls.add(product_url)
                # –û–±–Ω–æ–≤–ª—è–µ–º URL –≤ —Å–ª–æ–≤–∞—Ä–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π
                product['url'] = product_url
                unique_products.append(product)
            
            if duplicate_count > 0:
                log.info(f"üîç –ù–∞–π–¥–µ–Ω–æ {duplicate_count} –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, –æ—Å—Ç–∞–≤–ª–µ–Ω–æ {len(unique_products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤")
            
            products = unique_products  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
            log.info(f"‚úÖ –ü–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏: {len(products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            
            # 7.2. –¶–∏–∫–ª –ø–æ —Ç–æ–≤–∞—Ä–∞–º –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            for product_index, product in enumerate(products):
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    log.info(f"\nüéØ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
                    break
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
                if checked_products >= MAX_PRODUCTS_TO_CHECK:
                    log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
                    break
                
                # ‚ö†Ô∏è –ü–†–û–í–ï–†–ö–ê BAN-LIST: –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å
                product_url = product.get('url', '').rstrip('/')  # –£–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ
                product_id = product.get('product_id') or extract_product_id(product_url)
                
                if not product_id:
                    log.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å product_id –∏–∑ URL: {product_url}, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                    continue
                
                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
                if product_id in banned_product_ids:
                    log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list (product_id={product_id}): {product_url}")
                    log.warning(f"   –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.")
                    continue
                
                # –û—Ç–º–µ—á–∞–µ–º —Ç–æ–≤–∞—Ä –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –°–†–ê–ó–£ (–¥–æ –∫–ª–∏–∫–∞) - —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–≤–∞–∂–¥—ã
                banned_product_ids.add(product_id)
                log.info(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: product_id={product_id}, url={product_url}")
                
                checked_products += 1
                
                # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–∞
                log.info(f"\n{'='*80}")
                log.info(f"üì¶ –¢–û–í–ê–† {checked_products}/{MAX_PRODUCTS_TO_CHECK} "
                        f"(—É—Å–ø–µ—à–Ω—ã—Ö: {successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                log.info(f"{'='*80}")
                log.info(f"–ù–∞–∑–≤–∞–Ω–∏–µ: {product.get('name', 'N/A')[:70]}...")
                log.info(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {product.get('category', 'N/A')}")
                log.info(f"URL: {product.get('url', 'N/A')}")
                log.info(f"Product ID: {product_id}")
                
                try:
                    # 7.3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ (–∫–ª–∏–∫ –ø–æ –∏–Ω–¥–µ–∫—Å—É, –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞)
                    # –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥–∞–µ–º banned_product_ids –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
                    product_data = await parser.get_product_details_with_return(
                        product_index=product_index,
                        sheets_writer=sheets_writer,
                        banned_product_ids=banned_product_ids
                    )
                    
                    # 7.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    if product_data is None:
                        # –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
                        log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞")
                        
                        skipped_products.append({
                            "name": product.get('name', 'N/A'),
                            "reason": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ",
                            "videos_found": 0
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ)
                        all_products_analytics.append({
                            "product_name": product.get('name', 'N/A'),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": 0,
                            "top_3_videos": []
                        })
                        continue
                    
                    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç (–µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª—Å—è —Å—Ç–∞—Ç—É—Å "duplicate")
                    if isinstance(product_data, dict) and product_data.get("status") == "duplicate":
                        log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç, product_id={product_data.get('product_id')})")
                        duplicate_count += 1
                        continue
                    
                    if isinstance(product_data, dict) and product_data.get("status") == "insufficient_videos":
                        # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                        log.warning(f"‚è≠Ô∏è  –ü–†–û–ü–£–°–ö: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù–∞–π–¥–µ–Ω–æ: {product_data.get('videos_found', 0)} –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù—É–∂–Ω–æ: {product_data.get('videos_required', 3)} –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": product_data.get('product_name', product.get('name', 'N/A')),
                            "reason": product_data.get('reason', '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ'),
                            "videos_found": product_data.get('videos_found', 0)
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ - —Ç–æ–≤–∞—Ä –≤–µ—Ä–Ω—É–ª insufficient_videos)
                        all_products_analytics.append({
                            "product_name": product_data.get('product_name', product.get('name', 'N/A')),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": product_data.get('videos_found', 0),
                            "top_3_videos": []  # –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–ø-3
                        })
                        continue
                    
                    # 7.5. –°–±–æ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è summary
                    analytics_entry = {
                        "product_name": getattr(product_data, 'product_name', 'N/A'),
                        "product_url": getattr(product_data, 'pipiads_link', product_url),
                        "success": False,
                        "videos_found": len(getattr(product_data, 'videos', [])),
                        "top_3_videos": []
                    }
                    
                    # –ò–∑–≤–ª–µ–∫–∞–µ–º –¢–û–ü-3 –≤–∏–¥–µ–æ (–ø–æ impression) –∏–∑ –í–°–ï–• –≤–∏–¥–µ–æ
                    if hasattr(product_data, '_all_videos_raw'):
                        all_videos = product_data._all_videos_raw
                        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ impression (desc) –∏ –±–µ—Ä–µ–º —Ç–æ–ø-3
                        sorted_videos = sorted(all_videos, key=lambda v: v.get('impression', 0), reverse=True)
                        for i, video in enumerate(sorted_videos[:3], 1):
                            analytics_entry["top_3_videos"].append({
                                "rank": i,
                                "impression": video.get('impression', 0),
                                "first_seen": video.get('first_seen', 'N/A'),
                                "ad_search_url": video.get('ad_search_url', 'N/A')
                            })
                    
                    # 7.6. –£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞
                    if hasattr(product_data, 'videos') and len(product_data.videos) >= 3:
                        successful_products += 1
                        analytics_entry["success"] = True
                        
                        log.info(f"\n‚úÖ –£–°–ü–ï–•! –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω ({successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                        log.info(f"   –ù–∞–∑–≤–∞–Ω–∏–µ: {product_data.product_name[:70]}...")
                        log.info(f"   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ: {len(product_data.videos)}")
                        
                        # –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                        for i, video in enumerate(product_data.videos[:3], 1):
                            log.info(f"   –í–∏–¥–µ–æ {i}: {video.get('impression', 0)} impressions, "
                                    f"{video.get('country', 'N/A')}, {video.get('audience_age', 'N/A')}")
                        
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ –∏ –∫–æ–ø–∏—Ä—É–µ–º –≤ "–£—Å–ø–µ—à–Ω—ã–µ" –µ—Å–ª–∏ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                        if sheets_writer and hasattr(product_data, '_sheets_row'):
                            try:
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã A-Z (–∫—Ä–æ–º–µ C) –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                                if sheets_writer.is_row_complete(product_data._sheets_row):
                                    sheets_writer.copy_to_success_sheet(product_data._sheets_row)
                                    log.info(f"  ‚úÖ –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ ‚Üí —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ '–£—Å–ø–µ—à–Ω—ã–µ'")
                                else:
                                    log.warning(f"  ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ (–µ—Å—Ç—å –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏)")
                            except Exception as e:
                                log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ '–£—Å–ø–µ—à–Ω—ã–µ': {e}")
                    
                    # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
                    all_products_analytics.append(analytics_entry)
                    
                    # 7.7. –ï—Å–ª–∏ –≤–∏–¥–µ–æ –º–µ–Ω—å—à–µ 3 - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                    if not analytics_entry["success"]:
                        log.warning(f"‚ö†Ô∏è –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω, –Ω–æ –º–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": getattr(product_data, 'product_name', product.get('name', 'N/A')),
                            "reason": "–ú–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏",
                            "videos_found": len(getattr(product_data, 'videos', []))
                        })
                
                except Exception as e:
                    log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞: {e}")
                    import traceback
                    log.error(traceback.format_exc())
                    
                    skipped_products.append({
                        "name": product.get('name', 'N/A'),
                        "reason": f"–ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {str(e)[:50]}",
                        "videos_found": 0
                    })
            
            # 7.6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –≤—ã—Ö–æ–¥–∞ –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
            if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                break
            
            if checked_products >= MAX_PRODUCTS_TO_CHECK:
                break
        
        # 8. –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç
        log.info(f"\n{'='*80}")
        log.info("üìä –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢")
        log.info(f"{'='*80}")
        log.info(f"‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {successful_products}")
        log.info(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {len(skipped_products)}")
        log.info(f"üîç –í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {checked_products}")
        log.info(f"üö´ –¢–æ–≤–∞—Ä–æ–≤ –≤ ban-list: {len(banned_product_ids)}")
        log.info(f"{'='*80}")
        
        # –í—ã–≤–æ–¥ ban-list
        if banned_product_ids:
            log.info(f"\nüö´ BAN-LIST (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ product_id):")
            for i, product_id in enumerate(sorted(banned_product_ids), 1):
                log.info(f"   {i}. {product_id}")
        
        if skipped_products:
            log.info(f"\n‚è≠Ô∏è  –°–ü–ò–°–û–ö –ü–†–û–ü–£–©–ï–ù–ù–´–• –¢–û–í–ê–†–û–í:")
            for i, skipped in enumerate(skipped_products, 1):
                log.info(f"   {i}. {skipped['name'][:60]}...")
                log.info(f"      –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}")
                log.info(f"      –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}")
        
        if successful_products >= MIN_PRODUCTS_TO_COLLECT:
            log.info(f"\nüéâ –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
        elif checked_products >= MAX_PRODUCTS_TO_CHECK:
            log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
            log.warning(f"   –°–æ–±—Ä–∞–Ω–æ —Ç–æ–ª—å–∫–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ {MIN_PRODUCTS_TO_COLLECT}")
        
        # 9. –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
        log.info("\n" + "=" * 60)
        log.info("üìù –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –≤–∏–¥–µ–æ...")
        log.info("=" * 60)
        try:
            from datetime import datetime
            import os
            
            summary_dir = "logs/summaries"
            os.makedirs(summary_dir, exist_ok=True)
            
            timestamp = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
            summary_file = f"{summary_dir}/iteration_{timestamp}.md"
            
            with open(summary_file, "w", encoding="utf-8") as f:
                f.write(f"# üìä –ò—Ç–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
                
                f.write("## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã\n\n")
                f.write(f"- **–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ:** {successful_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–ø—É—â–µ–Ω–æ:** {len(skipped_products)} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** {checked_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **Ban-list:** {len(banned_product_ids)} —Ç–æ–≤–∞—Ä–æ–≤\n\n")
                
                if successful_products > 0:
                    f.write("### üéâ SUCCESS\n\n")
                    f.write(f"‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ —Å >= 3 –≤–∏–¥–µ–æ\n\n")
                
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                # –ù–û–í–´–ô –ë–õ–û–ö: –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                if all_products_analytics:
                    f.write("---\n\n")
                    f.write("## üìπ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º\n\n")
                    f.write(f"**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:** >= 5K impressions, –≤–æ–∑—Ä–∞—Å—Ç <= 30 –¥–Ω–µ–π\n\n")
                    
                    for idx, product in enumerate(all_products_analytics, 1):
                        status_icon = "‚úÖ" if product["success"] else "‚ùå"
                        f.write(f"### {status_icon} –¢–æ–≤–∞—Ä #{idx}: {product['product_name'][:80]}\n\n")
                        f.write(f"- **–°—Å—ã–ª–∫–∞:** [{product['product_url']}]({product['product_url']})\n")
                        f.write(f"- **–°—Ç–∞—Ç—É—Å:** {'–£–°–ü–ï–• (>= 3 –≤–∏–¥–µ–æ)' if product['success'] else '–ü–†–û–ü–£–©–ï–ù (< 3 –≤–∏–¥–µ–æ)'}\n")
                        f.write(f"- **–ù–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ:** {product['videos_found']}\n\n")
                        
                        # –¢–û–ü-3 –≤–∏–¥–µ–æ (–¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –∫—Ä–∏—Ç–µ—Ä–∏–∏)
                        if product['top_3_videos']:
                            f.write("#### üèÜ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ impression:\n\n")
                            for video in product['top_3_videos']:
                                impression = video['impression']
                                first_seen = video['first_seen']
                                ad_url = video['ad_search_url']
                                
                                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
                                meets_criteria = impression >= 5000  # –ü—Ä–æ–≤–µ—Ä–∫–∞ impression
                                criteria_icon = "‚úÖ" if meets_criteria else "‚ö†Ô∏è"
                                
                                f.write(f"{video['rank']}. {criteria_icon} **{impression:,} impressions** | "
                                       f"First seen: {first_seen}\n")
                                if ad_url and ad_url != 'N/A':
                                    f.write(f"   - –°—Å—ã–ª–∫–∞: [{ad_url}]({ad_url})\n")
                                f.write("\n")
                        else:
                            f.write("   ‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ (–≤–æ–∑–º–æ–∂–Ω–æ, –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞)\n\n")
                        
                        f.write("---\n\n")
                
                # –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
                if skipped_products:
                    f.write("### ‚è≠Ô∏è –ü–†–û–ü–£–©–ï–ù–ù–´–ï –¢–û–í–ê–†–´ (–∫—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫)\n\n")
                    for i, skipped in enumerate(skipped_products, 1):
                        f.write(f"{i}. **{skipped['name'][:60]}...**\n")
                        f.write(f"   - –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}\n")
                        f.write(f"   - –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}\n\n")
                
                # Ban-list
                if banned_product_ids:
                    f.write("### üö´ Ban-list (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ product_id)\n\n")
                    for i, product_id in enumerate(sorted(banned_product_ids), 1):
                        f.write(f"{i}. `{product_id}`\n")
                    f.write("\n")
                
                f.write("## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏\n\n")
                f.write(f"- **–¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:** {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–õ–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫:** {MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤–∏–¥–µ–æ:** >= 5K impressions, <= 30 –¥–Ω–µ–π\n\n")
                
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    f.write("## üéØ –°—Ç–∞—Ç—É—Å: –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê ‚úÖ\n\n")
                elif checked_products >= MAX_PRODUCTS_TO_CHECK:
                    f.write("## ‚ö†Ô∏è –°—Ç–∞—Ç—É—Å: –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫\n\n")
                else:
                    f.write("## ‚ùå –°—Ç–∞—Ç—É—Å: –ü—Ä–µ—Ä–≤–∞–Ω–æ\n\n")
            
            log.info(f"‚úÖ Summary —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {summary_file}")
        except Exception as e:
            log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ summary: {e}")
            import traceback
            log.error(traceback.format_exc())
        
        log.info("\n" + "=" * 60)
        log.info("‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û")
        log.info("=" * 60)
        
        # –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)
        log.info("\n‚è∏Ô∏è –û–∂–∏–¥–∞–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –±—Ä–∞—É–∑–µ—Ä–∞ (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)...")
        log.info("   –ù–∞–∂–º–∏—Ç–µ Ctrl+C, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å —Ä–∞–Ω—å—à–µ")
        try:
            await asyncio.sleep(10)
        except KeyboardInterrupt:
            log.info("   –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        
    except KeyboardInterrupt:
        log.warning("\n‚ö†Ô∏è –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Ctrl+C)")
    except Exception as e:
        log.error(f"\n{'='*60}")
        log.error(f"‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}")
        log.error(f"{'='*60}")
        import traceback
        log.error("–ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:")
        log.error(traceback.format_exc())
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
        if browser_manager and browser_manager.page:
            try:
                screenshot_path = config.SCREENSHOTS_DIR / f"error_test_{int(asyncio.get_event_loop().time())}.png"
                await browser_manager.page.screenshot(path=str(screenshot_path), full_page=True)
                log.info(f"üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {screenshot_path}")
            except Exception as e2:
                log.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç: {e2}")
        
        log.error("\n‚ö†Ô∏è –ë—Ä–∞—É–∑–µ—Ä –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞ 30 —Å–µ–∫—É–Ω–¥...")
        try:
            await asyncio.sleep(30)
        except:
            pass
    
    finally:
        if browser_manager:
            await browser_manager.close()


if __name__ == "__main__":
    asyncio.run(test_parser_engine())


```

```python
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Parser Engine
"""

import asyncio
import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ src
sys.path.insert(0, str(Path(__file__).parent))

from src.browser_manager import BrowserManager
from src.parser_engine import ParserEngine, ProductData
from src.sheets_writer import SheetsWriter
from src import config
from src import logger

log = logger.get_logger("TestParserEngine")


async def test_parser_engine():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Parser Engine"""
    
    browser_manager = None
    try:
        log.info("=" * 60)
        log.info("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï PARSER ENGINE")
        log.info("=" * 60)
        
        # 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
        log.info("\n1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞...")
        browser_manager = BrowserManager()
        success = await browser_manager.initialize(headless=False)  # headful –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä")
            return
        
        # 2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies (–µ—Å–ª–∏ –µ—Å—Ç—å)
        log.info("\n2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies...")
        await browser_manager.load_cookies()
        
        # 3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–∞—á–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads
        log.info("\n3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads...")
        success = await browser_manager.navigate_with_retry(
            config.PIPIADS_INITIAL_URL,
            wait_until="domcontentloaded",
            timeout=30000
        )
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É")
            return
        
        await browser_manager.human_delay(2, 3)
        
        # 4. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
        log.info("\n4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...")
        is_logged_in = await browser_manager._check_logged_in_strict()
        if not is_logged_in:
            log.info("–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...")
            success = await browser_manager.login_to_pipiads()
            if not success:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è")
                return
            await browser_manager.save_cookies()
        else:
            log.info("‚úÖ –£–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω")
        
        # 5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine
        log.info("\n5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine...")
        parser = ParserEngine(browser_manager.page)
        parser.set_browser_manager(browser_manager)
        
        # 6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets (–¥–æ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤)
        log.info("\n6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets...")
        sheets_writer = None
        try:
            sheets_writer = SheetsWriter()
            if sheets_writer.connect():
                log.info("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets —É—Å–ø–µ—à–Ω–æ")
            else:
                log.warning("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Google Sheets, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        except Exception as e:
            log.warning(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Google Sheets: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        
        # 7. –¶–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        log.info("\n" + "=" * 80)
        log.info("7. –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–û–í")
        log.info("=" * 80)
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        # –£–°–õ–ê–ë–õ–ï–ù–û –¥–ª—è —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏: —Å–Ω–∏–∂–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
        MIN_PRODUCTS_TO_COLLECT = 3   # –¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–º–æ–∂–Ω–æ —Å–Ω–∏–∑–∏—Ç—å –¥–æ 1-2)
        MAX_PRODUCTS_TO_CHECK = 15     # –ú–∞–∫—Å–∏–º—É–º —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é (—É–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –≤—ã–±–æ—Ä–∞)
        PRODUCTS_PER_PAGE = 20         # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        
        successful_products = 0  # –°—á–µ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        checked_products = 0      # –°—á–µ—Ç—á–∏–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        skipped_products = []     # –°–ø–∏—Å–æ–∫ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        banned_products = set()   # Ban-list: URL —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ)
        all_products_analytics = []  # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –í–°–ï–• —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è summary-—Ñ–∞–π–ª–∞
        
        def normalize_url(url: str) -> str:
            """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL (—É–±—Ä–∞—Ç—å —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É)"""
            if not url:
                return ""
            url = url.strip().rstrip('/')
            # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if '?' in url:
                url = url.split('?')[0]
            return url
        
        # –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏
        while successful_products < MIN_PRODUCTS_TO_COLLECT and checked_products < MAX_PRODUCTS_TO_CHECK:
            
            # 7.1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
            log.info(f"\n{'='*80}")
            log.info(f"–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã...")
            log.info(f"–ü—Ä–æ–≥—Ä–µ—Å—Å: {successful_products}/{MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ, "
                    f"{checked_products}/{MAX_PRODUCTS_TO_CHECK} –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ")
            log.info(f"{'='*80}")
            
            try:
                products = await parser.get_products_from_search_page(count=PRODUCTS_PER_PAGE)
            except Exception as e:
                log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
                break
            
            if not products:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã, –∑–∞–≤–µ—Ä—à–∞–µ–º")
                break
            
            log.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
            
            # 7.1.5. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ URL (–ø—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è)
            # –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º banned_products –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
            unique_products = []
            duplicate_count = 0
            seen_urls = set()  # –î–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
            
            for product in products:
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ü—Ä–æ–ø—É—Å–∫ —Ç–æ–≤–∞—Ä–∞ –±–µ–∑ URL")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ç–∏–≤ banned_products (—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)
                if product_url in banned_products:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (—É–∂–µ –≤ ban-list): {product_url}")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
                if product_url in seen_urls:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (–≤ —Ç–µ–∫—É—â–µ–º —Å–ø–∏—Å–∫–µ): {product_url}")
                    continue
                
                seen_urls.add(product_url)
                # –û–±–Ω–æ–≤–ª—è–µ–º URL –≤ —Å–ª–æ–≤–∞—Ä–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π
                product['url'] = product_url
                unique_products.append(product)
            
            if duplicate_count > 0:
                log.info(f"üîç –ù–∞–π–¥–µ–Ω–æ {duplicate_count} –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, –æ—Å—Ç–∞–≤–ª–µ–Ω–æ {len(unique_products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤")
            
            products = unique_products  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
            log.info(f"‚úÖ –ü–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏: {len(products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            
            # 7.2. –¶–∏–∫–ª –ø–æ —Ç–æ–≤–∞—Ä–∞–º –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            for product_index, product in enumerate(products):
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    log.info(f"\nüéØ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
                    break
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
                if checked_products >= MAX_PRODUCTS_TO_CHECK:
                    log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
                    break
                
                # ‚ö†Ô∏è –ü–†–û–í–ï–†–ö–ê BAN-LIST: –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                    continue
                
                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
                if product_url in banned_products:
                    log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: {product_url}")
                    log.warning(f"   –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.")
                    continue
                
                # –û—Ç–º–µ—á–∞–µ–º —Ç–æ–≤–∞—Ä –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –°–†–ê–ó–£ (–¥–æ –∫–ª–∏–∫–∞) - —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–≤–∞–∂–¥—ã
                banned_products.add(product_url)
                log.info(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: {product_url}")
                
                checked_products += 1
                
                # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–∞
                log.info(f"\n{'='*80}")
                log.info(f"üì¶ –¢–û–í–ê–† {checked_products}/{MAX_PRODUCTS_TO_CHECK} "
                        f"(—É—Å–ø–µ—à–Ω—ã—Ö: {successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                log.info(f"{'='*80}")
                log.info(f"–ù–∞–∑–≤–∞–Ω–∏–µ: {product.get('name', 'N/A')[:70]}...")
                log.info(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {product.get('category', 'N/A')}")
                log.info(f"URL: {product.get('url', 'N/A')}")
                log.info(f"Product ID: {product_id}")
                
                try:
                    # 7.3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ (–∫–ª–∏–∫ –ø–æ –∏–Ω–¥–µ–∫—Å—É, –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞)
                    # –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥–∞–µ–º banned_product_ids –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
                    product_data = await parser.get_product_details_with_return(
                        product_index=product_index,
                        sheets_writer=sheets_writer,
                        banned_product_ids=banned_product_ids
                    )
                    
                    # 7.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    if product_data is None:
                        # –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
                        log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞")
                        
                        skipped_products.append({
                            "name": product.get('name', 'N/A'),
                            "reason": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ",
                            "videos_found": 0
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ)
                        all_products_analytics.append({
                            "product_name": product.get('name', 'N/A'),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": 0,
                            "top_3_videos": []
                        })
                        continue
                    
                    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç (–µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª—Å—è —Å—Ç–∞—Ç—É—Å "duplicate")
                    if isinstance(product_data, dict) and product_data.get("status") == "duplicate":
                        log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç, product_id={product_data.get('product_id')})")
                        duplicate_count += 1
                        continue
                    
                    if isinstance(product_data, dict) and product_data.get("status") == "insufficient_videos":
                        # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                        log.warning(f"‚è≠Ô∏è  –ü–†–û–ü–£–°–ö: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù–∞–π–¥–µ–Ω–æ: {product_data.get('videos_found', 0)} –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù—É–∂–Ω–æ: {product_data.get('videos_required', 3)} –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": product_data.get('product_name', product.get('name', 'N/A')),
                            "reason": product_data.get('reason', '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ'),
                            "videos_found": product_data.get('videos_found', 0)
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ - —Ç–æ–≤–∞—Ä –≤–µ—Ä–Ω—É–ª insufficient_videos)
                        all_products_analytics.append({
                            "product_name": product_data.get('product_name', product.get('name', 'N/A')),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": product_data.get('videos_found', 0),
                            "top_3_videos": []  # –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–ø-3
                        })
                        continue
                    
                    # 7.5. –°–±–æ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è summary
                    analytics_entry = {
                        "product_name": getattr(product_data, 'product_name', 'N/A'),
                        "product_url": getattr(product_data, 'pipiads_link', product_url),
                        "success": False,
                        "videos_found": len(getattr(product_data, 'videos', [])),
                        "top_3_videos": []
                    }
                    
                    # –ò–∑–≤–ª–µ–∫–∞–µ–º –¢–û–ü-3 –≤–∏–¥–µ–æ (–ø–æ impression) –∏–∑ –í–°–ï–• –≤–∏–¥–µ–æ
                    if hasattr(product_data, '_all_videos_raw'):
                        all_videos = product_data._all_videos_raw
                        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ impression (desc) –∏ –±–µ—Ä–µ–º —Ç–æ–ø-3
                        sorted_videos = sorted(all_videos, key=lambda v: v.get('impression', 0), reverse=True)
                        for i, video in enumerate(sorted_videos[:3], 1):
                            analytics_entry["top_3_videos"].append({
                                "rank": i,
                                "impression": video.get('impression', 0),
                                "first_seen": video.get('first_seen', 'N/A'),
                                "ad_search_url": video.get('ad_search_url', 'N/A')
                            })
                    
                    # 7.6. –£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞
                    if hasattr(product_data, 'videos') and len(product_data.videos) >= 3:
                        successful_products += 1
                        analytics_entry["success"] = True
                        
                        log.info(f"\n‚úÖ –£–°–ü–ï–•! –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω ({successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                        log.info(f"   –ù–∞–∑–≤–∞–Ω–∏–µ: {product_data.product_name[:70]}...")
                        log.info(f"   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ: {len(product_data.videos)}")
                        
                        # –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                        for i, video in enumerate(product_data.videos[:3], 1):
                            log.info(f"   –í–∏–¥–µ–æ {i}: {video.get('impression', 0)} impressions, "
                                    f"{video.get('country', 'N/A')}, {video.get('audience_age', 'N/A')}")
                        
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ –∏ –∫–æ–ø–∏—Ä—É–µ–º –≤ "–£—Å–ø–µ—à–Ω—ã–µ" –µ—Å–ª–∏ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                        if sheets_writer and hasattr(product_data, '_sheets_row'):
                            try:
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã A-Z (–∫—Ä–æ–º–µ C) –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                                if sheets_writer.is_row_complete(product_data._sheets_row):
                                    sheets_writer.copy_to_success_sheet(product_data._sheets_row)
                                    log.info(f"  ‚úÖ –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ ‚Üí —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ '–£—Å–ø–µ—à–Ω—ã–µ'")
                                else:
                                    log.warning(f"  ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ (–µ—Å—Ç—å –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏)")
                            except Exception as e:
                                log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ '–£—Å–ø–µ—à–Ω—ã–µ': {e}")
                    
                    # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
                    all_products_analytics.append(analytics_entry)
                    
                    # 7.7. –ï—Å–ª–∏ –≤–∏–¥–µ–æ –º–µ–Ω—å—à–µ 3 - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                    if not analytics_entry["success"]:
                        log.warning(f"‚ö†Ô∏è –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω, –Ω–æ –º–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": getattr(product_data, 'product_name', product.get('name', 'N/A')),
                            "reason": "–ú–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏",
                            "videos_found": len(getattr(product_data, 'videos', []))
                        })
                
                except Exception as e:
                    log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞: {e}")
                    import traceback
                    log.error(traceback.format_exc())
                    
                    skipped_products.append({
                        "name": product.get('name', 'N/A'),
                        "reason": f"–ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {str(e)[:50]}",
                        "videos_found": 0
                    })
            
            # 7.6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –≤—ã—Ö–æ–¥–∞ –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
            if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                break
            
            if checked_products >= MAX_PRODUCTS_TO_CHECK:
                break
        
        # 8. –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç
        log.info(f"\n{'='*80}")
        log.info("üìä –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢")
        log.info(f"{'='*80}")
        log.info(f"‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {successful_products}")
        log.info(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {len(skipped_products)}")
        log.info(f"üîç –í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {checked_products}")
        log.info(f"üö´ –¢–æ–≤–∞—Ä–æ–≤ –≤ ban-list: {len(banned_product_ids)}")
        log.info(f"{'='*80}")
        
        # –í—ã–≤–æ–¥ ban-list
        if banned_product_ids:
            log.info(f"\nüö´ BAN-LIST (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ product_id):")
            for i, product_id in enumerate(sorted(banned_product_ids), 1):
                log.info(f"   {i}. {product_id}")
        
        if skipped_products:
            log.info(f"\n‚è≠Ô∏è  –°–ü–ò–°–û–ö –ü–†–û–ü–£–©–ï–ù–ù–´–• –¢–û–í–ê–†–û–í:")
            for i, skipped in enumerate(skipped_products, 1):
                log.info(f"   {i}. {skipped['name'][:60]}...")
                log.info(f"      –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}")
                log.info(f"      –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}")
        
        if successful_products >= MIN_PRODUCTS_TO_COLLECT:
            log.info(f"\nüéâ –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
        elif checked_products >= MAX_PRODUCTS_TO_CHECK:
            log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
            log.warning(f"   –°–æ–±—Ä–∞–Ω–æ —Ç–æ–ª—å–∫–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ {MIN_PRODUCTS_TO_COLLECT}")
        
        # 9. –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
        log.info("\n" + "=" * 60)
        log.info("üìù –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –≤–∏–¥–µ–æ...")
        log.info("=" * 60)
        try:
            from datetime import datetime
            import os
            
            summary_dir = "logs/summaries"
            os.makedirs(summary_dir, exist_ok=True)
            
            timestamp = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
            summary_file = f"{summary_dir}/iteration_{timestamp}.md"
            
            with open(summary_file, "w", encoding="utf-8") as f:
                f.write(f"# üìä –ò—Ç–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
                
                f.write("## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã\n\n")
                f.write(f"- **–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ:** {successful_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–ø—É—â–µ–Ω–æ:** {len(skipped_products)} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** {checked_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **Ban-list:** {len(banned_product_ids)} —Ç–æ–≤–∞—Ä–æ–≤\n\n")
                
                if successful_products > 0:
                    f.write("### üéâ SUCCESS\n\n")
                    f.write(f"‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ —Å >= 3 –≤–∏–¥–µ–æ\n\n")
                
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                # –ù–û–í–´–ô –ë–õ–û–ö: –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                if all_products_analytics:
                    f.write("---\n\n")
                    f.write("## üìπ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º\n\n")
                    f.write(f"**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:** >= 5K impressions, –≤–æ–∑—Ä–∞—Å—Ç <= 30 –¥–Ω–µ–π\n\n")
                    
                    for idx, product in enumerate(all_products_analytics, 1):
                        status_icon = "‚úÖ" if product["success"] else "‚ùå"
                        f.write(f"### {status_icon} –¢–æ–≤–∞—Ä #{idx}: {product['product_name'][:80]}\n\n")
                        f.write(f"- **–°—Å—ã–ª–∫–∞:** [{product['product_url']}]({product['product_url']})\n")
                        f.write(f"- **–°—Ç–∞—Ç—É—Å:** {'–£–°–ü–ï–• (>= 3 –≤–∏–¥–µ–æ)' if product['success'] else '–ü–†–û–ü–£–©–ï–ù (< 3 –≤–∏–¥–µ–æ)'}\n")
                        f.write(f"- **–ù–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ:** {product['videos_found']}\n\n")
                        
                        # –¢–û–ü-3 –≤–∏–¥–µ–æ (–¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –∫—Ä–∏—Ç–µ—Ä–∏–∏)
                        if product['top_3_videos']:
                            f.write("#### üèÜ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ impression:\n\n")
                            for video in product['top_3_videos']:
                                impression = video['impression']
                                first_seen = video['first_seen']
                                ad_url = video['ad_search_url']
                                
                                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
                                meets_criteria = impression >= 5000  # –ü—Ä–æ–≤–µ—Ä–∫–∞ impression
                                criteria_icon = "‚úÖ" if meets_criteria else "‚ö†Ô∏è"
                                
                                f.write(f"{video['rank']}. {criteria_icon} **{impression:,} impressions** | "
                                       f"First seen: {first_seen}\n")
                                if ad_url and ad_url != 'N/A':
                                    f.write(f"   - –°—Å—ã–ª–∫–∞: [{ad_url}]({ad_url})\n")
                                f.write("\n")
                        else:
                            f.write("   ‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ (–≤–æ–∑–º–æ–∂–Ω–æ, –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞)\n\n")
                        
                        f.write("---\n\n")
                
                # –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
                if skipped_products:
                    f.write("### ‚è≠Ô∏è –ü–†–û–ü–£–©–ï–ù–ù–´–ï –¢–û–í–ê–†–´ (–∫—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫)\n\n")
                    for i, skipped in enumerate(skipped_products, 1):
                        f.write(f"{i}. **{skipped['name'][:60]}...**\n")
                        f.write(f"   - –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}\n")
                        f.write(f"   - –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}\n\n")
                
                # Ban-list
                if banned_product_ids:
                    f.write("### üö´ Ban-list (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ product_id)\n\n")
                    for i, product_id in enumerate(sorted(banned_product_ids), 1):
                        f.write(f"{i}. `{product_id}`\n")
                    f.write("\n")
                
                f.write("## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏\n\n")
                f.write(f"- **–¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:** {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–õ–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫:** {MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤–∏–¥–µ–æ:** >= 5K impressions, <= 30 –¥–Ω–µ–π\n\n")
                
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    f.write("## üéØ –°—Ç–∞—Ç—É—Å: –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê ‚úÖ\n\n")
                elif checked_products >= MAX_PRODUCTS_TO_CHECK:
                    f.write("## ‚ö†Ô∏è –°—Ç–∞—Ç—É—Å: –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫\n\n")
                else:
                    f.write("## ‚ùå –°—Ç–∞—Ç—É—Å: –ü—Ä–µ—Ä–≤–∞–Ω–æ\n\n")
            
            log.info(f"‚úÖ Summary —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {summary_file}")
        except Exception as e:
            log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ summary: {e}")
            import traceback
            log.error(traceback.format_exc())
        
        log.info("\n" + "=" * 60)
        log.info("‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û")
        log.info("=" * 60)
        
        # –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)
        log.info("\n‚è∏Ô∏è –û–∂–∏–¥–∞–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –±—Ä–∞—É–∑–µ—Ä–∞ (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)...")
        log.info("   –ù–∞–∂–º–∏—Ç–µ Ctrl+C, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å —Ä–∞–Ω—å—à–µ")
        try:
            await asyncio.sleep(10)
        except KeyboardInterrupt:
            log.info("   –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        
    except KeyboardInterrupt:
        log.warning("\n‚ö†Ô∏è –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Ctrl+C)")
    except Exception as e:
        log.error(f"\n{'='*60}")
        log.error(f"‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}")
        log.error(f"{'='*60}")
        import traceback
        log.error("–ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:")
        log.error(traceback.format_exc())
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
        if browser_manager and browser_manager.page:
            try:
                screenshot_path = config.SCREENSHOTS_DIR / f"error_test_{int(asyncio.get_event_loop().time())}.png"
                await browser_manager.page.screenshot(path=str(screenshot_path), full_page=True)
                log.info(f"üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {screenshot_path}")
            except Exception as e2:
                log.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç: {e2}")
        
        log.error("\n‚ö†Ô∏è –ë—Ä–∞—É–∑–µ—Ä –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞ 30 —Å–µ–∫—É–Ω–¥...")
        try:
            await asyncio.sleep(30)
        except:
            pass
    
    finally:
        if browser_manager:
            await browser_manager.close()


if __name__ == "__main__":
    asyncio.run(test_parser_engine())


```

```python
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Parser Engine
"""

import asyncio
import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ src
sys.path.insert(0, str(Path(__file__).parent))

from src.browser_manager import BrowserManager
from src.parser_engine import ParserEngine, ProductData
from src.sheets_writer import SheetsWriter
from src import config
from src import logger

log = logger.get_logger("TestParserEngine")


async def test_parser_engine():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Parser Engine"""
    
    browser_manager = None
    try:
        log.info("=" * 60)
        log.info("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï PARSER ENGINE")
        log.info("=" * 60)
        
        # 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
        log.info("\n1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞...")
        browser_manager = BrowserManager()
        success = await browser_manager.initialize(headless=False)  # headful –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä")
            return
        
        # 2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies (–µ—Å–ª–∏ –µ—Å—Ç—å)
        log.info("\n2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies...")
        await browser_manager.load_cookies()
        
        # 3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–∞—á–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads
        log.info("\n3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads...")
        success = await browser_manager.navigate_with_retry(
            config.PIPIADS_INITIAL_URL,
            wait_until="domcontentloaded",
            timeout=30000
        )
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É")
            return
        
        await browser_manager.human_delay(2, 3)
        
        # 4. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
        log.info("\n4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...")
        is_logged_in = await browser_manager._check_logged_in_strict()
        if not is_logged_in:
            log.info("–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...")
            success = await browser_manager.login_to_pipiads()
            if not success:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è")
                return
            await browser_manager.save_cookies()
        else:
            log.info("‚úÖ –£–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω")
        
        # 5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine
        log.info("\n5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine...")
        parser = ParserEngine(browser_manager.page)
        parser.set_browser_manager(browser_manager)
        
        # 6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets (–¥–æ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤)
        log.info("\n6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets...")
        sheets_writer = None
        try:
            sheets_writer = SheetsWriter()
            if sheets_writer.connect():
                log.info("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets —É—Å–ø–µ—à–Ω–æ")
            else:
                log.warning("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Google Sheets, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        except Exception as e:
            log.warning(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Google Sheets: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        
        # 7. –¶–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        log.info("\n" + "=" * 80)
        log.info("7. –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–û–í")
        log.info("=" * 80)
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        # –£–°–õ–ê–ë–õ–ï–ù–û –¥–ª—è —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏: —Å–Ω–∏–∂–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
        MIN_PRODUCTS_TO_COLLECT = 3   # –¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–º–æ–∂–Ω–æ —Å–Ω–∏–∑–∏—Ç—å –¥–æ 1-2)
        MAX_PRODUCTS_TO_CHECK = 15     # –ú–∞–∫—Å–∏–º—É–º —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é (—É–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –≤—ã–±–æ—Ä–∞)
        PRODUCTS_PER_PAGE = 20         # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        
        successful_products = 0  # –°—á–µ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        checked_products = 0      # –°—á–µ—Ç—á–∏–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        skipped_products = []     # –°–ø–∏—Å–æ–∫ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        banned_products = set()   # Ban-list: URL —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ)
        all_products_analytics = []  # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –í–°–ï–• —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è summary-—Ñ–∞–π–ª–∞
        
        def normalize_url(url: str) -> str:
            """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL (—É–±—Ä–∞—Ç—å —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É)"""
            if not url:
                return ""
            url = url.strip().rstrip('/')
            # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if '?' in url:
                url = url.split('?')[0]
            return url
        
        # –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏
        while successful_products < MIN_PRODUCTS_TO_COLLECT and checked_products < MAX_PRODUCTS_TO_CHECK:
            
            # 7.1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
            log.info(f"\n{'='*80}")
            log.info(f"–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã...")
            log.info(f"–ü—Ä–æ–≥—Ä–µ—Å—Å: {successful_products}/{MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ, "
                    f"{checked_products}/{MAX_PRODUCTS_TO_CHECK} –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ")
            log.info(f"{'='*80}")
            
            try:
                products = await parser.get_products_from_search_page(count=PRODUCTS_PER_PAGE)
            except Exception as e:
                log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
                break
            
            if not products:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã, –∑–∞–≤–µ—Ä—à–∞–µ–º")
                break
            
            log.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
            
            # 7.1.5. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ URL (–ø—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è)
            # –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º banned_products –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
            unique_products = []
            duplicate_count = 0
            seen_urls = set()  # –î–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
            
            for product in products:
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ü—Ä–æ–ø—É—Å–∫ —Ç–æ–≤–∞—Ä–∞ –±–µ–∑ URL")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ç–∏–≤ banned_products (—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)
                if product_url in banned_products:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (—É–∂–µ –≤ ban-list): {product_url}")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
                if product_url in seen_urls:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (–≤ —Ç–µ–∫—É—â–µ–º —Å–ø–∏—Å–∫–µ): {product_url}")
                    continue
                
                seen_urls.add(product_url)
                # –û–±–Ω–æ–≤–ª—è–µ–º URL –≤ —Å–ª–æ–≤–∞—Ä–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π
                product['url'] = product_url
                unique_products.append(product)
            
            if duplicate_count > 0:
                log.info(f"üîç –ù–∞–π–¥–µ–Ω–æ {duplicate_count} –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, –æ—Å—Ç–∞–≤–ª–µ–Ω–æ {len(unique_products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤")
            
            products = unique_products  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
            log.info(f"‚úÖ –ü–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏: {len(products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            
            # 7.2. –¶–∏–∫–ª –ø–æ —Ç–æ–≤–∞—Ä–∞–º –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            for product_index, product in enumerate(products):
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    log.info(f"\nüéØ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
                    break
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
                if checked_products >= MAX_PRODUCTS_TO_CHECK:
                    log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
                    break
                
                # ‚ö†Ô∏è –ü–†–û–í–ï–†–ö–ê BAN-LIST: –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                    continue
                
                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
                if product_url in banned_products:
                    log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: {product_url}")
                    log.warning(f"   –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.")
                    continue
                
                # –û—Ç–º–µ—á–∞–µ–º —Ç–æ–≤–∞—Ä –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –°–†–ê–ó–£ (–¥–æ –∫–ª–∏–∫–∞) - —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–≤–∞–∂–¥—ã
                banned_products.add(product_url)
                log.info(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: {product_url}")
                
                checked_products += 1
                
                # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–∞
                log.info(f"\n{'='*80}")
                log.info(f"üì¶ –¢–û–í–ê–† {checked_products}/{MAX_PRODUCTS_TO_CHECK} "
                        f"(—É—Å–ø–µ—à–Ω—ã—Ö: {successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                log.info(f"{'='*80}")
                log.info(f"–ù–∞–∑–≤–∞–Ω–∏–µ: {product.get('name', 'N/A')[:70]}...")
                log.info(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {product.get('category', 'N/A')}")
                log.info(f"URL: {product.get('url', 'N/A')}")
                log.info(f"Product ID: {product_id}")
                
                try:
                    # 7.3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ (–∫–ª–∏–∫ –ø–æ –∏–Ω–¥–µ–∫—Å—É, –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞)
                    # –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥–∞–µ–º banned_products –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
                    product_data = await parser.get_product_details_with_return(
                        product_index=product_index,
                        sheets_writer=sheets_writer,
                        banned_products=banned_products
                    )
                    
                    # 7.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    if product_data is None:
                        # –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
                        log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞")
                        
                        skipped_products.append({
                            "name": product.get('name', 'N/A'),
                            "reason": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ",
                            "videos_found": 0
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ)
                        all_products_analytics.append({
                            "product_name": product.get('name', 'N/A'),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": 0,
                            "top_3_videos": []
                        })
                        continue
                    
                    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç (–µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª—Å—è —Å—Ç–∞—Ç—É—Å "duplicate")
                    if isinstance(product_data, dict) and product_data.get("status") == "duplicate":
                        log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç, product_id={product_data.get('product_id')})")
                        duplicate_count += 1
                        continue
                    
                    if isinstance(product_data, dict) and product_data.get("status") == "insufficient_videos":
                        # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                        log.warning(f"‚è≠Ô∏è  –ü–†–û–ü–£–°–ö: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù–∞–π–¥–µ–Ω–æ: {product_data.get('videos_found', 0)} –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù—É–∂–Ω–æ: {product_data.get('videos_required', 3)} –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": product_data.get('product_name', product.get('name', 'N/A')),
                            "reason": product_data.get('reason', '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ'),
                            "videos_found": product_data.get('videos_found', 0)
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ - —Ç–æ–≤–∞—Ä –≤–µ—Ä–Ω—É–ª insufficient_videos)
                        all_products_analytics.append({
                            "product_name": product_data.get('product_name', product.get('name', 'N/A')),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": product_data.get('videos_found', 0),
                            "top_3_videos": []  # –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–ø-3
                        })
                        continue
                    
                    # 7.5. –°–±–æ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è summary
                    analytics_entry = {
                        "product_name": getattr(product_data, 'product_name', 'N/A'),
                        "product_url": getattr(product_data, 'pipiads_link', product_url),
                        "success": False,
                        "videos_found": len(getattr(product_data, 'videos', [])),
                        "top_3_videos": []
                    }
                    
                    # –ò–∑–≤–ª–µ–∫–∞–µ–º –¢–û–ü-3 –≤–∏–¥–µ–æ (–ø–æ impression) –∏–∑ –í–°–ï–• –≤–∏–¥–µ–æ
                    if hasattr(product_data, '_all_videos_raw'):
                        all_videos = product_data._all_videos_raw
                        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ impression (desc) –∏ –±–µ—Ä–µ–º —Ç–æ–ø-3
                        sorted_videos = sorted(all_videos, key=lambda v: v.get('impression', 0), reverse=True)
                        for i, video in enumerate(sorted_videos[:3], 1):
                            analytics_entry["top_3_videos"].append({
                                "rank": i,
                                "impression": video.get('impression', 0),
                                "first_seen": video.get('first_seen', 'N/A'),
                                "ad_search_url": video.get('ad_search_url', 'N/A')
                            })
                    
                    # 7.6. –£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞
                    if hasattr(product_data, 'videos') and len(product_data.videos) >= 3:
                        successful_products += 1
                        analytics_entry["success"] = True
                        
                        log.info(f"\n‚úÖ –£–°–ü–ï–•! –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω ({successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                        log.info(f"   –ù–∞–∑–≤–∞–Ω–∏–µ: {product_data.product_name[:70]}...")
                        log.info(f"   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ: {len(product_data.videos)}")
                        
                        # –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                        for i, video in enumerate(product_data.videos[:3], 1):
                            log.info(f"   –í–∏–¥–µ–æ {i}: {video.get('impression', 0)} impressions, "
                                    f"{video.get('country', 'N/A')}, {video.get('audience_age', 'N/A')}")
                        
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ –∏ –∫–æ–ø–∏—Ä—É–µ–º –≤ "–£—Å–ø–µ—à–Ω—ã–µ" –µ—Å–ª–∏ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                        if sheets_writer and hasattr(product_data, '_sheets_row'):
                            try:
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã A-Z (–∫—Ä–æ–º–µ C) –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                                if sheets_writer.is_row_complete(product_data._sheets_row):
                                    sheets_writer.copy_to_success_sheet(product_data._sheets_row)
                                    log.info(f"  ‚úÖ –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ ‚Üí —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ '–£—Å–ø–µ—à–Ω—ã–µ'")
                                else:
                                    log.warning(f"  ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ (–µ—Å—Ç—å –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏)")
                            except Exception as e:
                                log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ '–£—Å–ø–µ—à–Ω—ã–µ': {e}")
                    
                    # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
                    all_products_analytics.append(analytics_entry)
                    
                    # 7.7. –ï—Å–ª–∏ –≤–∏–¥–µ–æ –º–µ–Ω—å—à–µ 3 - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                    if not analytics_entry["success"]:
                        log.warning(f"‚ö†Ô∏è –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω, –Ω–æ –º–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": getattr(product_data, 'product_name', product.get('name', 'N/A')),
                            "reason": "–ú–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏",
                            "videos_found": len(getattr(product_data, 'videos', []))
                        })
                
                except Exception as e:
                    log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞: {e}")
                    import traceback
                    log.error(traceback.format_exc())
                    
                    skipped_products.append({
                        "name": product.get('name', 'N/A'),
                        "reason": f"–ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {str(e)[:50]}",
                        "videos_found": 0
                    })
            
            # 7.6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –≤—ã—Ö–æ–¥–∞ –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
            if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                break
            
            if checked_products >= MAX_PRODUCTS_TO_CHECK:
                break
        
        # 8. –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç
        log.info(f"\n{'='*80}")
        log.info("üìä –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢")
        log.info(f"{'='*80}")
        log.info(f"‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {successful_products}")
        log.info(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {len(skipped_products)}")
        log.info(f"üîç –í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {checked_products}")
        log.info(f"üö´ –¢–æ–≤–∞—Ä–æ–≤ –≤ ban-list: {len(banned_product_ids)}")
        log.info(f"{'='*80}")
        
        # –í—ã–≤–æ–¥ ban-list
        if banned_product_ids:
            log.info(f"\nüö´ BAN-LIST (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ product_id):")
            for i, product_id in enumerate(sorted(banned_product_ids), 1):
                log.info(f"   {i}. {product_id}")
        
        if skipped_products:
            log.info(f"\n‚è≠Ô∏è  –°–ü–ò–°–û–ö –ü–†–û–ü–£–©–ï–ù–ù–´–• –¢–û–í–ê–†–û–í:")
            for i, skipped in enumerate(skipped_products, 1):
                log.info(f"   {i}. {skipped['name'][:60]}...")
                log.info(f"      –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}")
                log.info(f"      –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}")
        
        if successful_products >= MIN_PRODUCTS_TO_COLLECT:
            log.info(f"\nüéâ –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
        elif checked_products >= MAX_PRODUCTS_TO_CHECK:
            log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
            log.warning(f"   –°–æ–±—Ä–∞–Ω–æ —Ç–æ–ª—å–∫–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ {MIN_PRODUCTS_TO_COLLECT}")
        
        # 9. –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
        log.info("\n" + "=" * 60)
        log.info("üìù –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –≤–∏–¥–µ–æ...")
        log.info("=" * 60)
        try:
            from datetime import datetime
            import os
            
            summary_dir = "logs/summaries"
            os.makedirs(summary_dir, exist_ok=True)
            
            timestamp = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
            summary_file = f"{summary_dir}/iteration_{timestamp}.md"
            
            with open(summary_file, "w", encoding="utf-8") as f:
                f.write(f"# üìä –ò—Ç–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
                
                f.write("## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã\n\n")
                f.write(f"- **–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ:** {successful_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–ø—É—â–µ–Ω–æ:** {len(skipped_products)} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** {checked_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **Ban-list:** {len(banned_product_ids)} —Ç–æ–≤–∞—Ä–æ–≤\n\n")
                
                if successful_products > 0:
                    f.write("### üéâ SUCCESS\n\n")
                    f.write(f"‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ —Å >= 3 –≤–∏–¥–µ–æ\n\n")
                
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                # –ù–û–í–´–ô –ë–õ–û–ö: –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                if all_products_analytics:
                    f.write("---\n\n")
                    f.write("## üìπ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º\n\n")
                    f.write(f"**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:** >= 5K impressions, –≤–æ–∑—Ä–∞—Å—Ç <= 30 –¥–Ω–µ–π\n\n")
                    
                    for idx, product in enumerate(all_products_analytics, 1):
                        status_icon = "‚úÖ" if product["success"] else "‚ùå"
                        f.write(f"### {status_icon} –¢–æ–≤–∞—Ä #{idx}: {product['product_name'][:80]}\n\n")
                        f.write(f"- **–°—Å—ã–ª–∫–∞:** [{product['product_url']}]({product['product_url']})\n")
                        f.write(f"- **–°—Ç–∞—Ç—É—Å:** {'–£–°–ü–ï–• (>= 3 –≤–∏–¥–µ–æ)' if product['success'] else '–ü–†–û–ü–£–©–ï–ù (< 3 –≤–∏–¥–µ–æ)'}\n")
                        f.write(f"- **–ù–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ:** {product['videos_found']}\n\n")
                        
                        # –¢–û–ü-3 –≤–∏–¥–µ–æ (–¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –∫—Ä–∏—Ç–µ—Ä–∏–∏)
                        if product['top_3_videos']:
                            f.write("#### üèÜ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ impression:\n\n")
                            for video in product['top_3_videos']:
                                impression = video['impression']
                                first_seen = video['first_seen']
                                ad_url = video['ad_search_url']
                                
                                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
                                meets_criteria = impression >= 5000  # –ü—Ä–æ–≤–µ—Ä–∫–∞ impression
                                criteria_icon = "‚úÖ" if meets_criteria else "‚ö†Ô∏è"
                                
                                f.write(f"{video['rank']}. {criteria_icon} **{impression:,} impressions** | "
                                       f"First seen: {first_seen}\n")
                                if ad_url and ad_url != 'N/A':
                                    f.write(f"   - –°—Å—ã–ª–∫–∞: [{ad_url}]({ad_url})\n")
                                f.write("\n")
                        else:
                            f.write("   ‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ (–≤–æ–∑–º–æ–∂–Ω–æ, –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞)\n\n")
                        
                        f.write("---\n\n")
                
                # –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
                if skipped_products:
                    f.write("### ‚è≠Ô∏è –ü–†–û–ü–£–©–ï–ù–ù–´–ï –¢–û–í–ê–†–´ (–∫—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫)\n\n")
                    for i, skipped in enumerate(skipped_products, 1):
                        f.write(f"{i}. **{skipped['name'][:60]}...**\n")
                        f.write(f"   - –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}\n")
                        f.write(f"   - –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}\n\n")
                
                # Ban-list
                if banned_product_ids:
                    f.write("### üö´ Ban-list (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ product_id)\n\n")
                    for i, product_id in enumerate(sorted(banned_product_ids), 1):
                        f.write(f"{i}. `{product_id}`\n")
                    f.write("\n")
                
                f.write("## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏\n\n")
                f.write(f"- **–¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:** {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–õ–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫:** {MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤–∏–¥–µ–æ:** >= 5K impressions, <= 30 –¥–Ω–µ–π\n\n")
                
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    f.write("## üéØ –°—Ç–∞—Ç—É—Å: –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê ‚úÖ\n\n")
                elif checked_products >= MAX_PRODUCTS_TO_CHECK:
                    f.write("## ‚ö†Ô∏è –°—Ç–∞—Ç—É—Å: –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫\n\n")
                else:
                    f.write("## ‚ùå –°—Ç–∞—Ç—É—Å: –ü—Ä–µ—Ä–≤–∞–Ω–æ\n\n")
            
            log.info(f"‚úÖ Summary —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {summary_file}")
        except Exception as e:
            log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ summary: {e}")
            import traceback
            log.error(traceback.format_exc())
        
        log.info("\n" + "=" * 60)
        log.info("‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û")
        log.info("=" * 60)
        
        # –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)
        log.info("\n‚è∏Ô∏è –û–∂–∏–¥–∞–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –±—Ä–∞—É–∑–µ—Ä–∞ (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)...")
        log.info("   –ù–∞–∂–º–∏—Ç–µ Ctrl+C, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å —Ä–∞–Ω—å—à–µ")
        try:
            await asyncio.sleep(10)
        except KeyboardInterrupt:
            log.info("   –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        
    except KeyboardInterrupt:
        log.warning("\n‚ö†Ô∏è –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Ctrl+C)")
    except Exception as e:
        log.error(f"\n{'='*60}")
        log.error(f"‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}")
        log.error(f"{'='*60}")
        import traceback
        log.error("–ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:")
        log.error(traceback.format_exc())
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
        if browser_manager and browser_manager.page:
            try:
                screenshot_path = config.SCREENSHOTS_DIR / f"error_test_{int(asyncio.get_event_loop().time())}.png"
                await browser_manager.page.screenshot(path=str(screenshot_path), full_page=True)
                log.info(f"üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {screenshot_path}")
            except Exception as e2:
                log.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç: {e2}")
        
        log.error("\n‚ö†Ô∏è –ë—Ä–∞—É–∑–µ—Ä –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞ 30 —Å–µ–∫—É–Ω–¥...")
        try:
            await asyncio.sleep(30)
        except:
            pass
    
    finally:
        if browser_manager:
            await browser_manager.close()


if __name__ == "__main__":
    asyncio.run(test_parser_engine())


```

```python
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Parser Engine
"""

import asyncio
import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ src
sys.path.insert(0, str(Path(__file__).parent))

from src.browser_manager import BrowserManager
from src.parser_engine import ParserEngine, ProductData
from src.sheets_writer import SheetsWriter
from src import config
from src import logger

log = logger.get_logger("TestParserEngine")


async def test_parser_engine():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Parser Engine"""
    
    browser_manager = None
    try:
        log.info("=" * 60)
        log.info("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï PARSER ENGINE")
        log.info("=" * 60)
        
        # 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
        log.info("\n1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞...")
        browser_manager = BrowserManager()
        success = await browser_manager.initialize(headless=False)  # headful –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä")
            return
        
        # 2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies (–µ—Å–ª–∏ –µ—Å—Ç—å)
        log.info("\n2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies...")
        await browser_manager.load_cookies()
        
        # 3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–∞—á–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads
        log.info("\n3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads...")
        success = await browser_manager.navigate_with_retry(
            config.PIPIADS_INITIAL_URL,
            wait_until="domcontentloaded",
            timeout=30000
        )
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É")
            return
        
        await browser_manager.human_delay(2, 3)
        
        # 4. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
        log.info("\n4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...")
        is_logged_in = await browser_manager._check_logged_in_strict()
        if not is_logged_in:
            log.info("–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...")
            success = await browser_manager.login_to_pipiads()
            if not success:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è")
                return
            await browser_manager.save_cookies()
        else:
            log.info("‚úÖ –£–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω")
        
        # 5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine
        log.info("\n5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine...")
        parser = ParserEngine(browser_manager.page)
        parser.set_browser_manager(browser_manager)
        
        # 6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets (–¥–æ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤)
        log.info("\n6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets...")
        sheets_writer = None
        try:
            sheets_writer = SheetsWriter()
            if sheets_writer.connect():
                log.info("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets —É—Å–ø–µ—à–Ω–æ")
            else:
                log.warning("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Google Sheets, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        except Exception as e:
            log.warning(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Google Sheets: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        
        # 7. –¶–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        log.info("\n" + "=" * 80)
        log.info("7. –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–û–í")
        log.info("=" * 80)
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        # –£–°–õ–ê–ë–õ–ï–ù–û –¥–ª—è —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏: —Å–Ω–∏–∂–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
        MIN_PRODUCTS_TO_COLLECT = 3   # –¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–º–æ–∂–Ω–æ —Å–Ω–∏–∑–∏—Ç—å –¥–æ 1-2)
        MAX_PRODUCTS_TO_CHECK = 15     # –ú–∞–∫—Å–∏–º—É–º —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é (—É–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –≤—ã–±–æ—Ä–∞)
        PRODUCTS_PER_PAGE = 20         # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        
        successful_products = 0  # –°—á–µ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        checked_products = 0      # –°—á–µ—Ç—á–∏–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        skipped_products = []     # –°–ø–∏—Å–æ–∫ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        banned_products = set()   # Ban-list: URL —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ)
        all_products_analytics = []  # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –í–°–ï–• —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è summary-—Ñ–∞–π–ª–∞
        
        def normalize_url(url: str) -> str:
            """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL (—É–±—Ä–∞—Ç—å —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É)"""
            if not url:
                return ""
            url = url.strip().rstrip('/')
            # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if '?' in url:
                url = url.split('?')[0]
            return url
        
        # –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏
        while successful_products < MIN_PRODUCTS_TO_COLLECT and checked_products < MAX_PRODUCTS_TO_CHECK:
            
            # 7.1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
            log.info(f"\n{'='*80}")
            log.info(f"–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã...")
            log.info(f"–ü—Ä–æ–≥—Ä–µ—Å—Å: {successful_products}/{MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ, "
                    f"{checked_products}/{MAX_PRODUCTS_TO_CHECK} –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ")
            log.info(f"{'='*80}")
            
            try:
                products = await parser.get_products_from_search_page(count=PRODUCTS_PER_PAGE)
            except Exception as e:
                log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
                break
            
            if not products:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã, –∑–∞–≤–µ—Ä—à–∞–µ–º")
                break
            
            log.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
            
            # 7.1.5. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ URL (–ø—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è)
            # –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º banned_products –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
            unique_products = []
            duplicate_count = 0
            seen_urls = set()  # –î–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
            
            for product in products:
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ü—Ä–æ–ø—É—Å–∫ —Ç–æ–≤–∞—Ä–∞ –±–µ–∑ URL")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ç–∏–≤ banned_products (—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)
                if product_url in banned_products:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (—É–∂–µ –≤ ban-list): {product_url}")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
                if product_url in seen_urls:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (–≤ —Ç–µ–∫—É—â–µ–º —Å–ø–∏—Å–∫–µ): {product_url}")
                    continue
                
                seen_urls.add(product_url)
                # –û–±–Ω–æ–≤–ª—è–µ–º URL –≤ —Å–ª–æ–≤–∞—Ä–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π
                product['url'] = product_url
                unique_products.append(product)
            
            if duplicate_count > 0:
                log.info(f"üîç –ù–∞–π–¥–µ–Ω–æ {duplicate_count} –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, –æ—Å—Ç–∞–≤–ª–µ–Ω–æ {len(unique_products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤")
            
            products = unique_products  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
            log.info(f"‚úÖ –ü–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏: {len(products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            
            # 7.2. –¶–∏–∫–ª –ø–æ —Ç–æ–≤–∞—Ä–∞–º –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            for product_index, product in enumerate(products):
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    log.info(f"\nüéØ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
                    break
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
                if checked_products >= MAX_PRODUCTS_TO_CHECK:
                    log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
                    break
                
                # ‚ö†Ô∏è –ü–†–û–í–ï–†–ö–ê BAN-LIST: –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                    continue
                
                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
                if product_url in banned_products:
                    log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: {product_url}")
                    log.warning(f"   –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.")
                    continue
                
                # –û—Ç–º–µ—á–∞–µ–º —Ç–æ–≤–∞—Ä –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –°–†–ê–ó–£ (–¥–æ –∫–ª–∏–∫–∞) - —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–≤–∞–∂–¥—ã
                banned_products.add(product_url)
                log.info(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: {product_url}")
                
                checked_products += 1
                
                # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–∞
                log.info(f"\n{'='*80}")
                log.info(f"üì¶ –¢–û–í–ê–† {checked_products}/{MAX_PRODUCTS_TO_CHECK} "
                        f"(—É—Å–ø–µ—à–Ω—ã—Ö: {successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                log.info(f"{'='*80}")
                log.info(f"–ù–∞–∑–≤–∞–Ω–∏–µ: {product.get('name', 'N/A')[:70]}...")
                log.info(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {product.get('category', 'N/A')}")
                log.info(f"URL: {product.get('url', 'N/A')}")
                log.info(f"Product ID: {product_id}")
                
                try:
                    # 7.3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ (–∫–ª–∏–∫ –ø–æ –∏–Ω–¥–µ–∫—Å—É, –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞)
                    # –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥–∞–µ–º banned_products –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
                    product_data = await parser.get_product_details_with_return(
                        product_index=product_index,
                        sheets_writer=sheets_writer,
                        banned_products=banned_products
                    )
                    
                    # 7.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    if product_data is None:
                        # –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
                        log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞")
                        
                        skipped_products.append({
                            "name": product.get('name', 'N/A'),
                            "reason": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ",
                            "videos_found": 0
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ)
                        all_products_analytics.append({
                            "product_name": product.get('name', 'N/A'),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": 0,
                            "top_3_videos": []
                        })
                        continue
                    
                    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç (–µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª—Å—è —Å—Ç–∞—Ç—É—Å "duplicate")
                    if isinstance(product_data, dict) and product_data.get("status") == "duplicate":
                        duplicate_url = product_data.get('product_url', 'N/A')
                        log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): {duplicate_url}")
                        duplicate_count += 1
                        continue
                    
                    if isinstance(product_data, dict) and product_data.get("status") == "insufficient_videos":
                        # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                        log.warning(f"‚è≠Ô∏è  –ü–†–û–ü–£–°–ö: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù–∞–π–¥–µ–Ω–æ: {product_data.get('videos_found', 0)} –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù—É–∂–Ω–æ: {product_data.get('videos_required', 3)} –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": product_data.get('product_name', product.get('name', 'N/A')),
                            "reason": product_data.get('reason', '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ'),
                            "videos_found": product_data.get('videos_found', 0)
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ - —Ç–æ–≤–∞—Ä –≤–µ—Ä–Ω—É–ª insufficient_videos)
                        all_products_analytics.append({
                            "product_name": product_data.get('product_name', product.get('name', 'N/A')),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": product_data.get('videos_found', 0),
                            "top_3_videos": []  # –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–ø-3
                        })
                        continue
                    
                    # 7.5. –°–±–æ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è summary
                    analytics_entry = {
                        "product_name": getattr(product_data, 'product_name', 'N/A'),
                        "product_url": getattr(product_data, 'pipiads_link', product_url),
                        "success": False,
                        "videos_found": len(getattr(product_data, 'videos', [])),
                        "top_3_videos": []
                    }
                    
                    # –ò–∑–≤–ª–µ–∫–∞–µ–º –¢–û–ü-3 –≤–∏–¥–µ–æ (–ø–æ impression) –∏–∑ –í–°–ï–• –≤–∏–¥–µ–æ
                    if hasattr(product_data, '_all_videos_raw'):
                        all_videos = product_data._all_videos_raw
                        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ impression (desc) –∏ –±–µ—Ä–µ–º —Ç–æ–ø-3
                        sorted_videos = sorted(all_videos, key=lambda v: v.get('impression', 0), reverse=True)
                        for i, video in enumerate(sorted_videos[:3], 1):
                            analytics_entry["top_3_videos"].append({
                                "rank": i,
                                "impression": video.get('impression', 0),
                                "first_seen": video.get('first_seen', 'N/A'),
                                "ad_search_url": video.get('ad_search_url', 'N/A')
                            })
                    
                    # 7.6. –£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞
                    if hasattr(product_data, 'videos') and len(product_data.videos) >= 3:
                        successful_products += 1
                        analytics_entry["success"] = True
                        
                        log.info(f"\n‚úÖ –£–°–ü–ï–•! –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω ({successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                        log.info(f"   –ù–∞–∑–≤–∞–Ω–∏–µ: {product_data.product_name[:70]}...")
                        log.info(f"   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ: {len(product_data.videos)}")
                        
                        # –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                        for i, video in enumerate(product_data.videos[:3], 1):
                            log.info(f"   –í–∏–¥–µ–æ {i}: {video.get('impression', 0)} impressions, "
                                    f"{video.get('country', 'N/A')}, {video.get('audience_age', 'N/A')}")
                        
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ –∏ –∫–æ–ø–∏—Ä—É–µ–º –≤ "–£—Å–ø–µ—à–Ω—ã–µ" –µ—Å–ª–∏ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                        if sheets_writer and hasattr(product_data, '_sheets_row'):
                            try:
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã A-Z (–∫—Ä–æ–º–µ C) –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                                if sheets_writer.is_row_complete(product_data._sheets_row):
                                    sheets_writer.copy_to_success_sheet(product_data._sheets_row)
                                    log.info(f"  ‚úÖ –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ ‚Üí —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ '–£—Å–ø–µ—à–Ω—ã–µ'")
                                else:
                                    log.warning(f"  ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ (–µ—Å—Ç—å –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏)")
                            except Exception as e:
                                log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ '–£—Å–ø–µ—à–Ω—ã–µ': {e}")
                    
                    # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
                    all_products_analytics.append(analytics_entry)
                    
                    # 7.7. –ï—Å–ª–∏ –≤–∏–¥–µ–æ –º–µ–Ω—å—à–µ 3 - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                    if not analytics_entry["success"]:
                        log.warning(f"‚ö†Ô∏è –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω, –Ω–æ –º–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": getattr(product_data, 'product_name', product.get('name', 'N/A')),
                            "reason": "–ú–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏",
                            "videos_found": len(getattr(product_data, 'videos', []))
                        })
                
                except Exception as e:
                    log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞: {e}")
                    import traceback
                    log.error(traceback.format_exc())
                    
                    skipped_products.append({
                        "name": product.get('name', 'N/A'),
                        "reason": f"–ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {str(e)[:50]}",
                        "videos_found": 0
                    })
            
            # 7.6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –≤—ã—Ö–æ–¥–∞ –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
            if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                break
            
            if checked_products >= MAX_PRODUCTS_TO_CHECK:
                break
        
        # 8. –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç
        log.info(f"\n{'='*80}")
        log.info("üìä –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢")
        log.info(f"{'='*80}")
        log.info(f"‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {successful_products}")
        log.info(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {len(skipped_products)}")
        log.info(f"üîç –í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {checked_products}")
        log.info(f"üö´ –¢–æ–≤–∞—Ä–æ–≤ –≤ ban-list: {len(banned_product_ids)}")
        log.info(f"{'='*80}")
        
        # –í—ã–≤–æ–¥ ban-list
        if banned_product_ids:
            log.info(f"\nüö´ BAN-LIST (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ product_id):")
            for i, product_id in enumerate(sorted(banned_product_ids), 1):
                log.info(f"   {i}. {product_id}")
        
        if skipped_products:
            log.info(f"\n‚è≠Ô∏è  –°–ü–ò–°–û–ö –ü–†–û–ü–£–©–ï–ù–ù–´–• –¢–û–í–ê–†–û–í:")
            for i, skipped in enumerate(skipped_products, 1):
                log.info(f"   {i}. {skipped['name'][:60]}...")
                log.info(f"      –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}")
                log.info(f"      –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}")
        
        if successful_products >= MIN_PRODUCTS_TO_COLLECT:
            log.info(f"\nüéâ –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
        elif checked_products >= MAX_PRODUCTS_TO_CHECK:
            log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
            log.warning(f"   –°–æ–±—Ä–∞–Ω–æ —Ç–æ–ª—å–∫–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ {MIN_PRODUCTS_TO_COLLECT}")
        
        # 9. –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
        log.info("\n" + "=" * 60)
        log.info("üìù –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –≤–∏–¥–µ–æ...")
        log.info("=" * 60)
        try:
            from datetime import datetime
            import os
            
            summary_dir = "logs/summaries"
            os.makedirs(summary_dir, exist_ok=True)
            
            timestamp = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
            summary_file = f"{summary_dir}/iteration_{timestamp}.md"
            
            with open(summary_file, "w", encoding="utf-8") as f:
                f.write(f"# üìä –ò—Ç–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
                
                f.write("## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã\n\n")
                f.write(f"- **–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ:** {successful_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–ø—É—â–µ–Ω–æ:** {len(skipped_products)} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** {checked_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **Ban-list:** {len(banned_product_ids)} —Ç–æ–≤–∞—Ä–æ–≤\n\n")
                
                if successful_products > 0:
                    f.write("### üéâ SUCCESS\n\n")
                    f.write(f"‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ —Å >= 3 –≤–∏–¥–µ–æ\n\n")
                
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                # –ù–û–í–´–ô –ë–õ–û–ö: –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                if all_products_analytics:
                    f.write("---\n\n")
                    f.write("## üìπ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º\n\n")
                    f.write(f"**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:** >= 5K impressions, –≤–æ–∑—Ä–∞—Å—Ç <= 30 –¥–Ω–µ–π\n\n")
                    
                    for idx, product in enumerate(all_products_analytics, 1):
                        status_icon = "‚úÖ" if product["success"] else "‚ùå"
                        f.write(f"### {status_icon} –¢–æ–≤–∞—Ä #{idx}: {product['product_name'][:80]}\n\n")
                        f.write(f"- **–°—Å—ã–ª–∫–∞:** [{product['product_url']}]({product['product_url']})\n")
                        f.write(f"- **–°—Ç–∞—Ç—É—Å:** {'–£–°–ü–ï–• (>= 3 –≤–∏–¥–µ–æ)' if product['success'] else '–ü–†–û–ü–£–©–ï–ù (< 3 –≤–∏–¥–µ–æ)'}\n")
                        f.write(f"- **–ù–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ:** {product['videos_found']}\n\n")
                        
                        # –¢–û–ü-3 –≤–∏–¥–µ–æ (–¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –∫—Ä–∏—Ç–µ—Ä–∏–∏)
                        if product['top_3_videos']:
                            f.write("#### üèÜ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ impression:\n\n")
                            for video in product['top_3_videos']:
                                impression = video['impression']
                                first_seen = video['first_seen']
                                ad_url = video['ad_search_url']
                                
                                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
                                meets_criteria = impression >= 5000  # –ü—Ä–æ–≤–µ—Ä–∫–∞ impression
                                criteria_icon = "‚úÖ" if meets_criteria else "‚ö†Ô∏è"
                                
                                f.write(f"{video['rank']}. {criteria_icon} **{impression:,} impressions** | "
                                       f"First seen: {first_seen}\n")
                                if ad_url and ad_url != 'N/A':
                                    f.write(f"   - –°—Å—ã–ª–∫–∞: [{ad_url}]({ad_url})\n")
                                f.write("\n")
                        else:
                            f.write("   ‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ (–≤–æ–∑–º–æ–∂–Ω–æ, –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞)\n\n")
                        
                        f.write("---\n\n")
                
                # –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
                if skipped_products:
                    f.write("### ‚è≠Ô∏è –ü–†–û–ü–£–©–ï–ù–ù–´–ï –¢–û–í–ê–†–´ (–∫—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫)\n\n")
                    for i, skipped in enumerate(skipped_products, 1):
                        f.write(f"{i}. **{skipped['name'][:60]}...**\n")
                        f.write(f"   - –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}\n")
                        f.write(f"   - –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}\n\n")
                
                # Ban-list
                if banned_product_ids:
                    f.write("### üö´ Ban-list (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ product_id)\n\n")
                    for i, product_id in enumerate(sorted(banned_product_ids), 1):
                        f.write(f"{i}. `{product_id}`\n")
                    f.write("\n")
                
                f.write("## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏\n\n")
                f.write(f"- **–¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:** {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–õ–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫:** {MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤–∏–¥–µ–æ:** >= 5K impressions, <= 30 –¥–Ω–µ–π\n\n")
                
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    f.write("## üéØ –°—Ç–∞—Ç—É—Å: –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê ‚úÖ\n\n")
                elif checked_products >= MAX_PRODUCTS_TO_CHECK:
                    f.write("## ‚ö†Ô∏è –°—Ç–∞—Ç—É—Å: –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫\n\n")
                else:
                    f.write("## ‚ùå –°—Ç–∞—Ç—É—Å: –ü—Ä–µ—Ä–≤–∞–Ω–æ\n\n")
            
            log.info(f"‚úÖ Summary —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {summary_file}")
        except Exception as e:
            log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ summary: {e}")
            import traceback
            log.error(traceback.format_exc())
        
        log.info("\n" + "=" * 60)
        log.info("‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û")
        log.info("=" * 60)
        
        # –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)
        log.info("\n‚è∏Ô∏è –û–∂–∏–¥–∞–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –±—Ä–∞—É–∑–µ—Ä–∞ (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)...")
        log.info("   –ù–∞–∂–º–∏—Ç–µ Ctrl+C, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å —Ä–∞–Ω—å—à–µ")
        try:
            await asyncio.sleep(10)
        except KeyboardInterrupt:
            log.info("   –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        
    except KeyboardInterrupt:
        log.warning("\n‚ö†Ô∏è –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Ctrl+C)")
    except Exception as e:
        log.error(f"\n{'='*60}")
        log.error(f"‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}")
        log.error(f"{'='*60}")
        import traceback
        log.error("–ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:")
        log.error(traceback.format_exc())
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
        if browser_manager and browser_manager.page:
            try:
                screenshot_path = config.SCREENSHOTS_DIR / f"error_test_{int(asyncio.get_event_loop().time())}.png"
                await browser_manager.page.screenshot(path=str(screenshot_path), full_page=True)
                log.info(f"üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {screenshot_path}")
            except Exception as e2:
                log.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç: {e2}")
        
        log.error("\n‚ö†Ô∏è –ë—Ä–∞—É–∑–µ—Ä –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞ 30 —Å–µ–∫—É–Ω–¥...")
        try:
            await asyncio.sleep(30)
        except:
            pass
    
    finally:
        if browser_manager:
            await browser_manager.close()


if __name__ == "__main__":
    asyncio.run(test_parser_engine())


```

```python
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Parser Engine
"""

import asyncio
import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ src
sys.path.insert(0, str(Path(__file__).parent))

from src.browser_manager import BrowserManager
from src.parser_engine import ParserEngine, ProductData
from src.sheets_writer import SheetsWriter
from src import config
from src import logger

log = logger.get_logger("TestParserEngine")


async def test_parser_engine():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Parser Engine"""
    
    browser_manager = None
    try:
        log.info("=" * 60)
        log.info("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï PARSER ENGINE")
        log.info("=" * 60)
        
        # 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
        log.info("\n1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞...")
        browser_manager = BrowserManager()
        success = await browser_manager.initialize(headless=False)  # headful –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä")
            return
        
        # 2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies (–µ—Å–ª–∏ –µ—Å—Ç—å)
        log.info("\n2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies...")
        await browser_manager.load_cookies()
        
        # 3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–∞—á–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads
        log.info("\n3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads...")
        success = await browser_manager.navigate_with_retry(
            config.PIPIADS_INITIAL_URL,
            wait_until="domcontentloaded",
            timeout=30000
        )
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É")
            return
        
        await browser_manager.human_delay(2, 3)
        
        # 4. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
        log.info("\n4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...")
        is_logged_in = await browser_manager._check_logged_in_strict()
        if not is_logged_in:
            log.info("–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...")
            success = await browser_manager.login_to_pipiads()
            if not success:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è")
                return
            await browser_manager.save_cookies()
        else:
            log.info("‚úÖ –£–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω")
        
        # 5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine
        log.info("\n5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine...")
        parser = ParserEngine(browser_manager.page)
        parser.set_browser_manager(browser_manager)
        
        # 6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets (–¥–æ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤)
        log.info("\n6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets...")
        sheets_writer = None
        try:
            sheets_writer = SheetsWriter()
            if sheets_writer.connect():
                log.info("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets —É—Å–ø–µ—à–Ω–æ")
            else:
                log.warning("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Google Sheets, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        except Exception as e:
            log.warning(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Google Sheets: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        
        # 7. –¶–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        log.info("\n" + "=" * 80)
        log.info("7. –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–û–í")
        log.info("=" * 80)
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        # –£–°–õ–ê–ë–õ–ï–ù–û –¥–ª—è —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏: —Å–Ω–∏–∂–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
        MIN_PRODUCTS_TO_COLLECT = 3   # –¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–º–æ–∂–Ω–æ —Å–Ω–∏–∑–∏—Ç—å –¥–æ 1-2)
        MAX_PRODUCTS_TO_CHECK = 15     # –ú–∞–∫—Å–∏–º—É–º —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é (—É–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –≤—ã–±–æ—Ä–∞)
        PRODUCTS_PER_PAGE = 20         # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        
        successful_products = 0  # –°—á–µ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        checked_products = 0      # –°—á–µ—Ç—á–∏–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        skipped_products = []     # –°–ø–∏—Å–æ–∫ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        banned_products = set()   # Ban-list: URL —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ)
        all_products_analytics = []  # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –í–°–ï–• —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è summary-—Ñ–∞–π–ª–∞
        
        def normalize_url(url: str) -> str:
            """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL (—É–±—Ä–∞—Ç—å —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É)"""
            if not url:
                return ""
            url = url.strip().rstrip('/')
            # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if '?' in url:
                url = url.split('?')[0]
            return url
        
        # –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏
        while successful_products < MIN_PRODUCTS_TO_COLLECT and checked_products < MAX_PRODUCTS_TO_CHECK:
            
            # 7.1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
            log.info(f"\n{'='*80}")
            log.info(f"–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã...")
            log.info(f"–ü—Ä–æ–≥—Ä–µ—Å—Å: {successful_products}/{MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ, "
                    f"{checked_products}/{MAX_PRODUCTS_TO_CHECK} –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ")
            log.info(f"{'='*80}")
            
            try:
                products = await parser.get_products_from_search_page(count=PRODUCTS_PER_PAGE)
            except Exception as e:
                log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
                break
            
            if not products:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã, –∑–∞–≤–µ—Ä—à–∞–µ–º")
                break
            
            log.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
            
            # 7.1.5. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ URL (–ø—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è)
            # –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º banned_products –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
            unique_products = []
            duplicate_count = 0
            seen_urls = set()  # –î–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
            
            for product in products:
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ü—Ä–æ–ø—É—Å–∫ —Ç–æ–≤–∞—Ä–∞ –±–µ–∑ URL")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ç–∏–≤ banned_products (—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)
                if product_url in banned_products:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (—É–∂–µ –≤ ban-list): {product_url}")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
                if product_url in seen_urls:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (–≤ —Ç–µ–∫—É—â–µ–º —Å–ø–∏—Å–∫–µ): {product_url}")
                    continue
                
                seen_urls.add(product_url)
                # –û–±–Ω–æ–≤–ª—è–µ–º URL –≤ —Å–ª–æ–≤–∞—Ä–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π
                product['url'] = product_url
                unique_products.append(product)
            
            if duplicate_count > 0:
                log.info(f"üîç –ù–∞–π–¥–µ–Ω–æ {duplicate_count} –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, –æ—Å—Ç–∞–≤–ª–µ–Ω–æ {len(unique_products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤")
            
            products = unique_products  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
            log.info(f"‚úÖ –ü–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏: {len(products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            
            # 7.2. –¶–∏–∫–ª –ø–æ —Ç–æ–≤–∞—Ä–∞–º –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            for product_index, product in enumerate(products):
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    log.info(f"\nüéØ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
                    break
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
                if checked_products >= MAX_PRODUCTS_TO_CHECK:
                    log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
                    break
                
                # ‚ö†Ô∏è –ü–†–û–í–ï–†–ö–ê BAN-LIST: –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                    continue
                
                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
                if product_url in banned_products:
                    log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: {product_url}")
                    log.warning(f"   –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.")
                    continue
                
                # –û—Ç–º–µ—á–∞–µ–º —Ç–æ–≤–∞—Ä –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –°–†–ê–ó–£ (–¥–æ –∫–ª–∏–∫–∞) - —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–≤–∞–∂–¥—ã
                banned_products.add(product_url)
                log.info(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: {product_url}")
                
                checked_products += 1
                
                # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–∞
                log.info(f"\n{'='*80}")
                log.info(f"üì¶ –¢–û–í–ê–† {checked_products}/{MAX_PRODUCTS_TO_CHECK} "
                        f"(—É—Å–ø–µ—à–Ω—ã—Ö: {successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                log.info(f"{'='*80}")
                log.info(f"–ù–∞–∑–≤–∞–Ω–∏–µ: {product.get('name', 'N/A')[:70]}...")
                log.info(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {product.get('category', 'N/A')}")
                log.info(f"URL: {product.get('url', 'N/A')}")
                log.info(f"Product ID: {product_id}")
                
                try:
                    # 7.3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ (–∫–ª–∏–∫ –ø–æ –∏–Ω–¥–µ–∫—Å—É, –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞)
                    # –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥–∞–µ–º banned_products –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
                    product_data = await parser.get_product_details_with_return(
                        product_index=product_index,
                        sheets_writer=sheets_writer,
                        banned_products=banned_products
                    )
                    
                    # 7.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    if product_data is None:
                        # –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
                        log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞")
                        
                        skipped_products.append({
                            "name": product.get('name', 'N/A'),
                            "reason": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ",
                            "videos_found": 0
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ)
                        all_products_analytics.append({
                            "product_name": product.get('name', 'N/A'),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": 0,
                            "top_3_videos": []
                        })
                        continue
                    
                    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç (–µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª—Å—è —Å—Ç–∞—Ç—É—Å "duplicate")
                    if isinstance(product_data, dict) and product_data.get("status") == "duplicate":
                        duplicate_url = product_data.get('product_url', 'N/A')
                        log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): {duplicate_url}")
                        duplicate_count += 1
                        continue
                    
                    if isinstance(product_data, dict) and product_data.get("status") == "insufficient_videos":
                        # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                        log.warning(f"‚è≠Ô∏è  –ü–†–û–ü–£–°–ö: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù–∞–π–¥–µ–Ω–æ: {product_data.get('videos_found', 0)} –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù—É–∂–Ω–æ: {product_data.get('videos_required', 3)} –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": product_data.get('product_name', product.get('name', 'N/A')),
                            "reason": product_data.get('reason', '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ'),
                            "videos_found": product_data.get('videos_found', 0)
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ - —Ç–æ–≤–∞—Ä –≤–µ—Ä–Ω—É–ª insufficient_videos)
                        all_products_analytics.append({
                            "product_name": product_data.get('product_name', product.get('name', 'N/A')),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": product_data.get('videos_found', 0),
                            "top_3_videos": []  # –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–ø-3
                        })
                        continue
                    
                    # 7.5. –°–±–æ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è summary
                    analytics_entry = {
                        "product_name": getattr(product_data, 'product_name', 'N/A'),
                        "product_url": getattr(product_data, 'pipiads_link', product_url),
                        "success": False,
                        "videos_found": len(getattr(product_data, 'videos', [])),
                        "top_3_videos": []
                    }
                    
                    # –ò–∑–≤–ª–µ–∫–∞–µ–º –¢–û–ü-3 –≤–∏–¥–µ–æ (–ø–æ impression) –∏–∑ –í–°–ï–• –≤–∏–¥–µ–æ
                    if hasattr(product_data, '_all_videos_raw'):
                        all_videos = product_data._all_videos_raw
                        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ impression (desc) –∏ –±–µ—Ä–µ–º —Ç–æ–ø-3
                        sorted_videos = sorted(all_videos, key=lambda v: v.get('impression', 0), reverse=True)
                        for i, video in enumerate(sorted_videos[:3], 1):
                            analytics_entry["top_3_videos"].append({
                                "rank": i,
                                "impression": video.get('impression', 0),
                                "first_seen": video.get('first_seen', 'N/A'),
                                "ad_search_url": video.get('ad_search_url', 'N/A')
                            })
                    
                    # 7.6. –£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞
                    if hasattr(product_data, 'videos') and len(product_data.videos) >= 3:
                        successful_products += 1
                        analytics_entry["success"] = True
                        
                        log.info(f"\n‚úÖ –£–°–ü–ï–•! –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω ({successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                        log.info(f"   –ù–∞–∑–≤–∞–Ω–∏–µ: {product_data.product_name[:70]}...")
                        log.info(f"   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ: {len(product_data.videos)}")
                        
                        # –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                        for i, video in enumerate(product_data.videos[:3], 1):
                            log.info(f"   –í–∏–¥–µ–æ {i}: {video.get('impression', 0)} impressions, "
                                    f"{video.get('country', 'N/A')}, {video.get('audience_age', 'N/A')}")
                        
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ –∏ –∫–æ–ø–∏—Ä—É–µ–º –≤ "–£—Å–ø–µ—à–Ω—ã–µ" –µ—Å–ª–∏ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                        if sheets_writer and hasattr(product_data, '_sheets_row'):
                            try:
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã A-Z (–∫—Ä–æ–º–µ C) –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                                if sheets_writer.is_row_complete(product_data._sheets_row):
                                    sheets_writer.copy_to_success_sheet(product_data._sheets_row)
                                    log.info(f"  ‚úÖ –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ ‚Üí —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ '–£—Å–ø–µ—à–Ω—ã–µ'")
                                else:
                                    log.warning(f"  ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ (–µ—Å—Ç—å –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏)")
                            except Exception as e:
                                log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ '–£—Å–ø–µ—à–Ω—ã–µ': {e}")
                    
                    # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
                    all_products_analytics.append(analytics_entry)
                    
                    # 7.7. –ï—Å–ª–∏ –≤–∏–¥–µ–æ –º–µ–Ω—å—à–µ 3 - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                    if not analytics_entry["success"]:
                        log.warning(f"‚ö†Ô∏è –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω, –Ω–æ –º–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": getattr(product_data, 'product_name', product.get('name', 'N/A')),
                            "reason": "–ú–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏",
                            "videos_found": len(getattr(product_data, 'videos', []))
                        })
                
                except Exception as e:
                    log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞: {e}")
                    import traceback
                    log.error(traceback.format_exc())
                    
                    skipped_products.append({
                        "name": product.get('name', 'N/A'),
                        "reason": f"–ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {str(e)[:50]}",
                        "videos_found": 0
                    })
            
            # 7.6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –≤—ã—Ö–æ–¥–∞ –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
            if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                break
            
            if checked_products >= MAX_PRODUCTS_TO_CHECK:
                break
        
        # 8. –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç
        log.info(f"\n{'='*80}")
        log.info("üìä –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢")
        log.info(f"{'='*80}")
        log.info(f"‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {successful_products}")
        log.info(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {len(skipped_products)}")
        log.info(f"üîç –í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {checked_products}")
        log.info(f"üö´ –¢–æ–≤–∞—Ä–æ–≤ –≤ ban-list: {len(banned_products)}")
        log.info(f"{'='*80}")
        
        # –í—ã–≤–æ–¥ ban-list
        if banned_products:
            log.info(f"\nüö´ BAN-LIST (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã):")
            for i, product_url in enumerate(sorted(banned_products), 1):
                log.info(f"   {i}. {product_url}")
        
        if skipped_products:
            log.info(f"\n‚è≠Ô∏è  –°–ü–ò–°–û–ö –ü–†–û–ü–£–©–ï–ù–ù–´–• –¢–û–í–ê–†–û–í:")
            for i, skipped in enumerate(skipped_products, 1):
                log.info(f"   {i}. {skipped['name'][:60]}...")
                log.info(f"      –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}")
                log.info(f"      –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}")
        
        if successful_products >= MIN_PRODUCTS_TO_COLLECT:
            log.info(f"\nüéâ –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
        elif checked_products >= MAX_PRODUCTS_TO_CHECK:
            log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
            log.warning(f"   –°–æ–±—Ä–∞–Ω–æ —Ç–æ–ª—å–∫–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ {MIN_PRODUCTS_TO_COLLECT}")
        
        # 9. –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
        log.info("\n" + "=" * 60)
        log.info("üìù –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –≤–∏–¥–µ–æ...")
        log.info("=" * 60)
        try:
            from datetime import datetime
            import os
            
            summary_dir = "logs/summaries"
            os.makedirs(summary_dir, exist_ok=True)
            
            timestamp = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
            summary_file = f"{summary_dir}/iteration_{timestamp}.md"
            
            with open(summary_file, "w", encoding="utf-8") as f:
                f.write(f"# üìä –ò—Ç–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
                
                f.write("## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã\n\n")
                f.write(f"- **–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ:** {successful_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–ø—É—â–µ–Ω–æ:** {len(skipped_products)} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** {checked_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **Ban-list:** {len(banned_product_ids)} —Ç–æ–≤–∞—Ä–æ–≤\n\n")
                
                if successful_products > 0:
                    f.write("### üéâ SUCCESS\n\n")
                    f.write(f"‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ —Å >= 3 –≤–∏–¥–µ–æ\n\n")
                
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                # –ù–û–í–´–ô –ë–õ–û–ö: –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                if all_products_analytics:
                    f.write("---\n\n")
                    f.write("## üìπ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º\n\n")
                    f.write(f"**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:** >= 5K impressions, –≤–æ–∑—Ä–∞—Å—Ç <= 30 –¥–Ω–µ–π\n\n")
                    
                    for idx, product in enumerate(all_products_analytics, 1):
                        status_icon = "‚úÖ" if product["success"] else "‚ùå"
                        f.write(f"### {status_icon} –¢–æ–≤–∞—Ä #{idx}: {product['product_name'][:80]}\n\n")
                        f.write(f"- **–°—Å—ã–ª–∫–∞:** [{product['product_url']}]({product['product_url']})\n")
                        f.write(f"- **–°—Ç–∞—Ç—É—Å:** {'–£–°–ü–ï–• (>= 3 –≤–∏–¥–µ–æ)' if product['success'] else '–ü–†–û–ü–£–©–ï–ù (< 3 –≤–∏–¥–µ–æ)'}\n")
                        f.write(f"- **–ù–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ:** {product['videos_found']}\n\n")
                        
                        # –¢–û–ü-3 –≤–∏–¥–µ–æ (–¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –∫—Ä–∏—Ç–µ—Ä–∏–∏)
                        if product['top_3_videos']:
                            f.write("#### üèÜ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ impression:\n\n")
                            for video in product['top_3_videos']:
                                impression = video['impression']
                                first_seen = video['first_seen']
                                ad_url = video['ad_search_url']
                                
                                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
                                meets_criteria = impression >= 5000  # –ü—Ä–æ–≤–µ—Ä–∫–∞ impression
                                criteria_icon = "‚úÖ" if meets_criteria else "‚ö†Ô∏è"
                                
                                f.write(f"{video['rank']}. {criteria_icon} **{impression:,} impressions** | "
                                       f"First seen: {first_seen}\n")
                                if ad_url and ad_url != 'N/A':
                                    f.write(f"   - –°—Å—ã–ª–∫–∞: [{ad_url}]({ad_url})\n")
                                f.write("\n")
                        else:
                            f.write("   ‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ (–≤–æ–∑–º–æ–∂–Ω–æ, –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞)\n\n")
                        
                        f.write("---\n\n")
                
                # –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
                if skipped_products:
                    f.write("### ‚è≠Ô∏è –ü–†–û–ü–£–©–ï–ù–ù–´–ï –¢–û–í–ê–†–´ (–∫—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫)\n\n")
                    for i, skipped in enumerate(skipped_products, 1):
                        f.write(f"{i}. **{skipped['name'][:60]}...**\n")
                        f.write(f"   - –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}\n")
                        f.write(f"   - –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}\n\n")
                
                # Ban-list
                if banned_product_ids:
                    f.write("### üö´ Ban-list (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ product_id)\n\n")
                    for i, product_id in enumerate(sorted(banned_product_ids), 1):
                        f.write(f"{i}. `{product_id}`\n")
                    f.write("\n")
                
                f.write("## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏\n\n")
                f.write(f"- **–¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:** {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–õ–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫:** {MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤–∏–¥–µ–æ:** >= 5K impressions, <= 30 –¥–Ω–µ–π\n\n")
                
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    f.write("## üéØ –°—Ç–∞—Ç—É—Å: –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê ‚úÖ\n\n")
                elif checked_products >= MAX_PRODUCTS_TO_CHECK:
                    f.write("## ‚ö†Ô∏è –°—Ç–∞—Ç—É—Å: –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫\n\n")
                else:
                    f.write("## ‚ùå –°—Ç–∞—Ç—É—Å: –ü—Ä–µ—Ä–≤–∞–Ω–æ\n\n")
            
            log.info(f"‚úÖ Summary —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {summary_file}")
        except Exception as e:
            log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ summary: {e}")
            import traceback
            log.error(traceback.format_exc())
        
        log.info("\n" + "=" * 60)
        log.info("‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û")
        log.info("=" * 60)
        
        # –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)
        log.info("\n‚è∏Ô∏è –û–∂–∏–¥–∞–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –±—Ä–∞—É–∑–µ—Ä–∞ (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)...")
        log.info("   –ù–∞–∂–º–∏—Ç–µ Ctrl+C, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å —Ä–∞–Ω—å—à–µ")
        try:
            await asyncio.sleep(10)
        except KeyboardInterrupt:
            log.info("   –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        
    except KeyboardInterrupt:
        log.warning("\n‚ö†Ô∏è –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Ctrl+C)")
    except Exception as e:
        log.error(f"\n{'='*60}")
        log.error(f"‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}")
        log.error(f"{'='*60}")
        import traceback
        log.error("–ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:")
        log.error(traceback.format_exc())
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
        if browser_manager and browser_manager.page:
            try:
                screenshot_path = config.SCREENSHOTS_DIR / f"error_test_{int(asyncio.get_event_loop().time())}.png"
                await browser_manager.page.screenshot(path=str(screenshot_path), full_page=True)
                log.info(f"üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {screenshot_path}")
            except Exception as e2:
                log.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç: {e2}")
        
        log.error("\n‚ö†Ô∏è –ë—Ä–∞—É–∑–µ—Ä –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞ 30 —Å–µ–∫—É–Ω–¥...")
        try:
            await asyncio.sleep(30)
        except:
            pass
    
    finally:
        if browser_manager:
            await browser_manager.close()


if __name__ == "__main__":
    asyncio.run(test_parser_engine())


```

```python
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Parser Engine
"""

import asyncio
import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ src
sys.path.insert(0, str(Path(__file__).parent))

from src.browser_manager import BrowserManager
from src.parser_engine import ParserEngine, ProductData
from src.sheets_writer import SheetsWriter
from src import config
from src import logger

log = logger.get_logger("TestParserEngine")


async def test_parser_engine():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Parser Engine"""
    
    browser_manager = None
    try:
        log.info("=" * 60)
        log.info("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï PARSER ENGINE")
        log.info("=" * 60)
        
        # 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
        log.info("\n1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞...")
        browser_manager = BrowserManager()
        success = await browser_manager.initialize(headless=False)  # headful –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä")
            return
        
        # 2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies (–µ—Å–ª–∏ –µ—Å—Ç—å)
        log.info("\n2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies...")
        await browser_manager.load_cookies()
        
        # 3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–∞—á–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads
        log.info("\n3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads...")
        success = await browser_manager.navigate_with_retry(
            config.PIPIADS_INITIAL_URL,
            wait_until="domcontentloaded",
            timeout=30000
        )
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É")
            return
        
        await browser_manager.human_delay(2, 3)
        
        # 4. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
        log.info("\n4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...")
        is_logged_in = await browser_manager._check_logged_in_strict()
        if not is_logged_in:
            log.info("–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...")
            success = await browser_manager.login_to_pipiads()
            if not success:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è")
                return
            await browser_manager.save_cookies()
        else:
            log.info("‚úÖ –£–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω")
        
        # 5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine
        log.info("\n5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine...")
        parser = ParserEngine(browser_manager.page)
        parser.set_browser_manager(browser_manager)
        
        # 6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets (–¥–æ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤)
        log.info("\n6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets...")
        sheets_writer = None
        try:
            sheets_writer = SheetsWriter()
            if sheets_writer.connect():
                log.info("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets —É—Å–ø–µ—à–Ω–æ")
            else:
                log.warning("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Google Sheets, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        except Exception as e:
            log.warning(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Google Sheets: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        
        # 7. –¶–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        log.info("\n" + "=" * 80)
        log.info("7. –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–û–í")
        log.info("=" * 80)
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        # –£–°–õ–ê–ë–õ–ï–ù–û –¥–ª—è —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏: —Å–Ω–∏–∂–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
        MIN_PRODUCTS_TO_COLLECT = 3   # –¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–º–æ–∂–Ω–æ —Å–Ω–∏–∑–∏—Ç—å –¥–æ 1-2)
        MAX_PRODUCTS_TO_CHECK = 15     # –ú–∞–∫—Å–∏–º—É–º —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é (—É–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –≤—ã–±–æ—Ä–∞)
        PRODUCTS_PER_PAGE = 20         # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        
        successful_products = 0  # –°—á–µ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        checked_products = 0      # –°—á–µ—Ç—á–∏–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        skipped_products = []     # –°–ø–∏—Å–æ–∫ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        banned_products = set()   # Ban-list: URL —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ)
        all_products_analytics = []  # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –í–°–ï–• —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è summary-—Ñ–∞–π–ª–∞
        
        def normalize_url(url: str) -> str:
            """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL (—É–±—Ä–∞—Ç—å —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É)"""
            if not url:
                return ""
            url = url.strip().rstrip('/')
            # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if '?' in url:
                url = url.split('?')[0]
            return url
        
        # –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏
        while successful_products < MIN_PRODUCTS_TO_COLLECT and checked_products < MAX_PRODUCTS_TO_CHECK:
            
            # 7.1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
            log.info(f"\n{'='*80}")
            log.info(f"–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã...")
            log.info(f"–ü—Ä–æ–≥—Ä–µ—Å—Å: {successful_products}/{MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ, "
                    f"{checked_products}/{MAX_PRODUCTS_TO_CHECK} –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ")
            log.info(f"{'='*80}")
            
            try:
                products = await parser.get_products_from_search_page(count=PRODUCTS_PER_PAGE)
            except Exception as e:
                log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
                break
            
            if not products:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã, –∑–∞–≤–µ—Ä—à–∞–µ–º")
                break
            
            log.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
            
            # 7.1.5. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ URL (–ø—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è)
            # –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º banned_products –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
            unique_products = []
            duplicate_count = 0
            seen_urls = set()  # –î–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
            
            for product in products:
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ü—Ä–æ–ø—É—Å–∫ —Ç–æ–≤–∞—Ä–∞ –±–µ–∑ URL")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ç–∏–≤ banned_products (—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)
                if product_url in banned_products:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (—É–∂–µ –≤ ban-list): {product_url}")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
                if product_url in seen_urls:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (–≤ —Ç–µ–∫—É—â–µ–º —Å–ø–∏—Å–∫–µ): {product_url}")
                    continue
                
                seen_urls.add(product_url)
                # –û–±–Ω–æ–≤–ª—è–µ–º URL –≤ —Å–ª–æ–≤–∞—Ä–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π
                product['url'] = product_url
                unique_products.append(product)
            
            if duplicate_count > 0:
                log.info(f"üîç –ù–∞–π–¥–µ–Ω–æ {duplicate_count} –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, –æ—Å—Ç–∞–≤–ª–µ–Ω–æ {len(unique_products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤")
            
            products = unique_products  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
            log.info(f"‚úÖ –ü–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏: {len(products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            
            # 7.2. –¶–∏–∫–ª –ø–æ —Ç–æ–≤–∞—Ä–∞–º –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            for product_index, product in enumerate(products):
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    log.info(f"\nüéØ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
                    break
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
                if checked_products >= MAX_PRODUCTS_TO_CHECK:
                    log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
                    break
                
                # ‚ö†Ô∏è –ü–†–û–í–ï–†–ö–ê BAN-LIST: –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                    continue
                
                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
                if product_url in banned_products:
                    log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: {product_url}")
                    log.warning(f"   –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.")
                    continue
                
                # –û—Ç–º–µ—á–∞–µ–º —Ç–æ–≤–∞—Ä –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –°–†–ê–ó–£ (–¥–æ –∫–ª–∏–∫–∞) - —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–≤–∞–∂–¥—ã
                banned_products.add(product_url)
                log.info(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: {product_url}")
                
                checked_products += 1
                
                # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–∞
                log.info(f"\n{'='*80}")
                log.info(f"üì¶ –¢–û–í–ê–† {checked_products}/{MAX_PRODUCTS_TO_CHECK} "
                        f"(—É—Å–ø–µ—à–Ω—ã—Ö: {successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                log.info(f"{'='*80}")
                log.info(f"–ù–∞–∑–≤–∞–Ω–∏–µ: {product.get('name', 'N/A')[:70]}...")
                log.info(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {product.get('category', 'N/A')}")
                log.info(f"URL: {product.get('url', 'N/A')}")
                log.info(f"Product ID: {product_id}")
                
                try:
                    # 7.3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ (–∫–ª–∏–∫ –ø–æ –∏–Ω–¥–µ–∫—Å—É, –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞)
                    # –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥–∞–µ–º banned_products –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
                    product_data = await parser.get_product_details_with_return(
                        product_index=product_index,
                        sheets_writer=sheets_writer,
                        banned_products=banned_products
                    )
                    
                    # 7.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    if product_data is None:
                        # –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
                        log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞")
                        
                        skipped_products.append({
                            "name": product.get('name', 'N/A'),
                            "reason": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ",
                            "videos_found": 0
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ)
                        all_products_analytics.append({
                            "product_name": product.get('name', 'N/A'),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": 0,
                            "top_3_videos": []
                        })
                        continue
                    
                    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç (–µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª—Å—è —Å—Ç–∞—Ç—É—Å "duplicate")
                    if isinstance(product_data, dict) and product_data.get("status") == "duplicate":
                        duplicate_url = product_data.get('product_url', 'N/A')
                        log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): {duplicate_url}")
                        duplicate_count += 1
                        continue
                    
                    if isinstance(product_data, dict) and product_data.get("status") == "insufficient_videos":
                        # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                        log.warning(f"‚è≠Ô∏è  –ü–†–û–ü–£–°–ö: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù–∞–π–¥–µ–Ω–æ: {product_data.get('videos_found', 0)} –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù—É–∂–Ω–æ: {product_data.get('videos_required', 3)} –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": product_data.get('product_name', product.get('name', 'N/A')),
                            "reason": product_data.get('reason', '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ'),
                            "videos_found": product_data.get('videos_found', 0)
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ - —Ç–æ–≤–∞—Ä –≤–µ—Ä–Ω—É–ª insufficient_videos)
                        all_products_analytics.append({
                            "product_name": product_data.get('product_name', product.get('name', 'N/A')),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": product_data.get('videos_found', 0),
                            "top_3_videos": []  # –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–ø-3
                        })
                        continue
                    
                    # 7.5. –°–±–æ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è summary
                    analytics_entry = {
                        "product_name": getattr(product_data, 'product_name', 'N/A'),
                        "product_url": getattr(product_data, 'pipiads_link', product_url),
                        "success": False,
                        "videos_found": len(getattr(product_data, 'videos', [])),
                        "top_3_videos": []
                    }
                    
                    # –ò–∑–≤–ª–µ–∫–∞–µ–º –¢–û–ü-3 –≤–∏–¥–µ–æ (–ø–æ impression) –∏–∑ –í–°–ï–• –≤–∏–¥–µ–æ
                    if hasattr(product_data, '_all_videos_raw'):
                        all_videos = product_data._all_videos_raw
                        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ impression (desc) –∏ –±–µ—Ä–µ–º —Ç–æ–ø-3
                        sorted_videos = sorted(all_videos, key=lambda v: v.get('impression', 0), reverse=True)
                        for i, video in enumerate(sorted_videos[:3], 1):
                            analytics_entry["top_3_videos"].append({
                                "rank": i,
                                "impression": video.get('impression', 0),
                                "first_seen": video.get('first_seen', 'N/A'),
                                "ad_search_url": video.get('ad_search_url', 'N/A')
                            })
                    
                    # 7.6. –£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞
                    if hasattr(product_data, 'videos') and len(product_data.videos) >= 3:
                        successful_products += 1
                        analytics_entry["success"] = True
                        
                        log.info(f"\n‚úÖ –£–°–ü–ï–•! –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω ({successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                        log.info(f"   –ù–∞–∑–≤–∞–Ω–∏–µ: {product_data.product_name[:70]}...")
                        log.info(f"   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ: {len(product_data.videos)}")
                        
                        # –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                        for i, video in enumerate(product_data.videos[:3], 1):
                            log.info(f"   –í–∏–¥–µ–æ {i}: {video.get('impression', 0)} impressions, "
                                    f"{video.get('country', 'N/A')}, {video.get('audience_age', 'N/A')}")
                        
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ –∏ –∫–æ–ø–∏—Ä—É–µ–º –≤ "–£—Å–ø–µ—à–Ω—ã–µ" –µ—Å–ª–∏ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                        if sheets_writer and hasattr(product_data, '_sheets_row'):
                            try:
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã A-Z (–∫—Ä–æ–º–µ C) –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                                if sheets_writer.is_row_complete(product_data._sheets_row):
                                    sheets_writer.copy_to_success_sheet(product_data._sheets_row)
                                    log.info(f"  ‚úÖ –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ ‚Üí —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ '–£—Å–ø–µ—à–Ω—ã–µ'")
                                else:
                                    log.warning(f"  ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ (–µ—Å—Ç—å –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏)")
                            except Exception as e:
                                log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ '–£—Å–ø–µ—à–Ω—ã–µ': {e}")
                    
                    # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
                    all_products_analytics.append(analytics_entry)
                    
                    # 7.7. –ï—Å–ª–∏ –≤–∏–¥–µ–æ –º–µ–Ω—å—à–µ 3 - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                    if not analytics_entry["success"]:
                        log.warning(f"‚ö†Ô∏è –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω, –Ω–æ –º–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": getattr(product_data, 'product_name', product.get('name', 'N/A')),
                            "reason": "–ú–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏",
                            "videos_found": len(getattr(product_data, 'videos', []))
                        })
                
                except Exception as e:
                    log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞: {e}")
                    import traceback
                    log.error(traceback.format_exc())
                    
                    skipped_products.append({
                        "name": product.get('name', 'N/A'),
                        "reason": f"–ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {str(e)[:50]}",
                        "videos_found": 0
                    })
            
            # 7.6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –≤—ã—Ö–æ–¥–∞ –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
            if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                break
            
            if checked_products >= MAX_PRODUCTS_TO_CHECK:
                break
        
        # 8. –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç
        log.info(f"\n{'='*80}")
        log.info("üìä –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢")
        log.info(f"{'='*80}")
        log.info(f"‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {successful_products}")
        log.info(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {len(skipped_products)}")
        log.info(f"üîç –í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {checked_products}")
        log.info(f"üö´ –¢–æ–≤–∞—Ä–æ–≤ –≤ ban-list: {len(banned_products)}")
        log.info(f"{'='*80}")
        
        # –í—ã–≤–æ–¥ ban-list
        if banned_products:
            log.info(f"\nüö´ BAN-LIST (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã):")
            for i, product_url in enumerate(sorted(banned_products), 1):
                log.info(f"   {i}. {product_url}")
        
        if skipped_products:
            log.info(f"\n‚è≠Ô∏è  –°–ü–ò–°–û–ö –ü–†–û–ü–£–©–ï–ù–ù–´–• –¢–û–í–ê–†–û–í:")
            for i, skipped in enumerate(skipped_products, 1):
                log.info(f"   {i}. {skipped['name'][:60]}...")
                log.info(f"      –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}")
                log.info(f"      –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}")
        
        if successful_products >= MIN_PRODUCTS_TO_COLLECT:
            log.info(f"\nüéâ –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
        elif checked_products >= MAX_PRODUCTS_TO_CHECK:
            log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
            log.warning(f"   –°–æ–±—Ä–∞–Ω–æ —Ç–æ–ª—å–∫–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ {MIN_PRODUCTS_TO_COLLECT}")
        
        # 9. –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
        log.info("\n" + "=" * 60)
        log.info("üìù –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –≤–∏–¥–µ–æ...")
        log.info("=" * 60)
        try:
            from datetime import datetime
            import os
            
            summary_dir = "logs/summaries"
            os.makedirs(summary_dir, exist_ok=True)
            
            timestamp = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
            summary_file = f"{summary_dir}/iteration_{timestamp}.md"
            
            with open(summary_file, "w", encoding="utf-8") as f:
                f.write(f"# üìä –ò—Ç–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
                
                f.write("## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã\n\n")
                f.write(f"- **–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ:** {successful_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–ø—É—â–µ–Ω–æ:** {len(skipped_products)} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** {checked_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **Ban-list:** {len(banned_products)} —Ç–æ–≤–∞—Ä–æ–≤\n\n")
                
                if successful_products > 0:
                    f.write("### üéâ SUCCESS\n\n")
                    f.write(f"‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ —Å >= 3 –≤–∏–¥–µ–æ\n\n")
                
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                # –ù–û–í–´–ô –ë–õ–û–ö: –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                if all_products_analytics:
                    f.write("---\n\n")
                    f.write("## üìπ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º\n\n")
                    f.write(f"**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:** >= 5K impressions, –≤–æ–∑—Ä–∞—Å—Ç <= 30 –¥–Ω–µ–π\n\n")
                    
                    for idx, product in enumerate(all_products_analytics, 1):
                        status_icon = "‚úÖ" if product["success"] else "‚ùå"
                        f.write(f"### {status_icon} –¢–æ–≤–∞—Ä #{idx}: {product['product_name'][:80]}\n\n")
                        f.write(f"- **–°—Å—ã–ª–∫–∞:** [{product['product_url']}]({product['product_url']})\n")
                        f.write(f"- **–°—Ç–∞—Ç—É—Å:** {'–£–°–ü–ï–• (>= 3 –≤–∏–¥–µ–æ)' if product['success'] else '–ü–†–û–ü–£–©–ï–ù (< 3 –≤–∏–¥–µ–æ)'}\n")
                        f.write(f"- **–ù–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ:** {product['videos_found']}\n\n")
                        
                        # –¢–û–ü-3 –≤–∏–¥–µ–æ (–¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –∫—Ä–∏—Ç–µ—Ä–∏–∏)
                        if product['top_3_videos']:
                            f.write("#### üèÜ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ impression:\n\n")
                            for video in product['top_3_videos']:
                                impression = video['impression']
                                first_seen = video['first_seen']
                                ad_url = video['ad_search_url']
                                
                                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
                                meets_criteria = impression >= 5000  # –ü—Ä–æ–≤–µ—Ä–∫–∞ impression
                                criteria_icon = "‚úÖ" if meets_criteria else "‚ö†Ô∏è"
                                
                                f.write(f"{video['rank']}. {criteria_icon} **{impression:,} impressions** | "
                                       f"First seen: {first_seen}\n")
                                if ad_url and ad_url != 'N/A':
                                    f.write(f"   - –°—Å—ã–ª–∫–∞: [{ad_url}]({ad_url})\n")
                                f.write("\n")
                        else:
                            f.write("   ‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ (–≤–æ–∑–º–æ–∂–Ω–æ, –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞)\n\n")
                        
                        f.write("---\n\n")
                
                # –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
                if skipped_products:
                    f.write("### ‚è≠Ô∏è –ü–†–û–ü–£–©–ï–ù–ù–´–ï –¢–û–í–ê–†–´ (–∫—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫)\n\n")
                    for i, skipped in enumerate(skipped_products, 1):
                        f.write(f"{i}. **{skipped['name'][:60]}...**\n")
                        f.write(f"   - –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}\n")
                        f.write(f"   - –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}\n\n")
                
                # Ban-list
                if banned_product_ids:
                    f.write("### üö´ Ban-list (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ product_id)\n\n")
                    for i, product_id in enumerate(sorted(banned_product_ids), 1):
                        f.write(f"{i}. `{product_id}`\n")
                    f.write("\n")
                
                f.write("## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏\n\n")
                f.write(f"- **–¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:** {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–õ–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫:** {MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤–∏–¥–µ–æ:** >= 5K impressions, <= 30 –¥–Ω–µ–π\n\n")
                
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    f.write("## üéØ –°—Ç–∞—Ç—É—Å: –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê ‚úÖ\n\n")
                elif checked_products >= MAX_PRODUCTS_TO_CHECK:
                    f.write("## ‚ö†Ô∏è –°—Ç–∞—Ç—É—Å: –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫\n\n")
                else:
                    f.write("## ‚ùå –°—Ç–∞—Ç—É—Å: –ü—Ä–µ—Ä–≤–∞–Ω–æ\n\n")
            
            log.info(f"‚úÖ Summary —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {summary_file}")
        except Exception as e:
            log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ summary: {e}")
            import traceback
            log.error(traceback.format_exc())
        
        log.info("\n" + "=" * 60)
        log.info("‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û")
        log.info("=" * 60)
        
        # –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)
        log.info("\n‚è∏Ô∏è –û–∂–∏–¥–∞–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –±—Ä–∞—É–∑–µ—Ä–∞ (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)...")
        log.info("   –ù–∞–∂–º–∏—Ç–µ Ctrl+C, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å —Ä–∞–Ω—å—à–µ")
        try:
            await asyncio.sleep(10)
        except KeyboardInterrupt:
            log.info("   –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        
    except KeyboardInterrupt:
        log.warning("\n‚ö†Ô∏è –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Ctrl+C)")
    except Exception as e:
        log.error(f"\n{'='*60}")
        log.error(f"‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}")
        log.error(f"{'='*60}")
        import traceback
        log.error("–ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:")
        log.error(traceback.format_exc())
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
        if browser_manager and browser_manager.page:
            try:
                screenshot_path = config.SCREENSHOTS_DIR / f"error_test_{int(asyncio.get_event_loop().time())}.png"
                await browser_manager.page.screenshot(path=str(screenshot_path), full_page=True)
                log.info(f"üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {screenshot_path}")
            except Exception as e2:
                log.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç: {e2}")
        
        log.error("\n‚ö†Ô∏è –ë—Ä–∞—É–∑–µ—Ä –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞ 30 —Å–µ–∫—É–Ω–¥...")
        try:
            await asyncio.sleep(30)
        except:
            pass
    
    finally:
        if browser_manager:
            await browser_manager.close()


if __name__ == "__main__":
    asyncio.run(test_parser_engine())


```

```python
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Parser Engine
"""

import asyncio
import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ src
sys.path.insert(0, str(Path(__file__).parent))

from src.browser_manager import BrowserManager
from src.parser_engine import ParserEngine, ProductData
from src.sheets_writer import SheetsWriter
from src import config
from src import logger

log = logger.get_logger("TestParserEngine")


async def test_parser_engine():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Parser Engine"""
    
    browser_manager = None
    try:
        log.info("=" * 60)
        log.info("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï PARSER ENGINE")
        log.info("=" * 60)
        
        # 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
        log.info("\n1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞...")
        browser_manager = BrowserManager()
        success = await browser_manager.initialize(headless=False)  # headful –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä")
            return
        
        # 2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies (–µ—Å–ª–∏ –µ—Å—Ç—å)
        log.info("\n2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies...")
        await browser_manager.load_cookies()
        
        # 3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–∞—á–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads
        log.info("\n3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads...")
        success = await browser_manager.navigate_with_retry(
            config.PIPIADS_INITIAL_URL,
            wait_until="domcontentloaded",
            timeout=30000
        )
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É")
            return
        
        await browser_manager.human_delay(2, 3)
        
        # 4. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
        log.info("\n4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...")
        is_logged_in = await browser_manager._check_logged_in_strict()
        if not is_logged_in:
            log.info("–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...")
            success = await browser_manager.login_to_pipiads()
            if not success:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è")
                return
            await browser_manager.save_cookies()
        else:
            log.info("‚úÖ –£–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω")
        
        # 5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine
        log.info("\n5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine...")
        parser = ParserEngine(browser_manager.page)
        parser.set_browser_manager(browser_manager)
        
        # 6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets (–¥–æ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤)
        log.info("\n6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets...")
        sheets_writer = None
        try:
            sheets_writer = SheetsWriter()
            if sheets_writer.connect():
                log.info("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets —É—Å–ø–µ—à–Ω–æ")
            else:
                log.warning("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Google Sheets, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        except Exception as e:
            log.warning(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Google Sheets: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        
        # 7. –¶–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        log.info("\n" + "=" * 80)
        log.info("7. –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–û–í")
        log.info("=" * 80)
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        # –£–°–õ–ê–ë–õ–ï–ù–û –¥–ª—è —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏: —Å–Ω–∏–∂–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
        MIN_PRODUCTS_TO_COLLECT = 3   # –¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–º–æ–∂–Ω–æ —Å–Ω–∏–∑–∏—Ç—å –¥–æ 1-2)
        MAX_PRODUCTS_TO_CHECK = 15     # –ú–∞–∫—Å–∏–º—É–º —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é (—É–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –≤—ã–±–æ—Ä–∞)
        PRODUCTS_PER_PAGE = 20         # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        
        successful_products = 0  # –°—á–µ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        checked_products = 0      # –°—á–µ—Ç—á–∏–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        skipped_products = []     # –°–ø–∏—Å–æ–∫ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        banned_products = set()   # Ban-list: URL —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ)
        all_products_analytics = []  # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –í–°–ï–• —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è summary-—Ñ–∞–π–ª–∞
        
        def normalize_url(url: str) -> str:
            """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL (—É–±—Ä–∞—Ç—å —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É)"""
            if not url:
                return ""
            url = url.strip().rstrip('/')
            # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if '?' in url:
                url = url.split('?')[0]
            return url
        
        # –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏
        while successful_products < MIN_PRODUCTS_TO_COLLECT and checked_products < MAX_PRODUCTS_TO_CHECK:
            
            # 7.1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
            log.info(f"\n{'='*80}")
            log.info(f"–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã...")
            log.info(f"–ü—Ä–æ–≥—Ä–µ—Å—Å: {successful_products}/{MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ, "
                    f"{checked_products}/{MAX_PRODUCTS_TO_CHECK} –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ")
            log.info(f"{'='*80}")
            
            try:
                products = await parser.get_products_from_search_page(count=PRODUCTS_PER_PAGE)
            except Exception as e:
                log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
                break
            
            if not products:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã, –∑–∞–≤–µ—Ä—à–∞–µ–º")
                break
            
            log.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
            
            # 7.1.5. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ URL (–ø—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è)
            # –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º banned_products –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
            unique_products = []
            duplicate_count = 0
            seen_urls = set()  # –î–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
            
            for product in products:
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ü—Ä–æ–ø—É—Å–∫ —Ç–æ–≤–∞—Ä–∞ –±–µ–∑ URL")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ç–∏–≤ banned_products (—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)
                if product_url in banned_products:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (—É–∂–µ –≤ ban-list): {product_url}")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
                if product_url in seen_urls:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (–≤ —Ç–µ–∫—É—â–µ–º —Å–ø–∏—Å–∫–µ): {product_url}")
                    continue
                
                seen_urls.add(product_url)
                # –û–±–Ω–æ–≤–ª—è–µ–º URL –≤ —Å–ª–æ–≤–∞—Ä–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π
                product['url'] = product_url
                unique_products.append(product)
            
            if duplicate_count > 0:
                log.info(f"üîç –ù–∞–π–¥–µ–Ω–æ {duplicate_count} –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, –æ—Å—Ç–∞–≤–ª–µ–Ω–æ {len(unique_products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤")
            
            products = unique_products  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
            log.info(f"‚úÖ –ü–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏: {len(products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            
            # 7.2. –¶–∏–∫–ª –ø–æ —Ç–æ–≤–∞—Ä–∞–º –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            for product_index, product in enumerate(products):
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    log.info(f"\nüéØ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
                    break
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
                if checked_products >= MAX_PRODUCTS_TO_CHECK:
                    log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
                    break
                
                # ‚ö†Ô∏è –ü–†–û–í–ï–†–ö–ê BAN-LIST: –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                    continue
                
                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
                if product_url in banned_products:
                    log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: {product_url}")
                    log.warning(f"   –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.")
                    continue
                
                # –û—Ç–º–µ—á–∞–µ–º —Ç–æ–≤–∞—Ä –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –°–†–ê–ó–£ (–¥–æ –∫–ª–∏–∫–∞) - —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–≤–∞–∂–¥—ã
                banned_products.add(product_url)
                log.info(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: {product_url}")
                
                checked_products += 1
                
                # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–∞
                log.info(f"\n{'='*80}")
                log.info(f"üì¶ –¢–û–í–ê–† {checked_products}/{MAX_PRODUCTS_TO_CHECK} "
                        f"(—É—Å–ø–µ—à–Ω—ã—Ö: {successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                log.info(f"{'='*80}")
                log.info(f"–ù–∞–∑–≤–∞–Ω–∏–µ: {product.get('name', 'N/A')[:70]}...")
                log.info(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {product.get('category', 'N/A')}")
                log.info(f"URL: {product.get('url', 'N/A')}")
                log.info(f"Product ID: {product_id}")
                
                try:
                    # 7.3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ (–∫–ª–∏–∫ –ø–æ –∏–Ω–¥–µ–∫—Å—É, –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞)
                    # –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥–∞–µ–º banned_products –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
                    product_data = await parser.get_product_details_with_return(
                        product_index=product_index,
                        sheets_writer=sheets_writer,
                        banned_products=banned_products
                    )
                    
                    # 7.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    if product_data is None:
                        # –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
                        log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞")
                        
                        skipped_products.append({
                            "name": product.get('name', 'N/A'),
                            "reason": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ",
                            "videos_found": 0
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ)
                        all_products_analytics.append({
                            "product_name": product.get('name', 'N/A'),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": 0,
                            "top_3_videos": []
                        })
                        continue
                    
                    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç (–µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª—Å—è —Å—Ç–∞—Ç—É—Å "duplicate")
                    if isinstance(product_data, dict) and product_data.get("status") == "duplicate":
                        duplicate_url = product_data.get('product_url', 'N/A')
                        log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): {duplicate_url}")
                        duplicate_count += 1
                        continue
                    
                    if isinstance(product_data, dict) and product_data.get("status") == "insufficient_videos":
                        # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                        log.warning(f"‚è≠Ô∏è  –ü–†–û–ü–£–°–ö: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù–∞–π–¥–µ–Ω–æ: {product_data.get('videos_found', 0)} –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù—É–∂–Ω–æ: {product_data.get('videos_required', 3)} –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": product_data.get('product_name', product.get('name', 'N/A')),
                            "reason": product_data.get('reason', '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ'),
                            "videos_found": product_data.get('videos_found', 0)
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ - —Ç–æ–≤–∞—Ä –≤–µ—Ä–Ω—É–ª insufficient_videos)
                        all_products_analytics.append({
                            "product_name": product_data.get('product_name', product.get('name', 'N/A')),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": product_data.get('videos_found', 0),
                            "top_3_videos": []  # –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–ø-3
                        })
                        continue
                    
                    # 7.5. –°–±–æ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è summary
                    analytics_entry = {
                        "product_name": getattr(product_data, 'product_name', 'N/A'),
                        "product_url": getattr(product_data, 'pipiads_link', product_url),
                        "success": False,
                        "videos_found": len(getattr(product_data, 'videos', [])),
                        "top_3_videos": []
                    }
                    
                    # –ò–∑–≤–ª–µ–∫–∞–µ–º –¢–û–ü-3 –≤–∏–¥–µ–æ (–ø–æ impression) –∏–∑ –í–°–ï–• –≤–∏–¥–µ–æ
                    if hasattr(product_data, '_all_videos_raw'):
                        all_videos = product_data._all_videos_raw
                        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ impression (desc) –∏ –±–µ—Ä–µ–º —Ç–æ–ø-3
                        sorted_videos = sorted(all_videos, key=lambda v: v.get('impression', 0), reverse=True)
                        for i, video in enumerate(sorted_videos[:3], 1):
                            analytics_entry["top_3_videos"].append({
                                "rank": i,
                                "impression": video.get('impression', 0),
                                "first_seen": video.get('first_seen', 'N/A'),
                                "ad_search_url": video.get('ad_search_url', 'N/A')
                            })
                    
                    # 7.6. –£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞
                    if hasattr(product_data, 'videos') and len(product_data.videos) >= 3:
                        successful_products += 1
                        analytics_entry["success"] = True
                        
                        log.info(f"\n‚úÖ –£–°–ü–ï–•! –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω ({successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                        log.info(f"   –ù–∞–∑–≤–∞–Ω–∏–µ: {product_data.product_name[:70]}...")
                        log.info(f"   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ: {len(product_data.videos)}")
                        
                        # –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                        for i, video in enumerate(product_data.videos[:3], 1):
                            log.info(f"   –í–∏–¥–µ–æ {i}: {video.get('impression', 0)} impressions, "
                                    f"{video.get('country', 'N/A')}, {video.get('audience_age', 'N/A')}")
                        
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ –∏ –∫–æ–ø–∏—Ä—É–µ–º –≤ "–£—Å–ø–µ—à–Ω—ã–µ" –µ—Å–ª–∏ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                        if sheets_writer and hasattr(product_data, '_sheets_row'):
                            try:
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã A-Z (–∫—Ä–æ–º–µ C) –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                                if sheets_writer.is_row_complete(product_data._sheets_row):
                                    sheets_writer.copy_to_success_sheet(product_data._sheets_row)
                                    log.info(f"  ‚úÖ –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ ‚Üí —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ '–£—Å–ø–µ—à–Ω—ã–µ'")
                                else:
                                    log.warning(f"  ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ (–µ—Å—Ç—å –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏)")
                            except Exception as e:
                                log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ '–£—Å–ø–µ—à–Ω—ã–µ': {e}")
                    
                    # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
                    all_products_analytics.append(analytics_entry)
                    
                    # 7.7. –ï—Å–ª–∏ –≤–∏–¥–µ–æ –º–µ–Ω—å—à–µ 3 - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                    if not analytics_entry["success"]:
                        log.warning(f"‚ö†Ô∏è –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω, –Ω–æ –º–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": getattr(product_data, 'product_name', product.get('name', 'N/A')),
                            "reason": "–ú–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏",
                            "videos_found": len(getattr(product_data, 'videos', []))
                        })
                
                except Exception as e:
                    log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞: {e}")
                    import traceback
                    log.error(traceback.format_exc())
                    
                    skipped_products.append({
                        "name": product.get('name', 'N/A'),
                        "reason": f"–ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {str(e)[:50]}",
                        "videos_found": 0
                    })
            
            # 7.6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –≤—ã—Ö–æ–¥–∞ –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
            if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                break
            
            if checked_products >= MAX_PRODUCTS_TO_CHECK:
                break
        
        # 8. –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç
        log.info(f"\n{'='*80}")
        log.info("üìä –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢")
        log.info(f"{'='*80}")
        log.info(f"‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {successful_products}")
        log.info(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {len(skipped_products)}")
        log.info(f"üîç –í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {checked_products}")
        log.info(f"üö´ –¢–æ–≤–∞—Ä–æ–≤ –≤ ban-list: {len(banned_products)}")
        log.info(f"{'='*80}")
        
        # –í—ã–≤–æ–¥ ban-list
        if banned_products:
            log.info(f"\nüö´ BAN-LIST (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã):")
            for i, product_url in enumerate(sorted(banned_products), 1):
                log.info(f"   {i}. {product_url}")
        
        if skipped_products:
            log.info(f"\n‚è≠Ô∏è  –°–ü–ò–°–û–ö –ü–†–û–ü–£–©–ï–ù–ù–´–• –¢–û–í–ê–†–û–í:")
            for i, skipped in enumerate(skipped_products, 1):
                log.info(f"   {i}. {skipped['name'][:60]}...")
                log.info(f"      –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}")
                log.info(f"      –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}")
        
        if successful_products >= MIN_PRODUCTS_TO_COLLECT:
            log.info(f"\nüéâ –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
        elif checked_products >= MAX_PRODUCTS_TO_CHECK:
            log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
            log.warning(f"   –°–æ–±—Ä–∞–Ω–æ —Ç–æ–ª—å–∫–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ {MIN_PRODUCTS_TO_COLLECT}")
        
        # 9. –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
        log.info("\n" + "=" * 60)
        log.info("üìù –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –≤–∏–¥–µ–æ...")
        log.info("=" * 60)
        try:
            from datetime import datetime
            import os
            
            summary_dir = "logs/summaries"
            os.makedirs(summary_dir, exist_ok=True)
            
            timestamp = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
            summary_file = f"{summary_dir}/iteration_{timestamp}.md"
            
            with open(summary_file, "w", encoding="utf-8") as f:
                f.write(f"# üìä –ò—Ç–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
                
                f.write("## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã\n\n")
                f.write(f"- **–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ:** {successful_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–ø—É—â–µ–Ω–æ:** {len(skipped_products)} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** {checked_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **Ban-list:** {len(banned_products)} —Ç–æ–≤–∞—Ä–æ–≤\n\n")
                
                if successful_products > 0:
                    f.write("### üéâ SUCCESS\n\n")
                    f.write(f"‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ —Å >= 3 –≤–∏–¥–µ–æ\n\n")
                
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                # –ù–û–í–´–ô –ë–õ–û–ö: –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                if all_products_analytics:
                    f.write("---\n\n")
                    f.write("## üìπ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º\n\n")
                    f.write(f"**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:** >= 5K impressions, –≤–æ–∑—Ä–∞—Å—Ç <= 30 –¥–Ω–µ–π\n\n")
                    
                    for idx, product in enumerate(all_products_analytics, 1):
                        status_icon = "‚úÖ" if product["success"] else "‚ùå"
                        f.write(f"### {status_icon} –¢–æ–≤–∞—Ä #{idx}: {product['product_name'][:80]}\n\n")
                        f.write(f"- **–°—Å—ã–ª–∫–∞:** [{product['product_url']}]({product['product_url']})\n")
                        f.write(f"- **–°—Ç–∞—Ç—É—Å:** {'–£–°–ü–ï–• (>= 3 –≤–∏–¥–µ–æ)' if product['success'] else '–ü–†–û–ü–£–©–ï–ù (< 3 –≤–∏–¥–µ–æ)'}\n")
                        f.write(f"- **–ù–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ:** {product['videos_found']}\n\n")
                        
                        # –¢–û–ü-3 –≤–∏–¥–µ–æ (–¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –∫—Ä–∏—Ç–µ—Ä–∏–∏)
                        if product['top_3_videos']:
                            f.write("#### üèÜ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ impression:\n\n")
                            for video in product['top_3_videos']:
                                impression = video['impression']
                                first_seen = video['first_seen']
                                ad_url = video['ad_search_url']
                                
                                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
                                meets_criteria = impression >= 5000  # –ü—Ä–æ–≤–µ—Ä–∫–∞ impression
                                criteria_icon = "‚úÖ" if meets_criteria else "‚ö†Ô∏è"
                                
                                f.write(f"{video['rank']}. {criteria_icon} **{impression:,} impressions** | "
                                       f"First seen: {first_seen}\n")
                                if ad_url and ad_url != 'N/A':
                                    f.write(f"   - –°—Å—ã–ª–∫–∞: [{ad_url}]({ad_url})\n")
                                f.write("\n")
                        else:
                            f.write("   ‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ (–≤–æ–∑–º–æ–∂–Ω–æ, –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞)\n\n")
                        
                        f.write("---\n\n")
                
                # –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
                if skipped_products:
                    f.write("### ‚è≠Ô∏è –ü–†–û–ü–£–©–ï–ù–ù–´–ï –¢–û–í–ê–†–´ (–∫—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫)\n\n")
                    for i, skipped in enumerate(skipped_products, 1):
                        f.write(f"{i}. **{skipped['name'][:60]}...**\n")
                        f.write(f"   - –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}\n")
                        f.write(f"   - –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}\n\n")
                
                # Ban-list
                if banned_products:
                    f.write("### üö´ Ban-list (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)\n\n")
                    for i, product_url in enumerate(sorted(banned_products), 1):
                        f.write(f"{i}. `{product_url}`\n")
                    f.write("\n")
                
                f.write("## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏\n\n")
                f.write(f"- **–¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:** {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–õ–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫:** {MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤–∏–¥–µ–æ:** >= 5K impressions, <= 30 –¥–Ω–µ–π\n\n")
                
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    f.write("## üéØ –°—Ç–∞—Ç—É—Å: –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê ‚úÖ\n\n")
                elif checked_products >= MAX_PRODUCTS_TO_CHECK:
                    f.write("## ‚ö†Ô∏è –°—Ç–∞—Ç—É—Å: –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫\n\n")
                else:
                    f.write("## ‚ùå –°—Ç–∞—Ç—É—Å: –ü—Ä–µ—Ä–≤–∞–Ω–æ\n\n")
            
            log.info(f"‚úÖ Summary —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {summary_file}")
        except Exception as e:
            log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ summary: {e}")
            import traceback
            log.error(traceback.format_exc())
        
        log.info("\n" + "=" * 60)
        log.info("‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û")
        log.info("=" * 60)
        
        # –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)
        log.info("\n‚è∏Ô∏è –û–∂–∏–¥–∞–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –±—Ä–∞—É–∑–µ—Ä–∞ (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)...")
        log.info("   –ù–∞–∂–º–∏—Ç–µ Ctrl+C, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å —Ä–∞–Ω—å—à–µ")
        try:
            await asyncio.sleep(10)
        except KeyboardInterrupt:
            log.info("   –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        
    except KeyboardInterrupt:
        log.warning("\n‚ö†Ô∏è –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Ctrl+C)")
    except Exception as e:
        log.error(f"\n{'='*60}")
        log.error(f"‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}")
        log.error(f"{'='*60}")
        import traceback
        log.error("–ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:")
        log.error(traceback.format_exc())
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
        if browser_manager and browser_manager.page:
            try:
                screenshot_path = config.SCREENSHOTS_DIR / f"error_test_{int(asyncio.get_event_loop().time())}.png"
                await browser_manager.page.screenshot(path=str(screenshot_path), full_page=True)
                log.info(f"üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {screenshot_path}")
            except Exception as e2:
                log.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç: {e2}")
        
        log.error("\n‚ö†Ô∏è –ë—Ä–∞—É–∑–µ—Ä –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞ 30 —Å–µ–∫—É–Ω–¥...")
        try:
            await asyncio.sleep(30)
        except:
            pass
    
    finally:
        if browser_manager:
            await browser_manager.close()


if __name__ == "__main__":
    asyncio.run(test_parser_engine())


```

–ò—Å–ø—Ä–∞–≤–ª—è—é –æ—à–∏–±–∫—É –∏ –æ–±–Ω–æ–≤–ª—è—é `parser_engine.py`:


```python
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Parser Engine
"""

import asyncio
import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ src
sys.path.insert(0, str(Path(__file__).parent))

from src.browser_manager import BrowserManager
from src.parser_engine import ParserEngine, ProductData
from src.sheets_writer import SheetsWriter
from src import config
from src import logger

log = logger.get_logger("TestParserEngine")


async def test_parser_engine():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Parser Engine"""
    
    browser_manager = None
    try:
        log.info("=" * 60)
        log.info("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï PARSER ENGINE")
        log.info("=" * 60)
        
        # 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
        log.info("\n1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞...")
        browser_manager = BrowserManager()
        success = await browser_manager.initialize(headless=False)  # headful –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä")
            return
        
        # 2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies (–µ—Å–ª–∏ –µ—Å—Ç—å)
        log.info("\n2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies...")
        await browser_manager.load_cookies()
        
        # 3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–∞—á–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads
        log.info("\n3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads...")
        success = await browser_manager.navigate_with_retry(
            config.PIPIADS_INITIAL_URL,
            wait_until="domcontentloaded",
            timeout=30000
        )
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É")
            return
        
        await browser_manager.human_delay(2, 3)
        
        # 4. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
        log.info("\n4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...")
        is_logged_in = await browser_manager._check_logged_in_strict()
        if not is_logged_in:
            log.info("–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...")
            success = await browser_manager.login_to_pipiads()
            if not success:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è")
                return
            await browser_manager.save_cookies()
        else:
            log.info("‚úÖ –£–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω")
        
        # 5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine
        log.info("\n5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine...")
        parser = ParserEngine(browser_manager.page)
        parser.set_browser_manager(browser_manager)
        
        # 6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets (–¥–æ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤)
        log.info("\n6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets...")
        sheets_writer = None
        try:
            sheets_writer = SheetsWriter()
            if sheets_writer.connect():
                log.info("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets —É—Å–ø–µ—à–Ω–æ")
            else:
                log.warning("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Google Sheets, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        except Exception as e:
            log.warning(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Google Sheets: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        
        # 7. –¶–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        log.info("\n" + "=" * 80)
        log.info("7. –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–û–í")
        log.info("=" * 80)
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        # –£–°–õ–ê–ë–õ–ï–ù–û –¥–ª—è —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏: —Å–Ω–∏–∂–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
        MIN_PRODUCTS_TO_COLLECT = 3   # –¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–º–æ–∂–Ω–æ —Å–Ω–∏–∑–∏—Ç—å –¥–æ 1-2)
        MAX_PRODUCTS_TO_CHECK = 15     # –ú–∞–∫—Å–∏–º—É–º —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é (—É–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –≤—ã–±–æ—Ä–∞)
        PRODUCTS_PER_PAGE = 20         # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        
        successful_products = 0  # –°—á–µ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        checked_products = 0      # –°—á–µ—Ç—á–∏–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        skipped_products = []     # –°–ø–∏—Å–æ–∫ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        banned_products = set()   # Ban-list: URL —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ)
        all_products_analytics = []  # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –í–°–ï–• —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è summary-—Ñ–∞–π–ª–∞
        
        def normalize_url(url: str) -> str:
            """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL (—É–±—Ä–∞—Ç—å —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É)"""
            if not url:
                return ""
            url = url.strip().rstrip('/')
            # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if '?' in url:
                url = url.split('?')[0]
            return url
        
        # –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏
        while successful_products < MIN_PRODUCTS_TO_COLLECT and checked_products < MAX_PRODUCTS_TO_CHECK:
            
            # 7.1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
            log.info(f"\n{'='*80}")
            log.info(f"–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã...")
            log.info(f"–ü—Ä–æ–≥—Ä–µ—Å—Å: {successful_products}/{MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ, "
                    f"{checked_products}/{MAX_PRODUCTS_TO_CHECK} –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ")
            log.info(f"{'='*80}")
            
            try:
                products = await parser.get_products_from_search_page(count=PRODUCTS_PER_PAGE)
            except Exception as e:
                log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
                break
            
            if not products:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã, –∑–∞–≤–µ—Ä—à–∞–µ–º")
                break
            
            log.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
            
            # 7.1.5. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ URL (–ø—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è)
            # –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º banned_products –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
            unique_products = []
            duplicate_count = 0
            seen_urls = set()  # –î–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
            
            for product in products:
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ü—Ä–æ–ø—É—Å–∫ —Ç–æ–≤–∞—Ä–∞ –±–µ–∑ URL")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ç–∏–≤ banned_products (—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)
                if product_url in banned_products:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (—É–∂–µ –≤ ban-list): {product_url}")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
                if product_url in seen_urls:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (–≤ —Ç–µ–∫—É—â–µ–º —Å–ø–∏—Å–∫–µ): {product_url}")
                    continue
                
                seen_urls.add(product_url)
                # –û–±–Ω–æ–≤–ª—è–µ–º URL –≤ —Å–ª–æ–≤–∞—Ä–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π
                product['url'] = product_url
                unique_products.append(product)
            
            if duplicate_count > 0:
                log.info(f"üîç –ù–∞–π–¥–µ–Ω–æ {duplicate_count} –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, –æ—Å—Ç–∞–≤–ª–µ–Ω–æ {len(unique_products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤")
            
            products = unique_products  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
            log.info(f"‚úÖ –ü–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏: {len(products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            
            # 7.2. –¶–∏–∫–ª –ø–æ —Ç–æ–≤–∞—Ä–∞–º –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            for product_index, product in enumerate(products):
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    log.info(f"\nüéØ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
                    break
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
                if checked_products >= MAX_PRODUCTS_TO_CHECK:
                    log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
                    break
                
                # ‚ö†Ô∏è –ü–†–û–í–ï–†–ö–ê BAN-LIST: –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                    continue
                
                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
                if product_url in banned_products:
                    log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: {product_url}")
                    log.warning(f"   –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.")
                    continue
                
                # –û—Ç–º–µ—á–∞–µ–º —Ç–æ–≤–∞—Ä –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –°–†–ê–ó–£ (–¥–æ –∫–ª–∏–∫–∞) - —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–≤–∞–∂–¥—ã
                banned_products.add(product_url)
                log.info(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: {product_url}")
                
                checked_products += 1
                
                # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–∞
                log.info(f"\n{'='*80}")
                log.info(f"üì¶ –¢–û–í–ê–† {checked_products}/{MAX_PRODUCTS_TO_CHECK} "
                        f"(—É—Å–ø–µ—à–Ω—ã—Ö: {successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                log.info(f"{'='*80}")
                log.info(f"–ù–∞–∑–≤–∞–Ω–∏–µ: {product.get('name', 'N/A')[:70]}...")
                log.info(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {product.get('category', 'N/A')}")
                log.info(f"URL: {product_url}")
                
                try:
                    # 7.3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ (–∫–ª–∏–∫ –ø–æ –∏–Ω–¥–µ–∫—Å—É, –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞)
                    # –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥–∞–µ–º banned_products –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
                    product_data = await parser.get_product_details_with_return(
                        product_index=product_index,
                        sheets_writer=sheets_writer,
                        banned_products=banned_products
                    )
                    
                    # 7.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    if product_data is None:
                        # –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
                        log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞")
                        
                        skipped_products.append({
                            "name": product.get('name', 'N/A'),
                            "reason": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ",
                            "videos_found": 0
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ)
                        all_products_analytics.append({
                            "product_name": product.get('name', 'N/A'),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": 0,
                            "top_3_videos": []
                        })
                        continue
                    
                    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç (–µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª—Å—è —Å—Ç–∞—Ç—É—Å "duplicate")
                    if isinstance(product_data, dict) and product_data.get("status") == "duplicate":
                        duplicate_url = product_data.get('product_url', 'N/A')
                        log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): {duplicate_url}")
                        duplicate_count += 1
                        continue
                    
                    if isinstance(product_data, dict) and product_data.get("status") == "insufficient_videos":
                        # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                        log.warning(f"‚è≠Ô∏è  –ü–†–û–ü–£–°–ö: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù–∞–π–¥–µ–Ω–æ: {product_data.get('videos_found', 0)} –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù—É–∂–Ω–æ: {product_data.get('videos_required', 3)} –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": product_data.get('product_name', product.get('name', 'N/A')),
                            "reason": product_data.get('reason', '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ'),
                            "videos_found": product_data.get('videos_found', 0)
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ - —Ç–æ–≤–∞—Ä –≤–µ—Ä–Ω—É–ª insufficient_videos)
                        all_products_analytics.append({
                            "product_name": product_data.get('product_name', product.get('name', 'N/A')),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": product_data.get('videos_found', 0),
                            "top_3_videos": []  # –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–ø-3
                        })
                        continue
                    
                    # 7.5. –°–±–æ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è summary
                    analytics_entry = {
                        "product_name": getattr(product_data, 'product_name', 'N/A'),
                        "product_url": getattr(product_data, 'pipiads_link', product_url),
                        "success": False,
                        "videos_found": len(getattr(product_data, 'videos', [])),
                        "top_3_videos": []
                    }
                    
                    # –ò–∑–≤–ª–µ–∫–∞–µ–º –¢–û–ü-3 –≤–∏–¥–µ–æ (–ø–æ impression) –∏–∑ –í–°–ï–• –≤–∏–¥–µ–æ
                    if hasattr(product_data, '_all_videos_raw'):
                        all_videos = product_data._all_videos_raw
                        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ impression (desc) –∏ –±–µ—Ä–µ–º —Ç–æ–ø-3
                        sorted_videos = sorted(all_videos, key=lambda v: v.get('impression', 0), reverse=True)
                        for i, video in enumerate(sorted_videos[:3], 1):
                            analytics_entry["top_3_videos"].append({
                                "rank": i,
                                "impression": video.get('impression', 0),
                                "first_seen": video.get('first_seen', 'N/A'),
                                "ad_search_url": video.get('ad_search_url', 'N/A')
                            })
                    
                    # 7.6. –£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞
                    if hasattr(product_data, 'videos') and len(product_data.videos) >= 3:
                        successful_products += 1
                        analytics_entry["success"] = True
                        
                        log.info(f"\n‚úÖ –£–°–ü–ï–•! –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω ({successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                        log.info(f"   –ù–∞–∑–≤–∞–Ω–∏–µ: {product_data.product_name[:70]}...")
                        log.info(f"   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ: {len(product_data.videos)}")
                        
                        # –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                        for i, video in enumerate(product_data.videos[:3], 1):
                            log.info(f"   –í–∏–¥–µ–æ {i}: {video.get('impression', 0)} impressions, "
                                    f"{video.get('country', 'N/A')}, {video.get('audience_age', 'N/A')}")
                        
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ –∏ –∫–æ–ø–∏—Ä—É–µ–º –≤ "–£—Å–ø–µ—à–Ω—ã–µ" –µ—Å–ª–∏ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                        if sheets_writer and hasattr(product_data, '_sheets_row'):
                            try:
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã A-Z (–∫—Ä–æ–º–µ C) –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                                if sheets_writer.is_row_complete(product_data._sheets_row):
                                    sheets_writer.copy_to_success_sheet(product_data._sheets_row)
                                    log.info(f"  ‚úÖ –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ ‚Üí —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ '–£—Å–ø–µ—à–Ω—ã–µ'")
                                else:
                                    log.warning(f"  ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ (–µ—Å—Ç—å –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏)")
                            except Exception as e:
                                log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ '–£—Å–ø–µ—à–Ω—ã–µ': {e}")
                    
                    # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
                    all_products_analytics.append(analytics_entry)
                    
                    # 7.7. –ï—Å–ª–∏ –≤–∏–¥–µ–æ –º–µ–Ω—å—à–µ 3 - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                    if not analytics_entry["success"]:
                        log.warning(f"‚ö†Ô∏è –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω, –Ω–æ –º–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": getattr(product_data, 'product_name', product.get('name', 'N/A')),
                            "reason": "–ú–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏",
                            "videos_found": len(getattr(product_data, 'videos', []))
                        })
                
                except Exception as e:
                    log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞: {e}")
                    import traceback
                    log.error(traceback.format_exc())
                    
                    skipped_products.append({
                        "name": product.get('name', 'N/A'),
                        "reason": f"–ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {str(e)[:50]}",
                        "videos_found": 0
                    })
            
            # 7.6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –≤—ã—Ö–æ–¥–∞ –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
            if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                break
            
            if checked_products >= MAX_PRODUCTS_TO_CHECK:
                break
        
        # 8. –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç
        log.info(f"\n{'='*80}")
        log.info("üìä –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢")
        log.info(f"{'='*80}")
        log.info(f"‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {successful_products}")
        log.info(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {len(skipped_products)}")
        log.info(f"üîç –í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {checked_products}")
        log.info(f"üö´ –¢–æ–≤–∞—Ä–æ–≤ –≤ ban-list: {len(banned_products)}")
        log.info(f"{'='*80}")
        
        # –í—ã–≤–æ–¥ ban-list
        if banned_products:
            log.info(f"\nüö´ BAN-LIST (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã):")
            for i, product_url in enumerate(sorted(banned_products), 1):
                log.info(f"   {i}. {product_url}")
        
        if skipped_products:
            log.info(f"\n‚è≠Ô∏è  –°–ü–ò–°–û–ö –ü–†–û–ü–£–©–ï–ù–ù–´–• –¢–û–í–ê–†–û–í:")
            for i, skipped in enumerate(skipped_products, 1):
                log.info(f"   {i}. {skipped['name'][:60]}...")
                log.info(f"      –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}")
                log.info(f"      –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}")
        
        if successful_products >= MIN_PRODUCTS_TO_COLLECT:
            log.info(f"\nüéâ –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
        elif checked_products >= MAX_PRODUCTS_TO_CHECK:
            log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
            log.warning(f"   –°–æ–±—Ä–∞–Ω–æ —Ç–æ–ª—å–∫–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ {MIN_PRODUCTS_TO_COLLECT}")
        
        # 9. –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
        log.info("\n" + "=" * 60)
        log.info("üìù –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –≤–∏–¥–µ–æ...")
        log.info("=" * 60)
        try:
            from datetime import datetime
            import os
            
            summary_dir = "logs/summaries"
            os.makedirs(summary_dir, exist_ok=True)
            
            timestamp = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
            summary_file = f"{summary_dir}/iteration_{timestamp}.md"
            
            with open(summary_file, "w", encoding="utf-8") as f:
                f.write(f"# üìä –ò—Ç–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
                
                f.write("## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã\n\n")
                f.write(f"- **–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ:** {successful_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–ø—É—â–µ–Ω–æ:** {len(skipped_products)} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** {checked_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **Ban-list:** {len(banned_products)} —Ç–æ–≤–∞—Ä–æ–≤\n\n")
                
                if successful_products > 0:
                    f.write("### üéâ SUCCESS\n\n")
                    f.write(f"‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ —Å >= 3 –≤–∏–¥–µ–æ\n\n")
                
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                # –ù–û–í–´–ô –ë–õ–û–ö: –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                if all_products_analytics:
                    f.write("---\n\n")
                    f.write("## üìπ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º\n\n")
                    f.write(f"**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:** >= 5K impressions, –≤–æ–∑—Ä–∞—Å—Ç <= 30 –¥–Ω–µ–π\n\n")
                    
                    for idx, product in enumerate(all_products_analytics, 1):
                        status_icon = "‚úÖ" if product["success"] else "‚ùå"
                        f.write(f"### {status_icon} –¢–æ–≤–∞—Ä #{idx}: {product['product_name'][:80]}\n\n")
                        f.write(f"- **–°—Å—ã–ª–∫–∞:** [{product['product_url']}]({product['product_url']})\n")
                        f.write(f"- **–°—Ç–∞—Ç—É—Å:** {'–£–°–ü–ï–• (>= 3 –≤–∏–¥–µ–æ)' if product['success'] else '–ü–†–û–ü–£–©–ï–ù (< 3 –≤–∏–¥–µ–æ)'}\n")
                        f.write(f"- **–ù–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ:** {product['videos_found']}\n\n")
                        
                        # –¢–û–ü-3 –≤–∏–¥–µ–æ (–¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –∫—Ä–∏—Ç–µ—Ä–∏–∏)
                        if product['top_3_videos']:
                            f.write("#### üèÜ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ impression:\n\n")
                            for video in product['top_3_videos']:
                                impression = video['impression']
                                first_seen = video['first_seen']
                                ad_url = video['ad_search_url']
                                
                                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
                                meets_criteria = impression >= 5000  # –ü—Ä–æ–≤–µ—Ä–∫–∞ impression
                                criteria_icon = "‚úÖ" if meets_criteria else "‚ö†Ô∏è"
                                
                                f.write(f"{video['rank']}. {criteria_icon} **{impression:,} impressions** | "
                                       f"First seen: {first_seen}\n")
                                if ad_url and ad_url != 'N/A':
                                    f.write(f"   - –°—Å—ã–ª–∫–∞: [{ad_url}]({ad_url})\n")
                                f.write("\n")
                        else:
                            f.write("   ‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ (–≤–æ–∑–º–æ–∂–Ω–æ, –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞)\n\n")
                        
                        f.write("---\n\n")
                
                # –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
                if skipped_products:
                    f.write("### ‚è≠Ô∏è –ü–†–û–ü–£–©–ï–ù–ù–´–ï –¢–û–í–ê–†–´ (–∫—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫)\n\n")
                    for i, skipped in enumerate(skipped_products, 1):
                        f.write(f"{i}. **{skipped['name'][:60]}...**\n")
                        f.write(f"   - –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}\n")
                        f.write(f"   - –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}\n\n")
                
                # Ban-list
                if banned_products:
                    f.write("### üö´ Ban-list (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)\n\n")
                    for i, product_url in enumerate(sorted(banned_products), 1):
                        f.write(f"{i}. `{product_url}`\n")
                    f.write("\n")
                
                f.write("## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏\n\n")
                f.write(f"- **–¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:** {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–õ–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫:** {MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤–∏–¥–µ–æ:** >= 5K impressions, <= 30 –¥–Ω–µ–π\n\n")
                
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    f.write("## üéØ –°—Ç–∞—Ç—É—Å: –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê ‚úÖ\n\n")
                elif checked_products >= MAX_PRODUCTS_TO_CHECK:
                    f.write("## ‚ö†Ô∏è –°—Ç–∞—Ç—É—Å: –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫\n\n")
                else:
                    f.write("## ‚ùå –°—Ç–∞—Ç—É—Å: –ü—Ä–µ—Ä–≤–∞–Ω–æ\n\n")
            
            log.info(f"‚úÖ Summary —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {summary_file}")
        except Exception as e:
            log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ summary: {e}")
            import traceback
            log.error(traceback.format_exc())
        
        log.info("\n" + "=" * 60)
        log.info("‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û")
        log.info("=" * 60)
        
        # –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)
        log.info("\n‚è∏Ô∏è –û–∂–∏–¥–∞–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –±—Ä–∞—É–∑–µ—Ä–∞ (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)...")
        log.info("   –ù–∞–∂–º–∏—Ç–µ Ctrl+C, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å —Ä–∞–Ω—å—à–µ")
        try:
            await asyncio.sleep(10)
        except KeyboardInterrupt:
            log.info("   –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        
    except KeyboardInterrupt:
        log.warning("\n‚ö†Ô∏è –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Ctrl+C)")
    except Exception as e:
        log.error(f"\n{'='*60}")
        log.error(f"‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}")
        log.error(f"{'='*60}")
        import traceback
        log.error("–ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:")
        log.error(traceback.format_exc())
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
        if browser_manager and browser_manager.page:
            try:
                screenshot_path = config.SCREENSHOTS_DIR / f"error_test_{int(asyncio.get_event_loop().time())}.png"
                await browser_manager.page.screenshot(path=str(screenshot_path), full_page=True)
                log.info(f"üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {screenshot_path}")
            except Exception as e2:
                log.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç: {e2}")
        
        log.error("\n‚ö†Ô∏è –ë—Ä–∞—É–∑–µ—Ä –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞ 30 —Å–µ–∫—É–Ω–¥...")
        try:
            await asyncio.sleep(30)
        except:
            pass
    
    finally:
        if browser_manager:
            await browser_manager.close()


if __name__ == "__main__":
    asyncio.run(test_parser_engine())


```

–û–±–Ω–æ–≤–ª—è—é `parser_engine.py` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `banned_products` (URL –≤–º–µ—Å—Ç–æ product_id):


```python
"""
Parser Engine - –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö —Å Pipiads
"""

import asyncio
import re
import time
from typing import List, Dict, Optional, Any
from datetime import datetime

from playwright.async_api import Page, TimeoutError as PlaywrightTimeoutError

from . import config
from . import logger
from . import validator

log = logger.get_logger("ParserEngine")


class ProductData:
    """–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞"""
    def __init__(self):
        self.product_name: str = ""
        self.category: str = ""
        self.pipiads_link: str = ""
        self.videos: List[Dict[str, Any]] = []


class ParserEngine:
    """–ü–∞—Ä—Å–µ—Ä –¥–∞–Ω–Ω—ã—Ö —Å Pipiads"""
    
    def __init__(self, page: Page):
        self.page = page
        self.browser_manager = None  # –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ human_delay
    
    def set_browser_manager(self, browser_manager):
        """–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ browser_manager –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è human_delay"""
        self.browser_manager = browser_manager
    
    async def human_delay(self, min_seconds: float = 1, max_seconds: float = 3):
        """–ò–º–∏—Ç–∞—Ü–∏—è —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏"""
        if self.browser_manager:
            await self.browser_manager.human_delay(min_seconds, max_seconds)
        else:
            delay = asyncio.sleep(1)  # Fallback
            await delay
    
    async def scroll_to_element(self, selector: str, timeout: int = 10000):
        """
        –°–∫—Ä–æ–ª–ª–∏—Ç—å –¥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
        
        Args:
            selector: –°–µ–ª–µ–∫—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞
            timeout: –¢–∞–π–º–∞—É—Ç –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
        """
        try:
            element = await self.page.wait_for_selector(selector, timeout=timeout, state="visible")
            if element:
                await element.scroll_into_view_if_needed()
                await self.human_delay(0.5, 1)
                return True
        except:
            pass
        return False
    
    async def get_products_from_search_page(self, count: int = 3) -> List[Dict[str, str]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞
        
        Args:
            count: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ (–¥–ª—è MVP-0: 1, –ø–æ—Ç–æ–º —Ä–∞—Å—à–∏—Ä–∏–º –¥–æ 3)
        
        Returns:
            –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–æ–≤: [{"name": "...", "category": "...", "url": "..."}]
        """
        log.info(f"–ü–æ–ª—É—á–µ–Ω–∏–µ {count} —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞...")
        
        try:
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (domcontentloaded –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º networkidle)
            await self.page.wait_for_load_state("domcontentloaded")
            await self.human_delay(2, 3)
            
            # –°–∫—Ä–æ–ª–ª–∏–º –≤–Ω–∏–∑, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
            log.info("–°–∫—Ä–æ–ª–ª–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤...")
            for i in range(3):  # –°–∫—Ä–æ–ª–ª–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
                await self.page.evaluate("window.scrollBy(0, 500)")
                await self.human_delay(1, 2)
            
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤
            await self.human_delay(2, 3)
            
            # –ò—â–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ - –ø—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
            product_selectors = [
                'a[href*="/tiktok-shop-product/"]',
                '[class*="product"]',
                '[class*="card"]',
                'div[class*="item"]',
            ]
            
            products = []
            product_ids = set()  # –î–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ product_id
            
            def extract_product_id(url: str) -> str:
                """–ò–∑–≤–ª–µ—á—å product_id –∏–∑ URL"""
                # https://www.pipiads.com/tiktok-shop-product/1729732622305364547/
                # ‚Üí 1729732622305364547
                url_normalized = url.rstrip('/')
                parts = url_normalized.split('/')
                return parts[-1] if parts else ""
            
            for selector in product_selectors:
                try:
                    elements = await self.page.query_selector_all(selector)
                    log.info(f"üîç –ù–∞–π–¥–µ–Ω–æ {len(elements)} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º '{selector}'")
                    
                    for element in elements:
                        if len(products) >= count:
                            break
                        
                        try:
                            # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É
                            href = await element.get_attribute("href")
                            if not href:
                                # –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ —Å—Å—ã–ª–∫–∞, –∏—â–µ–º —Å—Å—ã–ª–∫—É –≤–Ω—É—Ç—Ä–∏
                                link_element = await element.query_selector('a[href*="/tiktok-shop-product/"]')
                                if link_element:
                                    href = await link_element.get_attribute("href")
                            
                            if href and "/tiktok-shop-product/" in href:
                                # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π URL
                                if href.startswith("/"):
                                    url = f"https://www.pipiads.com{href}"
                                elif href.startswith("http"):
                                    url = href
                                else:
                                    url = f"https://www.pipiads.com/{href}"
                                
                                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º URL (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ)
                                url = url.rstrip('/')
                                
                                # –ò–∑–≤–ª–µ–∫–∞–µ–º product_id –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
                                product_id = extract_product_id(url)
                                
                                if not product_id:
                                    log.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å product_id –∏–∑ URL: {url}")
                                    continue
                                
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä (–ø–æ product_id)
                                if product_id in product_ids:
                                    log.info(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id={product_id}): {url}")
                                    continue
                                
                                product_ids.add(product_id)
                                log.info(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #{len(products) + 1}: product_id={product_id}, url={url}")
                                
                                # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
                                name = ""
                                name_selectors = [
                                    'h1', 'h2', 'h3',
                                    '[class*="title"]',
                                    '[class*="name"]',
                                    'a',
                                ]
                                
                                for name_sel in name_selectors:
                                    try:
                                        name_elem = await element.query_selector(name_sel)
                                        if name_elem:
                                            name = await name_elem.inner_text()
                                            if name and len(name) > 5:  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏—è
                                                break
                                    except:
                                        continue
                                
                                # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                                category = ""
                                category_selectors = [
                                    '[class*="category"]',
                                    '[class*="tag"]',
                                    'span',
                                ]
                                
                                for cat_sel in category_selectors:
                                    try:
                                        cat_elem = await element.query_selector(cat_sel)
                                        if cat_elem:
                                            text = await cat_elem.inner_text()
                                            if text and len(text) < 50:  # –ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±—ã—á–Ω–æ –∫–æ—Ä–æ—Ç–∫–∞—è
                                                category = text
                                                break
                                    except:
                                        continue
                                
                                if url and product_id:
                                    products.append({
                                        "name": name.strip() if name else "N/A",
                                        "category": category.strip() if category else "N/A",
                                        "url": url,
                                        "product_id": product_id  # –î–æ–±–∞–≤–ª—è–µ–º product_id –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
                                    })
                                    log.info(f"   üì¶ –¢–æ–≤–∞—Ä {len(products)}: {name[:50] if name else 'N/A'}... (ID: {product_id})")
                                
                        except Exception as e:
                            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —ç–ª–µ–º–µ–Ω—Ç–∞: {e}")
                            continue
                    
                    if len(products) >= count:
                        break
                        
                except Exception as e:
                    log.debug(f"–û—à–∏–±–∫–∞ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º {selector}: {e}")
                    continue
            
            if len(products) < count:
                log.warning(f"–ù–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ {count} –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã—Ö")
            
            log.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤")
            return products[:count]
            
        except Exception as e:
            log.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
            import traceback
            log.error(traceback.format_exc())
            return []
    
    async def get_product_details(self, product_url: str, sheets_writer=None) -> ProductData:
        """
        –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞ –∏ –≤–∏–¥–µ–æ
        
        Args:
            product_url: URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞
        
        Returns:
            ProductData —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞ –∏ –≤–∏–¥–µ–æ
        """
        log.info("=" * 80)
        log.info(f"üîÑ –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–ê")
        log.info(f"URL: {product_url}")
        log.info("=" * 80)
        
        product_data = ProductData()
        product_data.pipiads_link = product_url
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è page
        if not self.page:
            log.error("‚ùå –û–®–ò–ë–ö–ê: page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
            return product_data
        
        try:
            # –®–ê–ì 1: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞
            log.info("\nüìå –®–ê–ì 1: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞...")
            try:
                log.info(f"  ‚Üí –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {product_url}")
                if not self.page:
                    raise Exception("Page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
                await self.page.goto(product_url, wait_until="domcontentloaded", timeout=30000)
                log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            except Exception as e:
                log.error(f"  ‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {e}")
                log.error(f"  ‚Üí –¢–∏–ø –æ—à–∏–±–∫–∏: {type(e).__name__}")
                import traceback
                log.error(f"  ‚Üí –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:\n{traceback.format_exc()}")
                # –ü—Ä–æ–±—É–µ–º –ø–æ–¥–æ–∂–¥–∞—Ç—å –µ—â–µ –Ω–µ–º–Ω–æ–≥–æ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                try:
                    await self.human_delay(2, 3)
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Å–µ –µ—â–µ –¥–æ—Å—Ç—É–ø–Ω–∞
                    if self.page:
                        current_url = self.page.url
                        log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
                except Exception as e2:
                    log.error(f"  ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e2}")
                    return product_data
            
            try:
                await self.human_delay(0.5, 1)
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–¥–µ—Ä–∂–∫–µ: {e}")
            
            # –®–ê–ì 1.5: –ü–µ—Ä–µ–≤–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫
            log.info("\nüìå –®–ê–ì 1.5: –ü–µ—Ä–µ–≤–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫...")
            try:
                current_url = self.page.url
                log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
                
                # –ï—Å–ª–∏ URL —Å–æ–¥–µ—Ä–∂–∏—Ç /ru/, –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ /en/
                if "/ru/" in current_url:
                    english_url = current_url.replace("/ru/", "/en/")
                    log.info(f"  ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫—É—é –≤–µ—Ä—Å–∏—é: {english_url}")
                    await self.page.goto(english_url, wait_until="domcontentloaded", timeout=30000)
                    await self.human_delay(1, 2)
                    log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π")
                else:
                    # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞
                    log.info("  ‚Üí –ü–æ–∏—Å–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —è–∑—ã–∫–∞...")
                    lang_selectors = [
                        'a[href*="/en/"]',
                        'button:has-text("English")',
                        '[class*="language"]',
                        '[class*="lang"]',
                        'select[name*="lang"]',
                    ]
                    
                    lang_found = False
                    for selector in lang_selectors:
                        try:
                            lang_element = await self.page.query_selector(selector)
                            if lang_element:
                                is_visible = await lang_element.is_visible()
                                if is_visible:
                                    await lang_element.click()
                                    await self.human_delay(1, 2)
                                    log.info(f"  ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ –Ω–∞–π–¥–µ–Ω –∏ –Ω–∞–∂–∞—Ç: {selector}")
                                    lang_found = True
                                    break
                        except:
                            continue
                    
                    if not lang_found:
                        log.warning("  ‚ö†Ô∏è –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –Ω–∞ —Ç–µ–∫—É—â–µ–º —è–∑—ã–∫–µ")
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            # –®–ê–ì 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Product Name
            log.info("\nüìå –®–ê–ì 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Product Name...")
            try:
                # –°–∫—Ä–æ–ª–ª–∏–º –≤–≤–µ—Ä—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
                log.info("  ‚Üí –°–∫—Ä–æ–ª–ª–∏–º –≤–≤–µ—Ä—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞...")
                if not self.page:
                    raise Exception("Page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
                await self.page.evaluate("window.scrollTo(0, 0)")
                await self.human_delay(0.3, 0.5)
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ: {e}")
                # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É
            
            # –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ - –ø—Ä–æ–±—É–µ–º –±–æ–ª—å—à–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –∏ –º–µ—Ç–æ–¥–æ–≤
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã...")
            try:
                # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
                name_selectors = [
                    'h1:first-of-type',
                    'h1[class*="product"]',
                    'h1[class*="title"]',
                    '[class*="product-title"]',
                    '[class*="product-name"]',
                    '[class*="product_title"]',
                    '[class*="product_name"]',
                    'h1',
                    'h2:first-of-type',
                    '[data-testid*="title"]',
                    '[data-testid*="name"]',
                    '[data-testid*="product-title"]',
                ]
                
                for selector in name_selectors:
                    try:
                        elements = await self.page.query_selector_all(selector)
                        for element in elements:
                            name = await element.inner_text()
                            if name and len(name) > 3:
                                # –§–∏–ª—å—Ç—Ä—É–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã
                                name_lower = name.lower()
                                skip_words = ['–æ—Å—Ç–∞—Ç–æ–∫', 'remain', 'stock', '–º–µ—Å—è—Ü', 'month', '–∫–æ–º–∏—Å—Å–∏—è', 'commission', 
                                            'tiktok shop product detail', 'category', '–∫–∞—Ç–µ–≥–æ—Ä–∏—è']
                                if any(skip in name_lower for skip in skip_words):
                                    continue
                                # –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å "TikTok Shop Product Detail:" –µ—Å–ª–∏ –µ—Å—Ç—å
                                if "TikTok Shop Product Detail:" in name:
                                    name = name.split("TikTok Shop Product Detail:")[-1].strip()
                                # –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
                                if name.lower().startswith('tiktok shop product'):
                                    name = re.sub(r'^tiktok shop product\s*:?\s*', '', name, flags=re.IGNORECASE).strip()
                                if name.lower().endswith('tiktok shop product'):
                                    name = re.sub(r'\s*tiktok shop product\s*$', '', name, flags=re.IGNORECASE).strip()
                                # –£–±–∏—Ä–∞–µ–º, –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ "TikTok Shop Product"
                                if name.lower() == 'tiktok shop product' or name.lower() == 'tiktok shop product detail':
                                    continue
                                if ":" in name and len(name.split(":")[0]) < 20:
                                    name = name.split(":", 1)[-1].strip()
                                product_data.product_name = name.strip()
                                if len(product_data.product_name) > 5:
                                    log.info(f"  ‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞–π–¥–µ–Ω–æ: {product_data.product_name[:50]}...")
                                    break
                        if product_data.product_name and len(product_data.product_name) > 5:
                            break
                    except:
                        continue
                
                # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
                if not product_data.product_name or len(product_data.product_name) <= 5:
                    try:
                        product_name = await self.page.evaluate("""
                            () => {
                                // –ò—â–µ–º h1
                                const h1 = document.querySelector('h1');
                                if (h1) {
                                    const text = h1.innerText.trim();
                                    if (text && text.length > 5 && !text.toLowerCase().includes('tiktok shop product detail')) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º –≤ —ç–ª–µ–º–µ–Ω—Ç–∞—Ö —Å –∫–ª–∞—Å—Å–æ–º product
                                const productElements = document.querySelectorAll('[class*="product"][class*="title"], [class*="product"][class*="name"]');
                                for (const el of productElements) {
                                    const text = el.innerText.trim();
                                    if (text && text.length > 5) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º —Å–∞–º—ã–π –±–æ–ª—å—à–æ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–æ–±—ã—á–Ω–æ —ç—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞)
                                // –ù–û –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã —Ç–∏–ø–∞ "Ad Analysis"
                                const headings = document.querySelectorAll('h1, h2, h3');
                                let maxLength = 0;
                                let bestHeading = null;
                                for (const h of headings) {
                                    const text = h.innerText.trim();
                                    const skipWords = ['tiktok', 'shop', 'product', 'detail', 'category', 'commission', 
                                                      '–æ—Å—Ç–∞—Ç–æ–∫', 'remain', 'stock', 'ad analysis', 'analysis', 
                                                      'limited time', 'promotion', 'annual plan', 'tiktok shop product'];
                                    const textLower = text.toLowerCase();
                                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã (–º–µ–Ω—å—à–µ 20 —Å–∏–º–≤–æ–ª–æ–≤) - —ç—Ç–æ –æ–±—ã—á–Ω–æ –Ω–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
                                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º "TikTok Shop Product" –∏ –ø–æ—Ö–æ–∂–∏–µ —Ç–µ–∫—Å—Ç—ã
                                    if (!skipWords.some(word => textLower.includes(word)) && 
                                        text.length > maxLength && text.length > 20 &&
                                        !textLower.includes('tiktok shop product')) {
                                        maxLength = text.length;
                                        bestHeading = text;
                                    }
                                }
                                if (bestHeading) {
                                    return bestHeading;
                                }
                                
                                // –ò—â–µ–º –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–∞—Ö - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ–±—ã—á–Ω–æ –¥–ª–∏–Ω–Ω–æ–µ
                                // –ù–∞–ø—Ä–∏–º–µ—Ä: "[BUY 1 TAKE 11] SHEEureka Scrub Facial Cleanser..."
                                // –ù–û –∏—Å–∫–ª—é—á–∞–µ–º —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                           'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                           'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                           'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                           'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                const textBlocks = document.querySelectorAll('p, div, span');
                                for (const block of textBlocks) {
                                    const text = block.innerText.trim();
                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    const isFooterMenu = footerMenuKeywords.some(keyword => text.includes(keyword));
                                    if (isFooterMenu) continue;
                                    
                                    // –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ–±—ã—á–Ω–æ –¥–ª–∏–Ω–Ω–æ–µ (–±–æ–ª—å—à–µ 30 —Å–∏–º–≤–æ–ª–æ–≤) –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–æ–≤–∞ —Ç–∏–ø–∞ "Set", "Kit", "Mask" –∏ —Ç.–¥.
                                    // –ò–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å "[" (–Ω–∞–ø—Ä–∏–º–µ—Ä "[BUY 1 TAKE 11]")
                                    if (text.length > 30 && text.length < 500 && 
                                        !text.toLowerCase().includes('ad analysis') &&
                                        !text.toLowerCase().includes('limited time') &&
                                        !text.toLowerCase().includes('promotion') &&
                                        !text.toLowerCase().includes('annual plan') &&
                                        (text.startsWith('[') || text.includes('Set') || text.includes('Kit') || 
                                         text.includes('Mask') || text.includes('Cleanser') || text.includes('Gift') ||
                                         text.includes('Scrub') || text.includes('Facial') || text.includes('Repairing'))) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º –≤ –º–µ—Ç–∞-—Ç–µ–≥–∞—Ö
                                const ogTitle = document.querySelector('meta[property="og:title"]');
                                if (ogTitle && ogTitle.content) {
                                    let title = ogTitle.content;
                                    if (title.includes('TikTok Shop Product Detail:')) {
                                        title = title.split('TikTok Shop Product Detail:')[1].trim();
                                    }
                                    // –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞
                                    if (title.toLowerCase().startsWith('tiktok shop product')) {
                                        title = title.replace(/^tiktok shop product\s*:?\s*/i, '').trim();
                                    }
                                    if (title && title.length > 5 && !title.toLowerCase().includes('tiktok shop product')) {
                                        return title;
                                    }
                                }
                                
                                return null;
                            }
                        """)
                        if product_name and len(product_name) > 5:
                            product_name = product_name.strip()
                            # –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
                            if product_name.lower().startswith('tiktok shop product'):
                                product_name = re.sub(r'^tiktok shop product\s*:?\s*', '', product_name, flags=re.IGNORECASE).strip()
                            if product_name.lower().endswith('tiktok shop product'):
                                product_name = re.sub(r'\s*tiktok shop product\s*$', '', product_name, flags=re.IGNORECASE).strip()
                            # –£–±–∏—Ä–∞–µ–º, –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ "TikTok Shop Product"
                            if product_name.lower() == 'tiktok shop product' or product_name.lower() == 'tiktok shop product detail':
                                product_name = None
                            if product_name and len(product_name) > 5:
                                product_data.product_name = product_name
                                log.info(f"  ‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞–π–¥–µ–Ω–æ (—á–µ—Ä–µ–∑ JS): {product_data.product_name[:50]}...")
                    except Exception as e:
                        log.debug(f"  ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —á–µ—Ä–µ–∑ JS: {e}")
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞: {e}")
            
            if not product_data.product_name or len(product_data.product_name) <= 5:
                log.warning("  ‚ö†Ô∏è –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                product_data.product_name = "N/A"
            
            # –®–ê–ì 3: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Category
            log.info("\nüìå –®–ê–ì 3: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Category...")
            try:
                log.info("  ‚Üí –ü–æ–∏—Å–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–∞...")
                
                # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
                category_selectors = [
                    '[class*="category"]',
                    '[class*="tag"]',
                    'span:has-text("Category")',
                    'span:has-text("–ö–∞—Ç–µ–≥–æ—Ä–∏—è")',
                    'text=/Category/i',
                    'text=/–ö–∞—Ç–µ–≥–æ—Ä–∏—è/i',
                    'div:has-text("Category")',
                    'div:has-text("–ö–∞—Ç–µ–≥–æ—Ä–∏—è")',
                ]
                
                for selector in category_selectors:
                    try:
                        elements = await self.page.query_selector_all(selector)
                        for element in elements:
                            category = await element.inner_text()
                            if category:
                                # –û—á–∏—â–∞–µ–º –æ—Ç –ª–∏—à–Ω–µ–≥–æ —Ç–µ–∫—Å—Ç–∞
                                category = re.sub(r'Category\s*:', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'–ö–∞—Ç–µ–≥–æ—Ä–∏—è\s*:', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'Commission\s*Rate\s*:.*', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'–ö–æ–º–∏—Å—Å–∏—è\s*:.*', '', category, flags=re.IGNORECASE)
                                # –£–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä "15.00%")
                                category = re.sub(r'\s*\d+\.?\d*\s*%', '', category)
                                # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ —Å–∏–º–≤–æ–ª—ã > –∏ –ø—Ä–æ–±–µ–ª—ã
                                category = re.sub(r'\s*>\s*', ' > ', category)
                                category = category.strip()
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é —á–∞—Å—Ç—å –¥–æ "Commission" –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É
                                if "Commission" in category or "–ö–æ–º–∏—Å—Å–∏—è" in category:
                                    category = category.split("Commission")[0].split("–ö–æ–º–∏—Å—Å–∏—è")[0].strip()
                                if len(category) > 100:
                                    category = category[:100]
                                if category and len(category) > 3:
                                    product_data.category = category
                                    log.info(f"  ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–∞: {product_data.category}")
                                    break
                        if product_data.category:
                            break
                    except:
                        continue
                
                # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π)
                if not product_data.category:
                    try:
                        category = await self.page.evaluate("""
                            () => {
                                // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Category" –∏–ª–∏ "–ö–∞—Ç–µ–≥–æ—Ä–∏—è"
                                const allElements = document.querySelectorAll('*');
                                for (const el of allElements) {
                                    const text = el.innerText || '';
                                    if (text.includes('Category') || text.includes('–ö–∞—Ç–µ–≥–æ—Ä–∏—è')) {
                                        // –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ—Å–ª–µ "Category:" –∏–ª–∏ "–ö–∞—Ç–µ–≥–æ—Ä–∏—è:"
                                        let categoryText = text;
                                        if (categoryText.includes('Category:')) {
                                            categoryText = categoryText.split('Category:')[1];
                                        } else if (categoryText.includes('–ö–∞—Ç–µ–≥–æ—Ä–∏—è:')) {
                                            categoryText = categoryText.split('–ö–∞—Ç–µ–≥–æ—Ä–∏—è:')[1];
                                        }
                                        
                                        // –£–±–∏—Ä–∞–µ–º "Commission Rate" –∏ –≤—Å–µ –ø–æ—Å–ª–µ
                                        if (categoryText.includes('Commission Rate') || categoryText.includes('–ö–æ–º–∏—Å—Å–∏—è')) {
                                            categoryText = categoryText.split('Commission Rate')[0].split('–ö–æ–º–∏—Å—Å–∏—è')[0];
                                        }
                                        
                                        // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä "15.00%")
                                        categoryText = categoryText.replace(/\s*\d+\.?\d*\s*%/g, '');
                                        
                                        categoryText = categoryText.trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é (—Å–æ–¥–µ—Ä–∂–∏—Ç ">" –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–æ–≤)
                                        if (categoryText && categoryText.length > 3 && 
                                            (categoryText.includes('>') || categoryText.split(' ').length >= 2)) {
                                            return categoryText.substring(0, 100);
                                        }
                                    }
                                }
                                return null;
                            }
                        """)
                        if category and len(category) > 3:
                            product_data.category = category.strip()
                            log.info(f"  ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–∞ (—á–µ—Ä–µ–∑ JS): {product_data.category}")
                    except Exception as e:
                        log.debug(f"  ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ JS: {e}")
                
                if not product_data.category:
                    log.warning("  ‚ö†Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ 'N/A'")
                    product_data.category = "N/A"
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {e}")
                product_data.category = "N/A"
            
            # –®–ê–ì 3.5: –ó–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets (–µ—Å–ª–∏ sheets_writer –ø–µ—Ä–µ–¥–∞–Ω)
            # –í–ê–ñ–ù–û: –ï—Å–ª–∏ —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ
            if sheets_writer:
                log.info("\nüìå –®–ê–ì 3.5: –ó–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets...")
                try:
                    row_number = sheets_writer.write_basic_product_data(
                        product_data.product_name,
                        product_data.category,
                        product_data.pipiads_link
                    )
                    if row_number > 0:
                        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ
                        product_data._sheets_row = row_number
                        log.info(f"  ‚úÖ –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {row_number})")
                    else:
                        # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–≤–æ–∑–º–æ–∂–Ω–æ, —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã),
                        # –Ω–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö
                        log.warning("  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–≤–æ–∑–º–æ–∂–Ω–æ, —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã)")
                        log.info("  ‚Üí –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö...")
                        row_number = sheets_writer.find_next_empty_row()
                        product_data._sheets_row = row_number
                        log.info(f"  ‚úÖ –ë—É–¥–µ–º –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫—É {row_number}")
                except Exception as e:
                    log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö: {e}")
                    # –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ
                    try:
                        row_number = sheets_writer.find_next_empty_row()
                        product_data._sheets_row = row_number
                        log.info(f"  ‚Üí –ë—É–¥–µ–º –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫—É {row_number}")
                    except:
                        pass
            
            # –®–ê–ì 4: –ü–æ–∏—Å–∫ –±–ª–æ–∫–∞ "TikTok Ads"
            log.info("\nüìå –®–ê–ì 4: –ü–æ–∏—Å–∫ –±–ª–æ–∫–∞ 'TikTok Ads'...")
            log.info("  ‚Üí –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–Ω–∏–∑ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞...")
            
            # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–Ω–∏–∑, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç
            # –ë–ª–æ–∫ "TikTok Ads" –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            try:
                log.info("  ‚Üí –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–Ω–∏–∑ (–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ)...")
                # –ü–æ–ª—É—á–∞–µ–º –≤—ã—Å–æ—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                page_height = await self.page.evaluate("document.body.scrollHeight")
                viewport_height = await self.page.evaluate("window.innerHeight")
                log.info(f"  ‚Üí –í—ã—Å–æ—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {page_height}px, –≤—ã—Å–æ—Ç–∞ viewport: {viewport_height}px")
                
                # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ (–∫–∞–∫ —á–µ–ª–æ–≤–µ–∫)
                scroll_steps = max(3, page_height // viewport_height)
                scroll_step = page_height // scroll_steps
                
                for step in range(scroll_steps):
                    scroll_position = scroll_step * (step + 1)
                    await self.page.evaluate(f"window.scrollTo(0, {scroll_position})")
                    await self.human_delay(0.3, 0.5)
                    log.debug(f"  ‚Üí –ü—Ä–æ–∫—Ä—É—Ç–∫–∞: {scroll_position}/{page_height}px")
                
                # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ —Å–∞–º–æ–≥–æ –Ω–∏–∑–∞
                await self.page.evaluate("window.scrollTo(0, document.body.scrollHeight)")
                await self.human_delay(1, 2)  # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–∫—Ä—É—á–µ–Ω–∞ –≤–Ω–∏–∑")
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            log.info("  ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (–∫–∞–∫ Ctrl+F)...")
            tiktok_ads_found = False
            tiktok_ads_element = None
            
            # –°–Ω–∞—á–∞–ª–∞ –∂–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            await self.human_delay(0.5, 1)
            
            # –í–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
            tiktok_ads_texts = [
                "TikTok Ads",  # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π
                "–†–µ–∫–ª–∞–º–∞ –¢–∏–∫–¢–æ–∫",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 1
                "–†–µ–∫–ª–∞–º–∞ TikTok",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 2
                "TikTok –†–µ–∫–ª–∞–º–∞",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 3
            ]
            
            # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –±–ª–æ–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä —Å —Ç–µ–∫—Å—Ç–æ–º (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±)
            log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ Playwright locator...")
            for text_variant in tiktok_ads_texts:
                try:
                    # –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Ç–µ–∫—Å—Ç (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ)
                    locator = self.page.locator(f'text=/{text_variant}/i').first
                    if await locator.count() > 0:
                        tiktok_ads_element = await locator.element_handle()
                        if tiktok_ads_element:
                            # –°–∫—Ä–æ–ª–ª–∏–º –∫ —ç–ª–µ–º–µ–Ω—Ç—É
                            await tiktok_ads_element.scroll_into_view_if_needed()
                            await self.human_delay(0.3, 0.5)
                            tiktok_ads_found = True
                            log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ Playwright locator")
                            break
                except Exception as e:
                    log.debug(f"–ü–æ–∏—Å–∫ '{text_variant}' —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä –Ω–µ —É–¥–∞–ª—Å—è: {e}")
                    continue
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ JavaScript –ø–æ–∏—Å–∫ (–∫–∞–∫ Ctrl+F)
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript TreeWalker...")
                for text_variant in tiktok_ads_texts:
                    try:
                        # –ò—Å–ø–æ–ª—å–∑—É–µ–º JavaScript –¥–ª—è –ø–æ–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å —Ç–µ–∫—Å—Ç–æ–º
                        # –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è regex
                        escaped_text = text_variant.replace("\\", "\\\\").replace("/", "\\/")
                        tiktok_ads_element = await self.page.evaluate_handle(f"""
                            () => {{
                                const walker = document.createTreeWalker(
                                    document.body,
                                    NodeFilter.SHOW_TEXT,
                                    null,
                                    false
                                );
                                
                                let node;
                                while (node = walker.nextNode()) {{
                                    if (node.textContent && /{escaped_text}/i.test(node.textContent)) {{
                                        // –ù–∞—Ö–æ–¥–∏–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç
                                        let parent = node.parentElement;
                                        while (parent && parent !== document.body) {{
                                            if (parent.offsetHeight > 0 && parent.offsetWidth > 0) {{
                                                return parent;
                                            }}
                                            parent = parent.parentElement;
                                        }}
                                    }}
                                }}
                                return null;
                            }}
                        """)
                        
                        if tiktok_ads_element and await tiktok_ads_element.as_element():
                            element = await tiktok_ads_element.as_element()
                            await element.scroll_into_view_if_needed()
                            await self.human_delay(0.3, 0.5)
                            tiktok_ads_found = True
                            log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript TreeWalker")
                            break
                    except Exception as e:
                        log.debug(f"JavaScript –ø–æ–∏—Å–∫ '{text_variant}' –Ω–µ —É–¥–∞–ª—Å—è: {e}")
                        continue
            
            # –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ query_selector
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 3: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ query_selector —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ —Ç–µ–∫—Å—Ç–∞...")
                try:
                    # –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
                    text_variants = []
                    for text in tiktok_ads_texts:
                        text_variants.extend([
                            f'text="{text}"',
                            f'text={text}',
                            f'*:has-text("{text}")',
                        ])
                    
                    for variant in text_variants:
                        try:
                            element = await self.page.query_selector(variant)
                            if element:
                                is_visible = await element.is_visible()
                                if is_visible:
                                    await element.scroll_into_view_if_needed()
                                    await self.human_delay(0.3, 0.5)
                                    tiktok_ads_found = True
                                    tiktok_ads_element = element
                                    log.info(f"  ‚úÖ –ë–ª–æ–∫ –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ query_selector: {variant}")
                                    break
                        except:
                            continue
                except Exception as e:
                    log.debug(f"Query selector –ø–æ–∏—Å–∫ –Ω–µ —É–¥–∞–ª—Å—è: {e}")
            
            # –ü–æ–ø—ã—Ç–∫–∞ 4: –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –µ—â–µ —Ä–∞–∑ –∏ –ø–æ–∏—Å–∫–∞—Ç—å —Å–Ω–æ–≤–∞
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 4: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∏ –ø–æ–∏—Å–∫...")
                try:
                    # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –µ—â–µ —Ä–∞–∑ –º–µ–¥–ª–µ–Ω–Ω–æ
                    await self.page.evaluate("window.scrollTo(0, 0)")  # –í –Ω–∞—á–∞–ª–æ
                    await self.human_delay(0.5, 1)
                    
                    # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑ –º–µ–¥–ª–µ–Ω–Ω–æ, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è—Å—å –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
                    page_height = await self.page.evaluate("document.body.scrollHeight")
                    scroll_increment = 300  # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –ø–æ 300px
                    
                    for scroll_pos in range(0, page_height, scroll_increment):
                        await self.page.evaluate(f"window.scrollTo(0, {scroll_pos})")
                        await self.human_delay(0.2, 0.3)
                        
                        # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –Ω–∞ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ (–≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞)
                        for text_variant in tiktok_ads_texts:
                            try:
                                # –ó–∞–º–µ–Ω—è–µ–º –ø—Ä–æ–±–µ–ª—ã –Ω–∞ \s+ –¥–ª—è regex
                                regex_pattern = text_variant.replace(" ", "\\s+")
                                locator = self.page.locator(f'text=/{regex_pattern}/i').first
                                if await locator.count() > 0:
                                    tiktok_ads_element = await locator.element_handle()
                                    if tiktok_ads_element:
                                        await tiktok_ads_element.scroll_into_view_if_needed()
                                        await self.human_delay(0.3, 0.5)
                                        tiktok_ads_found = True
                                        log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ {scroll_pos}px")
                                        break
                            except:
                                continue
                        
                        if tiktok_ads_found:
                            break
                    
                    if not tiktok_ads_found:
                        # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ —Å–∞–º–æ–≥–æ –Ω–∏–∑–∞ –µ—â–µ —Ä–∞–∑
                        await self.page.evaluate("window.scrollTo(0, document.body.scrollHeight)")
                        await self.human_delay(1, 2)
                        
                        # –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–∏—Å–∫–∞ (–≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞)
                        for text_variant in tiktok_ads_texts:
                            try:
                                # –ó–∞–º–µ–Ω—è–µ–º –ø—Ä–æ–±–µ–ª—ã –Ω–∞ \s+ –¥–ª—è regex
                                regex_pattern = text_variant.replace(" ", "\\s+")
                                locator = self.page.locator(f'text=/{regex_pattern}/i').first
                                if await locator.count() > 0:
                                    tiktok_ads_element = await locator.element_handle()
                                    if tiktok_ads_element:
                                        await tiktok_ads_element.scroll_into_view_if_needed()
                                        await self.human_delay(0.3, 0.5)
                                        tiktok_ads_found = True
                                        log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω –≤ —Å–∞–º–æ–º –Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã")
                                        break
                            except:
                                continue
                except Exception as e:
                    log.debug(f"–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –Ω–µ –ø–æ–º–æ–≥–ª–∞: {e}")
            
            if not tiktok_ads_found:
                log.error("  ‚ùå –ë–ª–æ–∫ 'TikTok Ads' –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫")
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                try:
                    screenshot_path = config.SCREENSHOTS_DIR / f"tiktok_ads_not_found_{int(time.time())}.png"
                    await self.page.screenshot(path=str(screenshot_path), full_page=True)
                    log.info(f"  üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {screenshot_path}")
                except:
                    pass
                log.error("  ‚ùå –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: –±–ª–æ–∫ 'TikTok Ads' –Ω–µ –Ω–∞–π–¥–µ–Ω")
                return product_data
            
            log.info("  ‚úÖ –ë–ª–æ–∫ 'TikTok Ads' —É—Å–ø–µ—à–Ω–æ –Ω–∞–π–¥–µ–Ω")
            
            # –®–ê–ì 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ "First seen"
            log.info("\nüìå –®–ê–ì 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ 'First seen'...")
            sort_success = await self._set_sort_by_first_seen()
            if not sort_success:
                log.warning("  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            # –®–ê–ì 6: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–∏–¥–µ–æ
            log.info("\nüìå –®–ê–ì 6: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ 'TikTok Ads'...")
            videos = await self._get_videos_from_tiktok_ads_block()
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ {len(videos)} –≤–∏–¥–µ–æ –≤ –±–ª–æ–∫–µ")
            
            # –®–ê–ì 7: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ
            log.info(f"\nüìå –®–ê–ì 7: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ (impression >= {config.MIN_IMPRESSIONS}, –¥–∞—Ç–∞ <= {config.DAYS_BACK} –¥–Ω–µ–π)...")
            filtered_videos = await self._filter_videos(videos)
            log.info(f"  ‚Üí –ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: {len(filtered_videos)} –≤–∏–¥–µ–æ")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –í–°–ï –≤–∏–¥–µ–æ (–¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏) –≤ ProductData
            product_data._all_videos_raw = videos[:20]  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–≤—ã–µ 20 –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
            
            # –í–ê–ñ–ù–û: –ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ 0 –≤–∏–¥–µ–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä
            if len(filtered_videos) == 0:
                log.warning(f"  ‚ö†Ô∏è –ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ (>= {config.MIN_IMPRESSIONS} impressions, <= {config.DAYS_BACK} –¥–Ω–µ–π)")
                log.warning(f"  ‚ö†Ô∏è –¢–æ–≤–∞—Ä –±—É–¥–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω")
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ —Ç–æ–≤–∞—Ä–∞
                product_data._insufficient_videos = True
                product_data._videos_found = len(videos)
                return product_data
            
            # –í—ã–±–æ—Ä —Ç–æ–ø-3 –≤–∏–¥–µ–æ
            video_count = 3
            selected_videos = filtered_videos[:video_count]
            
            log.info(f"  ‚úÖ –í—ã–±—Ä–∞–Ω–æ {len(selected_videos)} –≤–∏–¥–µ–æ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            
            # –®–ê–ì 8: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
            log.info(f"\nüìå –®–ê–ì 8: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–ª—è {len(selected_videos)} –≤–∏–¥–µ–æ...")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
            product_page_url = self.page.url
            log.info(f"  ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞: {product_page_url}")
            
            for i, video in enumerate(selected_videos, 1):
                log.info(f"\n  üé¨ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ {i}/{len(selected_videos)}...")
                log.info(f"    ‚Üí Impression: {video.get('impression', 0)}, First seen: {video.get('first_seen', 'N/A')}")
                
                # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ (–ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ ad-search –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
                video_details = await self._get_video_details(video)
                
                if video_details:
                    product_data.videos.append(video_details)
                    log.info(f"    ‚úÖ –í–∏–¥–µ–æ {i} –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ")
                else:
                    log.warning(f"    ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –¥–ª—è –≤–∏–¥–µ–æ {i}")
                
                # –í–ê–ñ–ù–û: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
                log.info(f"    ‚Üí –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ {i}...")
                try:
                    await self.page.goto(product_page_url, wait_until="domcontentloaded", timeout=30000)
                    await self.human_delay(1, 2)
                    
                    # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –±–ª–æ–∫–∞ TikTok Ads (—á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ –≤–∏–¥–µ–æ)
                    try:
                        await self.page.wait_for_selector('a[href*="/ad-search/"]', timeout=10000, state="visible")
                        log.info(f"    ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ —É—Å–ø–µ—à–µ–Ω (–≤–∏–¥–µ–æ {i})")
                    except:
                        log.warning(f"    ‚ö†Ô∏è –ë–ª–æ–∫ TikTok Ads –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
                except Exception as e:
                    log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞: {e}")
                    # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–ª–µ–¥—É—é—â–∏—Ö –≤–∏–¥–µ–æ –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤–æ–∑–≤—Ä–∞—Ç–∞
                
                await self.human_delay(0.5, 1)
            
            # –ó–∞–ø–æ–ª–Ω—è–µ–º N/A –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤–∏–¥–µ–æ (–Ω—É–∂–Ω–æ 3 –≤–∏–¥–µ–æ)
            while len(product_data.videos) < video_count:
                product_data.videos.append({
                    "tiktok_link": "N/A",
                    "impression": 0,
                    "script": "N/A",
                    "hook": "N/A",
                    "audience_age": "N/A",
                    "country": "N/A",
                    "first_seen": "N/A",
                })
            
            log.info(f"\n‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {len(product_data.videos)} –≤–∏–¥–µ–æ –¥–ª—è —Ç–æ–≤–∞—Ä–∞")
            
            # –®–ê–ì 9: –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ –≤ Google Sheets (–µ—Å–ª–∏ sheets_writer –ø–µ—Ä–µ–¥–∞–Ω)
            if sheets_writer:
                if hasattr(product_data, '_sheets_row') and product_data._sheets_row > 0:
                    log.info(f"\nüìå –®–ê–ì 9: –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {product_data._sheets_row})...")
                    log.info(f"  ‚Üí –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ –¥–ª—è –∑–∞–ø–∏—Å–∏: {len(product_data.videos)}")
                    
                    # –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é
                    for i, video in enumerate(product_data.videos[:3], 1):
                        log.info(f"  ‚Üí –í–∏–¥–µ–æ {i}: tiktok={video.get('tiktok_link', 'N/A')[:50]}, "
                                f"impression={video.get('impression', 'N/A')}, "
                                f"script={len(str(video.get('script', 'N/A')))} —Å–∏–º–≤–æ–ª–æ–≤, "
                                f"hook={len(str(video.get('hook', 'N/A')))} —Å–∏–º–≤–æ–ª–æ–≤, "
                                f"audience={video.get('audience_age', 'N/A')}, "
                                f"country={video.get('country', 'N/A')}, "
                                f"first_seen={video.get('first_seen', 'N/A')}")
                    
                    try:
                        # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏
                        video_data_dict = {
                            "product_name": product_data.product_name,
                            "category": product_data.category,
                            "pipiads_link": product_data.pipiads_link,
                            "videos": product_data.videos
                        }
                        
                        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (update_basic=False - –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ F-Z)
                        success = sheets_writer.write_product_data(
                            product_data._sheets_row,
                            video_data_dict,
                            update_basic=False
                        )
                        
                        if success:
                            log.info(f"  ‚úÖ –î–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {product_data._sheets_row}, —Å—Ç–æ–ª–±—Ü—ã F-Z)")
                        else:
                            log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –≤ Google Sheets")
                    except Exception as e:
                        log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ: {e}")
                        import traceback
                        log.error(traceback.format_exc())
                else:
                    log.warning(f"  ‚ö†Ô∏è –ù–µ—Ç –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö (_sheets_row –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)")
            
            log.info("=" * 80)
            log.info("‚úÖ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û")
            log.info("=" * 80)
            return product_data
            
        except Exception as e:
            log.error("\n" + "=" * 80)
            log.error(f"‚ùå –û–®–ò–ë–ö–ê –ü–†–ò –û–ë–†–ê–ë–û–¢–ö–ï –¢–û–í–ê–†–ê: {e}")
            log.error("=" * 80)
            import traceback
            log.error(traceback.format_exc())
            return product_data
    
    async def return_to_main_page(self, main_page_url: str) -> bool:
        """
        –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–æ–≤–∞—Ä–æ–≤
        
        Args:
            main_page_url: URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ —Ç–æ–≤–∞—Ä)
        
        Returns:
            True –µ—Å–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç —É—Å–ø–µ—à–µ–Ω, False –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        """
        try:
            log.info("\nüîô –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–æ–≤–∞—Ä–æ–≤...")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π URL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            current_url = self.page.url
            log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
            log.info(f"  ‚Üí –¶–µ–ª–µ–≤–æ–π URL: {main_page_url}")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            if current_url == main_page_url:
                log.info("  ‚ÑπÔ∏è  –£–∂–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
                return True
            
            # –ú–ï–¢–û–î 1: –ü—Ä—è–º–æ–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π URL (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            await self.page.goto(main_page_url, wait_until="domcontentloaded", timeout=30000)  # –£–≤–µ–ª–∏—á–µ–Ω –¥–æ 30 —Å–µ–∫
            await self.human_delay(1, 2)
            
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ë–ï–ó networkidle - –æ–Ω –≤—ã–∑—ã–≤–∞–µ—Ç —Ç–∞–π–º–∞—É—Ç—ã!)
            await self.page.wait_for_load_state("domcontentloaded", timeout=5000)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞
            new_url = self.page.url
            log.info(f"  ‚Üí –ù–æ–≤—ã–π URL: {new_url}")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤
            try:
                await self.page.wait_for_selector('a[href*="/tiktok-shop-product/"]', timeout=10000)
                
                # –î–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ä–µ–º—è –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
                await self.human_delay(2, 3)
                
                log.info("  ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —É—Å–ø–µ—à–µ–Ω")
                return True
            except:
                log.warning("  ‚ö†Ô∏è –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞")
                return False
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É: {e}")
            import traceback
            log.error(traceback.format_exc())
            return False
    
    async def get_product_details_with_return(self, product_index: int, sheets_writer=None, banned_products=None):
        """
        –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        
        –ê–ª–≥–æ—Ä–∏—Ç–º:
        1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        2. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É
        3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ban-list (–µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω)
        4. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–≤–∞—Ä (get_product_details)
        5. –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        
        Args:
            product_index: –ò–Ω–¥–µ–∫—Å —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–Ω–∞—á–∏–Ω–∞—è —Å 0)
            sheets_writer: –û–±—ä–µ–∫—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ Google Sheets
            banned_products: –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö URL (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
        
        Returns:
            ProductData –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ
            Dict —Å–æ status="insufficient_videos" –µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ
            Dict —Å–æ status="duplicate" –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
            None –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        """
        log.info(f"\n{'='*80}")
        log.info(f"üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ü–û –ò–ù–î–ï–ö–°–£ {product_index}")
        log.info(f"{'='*80}")
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        main_page_url = self.page.url
        log.info(f"  ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {main_page_url}")
        
        def normalize_url(url: str) -> str:
            """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL (—É–±—Ä–∞—Ç—å —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É)"""
            if not url:
                return ""
            url = url.strip().rstrip('/')
            # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if '?' in url:
                url = url.split('?')[0]
            return url
        
        try:
            # –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É
            log.info(f"\nüìå –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É {product_index}...")
            
            try:
                # –ò—â–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
                product_links = await self.page.query_selector_all('a[href*="/tiktok-shop-product/"]')
                
                if not product_links:
                    log.error("  ‚ùå –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
                    return None
                
                if product_index >= len(product_links):
                    log.error(f"  ‚ùå –ò–Ω–¥–µ–∫—Å {product_index} –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã (–≤—Å–µ–≥–æ {len(product_links)} —Ç–æ–≤–∞—Ä–æ–≤)")
                    return None
                
                # –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Ç–æ–≤–∞—Ä–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É
                product_link = product_links[product_index]
                
                # –ü–æ–ª—É—á–∞–µ–º URL —Ç–æ–≤–∞—Ä–∞
                href = await product_link.get_attribute("href")
                if not href:
                    log.error(f"  ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å URL –¥–ª—è —Ç–æ–≤–∞—Ä–∞ {product_index}")
                    return None
                
                # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π URL
                if href.startswith("/"):
                    product_url = f"https://www.pipiads.com{href}"
                elif href.startswith("http"):
                    product_url = href
                else:
                    product_url = f"https://www.pipiads.com/{href}"
                
                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º URL (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
                product_url = normalize_url(product_url)
                
                if not product_url:
                    log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                    return None
                
                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
                if banned_products is not None and product_url in banned_products:
                    log.warning(f"  üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: {product_url}")
                    log.warning(f"     –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.")
                    return {"status": "duplicate", "product_url": product_url}
                
                log.info(f"  ‚úÖ –ü–æ–ª—É—á–µ–Ω URL —Ç–æ–≤–∞—Ä–∞: {product_url}")
                
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ URL —Ç–æ–≤–∞—Ä–∞: {e}")
                return None
            
            # –®–ê–ì 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ get_product_details
            log.info(f"\nüìå –®–ê–ì 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞...")
            product_data = await self.get_product_details(product_url, sheets_writer=sheets_writer)
            
            # –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–¥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é)
            log.info(f"\nüìå –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞...")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∏ –µ—Å—Ç—å –≤–∏–¥–µ–æ
            if not product_data:
                log.warning("  ‚ö†Ô∏è product_data –ø—É—Å—Ç")
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                await self.return_to_main_page(main_page_url)
                return None
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ —Ç–æ–≤–∞—Ä –ø—Ä–æ–ø—É—â–µ–Ω –∏–∑-–∑–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
            if hasattr(product_data, '_insufficient_videos') and product_data._insufficient_videos:
                videos_found = getattr(product_data, '_videos_found', 0)
                log.warning(f"  ‚ö†Ô∏è –¢–æ–≤–∞—Ä –ø—Ä–æ–ø—É—â–µ–Ω: –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ (–Ω–∞–π–¥–µ–Ω–æ –≤—Å–µ–≥–æ: {videos_found})")
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                await self.return_to_main_page(main_page_url)
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª–æ–≤–∞—Ä—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "insufficient_videos"
                return {
                    "status": "insufficient_videos",
                    "product_name": getattr(product_data, 'product_name', 'N/A'),
                    "videos_found": videos_found,
                    "videos_required": 3,
                    "reason": f"–ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (>= {config.MIN_IMPRESSIONS} impressions, <= {config.DAYS_BACK} –¥–Ω–µ–π) –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ"
                }
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ
            videos_count = len(product_data.videos) if hasattr(product_data, 'videos') else 0
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ –≤–∏–¥–µ–æ: {videos_count}")
            
            # –ï—Å–ª–∏ –≤–∏–¥–µ–æ –º–µ–Ω—å—à–µ 3 - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
            if videos_count < 3:
                log.warning(f"  ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ: {videos_count} < 3")
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                await self.return_to_main_page(main_page_url)
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª–æ–≤–∞—Ä—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "insufficient_videos"
                return {
                    "status": "insufficient_videos",
                    "product_name": getattr(product_data, 'product_name', 'N/A'),
                    "videos_found": videos_count,
                    "videos_required": 3,
                    "reason": f"–ù–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ {videos_count} –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏"
                }
            
            # –®–ê–ì 4: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            log.info(f"\nüìå –®–ê–ì 4: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É...")
            await self.return_to_main_page(main_page_url)
            
            # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä
            log.info(f"  ‚úÖ –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ ({videos_count} –≤–∏–¥–µ–æ)")
            return product_data
            
        except Exception as e:
            log.error(f"\n‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É {product_index}: {e}")
            import traceback
            log.error(traceback.format_exc())
            
            # –ü—ã—Ç–∞–µ–º—Å—è –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
            try:
                await self.return_to_main_page(main_page_url)
            except:
                log.error("  ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏")
            
            return None
    
    async def _set_sort_by_first_seen(self) -> bool:
        """
        –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É "First seen" –≤ dropdown
        
        Returns:
            True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
        """
        log.info("  ‚Üí –ü–æ–∏—Å–∫ dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏...")
        try:
            # –ò—â–µ–º dropdown "Sort by"
            sort_selectors = [
                'select:has-text("Sort by")',
                'select',
                '[class*="sort"]',
                'text="Sort by: First seen"',
                'text="Sort by"',
            ]
            
            dropdown = None
            for selector in sort_selectors:
                try:
                    dropdown = await self.page.query_selector(selector)
                    if dropdown:
                        is_visible = await dropdown.is_visible()
                        if is_visible:
                            log.debug(f"–ù–∞–π–¥–µ–Ω dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: {selector}")
                            break
                        else:
                            dropdown = None
                except:
                    continue
            
            if not dropdown:
                # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ —Ç–µ–∫—Å—Ç—É "Sort by: First seen"
                try:
                    sort_text = await self.page.query_selector('text="Sort by: First seen"')
                    if sort_text:
                        # –ö–ª–∏–∫–∞–µ–º –Ω–∞ —Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å dropdown
                        await sort_text.click()
                        await self.human_delay(0.5, 1)
                        
                        # –ò—â–µ–º –æ–ø—Ü–∏—é "First seen"
                        first_seen_option = await self.page.query_selector('text="First seen"')
                        if first_seen_option:
                            await first_seen_option.click()
                            await self.human_delay(1, 2)
                            log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (—á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç)")
                            return True
                except:
                    pass
                
                log.warning("Dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å")
                return False
            
            # –ï—Å–ª–∏ —ç—Ç–æ select —ç–ª–µ–º–µ–Ω—Ç
            tag_name = await dropdown.evaluate("el => el.tagName.toLowerCase()")
            if tag_name == "select":
                # –í—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é —á–µ—Ä–µ–∑ value –∏–ª–∏ —Ç–µ–∫—Å—Ç
                try:
                    log.info("  ‚Üí –ù–∞–π–¥–µ–Ω select —ç–ª–µ–º–µ–Ω—Ç, –≤—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é 'First seen'...")
                    await dropdown.select_option(label="First seen")
                    await self.human_delay(1, 2)
                    log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (select)")
                    return True
                except:
                    pass
            
            # –ï—Å–ª–∏ —ç—Ç–æ –∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown - –∫–ª–∏–∫–∞–µ–º –∏ –≤—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é
            log.info("  ‚Üí –ù–∞–π–¥–µ–Ω –∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown, –æ—Ç–∫—Ä—ã–≤–∞–µ–º...")
            await dropdown.click()
            await self.human_delay(0.5, 1)
            
            # –ò—â–µ–º –æ–ø—Ü–∏—é "First seen"
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –æ–ø—Ü–∏–∏ 'First seen'...")
            option_selectors = [
                'text="First seen"',
                'text="Sort by: First seen"',
                '[role="option"]:has-text("First seen")',
            ]
            
            for opt_sel in option_selectors:
                try:
                    option = await self.page.query_selector(opt_sel)
                    if option:
                        await option.click()
                        await self.human_delay(1, 2)
                        log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (–∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown)")
                        return True
                except:
                    continue
            
            log.warning("  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É 'First seen'")
            return False
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: {e}")
            return False
    
    async def _get_videos_from_tiktok_ads_block(self) -> List[Dict[str, Any]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ TikTok Ads
        
        Returns:
            –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        videos = []
        
        try:
            log.info("  ‚Üí –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ...")
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ
            await self.human_delay(0.5, 1)
            
            # –ò—â–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ - –ø—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã...")
            video_card_selectors = [
                '[class*="video"]',
                '[class*="card"]',
                '[class*="ad"]',
                'div[class*="item"]',
                'a[href*="/ad-search/"]',
            ]
            
            video_elements = []
            for selector in video_card_selectors:
                try:
                    elements = await self.page.query_selector_all(selector)
                    if elements:
                        log.debug(f"–ù–∞–π–¥–µ–Ω–æ {len(elements)} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º {selector}")
                        # –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ, —á—Ç–æ —Å–æ–¥–µ—Ä–∂–∞—Ç –≤–∏–¥–µ–æ (–∏–º–µ—é—Ç thumbnail –∏–ª–∏ play button)
                        for elem in elements:
                            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –∫–∞—Ä—Ç–æ—á–∫–∞ –≤–∏–¥–µ–æ
                            has_play_button = await elem.query_selector('[class*="play"], svg, [class*="thumbnail"]')
                            if has_play_button or '/ad-search/' in str(await elem.get_attribute("href") or ""):
                                video_elements.append(elem)
                        if video_elements:
                            break
                except:
                    continue
            
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ")
            
            # –û–ì–†–ê–ù–ò–ß–ï–ù–ò–ï: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 50 –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
            max_cards = 50
            if len(video_elements) > max_cards:
                log.info(f"  ‚Üí –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ {max_cards} –∏–∑ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫")
                video_elements = video_elements[:max_cards]
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
            log.info("  ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–µ–∫...")
            log.info(f"  ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∞ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫...")
            
            successful_extractions = 0
            for i, card in enumerate(video_elements, 1):
                try:
                    video_data = await self._extract_video_data_from_card(card, i)
                    if video_data:
                        videos.append(video_data)
                        impression = video_data.get('impression', 0)
                        first_seen = video_data.get('first_seen', 'N/A')
                        
                        # –õ–û–ì–ò–†–£–ï–ú –ö–ê–ñ–î–û–ï –í–ò–î–ï–û (–∫–∞–∫ –ø—Ä–æ—Å–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
                        log.info(f"  üìπ –í–∏–¥–µ–æ {i}: impression={impression}, first_seen={first_seen}")
                        
                        if impression > 0 or first_seen != 'N/A':
                            successful_extractions += 1
                except Exception as e:
                    log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ {i}: {e}")
                    continue
            
            log.info(f"  ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–æ {len(videos)} –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ (—É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–æ: {successful_extractions})")
            return videos
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤–∏–¥–µ–æ: {e}")
            return []
    
    async def _extract_video_data_from_card(self, card_element, card_index: int = 0) -> Optional[Dict[str, Any]]:
        """
        –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ
        
        Args:
            card_element: –≠–ª–µ–º–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ
            card_index: –ò–Ω–¥–µ–∫—Å –∫–∞—Ä—Ç–æ—á–∫–∏ (–¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ –∏–ª–∏ None
        """
        try:
            video_data = {
                "ad_search_url": None,
                "impression": 0,
                "first_seen": None,
                "card_element": card_element,  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –∫–ª–∏–∫–∞
            }
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï IMPRESSION ==========
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ HTML-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
            # –ò—â–µ–º div.data-count > div.item –≥–¥–µ caption = "Impression"
            try:
                # –ò—â–µ–º –≤—Å–µ –±–ª–æ–∫–∏ data-count
                data_count_items = await card_element.query_selector_all('div.data-count div.item')
                
                if card_index <= 3:
                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –Ω–∞–π–¥–µ–Ω–æ {len(data_count_items)} –±–ª–æ–∫–æ–≤ div.item")
                
                for idx, item in enumerate(data_count_items):
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å impression
                    caption_elem = await item.query_selector('p.caption')
                    if caption_elem:
                        caption_text = await caption_elem.inner_text()
                        
                        if card_index <= 3:
                            log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}, –±–ª–æ–∫ {idx}: caption = '{caption_text}'")
                        
                        if 'Impression' in caption_text or '–ü–æ–∫–∞–∑' in caption_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
                            value_elem = await item.query_selector('p.value')
                            if value_elem:
                                # –ü–æ–ø—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
                                impression_str_inner = (await value_elem.inner_text()).strip()
                                impression_str_html = (await value_elem.inner_html()).strip()
                                impression_str_content = (await value_elem.text_content()).strip()
                                
                                # –í–°–ï–ì–î–ê –ª–æ–≥–∏—Ä—É–µ–º RAW-–∑–Ω–∞—á–µ–Ω–∏–µ (–¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–∞—Ä—Ç–æ—á–µ–∫)
                                if card_index <= 3:
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (inner_text) = '{impression_str_inner}'")
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (inner_html) = '{impression_str_html}'")
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (text_content) = '{impression_str_content}'")
                                
                                # –ò—Å–ø–æ–ª—å–∑—É–µ–º inner_text –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫
                                impression_str = impression_str_inner
                                impression = validator.parse_impressions(impression_str)
                                if impression:
                                    video_data["impression"] = impression
                                    if card_index <= 3:
                                        log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression PARSED = {impression}")
                                    break
                                else:
                                    if card_index <= 3:
                                        log.warning(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: parse_impressions –≤–µ—Ä–Ω—É–ª None –¥–ª—è '{impression_str}'")
            except Exception as e:
                if card_index <= 3:
                    log.error(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ impression: {e}")
                    import traceback
                    log.error(traceback.format_exc())
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï FIRST SEEN ==========
            # –ò—â–µ–º div.create-time > span —Å –¥–∞—Ç–æ–π
            try:
                create_time_elem = await card_element.query_selector('div.create-time span')
                if create_time_elem:
                    date_text = (await create_time_elem.inner_text()).strip()
                    # –õ–æ–≥–∏—Ä—É–µ–º RAW-–∑–Ω–∞—á–µ–Ω–∏–µ
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: first_seen RAW='{date_text}'")
                    
                    # –§–æ—Ä–º–∞—Ç: "Nov 05 2025-Nov 11 2025" - –±–µ—Ä–µ–º –ü–ï–†–í–£–Æ –¥–∞—Ç—É (–¥–æ –¥–µ—Ñ–∏—Å–∞)
                    # –ò—Å–ø–æ–ª—å–∑—É–µ–º regex –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–µ—Ä–≤–æ–π –¥–∞—Ç—ã
                    match = re.match(r'([A-Z][a-z]{2}\s+\d{1,2}\s+\d{4})', date_text)
                    if match:
                        first_seen_str = match.group(1)
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –¥–∞—Ç—ã
                        parsed_date = validator.parse_video_date(first_seen_str)
                        if parsed_date:
                            video_data["first_seen"] = first_seen_str
                            log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: first_seen parsed='{first_seen_str}'")
            except Exception as e:
                if card_index <= 3:
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ first_seen —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä: {e}")
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï AD-SEARCH –°–°–´–õ–ö–ò ==========
            try:
                link_element = await card_element.query_selector('a.btn-detail[href*="/ad-search/"]')
                if link_element:
                    href = await link_element.get_attribute("href")
                    if href:
                        if href.startswith("/"):
                            video_data["ad_search_url"] = f"https://www.pipiads.com{href}"
                        elif href.startswith("http"):
                            video_data["ad_search_url"] = href
                        else:
                            video_data["ad_search_url"] = f"https://www.pipiads.com/{href}"
                        if card_index <= 3:
                            log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: ad_search_url = {video_data['ad_search_url']}")
            except Exception as e:
                if card_index <= 3:
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ ad_search_url: {e}")
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Å—Å—ã–ª–∫—É, –Ω–æ –µ—Å—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∞ - –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –Ω–µ—ë
            if not video_data["ad_search_url"]:
                video_data["card_element"] = card_element
            
            # –õ–æ–≥–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–∞—Ä—Ç–æ—á–µ–∫
            if card_index <= 3:
                log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –∏—Ç–æ–≥–æ - impression={video_data['impression']}, first_seen={video_data['first_seen']}, ad_search_url={bool(video_data['ad_search_url'])}")
            
            return video_data
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ {card_index}: {e}")
            import traceback
            log.debug(traceback.format_exc())
            return None
    
    async def _filter_videos(self, videos: List[Dict[str, Any]]) -> List[Dict[str, Any]]:
        """
        –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
        
        Args:
            videos: –°–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        
        Returns:
            –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ
        """
        filtered = []
        
        for video in videos:
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ impression (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π "170.6K" –∏–ª–∏ —á–∏—Å–ª–æ–º)
            impression = video.get("impression", 0)
            impression_num = 0
            if isinstance(impression, str):
                # –ü–∞—Ä—Å–∏–º —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                impression_num = validator.parse_impressions(impression) or 0
            elif isinstance(impression, (int, float)):
                impression_num = int(impression)
            
            if not validator.validate_impressions(impression_num, config.MIN_IMPRESSIONS):
                log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: impression {impression} ({impression_num}) < {config.MIN_IMPRESSIONS}")
                continue
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
            first_seen = video.get("first_seen")
            if first_seen and first_seen != "N/A" and first_seen is not None:
                parsed_date = validator.parse_video_date(first_seen)
                if parsed_date:
                    if not validator.is_date_within_days(parsed_date, config.DAYS_BACK):
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –¥–∞—Ç–∞ {first_seen} —Å—Ç–∞—Ä—à–µ {config.DAYS_BACK} –¥–Ω–µ–π")
                        continue
                else:
                    # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å, –Ω–æ –µ—Å—Ç—å impression >= 50k, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –¥–∞—Ç—ã
                    if impression >= config.MIN_IMPRESSIONS:
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–∏–Ω—è—Ç–æ: –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É {first_seen}, –Ω–æ impression {impression} >= {config.MIN_IMPRESSIONS}")
                    else:
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É {first_seen} –∏ impression {impression} < {config.MIN_IMPRESSIONS}")
                        continue
            # –ï—Å–ª–∏ –¥–∞—Ç—ã –Ω–µ—Ç, –Ω–æ impression >= 50k, –ø—Ä–∏–Ω–∏–º–∞–µ–º –≤–∏–¥–µ–æ
            elif impression >= config.MIN_IMPRESSIONS:
                log.debug(f"–í–∏–¥–µ–æ –ø—Ä–∏–Ω—è—Ç–æ: –Ω–µ—Ç –¥–∞—Ç—ã, –Ω–æ impression {impression} >= {config.MIN_IMPRESSIONS}")
            else:
                log.debug("–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –Ω–µ—Ç –¥–∞—Ç—ã first_seen –∏ impression < –º–∏–Ω–∏–º—É–º–∞")
                continue
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
            video["_impression_num"] = impression_num
            filtered.append(video)
        
        # –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: —Å–Ω–∞—á–∞–ª–∞ –ø–æ –¥–∞—Ç–µ (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ), –ø–æ—Ç–æ–º –ø–æ impressions (—Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ)
        # –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ tiktok_link, ad_search_url –∏–ª–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ impression+first_seen
        seen_videos = set()
        unique_videos = []
        for video in filtered:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
            # 1. tiktok_link (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            # 2. ad_search_url (–µ—Å–ª–∏ –µ—Å—Ç—å)
            # 3. –ö–æ–º–±–∏–Ω–∞—Ü–∏—è impression + first_seen (fallback)
            video_id = None
            
            if video.get("tiktok_link") and video.get("tiktok_link") != "N/A":
                video_id = f"tiktok:{video.get('tiktok_link')}"
            elif video.get("ad_search_url") and video.get("ad_search_url") != "N/A":
                video_id = f"ad_search:{video.get('ad_search_url')}"
            else:
                # Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—é impression + first_seen
                impression = video.get("impression", 0)
                first_seen = video.get("first_seen", "N/A")
                video_id = f"fallback:{impression}:{first_seen}"
            
            if video_id and video_id not in seen_videos:
                seen_videos.add(video_id)
                unique_videos.append(video)
            else:
                log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ –∫–∞–∫ –¥—É–±–ª–∏–∫–∞—Ç: {video_id}")
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º: —Å–Ω–∞—á–∞–ª–∞ –ø–æ –¥–∞—Ç–µ (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ), –ø–æ—Ç–æ–º –ø–æ impressions (—Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ)
        def sort_key(v):
            parsed_date = validator.parse_video_date(v.get("first_seen", ""))
            if parsed_date:
                date_timestamp = -parsed_date.timestamp()  # –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ —É–±—ã–≤–∞–Ω–∏—é (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ)
            else:
                date_timestamp = 0  # –í–∏–¥–µ–æ –±–µ–∑ –¥–∞—Ç—ã –≤ –∫–æ–Ω–µ—Ü
            return (date_timestamp, -v.get("_impression_num", 0))
        
        unique_videos.sort(key=sort_key)
        
        # –ë–µ—Ä–µ–º —Ç–æ–ø-3
        top_videos = unique_videos[:3]
        
        log.info(f"‚úÖ –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ {len(filtered)} –≤–∏–¥–µ–æ –∏–∑ {len(videos)}, —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö: {len(unique_videos)}, —Ç–æ–ø-3: {len(top_videos)}")
        return top_videos
    
    async def _get_video_details(self, video: Dict[str, Any]) -> Optional[Dict[str, Any]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –≤–∏–¥–µ–æ
        
        Args:
            video: –°–ª–æ–≤–∞—Ä—å —Å –±–∞–∑–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ (–∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        try:
            # –ï—Å–ª–∏ –µ—Å—Ç—å ad_search_url, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞–ø—Ä—è–º—É—é
            if video.get("ad_search_url"):
                log.info(f"    ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É ad-search: {video['ad_search_url']}")
                await self.page.goto(video["ad_search_url"], wait_until="domcontentloaded", timeout=30000)
                await self.human_delay(0.5, 1)
                log.info("    ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ad-search –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            else:
                # –ï—Å–ª–∏ –Ω–µ—Ç URL, –∫–ª–∏–∫–∞–µ–º –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É
                # –í–ê–ñ–ù–û: –≠–ª–µ–º–µ–Ω—Ç –º–æ–∂–µ—Ç –∏—Å—á–µ–∑–Ω—É—Ç—å –∏–∑ DOM, –ø–æ—ç—Ç–æ–º—É –∏—â–µ–º –µ–≥–æ –∑–∞–Ω–æ–≤–æ
                card_element = video.get("card_element")
                if not card_element:
                    log.error("    ‚ùå –ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ –ø–µ—Ä–µ–π—Ç–∏ –∫ –≤–∏–¥–µ–æ (–Ω–µ—Ç URL –∏ —ç–ª–µ–º–µ–Ω—Ç–∞)")
                    return None
                
                log.info("    ‚Üí –ö–ª–∏–∫ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –≤–∏–¥–µ–æ...")
                try:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –µ—â–µ –≤ DOM
                    is_attached = await card_element.evaluate("el => el.isConnected")
                    if not is_attached:
                        log.warning("    ‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç –∏—Å—á–µ–∑ –∏–∑ DOM, –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∑–∞–Ω–æ–≤–æ...")
                        # –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ –ø–æ ad_search_url –∏–ª–∏ –¥—Ä—É–≥–∏–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º
                        # –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None
                        log.error("    ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ")
                        return None
                    
                    await card_element.click()
                    await self.human_delay(0.5, 1)
                    log.info("    ‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ –≤–∏–¥–µ–æ –æ—Ç–∫—Ä—ã—Ç–∞")
                except Exception as e:
                    log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É: {e}")
                    log.warning("    ‚ö†Ô∏è –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ...")
                    # –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –∏—Å—á–µ–∑, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None
                    return None
                
                # –ñ–¥–µ–º –æ—Ç–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞/–º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                # –ò—â–µ–º –∫–Ω–æ–ø–∫—É "More detail"
                log.info("    ‚Üí –ü–æ–∏—Å–∫ –∫–Ω–æ–ø–∫–∏ 'More detail'...")
                more_detail_selectors = [
                    'text="More detail"',
                    'text="More Detail"',
                    'button:has-text("More detail")',
                    'a:has-text("More detail")',
                ]
                
                more_detail_button = None
                for selector in more_detail_selectors:
                    try:
                        more_detail_button = await self.page.wait_for_selector(selector, timeout=5000, state="visible")
                        if more_detail_button:
                            log.info(f"    ‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ 'More detail' (—Å–µ–ª–µ–∫—Ç–æ—Ä: {selector})")
                            break
                    except:
                        continue
                
                if not more_detail_button:
                    log.error("    ‚ùå –ö–Ω–æ–ø–∫–∞ 'More detail' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
                    return None
                
                # –ö–ª–∏–∫–∞–µ–º –Ω–∞ "More detail"
                log.info("    ‚Üí –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É 'More detail'...")
                await more_detail_button.click()
                await self.human_delay(0.5, 1)
                
                # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
                log.info("    ‚Üí –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search...")
                await self.page.wait_for_load_state("domcontentloaded", timeout=10000)
                await self.human_delay(0.3, 0.5)
                log.info("    ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ad-search –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
            # –ü–µ—Ä–µ–¥–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏) –¥–ª—è fallback
            log.info("    ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search...")
            
            # –í–ê–ñ–ù–û: –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö
            try:
                await self.page.wait_for_load_state("networkidle", timeout=15000)
                await self.human_delay(1, 2)  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                log.info("    ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ad-search –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–∞ (networkidle)")
            except:
                log.warning("    ‚ö†Ô∏è –¢–∞–π–º–∞—É—Ç networkidle, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å domcontentloaded...")
                await self.page.wait_for_load_state("domcontentloaded", timeout=10000)
                await self.human_delay(2, 3)  # –£–≤–µ–ª–∏—á–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞
            
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (Script, Hook, Audience)
            try:
                # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                await self.page.wait_for_selector('li#ai-script, li#ai-hook, div.addel-info-item', timeout=10000, state="visible")
                log.info("    ‚úÖ –ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search")
            except:
                log.warning("    ‚ö†Ô∏è –ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ...")
            
            return await self._extract_ad_search_data(video)
            
        except Exception as e:
            log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–µ—Ç–∞–ª–µ–π –≤–∏–¥–µ–æ: {e}")
            import traceback
            log.error(traceback.format_exc())
            return None
    
    async def _extract_ad_search_data(self, original_video: Optional[Dict[str, Any]] = None) -> Dict[str, Any]:
        """
        –ò–∑–≤–ª–µ—á—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
        
        Args:
            original_video: –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (–¥–ª—è fallback impressions)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        video_data = {
            "tiktok_link": "N/A",
            "impression": 0,
            "script": "N/A",
            "hook": "N/A",
            "audience_age": "N/A",
            "country": "N/A",
            "first_seen": "N/A",
        }
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è fallback
        if original_video:
            original_impression = original_video.get("impression")
            if original_impression:
                video_data["_original_impression"] = original_impression
        
        try:
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            await self.page.wait_for_load_state("domcontentloaded")
            await self.human_delay(0.3, 0.5)
            
            # –ü–æ–ª—É—á–∞–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ø–æ–∏—Å–∫–∞
            page_text = await self.page.content()
            
            # 1. TikTok —Å—Å—ã–ª–∫–∞ (–∏–∑ –ø–æ–ª—è "TikTok Post" (–∞–Ω–≥–ª.) –∏–ª–∏ "–ü–æ—Å—Ç TikTok" (—Ä—É—Å.))
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ TikTok —Å—Å—ã–ª–∫–∏...")
            
            # –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –ø–æ —Ç–µ–∫—Å—Ç—É "TikTok Post" –∏–ª–∏ "–ü–æ—Å—Ç TikTok"
            tiktok_post_selectors = [
                'text=/TikTok Post/i',  # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
                'text=/–ü–æ—Å—Ç TikTok/i',  # –†—É—Å—Å–∫–∏–π fallback
            ]
            
            for selector in tiktok_post_selectors:
                try:
                    locator = self.page.locator(selector).first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Å—Å—ã–ª–∫—É —Ä—è–¥–æ–º
                        try:
                            parent_locator = locator.locator("..")
                            # –ò—â–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å—Å—ã–ª–∫–∞–º —Å /v/)
                            link = await parent_locator.locator('a[href*="m.tiktok.com/v/"]').first.element_handle()
                            if not link:
                                link = await parent_locator.locator('a[href*="tiktok.com/v/"]').first.element_handle()
                            if not link:
                                link = await parent_locator.locator('a[href*="tiktok.com"]').first.element_handle()
                            if link:
                                href = await link.get_attribute("href")
                                if href:
                                    # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä—ã –≤ TikTok Shop
                                    if "shop.tiktok.com/view/product" in href or "/view/product" in href:
                                        log.debug(f"      ‚Üí –ü—Ä–æ–ø—É—â–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä: {href[:50]}...")
                                        continue
                                    # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ
                                    if "/v/" in href or "m.tiktok.com" in href:
                                        video_data["tiktok_link"] = href
                                        log.info(f"      ‚úÖ TikTok —Å—Å—ã–ª–∫–∞ –Ω–∞–π–¥–µ–Ω–∞: {href[:50]}...")
                                        break
                        except:
                            pass
                except:
                    continue
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç, –∏—â–µ–º –≤—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ TikTok
            # –í–ê–ñ–ù–û: –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ (m.tiktok.com/v/...), –ù–ï –Ω–∞ —Ç–æ–≤–∞—Ä—ã (shop.tiktok.com/view/product/...)
            if video_data["tiktok_link"] == "N/A":
                tiktok_link_selectors = [
                    'a[href*="m.tiktok.com/v/"]',  # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ
                    'a[href*="tiktok.com/v/"]',    # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                    'a[href*="tiktok.com"]',       # Fallback
                ]
                
                for selector in tiktok_link_selectors:
                    try:
                        links = await self.page.query_selector_all(selector)
                        for link in links:
                            href = await link.get_attribute("href")
                            if href and "tiktok.com" in href:
                                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä—ã –≤ TikTok Shop
                                if "shop.tiktok.com/view/product" in href or "/view/product" in href:
                                    log.debug(f"      ‚Üí –ü—Ä–æ–ø—É—â–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä: {href[:50]}...")
                                    continue
                                
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ (—Å–æ–¥–µ—Ä–∂–∞—Ç /v/ –≤ –ø—É—Ç–∏)
                                if "/v/" in href or "m.tiktok.com" in href:
                                    video_data["tiktok_link"] = href
                                    log.info(f"      ‚úÖ TikTok —Å—Å—ã–ª–∫–∞ –Ω–∞–π–¥–µ–Ω–∞: {href[:50]}...")
                                    break
                        if video_data["tiktok_link"] != "N/A":
                            break
                    except:
                        continue
            
            if video_data["tiktok_link"] == "N/A":
                log.warning("      ‚ö†Ô∏è TikTok —Å—Å—ã–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
            
            # 2. Impressions - –ö–†–ò–¢–ò–ß–ù–û: "Impressions" (–∞–Ω–≥–ª.) –∏–ª–∏ "–ü–æ–∫–∞–∑—ã" (—Ä—É—Å.), –Ω–µ "Likes" –∏–ª–∏ "–ù—Ä–∞–≤–∏—Ç—Å—è"!
            # –ò—â–µ–º –≤ —Ä–∞–∑–¥–µ–ª–µ "Data/–î–∞–Ω–Ω—ã–µ" –≤ –ø—É–Ω–∫—Ç–µ "Impression/–ü–æ–∫–∞–∑"
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ impressions...")
            impression_text = await self._extract_impressions()
            if impression_text:
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–µ—Å–ª–∏ –æ–Ω —É–∂–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "170.6K" –∏–ª–∏ "339.9M")
                if impression_text.upper().endswith(('K', 'M')):
                    video_data["impression"] = impression_text
                    log.info(f"      ‚úÖ Impressions (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç): {impression_text}")
                else:
                    # –ü–∞—Ä—Å–∏–º —á–∏—Å–ª–æ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞—Ç–Ω–æ
                    impression_num = validator.parse_impressions(impression_text) or 0
                    video_data["impression"] = validator.format_impressions(impression_num)
                    log.info(f"      ‚úÖ Impressions (—Å—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–æ): {video_data['impression']}")
            else:
                # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ–Ω–∏ –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                # (–∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞)
                original_impression = video_data.get("_original_impression")
                if original_impression:
                    if isinstance(original_impression, (int, float)) and original_impression > 0:
                        video_data["impression"] = validator.format_impressions(int(original_impression))
                        log.info(f"      ‚úÖ Impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏: {video_data['impression']}")
                    elif isinstance(original_impression, str) and original_impression != "N/A":
                        video_data["impression"] = original_impression
                        log.info(f"      ‚úÖ Impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (—Å—Ç—Ä–æ–∫–∞): {original_impression}")
                    else:
                        video_data["impression"] = "N/A"
                        log.warning("      ‚ö†Ô∏è Impressions –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –Ω–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ")
                else:
                    video_data["impression"] = "N/A"
                    log.warning("      ‚ö†Ô∏è Impressions –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
            
            # 3. Script (–∏–∑ "Transcript" –∏–ª–∏ "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞")
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è (script)...")
            log.info(f"      ‚Üí –¢–µ–∫—É—â–∏–π URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {self.page.url}")
            script = await self._extract_script()
            if script:
                video_data["script"] = script
                log.info(f"      ‚úÖ Script –Ω–∞–π–¥–µ–Ω ({len(script)} —Å–∏–º–≤–æ–ª–æ–≤): {script[:100]}...")
            else:
                video_data["script"] = "N/A"
                log.warning("      ‚ö†Ô∏è Script –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-script p.content-text –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 4. Hook (–∏–∑ —Å–µ–∫—Ü–∏–∏ Hook –∏–ª–∏ Hooks)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ hook...")
            hook = await self._extract_hook()
            if not hook:
                # –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω
                log.warning("      ‚ö†Ô∏è Hook –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫...")
                await self.human_delay(1, 2)  # –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É
                hook = await self._extract_hook()
            
            if hook:
                video_data["hook"] = hook
                log.info(f"      ‚úÖ Hook –Ω–∞–π–¥–µ–Ω ({len(hook)} —Å–∏–º–≤–æ–ª–æ–≤): {hook[:100]}...")
            else:
                video_data["hook"] = "N/A"
                log.warning("      ‚ö†Ô∏è Hook –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook p.content-text –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 5. Audience Age (–∏–∑ –ø–æ–ª—è Audience/–ê—É–¥–∏—Ç–æ—Ä–∏—è)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∞—É–¥–∏—Ç–æ—Ä–∏–∏...")
            audience_data = await self._extract_audience()
            if audience_data:
                age = audience_data.get("age", "N/A")
                platform = audience_data.get("platform", "N/A")
                # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ "35-45" –∏–ª–∏ "35-45 Android" (–µ—Å–ª–∏ –µ—Å—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞)
                # –í —Å—Ç—Ä–æ–∫–µ 6 —Ç–æ–ª—å–∫–æ –≤–æ–∑—Ä–∞—Å—Ç "25-35", –±–µ–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
                video_data["audience_age"] = age if age != "N/A" else "N/A"
                log.info(f"      ‚úÖ Audience: {video_data['audience_age']}")
            else:
                video_data["audience_age"] = "N/A"
                log.info("      ‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
            
            # 6. Country (–∏–∑ –ø–æ–ª—è "Country/Region" –∏–ª–∏ "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω" - –û–¢–î–ï–õ–¨–ù–û –æ—Ç Audience!)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã...")
            country = await self._extract_country()
            if country:
                video_data["country"] = country
                log.info(f"      ‚úÖ Country: {country}")
            else:
                video_data["country"] = "N/A"
                log.warning("      ‚ö†Ô∏è Country –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä div.addel-info-item —Å 'Country/Region' –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 7. First seen (—Ñ–æ—Ä–º–∞—Ç "Oct 27 2025" - –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ "Oct 28 2025 ~ Nov 10 2025")
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞—Ç—ã First seen...")
            first_seen = await self._extract_first_seen()
            if first_seen:
                video_data["first_seen"] = first_seen
                log.info(f"      ‚úÖ First seen: {first_seen}")
            else:
                video_data["first_seen"] = "N/A"
                log.info("      ‚ö†Ô∏è First seen –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
            
            log.info(f"    ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ—á–µ–Ω—ã: impression={video_data['impression']}, first_seen={video_data['first_seen']}")
            return video_data
            
        except Exception as e:
            log.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö ad-search: {e}")
            return video_data
    
    async def _extract_impressions(self) -> Optional[str]:
        """
        –ò–∑–≤–ª–µ—á—å impressions - –ö–†–ò–¢–ò–ß–ù–û: –≤ —Ä–∞–∑–¥–µ–ª–µ "Data/–î–∞–Ω–Ω—ã–µ" –≤ –ø—É–Ω–∫—Ç–µ "Impression/–ü–æ–∫–∞–∑"
        –í–ê–ñ–ù–û: –ù–ï –±—Ä–∞—Ç—å —à–∞–±–ª–æ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã!
        
        Returns:
            –°—Ç—Ä–æ–∫–∞ —Å impressions (–Ω–∞–ø—Ä–∏–º–µ—Ä "170.6K", "339.9M") –∏–ª–∏ None
        """
        try:
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM (–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ)
            try:
                impression_data = await self.page.evaluate("""
                    () => {
                        // –ò—â–µ–º —Ä–∞–∑–¥–µ–ª "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                        const dataKeywords = ['Data', '–î–∞–Ω–Ω—ã–µ'];
                        const impressionKeywords = ['Impression', '–ü–æ–∫–∞–∑', '–ü–æ–∫–∞–∑—ã'];
                        
                        // –ò—â–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —ç–ª–µ–º–µ–Ω—Ç "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                            for (const dataKeyword of dataKeywords) {
                                if (text.includes(dataKeyword)) {
                                    // –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –∏—â–µ–º "Impression" –∏–ª–∏ "–ü–æ–∫–∞–∑"
                                    for (const impKeyword of impressionKeywords) {
                                        if (text.includes(impKeyword)) {
                                            // –ò—â–µ–º —á–∏—Å–ª–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "170.6K", "403.2M" –∏ —Ç.–¥.
                                            const patterns = [
                                                new RegExp(impKeyword + '[\\s:]*([\\d.,]+[KM]?)', 'i'),
                                                new RegExp('([\\d.,]+[KM]?)\\s*' + impKeyword, 'i')
                                            ];
                                            
                                            for (const pattern of patterns) {
                                                const match = text.match(pattern);
                                                if (match && match[1]) {
                                                    const value = match[1];
                                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ —á–∏—Å–ª–æ (–Ω–µ —à–∞–±–ª–æ–Ω–Ω–æ–µ)
                                                    // –û–±—ã—á–Ω–æ —Ä–µ–∞–ª—å–Ω—ã–µ impressions –æ—Ç 50K –¥–æ 500M
                                                    const numValue = parseFloat(value.replace(/[KM]/i, ''));
                                                    if (numValue >= 0.05 && numValue <= 1000) {
                                                        return value;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        
                        // Fallback: –∏—â–µ–º –Ω–∞–ø—Ä—è–º—É—é "Impression" –∏–ª–∏ "–ü–æ–∫–∞–∑" (–ù–ï "Likes"!)
                        for (const impKeyword of impressionKeywords) {
                            const elements = Array.from(document.querySelectorAll('*')).filter(el => {
                                const text = el.innerText || '';
                                return text.includes(impKeyword) && !text.toLowerCase().includes('likes') && !text.toLowerCase().includes('–Ω—Ä–∞–≤–∏—Ç—Å—è');
                            });
                            
                            for (const el of elements) {
                                const text = el.innerText || '';
                                const patterns = [
                                    new RegExp(impKeyword + '[\\s:]*([\\d.,]+[KM]?)', 'i'),
                                    new RegExp('([\\d.,]+[KM]?)\\s*' + impKeyword, 'i')
                                ];
                                
                                for (const pattern of patterns) {
                                    const match = text.match(pattern);
                                    if (match && match[1]) {
                                        const value = match[1];
                                        const numValue = parseFloat(value.replace(/[KM]/i, ''));
                                        if (numValue >= 0.05 && numValue <= 1000) {
                                            return value;
                                        }
                                    }
                                }
                            }
                        }
                        
                        return null;
                    }
                """)
                
                if impression_data:
                    log.debug(f"–ù–∞–π–¥–µ–Ω–æ impressions —á–µ—Ä–µ–∑ JavaScript: {impression_data}")
                    return impression_data
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ impressions —á–µ—Ä–µ–∑ JS: {e}")
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (fallback)
            data_keywords = ["Data", "–î–∞–Ω–Ω—ã–µ"]
            
            for keyword in data_keywords:
                try:
                    data_locator = self.page.locator(f'text=/{keyword}/i').first
                    if await data_locator.count() > 0:
                        impression_keywords = ["Impression", "–ü–æ–∫–∞–∑", "–ü–æ–∫–∞–∑—ã"]
                        for imp_keyword in impression_keywords:
                            try:
                                parent_text = await data_locator.locator("..").inner_text()
                                if imp_keyword in parent_text and "Likes" not in parent_text and "–ù—Ä–∞–≤–∏—Ç—Å—è" not in parent_text:
                                    pattern = rf'{imp_keyword}[:\s]*([\d.,]+[KM]?)'
                                    match = re.search(pattern, parent_text, re.IGNORECASE)
                                    if match:
                                        impression_str = match.group(1)
                                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —à–∞–±–ª–æ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                                        num_value = validator.parse_impressions(impression_str)
                                        if num_value and 50000 <= num_value <= 1000000000:  # –û—Ç 50K –¥–æ 1B
                                            log.debug(f"–ù–∞–π–¥–µ–Ω–æ impressions –≤ —Ä–∞–∑–¥–µ–ª–µ Data: {impression_str}")
                                            return impression_str
                            except:
                                continue
                except:
                    continue
            
            log.warning("–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ 'Impression' –∏–ª–∏ '–ü–æ–∫–∞–∑' –≤ —Ä–∞–∑–¥–µ–ª–µ Data")
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ impressions: {e}")
            return None
    
    async def _extract_script(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å —Å—Ü–µ–Ω–∞—Ä–∏–π –∏–∑ —Å–µ–∫—Ü–∏–∏ 'Script' –∏–ª–∏ '–°—Ü–µ–Ω–∞—Ä–∏–π' (–∏–ª–∏ 'Transcript' –∏–ª–∏ '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞')
        
        –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
        <li id="ai-script">
            <div class="li-title">...</div>
            <div class="control-content li-content">
                <p class="content-text slot-wrap">...</p>
            </div>
        </li>
        """
        try:
            # –ú–ï–¢–û–î 0: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä—É –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                # –°–Ω–∞—á–∞–ª–∞ –∂–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
                try:
                    await self.page.wait_for_selector('li#ai-script', timeout=5000, state="visible")
                except:
                    log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-script –Ω–µ –ø–æ—è–≤–∏–ª—Å—è –∑–∞ 5 —Å–µ–∫—É–Ω–¥")
                
                script_element = await self.page.query_selector('li#ai-script p.content-text')
                if script_element:
                    script = await script_element.inner_text()
                    if script and len(script.strip()) > 10:
                        log.info(f"      ‚úÖ Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-script p.content-text ({len(script)} —Å–∏–º–≤–æ–ª–æ–≤)")
                        return script.strip()
                else:
                    log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-script p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω")
            except Exception as e:
                log.debug(f"      ‚Üí –°–µ–ª–µ–∫—Ç–æ—Ä li#ai-script –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: {e}")
            
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
            script_keywords = ["Script", "–°—Ü–µ–Ω–∞—Ä–∏–π", "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞", "–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç"]
            
            for keyword in script_keywords:
                try:
                    # –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å —Ç–µ–∫—Å—Ç–æ–º
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            parent_text = await locator.locator("..").inner_text()
                            if keyword in parent_text:
                                parts = parent_text.split(keyword, 1)
                                if len(parts) > 1:
                                    script = parts[1].strip()
                                    # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –º–µ—Ç–∫–∏
                                    stop_words = ["Hook", "–•—É–∫", "Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", 
                                                "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", "Impressions", "–ü–æ–∫–∞–∑—ã",
                                                "Limited Time Offer", "Annual Plan", "Promotion Period", "50% OFF",
                                                "Privacy", "Terms", "Copyright", "PIPIADS", "All Rights Reserved",
                                                "AI-agent", "cosmobeauty", "credits", "subscription", "invoice",
                                                "Monthly Credits", "Extra Credits", "data cost", "detail costs",
                                                "Team Setting", "Affiliate Dashboard", "Logout"]
                                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                           "cosmobeauty", "credits", "subscription", "invoice", 
                                                           "Monthly Credits", "Extra Credits", "@gmail.com"]
                                    is_footer_menu = any(keyword in script for keyword in footer_menu_keywords)
                                    
                                    for stop_word in stop_words:
                                        if stop_word in script:
                                            script = script.split(stop_word)[0].strip()
                                    # –§–∏–ª—å—Ç—Ä—É–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (Video Text Translator, Quality, Size –∏ —Ç.–¥.)
                                    metadata_keywords = ["Video Text Translator", "Translator", "Quality", "Size", "Resolution", 
                                                        "Width", "Height", "Duration", "Format", "Codec", "Frame Rate"]
                                    is_metadata = any(keyword in script for keyword in metadata_keywords)
                                    
                                    # –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                    lines = script.split('\n')
                                    cleaned_lines = []
                                    skip_words = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook']
                                    for line in lines:
                                        line = line.strip()
                                        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                        if line and not line.startswith('#') and not any(skip in line for skip in skip_words):
                                            cleaned_lines.append(line)
                                    script = '\n'.join(cleaned_lines).strip()
                                    
                                    if script and len(script) > 10 and not is_footer_menu and not is_metadata:
                                        log.debug(f"Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Ä–æ–¥–∏—Ç–µ–ª—å)")
                                        return script
                        except:
                            pass
                        
                        # –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            next_sibling = await locator.evaluate_handle("el => el.nextElementSibling")
                            if next_sibling:
                                script = await next_sibling.as_element().inner_text()
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                       "cosmobeauty", "credits", "subscription", "invoice", 
                                                       "Monthly Credits", "Extra Credits", "@gmail.com"]
                                is_footer_menu = any(keyword in script for keyword in footer_menu_keywords)
                                # –§–∏–ª—å—Ç—Ä—É–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                metadata_keywords = ["Video Text Translator", "Translator", "Quality", "Size", "Resolution"]
                                is_metadata = any(keyword in script for keyword in metadata_keywords)
                                
                                # –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                lines = script.split('\n')
                                cleaned_lines = []
                                skip_words = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook']
                                for line in lines:
                                    line = line.strip()
                                    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                    if line and not line.startswith('#') and not any(skip in line for skip in skip_words):
                                        cleaned_lines.append(line)
                                script = '\n'.join(cleaned_lines).strip()
                                
                                if script and len(script) > 10 and not is_footer_menu and not is_metadata:
                                    log.debug(f"Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç)")
                                    return script.strip()
                        except:
                            pass
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                script = await self.page.evaluate("""
                    () => {
                        const keywords = ['Script', '–°—Ü–µ–Ω–∞—Ä–∏–π', 'Transcript', '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞', '–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç'];
                        const stopWords = ['Hook', '–•—É–∫', 'Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 
                                          'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 'Impressions', '–ü–æ–∫–∞–∑—ã',
                                          'Analysis', 'Advertiser', 'Display Name', 'Ad Copy',
                                          'Limited Time Offer', 'Annual Plan', 'Promotion Period', '50% OFF'];
                        
                        // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    // –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ (–æ–±—ã—á–Ω–æ —ç—Ç–æ —Å–∞–º script)
                                    let scriptText = null;
                                    
                                    // –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ sibling —ç–ª–µ–º–µ–Ω—Ç–∞
                                    let nextSibling = el.nextElementSibling;
                                    if (nextSibling) {
                                        scriptText = nextSibling.innerText || '';
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    if (!scriptText || scriptText.length < 10) {
                                        const parentText = el.parentElement ? el.parentElement.innerText || '' : '';
                                        if (parentText.includes(keyword)) {
                                            const parts = parentText.split(keyword);
                                            if (parts.length > 1) {
                                                scriptText = parts[1].trim();
                                            }
                                        }
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 3: –ò—â–µ–º –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö (–æ–±—ã—á–Ω–æ script –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –±–ª–æ–∫–µ)
                                    if (!scriptText || scriptText.length < 10) {
                                        const children = el.querySelectorAll('p, div, span');
                                        for (const child of children) {
                                            const childText = child.innerText || '';
                                            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç—ã
                                            if (childText.length > 20 && 
                                                !childText.includes('Advertiser') && 
                                                !childText.includes('Display Name') &&
                                                !childText.includes('Analysis') &&
                                                !childText.includes('Generator') &&
                                                !childText.includes('Limited Time Offer') &&
                                                !childText.includes('Annual Plan') &&
                                                !childText.includes('Promotion Period') &&
                                                !childText.includes('50% OFF')) {
                                                scriptText = childText;
                                                break;
                                            }
                                        }
                                    }
                                    
                                    if (scriptText) {
                                        // –£–±–∏—Ä–∞–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                        for (const stopWord of stopWords) {
                                            if (scriptText.includes(stopWord)) {
                                                scriptText = scriptText.split(stopWord)[0];
                                            }
                                        }
                                        
                                        scriptText = scriptText.trim();
                                        
                                        // –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                        const skipWords = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook'];
                                        const lines = scriptText.split('\\n');
                                        const cleanedLines = [];
                                        for (const line of lines) {
                                            const trimmedLine = line.trim();
                                            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                            if (trimmedLine && !trimmedLine.startsWith('#') && 
                                                !skipWords.some(word => trimmedLine.includes(word))) {
                                                cleanedLines.push(trimmedLine);
                                            }
                                        }
                                        scriptText = cleanedLines.join('\\n').trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π script (–Ω–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –Ω–µ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç, –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é)
                                        const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                                   'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                                   'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                                   'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                                   'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                        const isFooterMenu = footerMenuKeywords.some(keyword => scriptText.includes(keyword));
                                        
                                        // –§–∏–ª—å—Ç—Ä—É–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                    const metadataKeywords = ['Video Text Translator', 'Translator', 'Quality', 'Size', 'Resolution', 
                                                             'Width', 'Height', 'Duration', 'Format', 'Codec', 'Frame Rate'];
                                    const isMetadata = metadataKeywords.some(keyword => scriptText.includes(keyword));
                                    
                                    if (scriptText && scriptText.length > 20 && 
                                            !scriptText.startsWith('Analysis') &&
                                            !scriptText.includes('shop.tiktok.com') &&
                                            !scriptText.includes('Generator Image') &&
                                            !scriptText.includes('Limited Time Offer') &&
                                            !scriptText.includes('Annual Plan') &&
                                            !scriptText.includes('Promotion Period') &&
                                            !scriptText.includes('50% OFF') &&
                                            !scriptText.toLowerCase().includes('q4') &&
                                            !scriptText.toLowerCase().includes('monthly plan') &&
                                            !isFooterMenu &&
                                            !isMetadata) {
                                            return scriptText;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if script and len(script) > 10:
                    log.debug("Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript")
                    return script.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ script —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è: {e}")
            return None
    
    async def _extract_hook(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å hook –∏–∑ —Å–µ–∫—Ü–∏–∏ Hook/Hooks (–∞–Ω–≥–ª.) –∏–ª–∏ –•—É–∫/–•—É–∫–∏ (—Ä—É—Å.)
        –í–ê–ñ–ù–û: Hook –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ Script –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ!
        
        –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
        <li id="ai-hook">
            <div class="li-title">...</div>
            <div class="control-content li-content">
                <p class="content-text slot-wrap">...</p>
            </div>
        </li>
        """
        try:
            # –ú–ï–¢–û–î 0: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä—É –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                # –°–Ω–∞—á–∞–ª–∞ –∂–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
                try:
                    await self.page.wait_for_selector('li#ai-hook', timeout=5000, state="visible")
                except:
                    log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-hook –Ω–µ –ø–æ—è–≤–∏–ª—Å—è –∑–∞ 5 —Å–µ–∫—É–Ω–¥")
                
                hook_element = await self.page.query_selector('li#ai-hook p.content-text')
                if hook_element:
                    hook = await hook_element.inner_text()
                    if hook and len(hook.strip()) > 5:
                        log.info(f"      ‚úÖ Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook p.content-text ({len(hook)} —Å–∏–º–≤–æ–ª–æ–≤)")
                        return hook.strip()
                else:
                    log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-hook p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω")
            except Exception as e:
                log.debug(f"      ‚Üí –°–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: {e}")
            
            # –ù–û–í–´–ô –ú–ï–¢–û–î: –ò—â–µ–º Script, –∑–∞—Ç–µ–º –∏—â–µ–º Hook –≤ —Å–ª–µ–¥—É—é—â–µ–º —ç–ª–µ–º–µ–Ω—Ç–µ/—Å–µ–∫—Ü–∏–∏
            try:
                # –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏–º Script
                script_keywords = ["Script", "–°—Ü–µ–Ω–∞—Ä–∏–π", "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞"]
                for script_keyword in script_keywords:
                    try:
                        script_locator = self.page.locator(f'text=/{script_keyword}/i').first
                        if await script_locator.count() > 0:
                            # –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ Script, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç "Hook" –∏–ª–∏ "Hooks"
                            # –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ –ø–æ—Å–ª–µ Script
                            try:
                                # –°–ø–æ—Å–æ–± 1: –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å "Hook" –∏–ª–∏ "Hooks" –ø–æ—Å–ª–µ Script
                                parent = script_locator.locator("..")
                                parent_text = await parent.inner_text()
                                
                                # –ò—â–µ–º "Hook" –∏–ª–∏ "Hooks" –≤ —Ç–æ–º –∂–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ
                                if "Hook" in parent_text or "Hooks" in parent_text or "–•—É–∫" in parent_text or "–•—É–∫–∏" in parent_text:
                                    # –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é Script –∏ Hook –≤ —Ç–µ–∫—Å—Ç–µ
                                    script_pos = parent_text.find(script_keyword)
                                    hook_pos = -1
                                    for hook_word in ["Hook", "Hooks", "–•—É–∫", "–•—É–∫–∏"]:
                                        pos = parent_text.find(hook_word, script_pos)
                                        if pos > script_pos:
                                            hook_pos = pos
                                            break
                                    
                                    if hook_pos > script_pos:
                                        # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ "Hook" –∏–ª–∏ "Hooks"
                                        hook_section = parent_text[hook_pos:]
                                        # –£–±–∏—Ä–∞–µ–º "Hook" –∏–ª–∏ "Hooks" –∏–∑ –Ω–∞—á–∞–ª–∞
                                        hook_section = re.sub(r'^Hooks?\s*:?\s*', '', hook_section, flags=re.IGNORECASE)
                                        hook_section = re.sub(r'^–•—É–∫–∏?\s*:?\s*', '', hook_section, flags=re.IGNORECASE)
                                        hook_text = hook_section.strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏ (Target Audience, First seen –∏ —Ç.–¥.)
                                        stop_words = ["Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", 
                                                    "Impressions", "–ü–æ–∫–∞–∑—ã", "Country", "–°—Ç—Ä–∞–Ω–∞", "Country/Region", "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω"]
                                        for stop_word in stop_words:
                                            if stop_word in hook_text:
                                                hook_text = hook_text.split(stop_word)[0].strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                        hook_text = re.sub(r'Quality\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'Size\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'Resolution\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'--', '', hook_text)
                                        hook_text = re.sub(r'\n{2,}', '\n', hook_text).strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞ –≤ –Ω–∞—á–∞–ª–µ
                                        hook_text = re.sub(r'^(Tags|Script|Hooks?)\s*:?\s*', '', hook_text, flags=re.IGNORECASE)
                                        
                                        if hook_text and len(hook_text) > 5 and len(hook_text) < 500:
                                            log.debug(f"Hook –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ Script —á–µ—Ä–µ–∑ '{script_keyword}'")
                                            return hook_text
                            except:
                                pass
                            
                            # –°–ø–æ—Å–æ–± 2: –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π sibling —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ Script
                            try:
                                script_element = await script_locator.element_handle()
                                if script_element:
                                    # –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å —Ç–µ–∫—Å—Ç–æ–º "Hook" –∏–ª–∏ "Hooks"
                                    next_elements = await self.page.evaluate("""
                                        (scriptEl) => {
                                            let current = scriptEl;
                                            // –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å "Hook" –∏–ª–∏ "Hooks"
                                            for (let i = 0; i < 10; i++) {
                                                current = current.nextElementSibling;
                                                if (!current) break;
                                                const text = current.innerText || '';
                                                if (text.includes('Hook') || text.includes('Hooks') || 
                                                    text.includes('–•—É–∫') || text.includes('–•—É–∫–∏')) {
                                                    // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ "Hook" –∏–ª–∏ "Hooks"
                                                    const parts = text.split(/Hooks?\\s*:?\\s*|–•—É–∫–∏?\\s*:?\\s*/i);
                                                    if (parts.length > 1) {
                                                        let hookText = parts[1].trim();
                                                        // –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏
                                                        const stopWords = ['Target Audience', 'First seen', 'Impressions', 'Country'];
                                                        for (const stop of stopWords) {
                                                            if (hookText.includes(stop)) {
                                                                hookText = hookText.split(stop)[0];
                                                            }
                                                        }
                                                        hookText = hookText.replace(/Quality\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/Size\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/Resolution\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/--/g, '');
                                                        hookText = hookText.replace(/\\n{2,}/g, '\\n').trim();
                                                        if (hookText && hookText.length > 5 && hookText.length < 500) {
                                                            return hookText;
                                                        }
                                                    }
                                                }
                                            }
                                            return null;
                                        }
                                    """, script_element)
                                    
                                    if next_elements:
                                        log.debug(f"Hook –Ω–∞–π–¥–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–º —ç–ª–µ–º–µ–Ω—Ç–µ –ø–æ—Å–ª–µ Script")
                                        return next_elements
                            except:
                                pass
                            
                            # –°–ø–æ—Å–æ–± 3: –ò—â–µ–º Hook –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –ø–æ—Å–ª–µ Script
                            try:
                                # –ü–æ–ª—É—á–∞–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –∏—â–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω "Script...Hook"
                                page_text = await self.page.content()
                                # –ò—â–µ–º —á–µ—Ä–µ–∑ JavaScript –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ
                                hook_text = await self.page.evaluate("""
                                    () => {
                                        // –ò—â–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Script"
                                        const allElements = Array.from(document.querySelectorAll('*'));
                                        for (const el of allElements) {
                                            const text = el.innerText || '';
                                            if (text.includes('Script') || text.includes('–°—Ü–µ–Ω–∞—Ä–∏–π')) {
                                                // –ò—â–µ–º –≤ —ç—Ç–æ–º –∂–µ —ç–ª–µ–º–µ–Ω—Ç–µ –∏–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º "Hook" –∏–ª–∏ "Hooks"
                                                let searchEl = el;
                                                for (let depth = 0; depth < 3; depth++) {
                                                    const searchText = searchEl.innerText || '';
                                                    if (searchText.includes('Hook') || searchText.includes('Hooks') || 
                                                        searchText.includes('–•—É–∫') || searchText.includes('–•—É–∫–∏')) {
                                                        // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –º–µ–∂–¥—É Script –∏ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Å–µ–∫—Ü–∏—è–º–∏
                                                        const scriptIndex = searchText.indexOf('Script');
                                                        const hookIndex = searchText.indexOf('Hook', scriptIndex);
                                                        if (hookIndex > scriptIndex) {
                                                            let hookText = searchText.substring(hookIndex);
                                                            // –£–±–∏—Ä–∞–µ–º "Hook" –∏–ª–∏ "Hooks" –∏–∑ –Ω–∞—á–∞–ª–∞
                                                            hookText = hookText.replace(/^Hooks?\\s*:?\\s*/i, '');
                                                            hookText = hookText.replace(/^–•—É–∫–∏?\\s*:?\\s*/i, '');
                                                            // –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏
                                                            const stopWords = ['Target Audience', 'First seen', 'Impressions', 'Country'];
                                                            for (const stop of stopWords) {
                                                                if (hookText.includes(stop)) {
                                                                    hookText = hookText.split(stop)[0];
                                                                }
                                                            }
                                                            hookText = hookText.replace(/Quality\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/Size\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/Resolution\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/--/g, '');
                                                            hookText = hookText.replace(/\\n{2,}/g, '\\n').trim();
                                                            if (hookText && hookText.length > 5 && hookText.length < 500) {
                                                                return hookText;
                                                            }
                                                        }
                                                    }
                                                    searchEl = searchEl.parentElement;
                                                    if (!searchEl) break;
                                                }
                                            }
                                        }
                                        return null;
                                    }
                                """)
                                
                                if hook_text:
                                    log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ—Å–ª–µ Script")
                                    return hook_text
                            except:
                                pass
                    except:
                        continue
            except:
                pass
            
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (—Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±, –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ fallback)
            hook_keywords = ["Hooks", "Hook", "–•—É–∫–∏", "–•—É–∫"]
            
            for keyword in hook_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            parent_text = await locator.locator("..").inner_text()
                            if keyword in parent_text:
                                parts = parent_text.split(keyword, 1)
                                if len(parts) > 1:
                                    hook = parts[1].strip()
                                    # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –º–µ—Ç–∫–∏
                                    stop_words = ["Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", 
                                                "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞", "Impressions", "–ü–æ–∫–∞–∑—ã",
                                                "Limited Time Offer", "Annual Plan", "Promotion Period", "50% OFF",
                                                "Privacy", "Terms", "Copyright", "PIPIADS", "All Rights Reserved",
                                                "AI-agent", "cosmobeauty", "credits", "subscription", "invoice",
                                                "Monthly Credits", "Extra Credits", "data cost", "detail costs",
                                                "Team Setting", "Affiliate Dashboard", "Logout"]
                                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                           "cosmobeauty", "credits", "subscription", "invoice", 
                                                           "Monthly Credits", "Extra Credits", "@gmail.com"]
                                    is_footer_menu = any(keyword in hook for keyword in footer_menu_keywords)
                                    
                                    for stop_word in stop_words:
                                        if stop_word in hook:
                                            hook = hook.split(stop_word)[0].strip()
                                    
                                    # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                    metadata_patterns = [
                                        r'Quality\s*:?\s*[^\n]*',
                                        r'Size\s*:?\s*[^\n]*',
                                        r'Resolution\s*:?\s*[^\n]*',
                                        r'Width\s*:?\s*[^\n]*',
                                        r'Height\s*:?\s*[^\n]*',
                                        r'Duration\s*:?\s*[^\n]*',
                                        r'Format\s*:?\s*[^\n]*',
                                        r'Codec\s*:?\s*[^\n]*',
                                        r'Frame Rate\s*:?\s*[^\n]*',
                                        r'--',  # –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                    ]
                                    for pattern in metadata_patterns:
                                        hook = re.sub(pattern, '', hook, flags=re.IGNORECASE)
                                    hook = re.sub(r'\n{2,}', '\n', hook).strip()  # –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                    
                                    if hook and len(hook) > 5 and not is_footer_menu:
                                        log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Ä–æ–¥–∏—Ç–µ–ª—å)")
                                        return hook
                        except:
                            pass
                        
                        # –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            next_sibling = await locator.evaluate_handle("el => el.nextElementSibling")
                            if next_sibling:
                                hook = await next_sibling.as_element().inner_text()
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                       "cosmobeauty", "credits", "subscription", "invoice", 
                                                       "Monthly Credits", "Extra Credits", "@gmail.com"]
                                is_footer_menu = any(keyword in hook for keyword in footer_menu_keywords)
                                
                                # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                metadata_patterns = [
                                    r'Quality\s*:?\s*[^\n]*',
                                    r'Size\s*:?\s*[^\n]*',
                                    r'Resolution\s*:?\s*[^\n]*',
                                    r'Width\s*:?\s*[^\n]*',
                                    r'Height\s*:?\s*[^\n]*',
                                    r'Duration\s*:?\s*[^\n]*',
                                    r'Format\s*:?\s*[^\n]*',
                                    r'Codec\s*:?\s*[^\n]*',
                                    r'Frame Rate\s*:?\s*[^\n]*',
                                    r'--',  # –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                ]
                                for pattern in metadata_patterns:
                                    hook = re.sub(pattern, '', hook, flags=re.IGNORECASE)
                                hook = re.sub(r'\n{2,}', '\n', hook).strip()  # –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                
                                if hook and len(hook) > 5 and not is_footer_menu:
                                    log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç)")
                                    return hook.strip()
                        except:
                            pass
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                hook = await self.page.evaluate("""
                    () => {
                        const keywords = ['Hooks', 'Hook', '–•—É–∫–∏', '–•—É–∫'];
                        const stopWords = ['Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 
                                         'Transcript', '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞', 'Impressions', '–ü–æ–∫–∞–∑—ã',
                                         'Script', '–°—Ü–µ–Ω–∞—Ä–∏–π', 'Analysis',
                                         'Limited Time Offer', 'Annual Plan', 'Promotion Period', '50% OFF'];
                        
                        // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    let hookText = null;
                                    
                                    // –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ sibling —ç–ª–µ–º–µ–Ω—Ç–∞
                                    let nextSibling = el.nextElementSibling;
                                    if (nextSibling) {
                                        hookText = nextSibling.innerText || '';
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    if (!hookText || hookText.length < 5) {
                                        const parentText = el.parentElement ? el.parentElement.innerText || '' : '';
                                        if (parentText.includes(keyword)) {
                                            const parts = parentText.split(keyword);
                                            if (parts.length > 1) {
                                                hookText = parts[1].trim();
                                            }
                                        }
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 3: –ò—â–µ–º –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö
                                    if (!hookText || hookText.length < 5) {
                                        const children = el.querySelectorAll('p, div, span');
                                        for (const child of children) {
                                            const childText = child.innerText || '';
                                            if (childText.length > 5 && childText.length < 200) {
                                                hookText = childText;
                                                break;
                                            }
                                        }
                                    }
                                    
                                    if (hookText) {
                                        // –£–±–∏—Ä–∞–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞
                                        for (const stopWord of stopWords) {
                                            if (hookText.includes(stopWord)) {
                                                hookText = hookText.split(stopWord)[0];
                                            }
                                        }
                                        
                                        hookText = hookText.trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π hook (–∫–æ—Ä–æ—Ç–∫–∞—è —Ñ—Ä–∞–∑–∞, –Ω–µ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç, –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é)
                                        const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                                   'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                                   'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                                   'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                                   'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                        const isFooterMenu = footerMenuKeywords.some(keyword => hookText.includes(keyword));
                                        
                                        // –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                        const metadataPatterns = [
                                            /Quality\s*:?\s*[^\n]*/gi,
                                            /Size\s*:?\s*[^\n]*/gi,
                                            /Resolution\s*:?\s*[^\n]*/gi,
                                            /Width\s*:?\s*[^\n]*/gi,
                                            /Height\s*:?\s*[^\n]*/gi,
                                            /Duration\s*:?\s*[^\n]*/gi,
                                            /Format\s*:?\s*[^\n]*/gi,
                                            /Codec\s*:?\s*[^\n]*/gi,
                                            /Frame Rate\s*:?\s*[^\n]*/gi,
                                            /--/g,  // –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                        ];
                                        let cleanedHook = hookText;
                                        for (const pattern of metadataPatterns) {
                                            cleanedHook = cleanedHook.replace(pattern, '');
                                        }
                                        cleanedHook = cleanedHook.replace(/\n{2,}/g, '\n').trim();  // –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                        
                                        if (cleanedHook && cleanedHook.length > 5 && cleanedHook.length < 300 &&
                                            !cleanedHook.includes('Limited Time Offer') &&
                                            !cleanedHook.includes('Annual Plan') &&
                                            !cleanedHook.includes('Promotion Period') &&
                                            !cleanedHook.includes('50% OFF') &&
                                            !cleanedHook.toLowerCase().includes('q4') &&
                                            !cleanedHook.toLowerCase().includes('monthly plan') &&
                                            !isFooterMenu) {
                                            return cleanedHook;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if hook and len(hook) > 5:
                    log.debug("Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript")
                    return hook.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ hook —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ hook: {e}")
            return None
    
    async def _extract_audience(self) -> Optional[Dict[str, str]]:
        """
        –ò–∑–≤–ª–µ—á—å –≤–æ–∑—Ä–∞—Å—Ç –∏–∑ –ø–æ–ª—è Audience
        
        –°—Ç—Ä—É–∫—Ç—É—Ä–∞ HTML:
        <div class="addel-info-item">
            <div class="name"> Audience </div>
            <div class="value">
                <div class="audience-info">
                    <div class="audience-info-info">45-55 ... Android...</div>
                </div>
            </div>
        </div>
        """
        try:
            audience_data = {"age": "N/A", "platform": "N/A"}
            
            # –ú–ï–¢–û–î 1: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                # –ò—â–µ–º –±–ª–æ–∫ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "Audience"
                audience_items = await self.page.query_selector_all('div.addel-info-item')
                
                for item in audience_items:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å Audience
                    name_elem = await item.query_selector('div.name')
                    if name_elem:
                        name_text = await name_elem.inner_text()
                        if 'Audience' in name_text or '–ê—É–¥–∏—Ç–æ—Ä–∏—è' in name_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ audience-info-info
                            audience_info = await item.query_selector('div.audience-info-info')
                            if audience_info:
                                text = await audience_info.inner_text()
                                # –ò–∑–≤–ª–µ–∫–∞–µ–º –≤–æ–∑—Ä–∞—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ "45-55" (–º–æ–∂–µ—Ç –±—ã—Ç—å 2 —Ü–∏—Ñ—Ä—ã)
                                age_match = re.search(r'(\d{1,2}-\d{1,2})', text)
                                if age_match:
                                    audience_data["age"] = age_match.group(1)
                                    log.debug(f"      ‚Üí Audience age –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä: {audience_data['age']}")
                                    return audience_data
            except Exception as e:
                log.debug(f"      ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–º –ø–æ–∏—Å–∫–µ audience: {e}")
            
            # –ú–ï–¢–û–î 2: Fallback —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (–µ—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª)
            audience_keywords = ["Audience", "–ê—É–¥–∏—Ç–æ—Ä–∏—è", "Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è"]
            
            for keyword in audience_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç –∞—É–¥–∏—Ç–æ—Ä–∏–∏ —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º –≤–æ–∑—Ä–∞—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ "25-35" –∏–ª–∏ "45-55"
                        age_patterns = [
                            r'–í–æ–∑—Ä–∞—Å—Ç[:\s]+(\d{1,2}-\d{1,2})',
                            r'Age[:\s]+(\d{1,2}-\d{1,2})',
                            r'(\d{1,2}-\d{1,2})',  # –ü—Ä–æ—Å—Ç–æ –≤–æ–∑—Ä–∞—Å—Ç
                        ]
                        
                        for pattern in age_patterns:
                            age_match = re.search(pattern, text, re.IGNORECASE)
                            if age_match:
                                audience_data["age"] = age_match.group(1)
                                log.debug(f"      ‚Üí Audience age –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä: {audience_data['age']}")
                                break
                        
                        if audience_data["age"] != "N/A":
                            return audience_data
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π)
            try:
                result = await self.page.evaluate("""
                    () => {
                        const keywords = ['Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 'Audience', '–ê—É–¥–∏—Ç–æ—Ä–∏—è'];
                        const agePattern = /(\\d{1,2}-\\d{1,2})/;
                        const platformKeywords = ['Android', 'iOS', 'iPhone', 'iPad'];
                        const countryKeywords = ['USA', 'US', 'United States', '–†–æ—Å—Å–∏—è', 'Russia', 'Philippines', 
                                                '–§–∏–ª–∏–ø–ø–∏–Ω—ã', 'China', '–ö–∏—Ç–∞–π', 'India', '–ò–Ω–¥–∏—è'];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    const result = {age: 'N/A', platform: 'N/A', country: 'N/A'};
                                    
                                    // –ò—â–µ–º –≤–æ–∑—Ä–∞—Å—Ç
                                    const ageMatch = text.match(agePattern);
                                    if (ageMatch) {
                                        result.age = ageMatch[1];
                                    }
                                    
                                    // –ò—â–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
                                    for (const platform of platformKeywords) {
                                        if (text.includes(platform)) {
                                            result.platform = (platform === 'iOS' || platform === 'iPhone' || platform === 'iPad') ? 'iOS' : 'Android';
                                            break;
                                        }
                                    }
                                    
                                    // –ò—â–µ–º —Å—Ç—Ä–∞–Ω—É
                                    for (const country of countryKeywords) {
                                        if (text.includes(country)) {
                                            result.country = country;
                                            break;
                                        }
                                    }
                                    
                                    if (result.age !== 'N/A' || result.platform !== 'N/A' || result.country !== 'N/A') {
                                        return result;
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if result:
                    audience_data.update(result)
                    return audience_data
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ audience —á–µ—Ä–µ–∑ JS: {e}")
            
            return audience_data
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–∏: {e}")
            return None
    
    async def _extract_country(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å —Å—Ç—Ä–∞–Ω—É –∏–∑ –ø–æ–ª—è 'Country/Region' –∏–ª–∏ '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω' (–û–¢–î–ï–õ–¨–ù–û –æ—Ç Audience!)"""
        try:
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            try:
                await self.page.wait_for_selector('div.addel-info-item', timeout=5000, state="visible")
            except:
                log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç—ã div.addel-info-item –Ω–µ –ø–æ—è–≤–∏–ª–∏—Å—å –∑–∞ 5 —Å–µ–∫—É–Ω–¥")
            
            country_keywords = ["Country/Region", "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω", "Country", "–°—Ç—Ä–∞–Ω–∞", "Region", "–†–µ–≥–∏–æ–Ω"]
            
            # –ú–ï–¢–û–î 0: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                country_items = await self.page.query_selector_all('div.addel-info-item')
                
                for item in country_items:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å Country/Region
                    name_elem = await item.query_selector('div.name')
                    if name_elem:
                        name_text = await name_elem.inner_text()
                        if 'Country/Region' in name_text or '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω' in name_text or 'Country' in name_text or '–°—Ç—Ä–∞–Ω–∞' in name_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º —Å—Ç—Ä–∞–Ω—É
                            value_elem = await item.query_selector('div.ellipsis, div.value')
                            if value_elem:
                                country_text = await value_elem.inner_text()
                                # –£–±–∏—Ä–∞–µ–º (1) –∏ —Ç.–¥.
                                country = re.sub(r'\([0-9]+\)', '', country_text).strip()
                                if country and len(country) > 0:
                                    log.info(f"      ‚úÖ Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä: {country}")
                                    return country
            except Exception as e:
                log.debug(f"      ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–º –ø–æ–∏—Å–∫–µ country: {e}")
            
            for keyword in country_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω—ã —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º —Å—Ç—Ä–∞–Ω—É (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫)
                        country_patterns = [
                            r'United States(?:\([0-9]+\))?',  # United States(1)
                            r'USA(?:\([0-9]+\))?',
                            r'US(?:\([0-9]+\))?',
                            r'Philippines(?:\([0-9]+\))?',
                            r'–§–∏–ª–∏–ø–ø–∏–Ω—ã(?:\([0-9]+\))?',
                            r'Russia(?:\([0-9]+\))?',
                            r'–†–æ—Å—Å–∏—è(?:\([0-9]+\))?',
                            r'China(?:\([0-9]+\))?',
                            r'–ö–∏—Ç–∞–π(?:\([0-9]+\))?',
                            r'India(?:\([0-9]+\))?',
                            r'–ò–Ω–¥–∏—è(?:\([0-9]+\))?',
                            r'Brazil(?:\([0-9]+\))?',
                            r'–ë—Ä–∞–∑–∏–ª–∏—è(?:\([0-9]+\))?',
                            r'Germany(?:\([0-9]+\))?',
                            r'–ì–µ—Ä–º–∞–Ω–∏—è(?:\([0-9]+\))?',
                            r'France(?:\([0-9]+\))?',
                            r'–§—Ä–∞–Ω—Ü–∏—è(?:\([0-9]+\))?',
                            r'UK(?:\([0-9]+\))?',
                            r'United Kingdom(?:\([0-9]+\))?',
                        ]
                        
                        for pattern in country_patterns:
                            match = re.search(pattern, text, re.IGNORECASE)
                            if match:
                                country = match.group(0)
                                # –£–±–∏—Ä–∞–µ–º (1) –∏ —Ç.–¥.
                                country = re.sub(r'\([0-9]+\)', '', country).strip()
                                log.debug(f"Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}': {country}")
                                return country
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript
            try:
                country = await self.page.evaluate("""
                    () => {
                        const keywords = ['Country/Region', '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω', 'Country', '–°—Ç—Ä–∞–Ω–∞'];
                        const countryPatterns = [
                            /United States(?:\\([0-9]+\\))?/i,
                            /USA(?:\\([0-9]+\\))?/i,
                            /Philippines(?:\\([0-9]+\\))?/i,
                            /Russia(?:\\([0-9]+\\))?/i,
                            /China(?:\\([0-9]+\\))?/i,
                            /India(?:\\([0-9]+\\))?/i
                        ];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    for (const pattern of countryPatterns) {
                                        const match = text.match(pattern);
                                        if (match) {
                                            return match[0].replace(/\\([0-9]+\\)/g, '').trim();
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if country:
                    log.debug(f"Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript: {country}")
                    return country.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ country —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ country: {e}")
            return None
    
    async def _extract_first_seen(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å First seen –≤ —Ñ–æ—Ä–º–∞—Ç–µ 'Oct 27 2025' - —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ 'Oct 28 2025 ~ Nov 10 2025'"""
        try:
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã
            first_seen_keywords = ["First seen - Last seen", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", "First Seen"]
            
            for keyword in first_seen_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç –¥–∞—Ç—ã —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ "Oct 27 2025" –∏–ª–∏ "Oct 27, 2025"
                        # –ò—â–µ–º –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ "Oct 28 2025 ~ Nov 10 2025"
                        date_patterns = [
                            r'([A-Z][a-z]{2}\s+\d{1,2}\s+\d{4})',  # Oct 27 2025
                            r'([A-Z][a-z]{2}\s+\d{1,2},\s+\d{4})',  # Oct 27, 2025
                            r'(\d{1,2}\s+[A-Z][a-z]{2}\s+\d{4})',  # 27 Oct 2025
                        ]
                        
                        for pattern in date_patterns:
                            # –ò—â–µ–º –ø–µ—Ä–≤—É—é –¥–∞—Ç—É (–¥–æ ~ –∏–ª–∏ –∫–æ–Ω—Ü–∞ —Å—Ç—Ä–æ–∫–∏)
                            date_match = re.search(pattern, text)
                            if date_match:
                                date_str = date_match.group(1)
                                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ñ–æ—Ä–º–∞—Ç (—É–±–∏—Ä–∞–µ–º –∑–∞–ø—è—Ç—É—é –µ—Å–ª–∏ –µ—Å—Ç—å)
                                date_str = date_str.replace(',', '').strip()
                                log.debug(f"First seen –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}': {date_str}")
                                return date_str
                        
                        # –¢–∞–∫–∂–µ –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –¥–∞—Ç—É –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
                        if keyword in text:
                            parts = text.split(keyword, 1)
                            if len(parts) > 1:
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–æ ~ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω)
                                after_keyword = parts[1].split('~')[0].strip()
                                for pattern in date_patterns:
                                    date_match = re.search(pattern, after_keyword)
                                    if date_match:
                                        date_str = date_match.group(1).replace(',', '').strip()
                                        log.debug(f"First seen –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ '{keyword}': {date_str}")
                                        return date_str
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                first_seen = await self.page.evaluate("""
                    () => {
                        const keywords = ['First seen - Last seen', 'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 'First Seen'];
                        const datePatterns = [
                            /([A-Z][a-z]{2}\\s+\\d{1,2}\\s+\\d{4})/,  // Oct 27 2025
                            /([A-Z][a-z]{2}\\s+\\d{1,2},\\s+\\d{4})/,  // Oct 27, 2025
                            /(\\d{1,2}\\s+[A-Z][a-z]{2}\\s+\\d{4})/   // 27 Oct 2025
                        ];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    // –ò—â–µ–º –¥–∞—Ç—É –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    const index = text.indexOf(keyword);
                                    let afterKeyword = text.substring(index + keyword.length);
                                    
                                    // –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–æ ~ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω)
                                    if (afterKeyword.includes('~')) {
                                        afterKeyword = afterKeyword.split('~')[0];
                                    }
                                    
                                    for (const pattern of datePatterns) {
                                        const match = afterKeyword.match(pattern);
                                        if (match) {
                                            const dateStr = match[1].replace(',', '').trim();
                                            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤—É—é –Ω–∞–π–¥–µ–Ω–Ω—É—é –¥–∞—Ç—É (–±–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫ - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç –≤ _filter_videos)
                                            return dateStr;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if first_seen:
                    log.debug(f"First seen –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript: {first_seen}")
                    return first_seen.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ first_seen —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ first_seen: {e}")
            return None


```

–ü—Ä–æ–≤–µ—Ä—è—é –æ—à–∏–±–∫–∏ –∏ –æ–±–Ω–æ–≤–ª—è—é TODO:


–ò—Å–ø—Ä–∞–≤–∏–ª –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é —Ç–æ–≤–∞—Ä–æ–≤. –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤

1. –£–ø—Ä–æ—Å—Ç–∏–ª –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é: –≤–º–µ—Å—Ç–æ `product_id` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π URL
2. –î–æ–±–∞–≤–∏–ª —Ñ—É–Ω–∫—Ü–∏—é `normalize_url()` –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–π –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ URL
3. –û–±–Ω–æ–≤–∏–ª `banned_products` ‚Äî —Ç–µ–ø–µ—Ä—å —ç—Ç–æ `set()` —Å URL –≤–º–µ—Å—Ç–æ `product_id`
4. –£–±—Ä–∞–ª –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ ‚Äî –æ–¥–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ ban-list –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
5. –û–±–Ω–æ–≤–∏–ª `parser_engine.py` ‚Äî –º–µ—Ç–æ–¥ `get_product_details_with_return()` —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `banned_products` (URL)

## –ß—Ç–æ –Ω—É–∂–Ω–æ –æ—Ç —Ç–µ–±—è

### 1. HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search (–∫—Ä–∏—Ç–∏—á–Ω–æ)
- –û—Ç–∫—Ä–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—É ad-search –æ–¥–Ω–æ–≥–æ –∏–∑ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –°–æ—Ö—Ä–∞–Ω–∏ –ø–æ–ª–Ω—ã–π HTML:
  - –í–∞—Ä–∏–∞–Ω—Ç 1: Ctrl+S (–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–∞–∫ HTML)
  - –í–∞—Ä–∏–∞–Ω—Ç 2: DevTools (F12) ‚Üí Elements ‚Üí –ø—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ `<html>` ‚Üí Copy ‚Üí Copy outer HTML
- –ü—Ä–∏—à–ª–∏ —Ñ–∞–π–ª –∏–ª–∏ –≤—Å—Ç–∞–≤—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ

–≠—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã `li#ai-script`, `li#ai-hook`
- –ü–æ–Ω—è—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è Script/Hook/Country

### 2. –ü—Ä–∏–º–µ—Ä—ã –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –ù–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –∏–∑ Google Sheets, –≥–¥–µ –≤–∏–¥–Ω–æ –¥—É–±–ª–∏–∫–∞—Ç—ã
- –ò–ª–∏ –ª–æ–≥–∏, –≥–¥–µ –≤–∏–¥–Ω–æ, —á—Ç–æ –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑

### 3. –õ–æ–≥–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –§–∞–π–ª –∏–∑ `logs/` —Å –æ—à–∏–±–∫–∞–º–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è Script/Hook/Country

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è HTML:
1. –ò—Å–ø—Ä–∞–≤–ª—é –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ Script/Hook/Country
2. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É—é —Å–∫–æ—Ä–æ—Å—Ç—å (—É–±—Ä–∞—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è)
3. –û—Å—Ç–∞–≤–ª—é –Ω–∏–∑–∫–∏–µ –ø–æ—Ä–æ–≥–∏ –¥–ª—è MVP

–ú–æ–∂–µ—à—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏–ª–∏ —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–∏—Å–ª–∞—Ç—å HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search?

---

**User**

1. –≤–æ—Ç —Å–æ–∑–¥–∞–ª —Ñ–∞–π–ª —Å HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search - example_adsearch_page.html

2. logs\summaries\iteration_2025-11-14_18-52-49.md –≤–æ—Ç —Ç—É—Ç –≤–∏–¥–Ω–æ –¥—É–±–ª–∏–∫–∞—Ç—ã –∏ –≤ —Ç–æ–≤–∞—Ä–∞—Ö –∏ –≤ –≤–∏–¥–µ–æ

3. logs\summaries\iteration_2025-11-14_18-52-49.md –∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã —Ç–∞–º –≥–¥–µ –≤–æ–æ–±—â–µ –≤ –≤–∏–¥–µ–æ –Ω–µ –∑–∞—Ö–æ–¥–∏–ª–æ - https://docs.google.com/spreadsheets/d/1VJMixODvnIPBf7EjFoJ8XMH1lepycVlXREKQI7MVxWQ/edit?gid=143310243#gid=143310243&range=57:57  –∏ —Å—Ç–∞—Ä—É—é –ø–æ–ø—ã—Ç–∫—É —Å –∑–∞—Ö–æ–¥–æ–º –≤ ad-search —Å—Ç—Ä–∞–Ω–∏—Ü—É https://docs.google.com/spreadsheets/d/1VJMixODvnIPBf7EjFoJ8XMH1lepycVlXREKQI7MVxWQ/edit?gid=143310243#gid=143310243&range=46:46 

---

**Cursor**

–ò–∑—É—á–∞—é HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search –∏ –ª–æ–≥–∏, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã.


–í–∏–∂—É –ø—Ä–æ–±–ª–µ–º—ã:
1. –î—É–±–ª–∏–∫–∞—Ç—ã —Ç–æ–≤–∞—Ä–æ–≤: —Ç–æ–≤–∞—Ä `1730994090387212243` –æ–±—Ä–∞–±–æ—Ç–∞–Ω 3 —Ä–∞–∑–∞ (—Ç–æ–≤–∞—Ä—ã #7, #8, #9).
2. –î—É–±–ª–∏–∫–∞—Ç—ã –≤–∏–¥–µ–æ: –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –≤–∏–¥–µ–æ `830e981c72e63bf0a587` –ø–æ—è–≤–ª—è–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã.
3. –í HTML –Ω–µ –Ω–∞–π–¥–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç—ã `ai-script`, `ai-hook` ‚Äî –Ω—É–∂–Ω–æ –∏—Å–∫–∞—Ç—å –ø–æ-–¥—Ä—É–≥–æ–º—É.

–ò—â—É –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –≤ HTML:


–ò—â—É —Ä–µ–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤ HTML –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM:


–°–µ–ª–µ–∫—Ç–æ—Ä—ã –≤–µ—Ä–Ω—ã–µ, –Ω–æ —ç–ª–µ–º–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏. –ò—Å–ø—Ä–∞–≤–ª—è—é:

1. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ ‚Äî –ø—Ä–æ–≤–µ—Ä—è—é, –ø–æ—á–µ–º—É –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è 3 —Ä–∞–∑–∞
2. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –≤–∏–¥–µ–æ ‚Äî –æ–¥–Ω–æ –≤–∏–¥–µ–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã
3. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Script/Hook/Country ‚Äî —ç–ª–µ–º–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ


–ò—Å–ø—Ä–∞–≤–ª—è—é –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –≤–∏–¥–µ–æ –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ Script/Hook/Country. –ü—Ä–æ–≤–µ—Ä—è—é, –ø–æ—á–µ–º—É —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è 3 —Ä–∞–∑–∞:


–ò—Å–ø—Ä–∞–≤–ª—è—é –ø—Ä–æ–±–ª–µ–º—ã –ø–æ –ø–æ—Ä—è–¥–∫—É. –ù–∞—á–∏–Ω–∞—é —Å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –≤–∏–¥–µ–æ –∏ —É–ª—É—á—à–µ–Ω–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è Script/Hook/Country:


```python
"""
Parser Engine - –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö —Å Pipiads
"""

import asyncio
import re
import time
from typing import List, Dict, Optional, Any
from datetime import datetime

from playwright.async_api import Page, TimeoutError as PlaywrightTimeoutError

from . import config
from . import logger
from . import validator

log = logger.get_logger("ParserEngine")


class ProductData:
    """–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞"""
    def __init__(self):
        self.product_name: str = ""
        self.category: str = ""
        self.pipiads_link: str = ""
        self.videos: List[Dict[str, Any]] = []


class ParserEngine:
    """–ü–∞—Ä—Å–µ—Ä –¥–∞–Ω–Ω—ã—Ö —Å Pipiads"""
    
    def __init__(self, page: Page):
        self.page = page
        self.browser_manager = None  # –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ human_delay
    
    def set_browser_manager(self, browser_manager):
        """–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ browser_manager –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è human_delay"""
        self.browser_manager = browser_manager
    
    async def human_delay(self, min_seconds: float = 1, max_seconds: float = 3):
        """–ò–º–∏—Ç–∞—Ü–∏—è —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏"""
        if self.browser_manager:
            await self.browser_manager.human_delay(min_seconds, max_seconds)
        else:
            delay = asyncio.sleep(1)  # Fallback
            await delay
    
    async def scroll_to_element(self, selector: str, timeout: int = 10000):
        """
        –°–∫—Ä–æ–ª–ª–∏—Ç—å –¥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
        
        Args:
            selector: –°–µ–ª–µ–∫—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞
            timeout: –¢–∞–π–º–∞—É—Ç –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
        """
        try:
            element = await self.page.wait_for_selector(selector, timeout=timeout, state="visible")
            if element:
                await element.scroll_into_view_if_needed()
                await self.human_delay(0.5, 1)
                return True
        except:
            pass
        return False
    
    async def get_products_from_search_page(self, count: int = 3) -> List[Dict[str, str]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞
        
        Args:
            count: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ (–¥–ª—è MVP-0: 1, –ø–æ—Ç–æ–º —Ä–∞—Å—à–∏—Ä–∏–º –¥–æ 3)
        
        Returns:
            –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–æ–≤: [{"name": "...", "category": "...", "url": "..."}]
        """
        log.info(f"–ü–æ–ª—É—á–µ–Ω–∏–µ {count} —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞...")
        
        try:
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (domcontentloaded –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º networkidle)
            await self.page.wait_for_load_state("domcontentloaded")
            await self.human_delay(2, 3)
            
            # –°–∫—Ä–æ–ª–ª–∏–º –≤–Ω–∏–∑, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
            log.info("–°–∫—Ä–æ–ª–ª–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤...")
            for i in range(3):  # –°–∫—Ä–æ–ª–ª–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
                await self.page.evaluate("window.scrollBy(0, 500)")
                await self.human_delay(1, 2)
            
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤
            await self.human_delay(2, 3)
            
            # –ò—â–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ - –ø—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
            product_selectors = [
                'a[href*="/tiktok-shop-product/"]',
                '[class*="product"]',
                '[class*="card"]',
                'div[class*="item"]',
            ]
            
            products = []
            product_ids = set()  # –î–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ product_id
            
            def extract_product_id(url: str) -> str:
                """–ò–∑–≤–ª–µ—á—å product_id –∏–∑ URL"""
                # https://www.pipiads.com/tiktok-shop-product/1729732622305364547/
                # ‚Üí 1729732622305364547
                url_normalized = url.rstrip('/')
                parts = url_normalized.split('/')
                return parts[-1] if parts else ""
            
            for selector in product_selectors:
                try:
                    elements = await self.page.query_selector_all(selector)
                    log.info(f"üîç –ù–∞–π–¥–µ–Ω–æ {len(elements)} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º '{selector}'")
                    
                    for element in elements:
                        if len(products) >= count:
                            break
                        
                        try:
                            # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É
                            href = await element.get_attribute("href")
                            if not href:
                                # –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ —Å—Å—ã–ª–∫–∞, –∏—â–µ–º —Å—Å—ã–ª–∫—É –≤–Ω—É—Ç—Ä–∏
                                link_element = await element.query_selector('a[href*="/tiktok-shop-product/"]')
                                if link_element:
                                    href = await link_element.get_attribute("href")
                            
                            if href and "/tiktok-shop-product/" in href:
                                # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π URL
                                if href.startswith("/"):
                                    url = f"https://www.pipiads.com{href}"
                                elif href.startswith("http"):
                                    url = href
                                else:
                                    url = f"https://www.pipiads.com/{href}"
                                
                                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º URL (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ)
                                url = url.rstrip('/')
                                
                                # –ò–∑–≤–ª–µ–∫–∞–µ–º product_id –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
                                product_id = extract_product_id(url)
                                
                                if not product_id:
                                    log.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å product_id –∏–∑ URL: {url}")
                                    continue
                                
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä (–ø–æ product_id)
                                if product_id in product_ids:
                                    log.info(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id={product_id}): {url}")
                                    continue
                                
                                product_ids.add(product_id)
                                log.info(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #{len(products) + 1}: product_id={product_id}, url={url}")
                                
                                # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
                                name = ""
                                name_selectors = [
                                    'h1', 'h2', 'h3',
                                    '[class*="title"]',
                                    '[class*="name"]',
                                    'a',
                                ]
                                
                                for name_sel in name_selectors:
                                    try:
                                        name_elem = await element.query_selector(name_sel)
                                        if name_elem:
                                            name = await name_elem.inner_text()
                                            if name and len(name) > 5:  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏—è
                                                break
                                    except:
                                        continue
                                
                                # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                                category = ""
                                category_selectors = [
                                    '[class*="category"]',
                                    '[class*="tag"]',
                                    'span',
                                ]
                                
                                for cat_sel in category_selectors:
                                    try:
                                        cat_elem = await element.query_selector(cat_sel)
                                        if cat_elem:
                                            text = await cat_elem.inner_text()
                                            if text and len(text) < 50:  # –ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±—ã—á–Ω–æ –∫–æ—Ä–æ—Ç–∫–∞—è
                                                category = text
                                                break
                                    except:
                                        continue
                                
                                if url and product_id:
                                    products.append({
                                        "name": name.strip() if name else "N/A",
                                        "category": category.strip() if category else "N/A",
                                        "url": url,
                                        "product_id": product_id  # –î–æ–±–∞–≤–ª—è–µ–º product_id –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
                                    })
                                    log.info(f"   üì¶ –¢–æ–≤–∞—Ä {len(products)}: {name[:50] if name else 'N/A'}... (ID: {product_id})")
                                
                        except Exception as e:
                            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —ç–ª–µ–º–µ–Ω—Ç–∞: {e}")
                            continue
                    
                    if len(products) >= count:
                        break
                        
                except Exception as e:
                    log.debug(f"–û—à–∏–±–∫–∞ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º {selector}: {e}")
                    continue
            
            if len(products) < count:
                log.warning(f"–ù–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ {count} –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã—Ö")
            
            log.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤")
            return products[:count]
            
        except Exception as e:
            log.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
            import traceback
            log.error(traceback.format_exc())
            return []
    
    async def get_product_details(self, product_url: str, sheets_writer=None) -> ProductData:
        """
        –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞ –∏ –≤–∏–¥–µ–æ
        
        Args:
            product_url: URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞
        
        Returns:
            ProductData —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞ –∏ –≤–∏–¥–µ–æ
        """
        log.info("=" * 80)
        log.info(f"üîÑ –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–ê")
        log.info(f"URL: {product_url}")
        log.info("=" * 80)
        
        product_data = ProductData()
        product_data.pipiads_link = product_url
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è page
        if not self.page:
            log.error("‚ùå –û–®–ò–ë–ö–ê: page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
            return product_data
        
        try:
            # –®–ê–ì 1: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞
            log.info("\nüìå –®–ê–ì 1: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞...")
            try:
                log.info(f"  ‚Üí –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {product_url}")
                if not self.page:
                    raise Exception("Page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
                await self.page.goto(product_url, wait_until="domcontentloaded", timeout=30000)
                log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            except Exception as e:
                log.error(f"  ‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {e}")
                log.error(f"  ‚Üí –¢–∏–ø –æ—à–∏–±–∫–∏: {type(e).__name__}")
                import traceback
                log.error(f"  ‚Üí –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:\n{traceback.format_exc()}")
                # –ü—Ä–æ–±—É–µ–º –ø–æ–¥–æ–∂–¥–∞—Ç—å –µ—â–µ –Ω–µ–º–Ω–æ–≥–æ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                try:
                    await self.human_delay(2, 3)
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Å–µ –µ—â–µ –¥–æ—Å—Ç—É–ø–Ω–∞
                    if self.page:
                        current_url = self.page.url
                        log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
                except Exception as e2:
                    log.error(f"  ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e2}")
                    return product_data
            
            try:
                await self.human_delay(0.5, 1)
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–¥–µ—Ä–∂–∫–µ: {e}")
            
            # –®–ê–ì 1.5: –ü–µ—Ä–µ–≤–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫
            log.info("\nüìå –®–ê–ì 1.5: –ü–µ—Ä–µ–≤–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫...")
            try:
                current_url = self.page.url
                log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
                
                # –ï—Å–ª–∏ URL —Å–æ–¥–µ—Ä–∂–∏—Ç /ru/, –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ /en/
                if "/ru/" in current_url:
                    english_url = current_url.replace("/ru/", "/en/")
                    log.info(f"  ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫—É—é –≤–µ—Ä—Å–∏—é: {english_url}")
                    await self.page.goto(english_url, wait_until="domcontentloaded", timeout=30000)
                    await self.human_delay(1, 2)
                    log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π")
                else:
                    # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞
                    log.info("  ‚Üí –ü–æ–∏—Å–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —è–∑—ã–∫–∞...")
                    lang_selectors = [
                        'a[href*="/en/"]',
                        'button:has-text("English")',
                        '[class*="language"]',
                        '[class*="lang"]',
                        'select[name*="lang"]',
                    ]
                    
                    lang_found = False
                    for selector in lang_selectors:
                        try:
                            lang_element = await self.page.query_selector(selector)
                            if lang_element:
                                is_visible = await lang_element.is_visible()
                                if is_visible:
                                    await lang_element.click()
                                    await self.human_delay(1, 2)
                                    log.info(f"  ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ –Ω–∞–π–¥–µ–Ω –∏ –Ω–∞–∂–∞—Ç: {selector}")
                                    lang_found = True
                                    break
                        except:
                            continue
                    
                    if not lang_found:
                        log.warning("  ‚ö†Ô∏è –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –Ω–∞ —Ç–µ–∫—É—â–µ–º —è–∑—ã–∫–µ")
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            # –®–ê–ì 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Product Name
            log.info("\nüìå –®–ê–ì 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Product Name...")
            try:
                # –°–∫—Ä–æ–ª–ª–∏–º –≤–≤–µ—Ä—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
                log.info("  ‚Üí –°–∫—Ä–æ–ª–ª–∏–º –≤–≤–µ—Ä—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞...")
                if not self.page:
                    raise Exception("Page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
                await self.page.evaluate("window.scrollTo(0, 0)")
                await self.human_delay(0.3, 0.5)
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ: {e}")
                # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É
            
            # –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ - –ø—Ä–æ–±—É–µ–º –±–æ–ª—å—à–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –∏ –º–µ—Ç–æ–¥–æ–≤
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã...")
            try:
                # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
                name_selectors = [
                    'h1:first-of-type',
                    'h1[class*="product"]',
                    'h1[class*="title"]',
                    '[class*="product-title"]',
                    '[class*="product-name"]',
                    '[class*="product_title"]',
                    '[class*="product_name"]',
                    'h1',
                    'h2:first-of-type',
                    '[data-testid*="title"]',
                    '[data-testid*="name"]',
                    '[data-testid*="product-title"]',
                ]
                
                for selector in name_selectors:
                    try:
                        elements = await self.page.query_selector_all(selector)
                        for element in elements:
                            name = await element.inner_text()
                            if name and len(name) > 3:
                                # –§–∏–ª—å—Ç—Ä—É–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã
                                name_lower = name.lower()
                                skip_words = ['–æ—Å—Ç–∞—Ç–æ–∫', 'remain', 'stock', '–º–µ—Å—è—Ü', 'month', '–∫–æ–º–∏—Å—Å–∏—è', 'commission', 
                                            'tiktok shop product detail', 'category', '–∫–∞—Ç–µ–≥–æ—Ä–∏—è']
                                if any(skip in name_lower for skip in skip_words):
                                    continue
                                # –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å "TikTok Shop Product Detail:" –µ—Å–ª–∏ –µ—Å—Ç—å
                                if "TikTok Shop Product Detail:" in name:
                                    name = name.split("TikTok Shop Product Detail:")[-1].strip()
                                # –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
                                if name.lower().startswith('tiktok shop product'):
                                    name = re.sub(r'^tiktok shop product\s*:?\s*', '', name, flags=re.IGNORECASE).strip()
                                if name.lower().endswith('tiktok shop product'):
                                    name = re.sub(r'\s*tiktok shop product\s*$', '', name, flags=re.IGNORECASE).strip()
                                # –£–±–∏—Ä–∞–µ–º, –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ "TikTok Shop Product"
                                if name.lower() == 'tiktok shop product' or name.lower() == 'tiktok shop product detail':
                                    continue
                                if ":" in name and len(name.split(":")[0]) < 20:
                                    name = name.split(":", 1)[-1].strip()
                                product_data.product_name = name.strip()
                                if len(product_data.product_name) > 5:
                                    log.info(f"  ‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞–π–¥–µ–Ω–æ: {product_data.product_name[:50]}...")
                                    break
                        if product_data.product_name and len(product_data.product_name) > 5:
                            break
                    except:
                        continue
                
                # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
                if not product_data.product_name or len(product_data.product_name) <= 5:
                    try:
                        product_name = await self.page.evaluate("""
                            () => {
                                // –ò—â–µ–º h1
                                const h1 = document.querySelector('h1');
                                if (h1) {
                                    const text = h1.innerText.trim();
                                    if (text && text.length > 5 && !text.toLowerCase().includes('tiktok shop product detail')) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º –≤ —ç–ª–µ–º–µ–Ω—Ç–∞—Ö —Å –∫–ª–∞—Å—Å–æ–º product
                                const productElements = document.querySelectorAll('[class*="product"][class*="title"], [class*="product"][class*="name"]');
                                for (const el of productElements) {
                                    const text = el.innerText.trim();
                                    if (text && text.length > 5) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º —Å–∞–º—ã–π –±–æ–ª—å—à–æ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–æ–±—ã—á–Ω–æ —ç—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞)
                                // –ù–û –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã —Ç–∏–ø–∞ "Ad Analysis"
                                const headings = document.querySelectorAll('h1, h2, h3');
                                let maxLength = 0;
                                let bestHeading = null;
                                for (const h of headings) {
                                    const text = h.innerText.trim();
                                    const skipWords = ['tiktok', 'shop', 'product', 'detail', 'category', 'commission', 
                                                      '–æ—Å—Ç–∞—Ç–æ–∫', 'remain', 'stock', 'ad analysis', 'analysis', 
                                                      'limited time', 'promotion', 'annual plan', 'tiktok shop product'];
                                    const textLower = text.toLowerCase();
                                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã (–º–µ–Ω—å—à–µ 20 —Å–∏–º–≤–æ–ª–æ–≤) - —ç—Ç–æ –æ–±—ã—á–Ω–æ –Ω–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
                                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º "TikTok Shop Product" –∏ –ø–æ—Ö–æ–∂–∏–µ —Ç–µ–∫—Å—Ç—ã
                                    if (!skipWords.some(word => textLower.includes(word)) && 
                                        text.length > maxLength && text.length > 20 &&
                                        !textLower.includes('tiktok shop product')) {
                                        maxLength = text.length;
                                        bestHeading = text;
                                    }
                                }
                                if (bestHeading) {
                                    return bestHeading;
                                }
                                
                                // –ò—â–µ–º –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–∞—Ö - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ–±—ã—á–Ω–æ –¥–ª–∏–Ω–Ω–æ–µ
                                // –ù–∞–ø—Ä–∏–º–µ—Ä: "[BUY 1 TAKE 11] SHEEureka Scrub Facial Cleanser..."
                                // –ù–û –∏—Å–∫–ª—é—á–∞–µ–º —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                           'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                           'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                           'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                           'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                const textBlocks = document.querySelectorAll('p, div, span');
                                for (const block of textBlocks) {
                                    const text = block.innerText.trim();
                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    const isFooterMenu = footerMenuKeywords.some(keyword => text.includes(keyword));
                                    if (isFooterMenu) continue;
                                    
                                    // –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ–±—ã—á–Ω–æ –¥–ª–∏–Ω–Ω–æ–µ (–±–æ–ª—å—à–µ 30 —Å–∏–º–≤–æ–ª–æ–≤) –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–æ–≤–∞ —Ç–∏–ø–∞ "Set", "Kit", "Mask" –∏ —Ç.–¥.
                                    // –ò–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å "[" (–Ω–∞–ø—Ä–∏–º–µ—Ä "[BUY 1 TAKE 11]")
                                    if (text.length > 30 && text.length < 500 && 
                                        !text.toLowerCase().includes('ad analysis') &&
                                        !text.toLowerCase().includes('limited time') &&
                                        !text.toLowerCase().includes('promotion') &&
                                        !text.toLowerCase().includes('annual plan') &&
                                        (text.startsWith('[') || text.includes('Set') || text.includes('Kit') || 
                                         text.includes('Mask') || text.includes('Cleanser') || text.includes('Gift') ||
                                         text.includes('Scrub') || text.includes('Facial') || text.includes('Repairing'))) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º –≤ –º–µ—Ç–∞-—Ç–µ–≥–∞—Ö
                                const ogTitle = document.querySelector('meta[property="og:title"]');
                                if (ogTitle && ogTitle.content) {
                                    let title = ogTitle.content;
                                    if (title.includes('TikTok Shop Product Detail:')) {
                                        title = title.split('TikTok Shop Product Detail:')[1].trim();
                                    }
                                    // –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞
                                    if (title.toLowerCase().startsWith('tiktok shop product')) {
                                        title = title.replace(/^tiktok shop product\s*:?\s*/i, '').trim();
                                    }
                                    if (title && title.length > 5 && !title.toLowerCase().includes('tiktok shop product')) {
                                        return title;
                                    }
                                }
                                
                                return null;
                            }
                        """)
                        if product_name and len(product_name) > 5:
                            product_name = product_name.strip()
                            # –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
                            if product_name.lower().startswith('tiktok shop product'):
                                product_name = re.sub(r'^tiktok shop product\s*:?\s*', '', product_name, flags=re.IGNORECASE).strip()
                            if product_name.lower().endswith('tiktok shop product'):
                                product_name = re.sub(r'\s*tiktok shop product\s*$', '', product_name, flags=re.IGNORECASE).strip()
                            # –£–±–∏—Ä–∞–µ–º, –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ "TikTok Shop Product"
                            if product_name.lower() == 'tiktok shop product' or product_name.lower() == 'tiktok shop product detail':
                                product_name = None
                            if product_name and len(product_name) > 5:
                                product_data.product_name = product_name
                                log.info(f"  ‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞–π–¥–µ–Ω–æ (—á–µ—Ä–µ–∑ JS): {product_data.product_name[:50]}...")
                    except Exception as e:
                        log.debug(f"  ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —á–µ—Ä–µ–∑ JS: {e}")
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞: {e}")
            
            if not product_data.product_name or len(product_data.product_name) <= 5:
                log.warning("  ‚ö†Ô∏è –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                product_data.product_name = "N/A"
            
            # –®–ê–ì 3: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Category
            log.info("\nüìå –®–ê–ì 3: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Category...")
            try:
                log.info("  ‚Üí –ü–æ–∏—Å–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–∞...")
                
                # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
                category_selectors = [
                    '[class*="category"]',
                    '[class*="tag"]',
                    'span:has-text("Category")',
                    'span:has-text("–ö–∞—Ç–µ–≥–æ—Ä–∏—è")',
                    'text=/Category/i',
                    'text=/–ö–∞—Ç–µ–≥–æ—Ä–∏—è/i',
                    'div:has-text("Category")',
                    'div:has-text("–ö–∞—Ç–µ–≥–æ—Ä–∏—è")',
                ]
                
                for selector in category_selectors:
                    try:
                        elements = await self.page.query_selector_all(selector)
                        for element in elements:
                            category = await element.inner_text()
                            if category:
                                # –û—á–∏—â–∞–µ–º –æ—Ç –ª–∏—à–Ω–µ–≥–æ —Ç–µ–∫—Å—Ç–∞
                                category = re.sub(r'Category\s*:', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'–ö–∞—Ç–µ–≥–æ—Ä–∏—è\s*:', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'Commission\s*Rate\s*:.*', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'–ö–æ–º–∏—Å—Å–∏—è\s*:.*', '', category, flags=re.IGNORECASE)
                                # –£–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä "15.00%")
                                category = re.sub(r'\s*\d+\.?\d*\s*%', '', category)
                                # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ —Å–∏–º–≤–æ–ª—ã > –∏ –ø—Ä–æ–±–µ–ª—ã
                                category = re.sub(r'\s*>\s*', ' > ', category)
                                category = category.strip()
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é —á–∞—Å—Ç—å –¥–æ "Commission" –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É
                                if "Commission" in category or "–ö–æ–º–∏—Å—Å–∏—è" in category:
                                    category = category.split("Commission")[0].split("–ö–æ–º–∏—Å—Å–∏—è")[0].strip()
                                if len(category) > 100:
                                    category = category[:100]
                                if category and len(category) > 3:
                                    product_data.category = category
                                    log.info(f"  ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–∞: {product_data.category}")
                                    break
                        if product_data.category:
                            break
                    except:
                        continue
                
                # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π)
                if not product_data.category:
                    try:
                        category = await self.page.evaluate("""
                            () => {
                                // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Category" –∏–ª–∏ "–ö–∞—Ç–µ–≥–æ—Ä–∏—è"
                                const allElements = document.querySelectorAll('*');
                                for (const el of allElements) {
                                    const text = el.innerText || '';
                                    if (text.includes('Category') || text.includes('–ö–∞—Ç–µ–≥–æ—Ä–∏—è')) {
                                        // –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ—Å–ª–µ "Category:" –∏–ª–∏ "–ö–∞—Ç–µ–≥–æ—Ä–∏—è:"
                                        let categoryText = text;
                                        if (categoryText.includes('Category:')) {
                                            categoryText = categoryText.split('Category:')[1];
                                        } else if (categoryText.includes('–ö–∞—Ç–µ–≥–æ—Ä–∏—è:')) {
                                            categoryText = categoryText.split('–ö–∞—Ç–µ–≥–æ—Ä–∏—è:')[1];
                                        }
                                        
                                        // –£–±–∏—Ä–∞–µ–º "Commission Rate" –∏ –≤—Å–µ –ø–æ—Å–ª–µ
                                        if (categoryText.includes('Commission Rate') || categoryText.includes('–ö–æ–º–∏—Å—Å–∏—è')) {
                                            categoryText = categoryText.split('Commission Rate')[0].split('–ö–æ–º–∏—Å—Å–∏—è')[0];
                                        }
                                        
                                        // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä "15.00%")
                                        categoryText = categoryText.replace(/\s*\d+\.?\d*\s*%/g, '');
                                        
                                        categoryText = categoryText.trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é (—Å–æ–¥–µ—Ä–∂–∏—Ç ">" –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–æ–≤)
                                        if (categoryText && categoryText.length > 3 && 
                                            (categoryText.includes('>') || categoryText.split(' ').length >= 2)) {
                                            return categoryText.substring(0, 100);
                                        }
                                    }
                                }
                                return null;
                            }
                        """)
                        if category and len(category) > 3:
                            product_data.category = category.strip()
                            log.info(f"  ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–∞ (—á–µ—Ä–µ–∑ JS): {product_data.category}")
                    except Exception as e:
                        log.debug(f"  ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ JS: {e}")
                
                if not product_data.category:
                    log.warning("  ‚ö†Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ 'N/A'")
                    product_data.category = "N/A"
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {e}")
                product_data.category = "N/A"
            
            # –®–ê–ì 3.5: –ó–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets (–µ—Å–ª–∏ sheets_writer –ø–µ—Ä–µ–¥–∞–Ω)
            # –í–ê–ñ–ù–û: –ï—Å–ª–∏ —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ
            if sheets_writer:
                log.info("\nüìå –®–ê–ì 3.5: –ó–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets...")
                try:
                    row_number = sheets_writer.write_basic_product_data(
                        product_data.product_name,
                        product_data.category,
                        product_data.pipiads_link
                    )
                    if row_number > 0:
                        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ
                        product_data._sheets_row = row_number
                        log.info(f"  ‚úÖ –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {row_number})")
                    else:
                        # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–≤–æ–∑–º–æ–∂–Ω–æ, —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã),
                        # –Ω–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö
                        log.warning("  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–≤–æ–∑–º–æ–∂–Ω–æ, —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã)")
                        log.info("  ‚Üí –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö...")
                        row_number = sheets_writer.find_next_empty_row()
                        product_data._sheets_row = row_number
                        log.info(f"  ‚úÖ –ë—É–¥–µ–º –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫—É {row_number}")
                except Exception as e:
                    log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö: {e}")
                    # –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ
                    try:
                        row_number = sheets_writer.find_next_empty_row()
                        product_data._sheets_row = row_number
                        log.info(f"  ‚Üí –ë—É–¥–µ–º –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫—É {row_number}")
                    except:
                        pass
            
            # –®–ê–ì 4: –ü–æ–∏—Å–∫ –±–ª–æ–∫–∞ "TikTok Ads"
            log.info("\nüìå –®–ê–ì 4: –ü–æ–∏—Å–∫ –±–ª–æ–∫–∞ 'TikTok Ads'...")
            log.info("  ‚Üí –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–Ω–∏–∑ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞...")
            
            # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–Ω–∏–∑, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç
            # –ë–ª–æ–∫ "TikTok Ads" –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            try:
                log.info("  ‚Üí –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–Ω–∏–∑ (–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ)...")
                # –ü–æ–ª—É—á–∞–µ–º –≤—ã—Å–æ—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                page_height = await self.page.evaluate("document.body.scrollHeight")
                viewport_height = await self.page.evaluate("window.innerHeight")
                log.info(f"  ‚Üí –í—ã—Å–æ—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {page_height}px, –≤—ã—Å–æ—Ç–∞ viewport: {viewport_height}px")
                
                # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ (–∫–∞–∫ —á–µ–ª–æ–≤–µ–∫)
                scroll_steps = max(3, page_height // viewport_height)
                scroll_step = page_height // scroll_steps
                
                for step in range(scroll_steps):
                    scroll_position = scroll_step * (step + 1)
                    await self.page.evaluate(f"window.scrollTo(0, {scroll_position})")
                    await self.human_delay(0.3, 0.5)
                    log.debug(f"  ‚Üí –ü—Ä–æ–∫—Ä—É—Ç–∫–∞: {scroll_position}/{page_height}px")
                
                # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ —Å–∞–º–æ–≥–æ –Ω–∏–∑–∞
                await self.page.evaluate("window.scrollTo(0, document.body.scrollHeight)")
                await self.human_delay(1, 2)  # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–∫—Ä—É—á–µ–Ω–∞ –≤–Ω–∏–∑")
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            log.info("  ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (–∫–∞–∫ Ctrl+F)...")
            tiktok_ads_found = False
            tiktok_ads_element = None
            
            # –°–Ω–∞—á–∞–ª–∞ –∂–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            await self.human_delay(0.5, 1)
            
            # –í–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
            tiktok_ads_texts = [
                "TikTok Ads",  # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π
                "–†–µ–∫–ª–∞–º–∞ –¢–∏–∫–¢–æ–∫",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 1
                "–†–µ–∫–ª–∞–º–∞ TikTok",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 2
                "TikTok –†–µ–∫–ª–∞–º–∞",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 3
            ]
            
            # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –±–ª–æ–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä —Å —Ç–µ–∫—Å—Ç–æ–º (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±)
            log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ Playwright locator...")
            for text_variant in tiktok_ads_texts:
                try:
                    # –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Ç–µ–∫—Å—Ç (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ)
                    locator = self.page.locator(f'text=/{text_variant}/i').first
                    if await locator.count() > 0:
                        tiktok_ads_element = await locator.element_handle()
                        if tiktok_ads_element:
                            # –°–∫—Ä–æ–ª–ª–∏–º –∫ —ç–ª–µ–º–µ–Ω—Ç—É
                            await tiktok_ads_element.scroll_into_view_if_needed()
                            await self.human_delay(0.3, 0.5)
                            tiktok_ads_found = True
                            log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ Playwright locator")
                            break
                except Exception as e:
                    log.debug(f"–ü–æ–∏—Å–∫ '{text_variant}' —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä –Ω–µ —É–¥–∞–ª—Å—è: {e}")
                    continue
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ JavaScript –ø–æ–∏—Å–∫ (–∫–∞–∫ Ctrl+F)
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript TreeWalker...")
                for text_variant in tiktok_ads_texts:
                    try:
                        # –ò—Å–ø–æ–ª—å–∑—É–µ–º JavaScript –¥–ª—è –ø–æ–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å —Ç–µ–∫—Å—Ç–æ–º
                        # –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è regex
                        escaped_text = text_variant.replace("\\", "\\\\").replace("/", "\\/")
                        tiktok_ads_element = await self.page.evaluate_handle(f"""
                            () => {{
                                const walker = document.createTreeWalker(
                                    document.body,
                                    NodeFilter.SHOW_TEXT,
                                    null,
                                    false
                                );
                                
                                let node;
                                while (node = walker.nextNode()) {{
                                    if (node.textContent && /{escaped_text}/i.test(node.textContent)) {{
                                        // –ù–∞—Ö–æ–¥–∏–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç
                                        let parent = node.parentElement;
                                        while (parent && parent !== document.body) {{
                                            if (parent.offsetHeight > 0 && parent.offsetWidth > 0) {{
                                                return parent;
                                            }}
                                            parent = parent.parentElement;
                                        }}
                                    }}
                                }}
                                return null;
                            }}
                        """)
                        
                        if tiktok_ads_element and await tiktok_ads_element.as_element():
                            element = await tiktok_ads_element.as_element()
                            await element.scroll_into_view_if_needed()
                            await self.human_delay(0.3, 0.5)
                            tiktok_ads_found = True
                            log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript TreeWalker")
                            break
                    except Exception as e:
                        log.debug(f"JavaScript –ø–æ–∏—Å–∫ '{text_variant}' –Ω–µ —É–¥–∞–ª—Å—è: {e}")
                        continue
            
            # –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ query_selector
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 3: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ query_selector —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ —Ç–µ–∫—Å—Ç–∞...")
                try:
                    # –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
                    text_variants = []
                    for text in tiktok_ads_texts:
                        text_variants.extend([
                            f'text="{text}"',
                            f'text={text}',
                            f'*:has-text("{text}")',
                        ])
                    
                    for variant in text_variants:
                        try:
                            element = await self.page.query_selector(variant)
                            if element:
                                is_visible = await element.is_visible()
                                if is_visible:
                                    await element.scroll_into_view_if_needed()
                                    await self.human_delay(0.3, 0.5)
                                    tiktok_ads_found = True
                                    tiktok_ads_element = element
                                    log.info(f"  ‚úÖ –ë–ª–æ–∫ –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ query_selector: {variant}")
                                    break
                        except:
                            continue
                except Exception as e:
                    log.debug(f"Query selector –ø–æ–∏—Å–∫ –Ω–µ —É–¥–∞–ª—Å—è: {e}")
            
            # –ü–æ–ø—ã—Ç–∫–∞ 4: –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –µ—â–µ —Ä–∞–∑ –∏ –ø–æ–∏—Å–∫–∞—Ç—å —Å–Ω–æ–≤–∞
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 4: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∏ –ø–æ–∏—Å–∫...")
                try:
                    # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –µ—â–µ —Ä–∞–∑ –º–µ–¥–ª–µ–Ω–Ω–æ
                    await self.page.evaluate("window.scrollTo(0, 0)")  # –í –Ω–∞—á–∞–ª–æ
                    await self.human_delay(0.5, 1)
                    
                    # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑ –º–µ–¥–ª–µ–Ω–Ω–æ, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è—Å—å –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
                    page_height = await self.page.evaluate("document.body.scrollHeight")
                    scroll_increment = 300  # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –ø–æ 300px
                    
                    for scroll_pos in range(0, page_height, scroll_increment):
                        await self.page.evaluate(f"window.scrollTo(0, {scroll_pos})")
                        await self.human_delay(0.2, 0.3)
                        
                        # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –Ω–∞ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ (–≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞)
                        for text_variant in tiktok_ads_texts:
                            try:
                                # –ó–∞–º–µ–Ω—è–µ–º –ø—Ä–æ–±–µ–ª—ã –Ω–∞ \s+ –¥–ª—è regex
                                regex_pattern = text_variant.replace(" ", "\\s+")
                                locator = self.page.locator(f'text=/{regex_pattern}/i').first
                                if await locator.count() > 0:
                                    tiktok_ads_element = await locator.element_handle()
                                    if tiktok_ads_element:
                                        await tiktok_ads_element.scroll_into_view_if_needed()
                                        await self.human_delay(0.3, 0.5)
                                        tiktok_ads_found = True
                                        log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ {scroll_pos}px")
                                        break
                            except:
                                continue
                        
                        if tiktok_ads_found:
                            break
                    
                    if not tiktok_ads_found:
                        # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ —Å–∞–º–æ–≥–æ –Ω–∏–∑–∞ –µ—â–µ —Ä–∞–∑
                        await self.page.evaluate("window.scrollTo(0, document.body.scrollHeight)")
                        await self.human_delay(1, 2)
                        
                        # –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–∏—Å–∫–∞ (–≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞)
                        for text_variant in tiktok_ads_texts:
                            try:
                                # –ó–∞–º–µ–Ω—è–µ–º –ø—Ä–æ–±–µ–ª—ã –Ω–∞ \s+ –¥–ª—è regex
                                regex_pattern = text_variant.replace(" ", "\\s+")
                                locator = self.page.locator(f'text=/{regex_pattern}/i').first
                                if await locator.count() > 0:
                                    tiktok_ads_element = await locator.element_handle()
                                    if tiktok_ads_element:
                                        await tiktok_ads_element.scroll_into_view_if_needed()
                                        await self.human_delay(0.3, 0.5)
                                        tiktok_ads_found = True
                                        log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω –≤ —Å–∞–º–æ–º –Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã")
                                        break
                            except:
                                continue
                except Exception as e:
                    log.debug(f"–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –Ω–µ –ø–æ–º–æ–≥–ª–∞: {e}")
            
            if not tiktok_ads_found:
                log.error("  ‚ùå –ë–ª–æ–∫ 'TikTok Ads' –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫")
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                try:
                    screenshot_path = config.SCREENSHOTS_DIR / f"tiktok_ads_not_found_{int(time.time())}.png"
                    await self.page.screenshot(path=str(screenshot_path), full_page=True)
                    log.info(f"  üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {screenshot_path}")
                except:
                    pass
                log.error("  ‚ùå –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: –±–ª–æ–∫ 'TikTok Ads' –Ω–µ –Ω–∞–π–¥–µ–Ω")
                return product_data
            
            log.info("  ‚úÖ –ë–ª–æ–∫ 'TikTok Ads' —É—Å–ø–µ—à–Ω–æ –Ω–∞–π–¥–µ–Ω")
            
            # –®–ê–ì 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ "First seen"
            log.info("\nüìå –®–ê–ì 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ 'First seen'...")
            sort_success = await self._set_sort_by_first_seen()
            if not sort_success:
                log.warning("  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            # –®–ê–ì 6: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–∏–¥–µ–æ
            log.info("\nüìå –®–ê–ì 6: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ 'TikTok Ads'...")
            videos = await self._get_videos_from_tiktok_ads_block()
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ {len(videos)} –≤–∏–¥–µ–æ –≤ –±–ª–æ–∫–µ")
            
            # –®–ê–ì 7: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ
            log.info(f"\nüìå –®–ê–ì 7: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ (impression >= {config.MIN_IMPRESSIONS}, –¥–∞—Ç–∞ <= {config.DAYS_BACK} –¥–Ω–µ–π)...")
            filtered_videos = await self._filter_videos(videos)
            log.info(f"  ‚Üí –ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: {len(filtered_videos)} –≤–∏–¥–µ–æ")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –í–°–ï –≤–∏–¥–µ–æ (–¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏) –≤ ProductData
            product_data._all_videos_raw = videos[:20]  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–≤—ã–µ 20 –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
            
            # –í–ê–ñ–ù–û: –ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ 0 –≤–∏–¥–µ–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä
            if len(filtered_videos) == 0:
                log.warning(f"  ‚ö†Ô∏è –ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ (>= {config.MIN_IMPRESSIONS} impressions, <= {config.DAYS_BACK} –¥–Ω–µ–π)")
                log.warning(f"  ‚ö†Ô∏è –¢–æ–≤–∞—Ä –±—É–¥–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω")
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ —Ç–æ–≤–∞—Ä–∞
                product_data._insufficient_videos = True
                product_data._videos_found = len(videos)
                return product_data
            
            # –í—ã–±–æ—Ä —Ç–æ–ø-3 –≤–∏–¥–µ–æ
            video_count = 3
            selected_videos = filtered_videos[:video_count]
            
            log.info(f"  ‚úÖ –í—ã–±—Ä–∞–Ω–æ {len(selected_videos)} –≤–∏–¥–µ–æ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            
            # –®–ê–ì 8: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
            log.info(f"\nüìå –®–ê–ì 8: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–ª—è {len(selected_videos)} –≤–∏–¥–µ–æ...")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
            product_page_url = self.page.url
            log.info(f"  ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞: {product_page_url}")
            
            for i, video in enumerate(selected_videos, 1):
                log.info(f"\n  üé¨ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ {i}/{len(selected_videos)}...")
                log.info(f"    ‚Üí Impression: {video.get('impression', 0)}, First seen: {video.get('first_seen', 'N/A')}")
                
                # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ (–ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ ad-search –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
                video_details = await self._get_video_details(video)
                
                if video_details:
                    product_data.videos.append(video_details)
                    log.info(f"    ‚úÖ –í–∏–¥–µ–æ {i} –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ")
                else:
                    log.warning(f"    ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –¥–ª—è –≤–∏–¥–µ–æ {i}")
                
                # –í–ê–ñ–ù–û: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
                log.info(f"    ‚Üí –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ {i}...")
                try:
                    await self.page.goto(product_page_url, wait_until="domcontentloaded", timeout=30000)
                    await self.human_delay(1, 2)
                    
                    # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –±–ª–æ–∫–∞ TikTok Ads (—á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ –≤–∏–¥–µ–æ)
                    try:
                        await self.page.wait_for_selector('a[href*="/ad-search/"]', timeout=10000, state="visible")
                        log.info(f"    ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ —É—Å–ø–µ—à–µ–Ω (–≤–∏–¥–µ–æ {i})")
                    except:
                        log.warning(f"    ‚ö†Ô∏è –ë–ª–æ–∫ TikTok Ads –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
                except Exception as e:
                    log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞: {e}")
                    # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–ª–µ–¥—É—é—â–∏—Ö –≤–∏–¥–µ–æ –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤–æ–∑–≤—Ä–∞—Ç–∞
                
                await self.human_delay(0.5, 1)
            
            # –ó–∞–ø–æ–ª–Ω—è–µ–º N/A –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤–∏–¥–µ–æ (–Ω—É–∂–Ω–æ 3 –≤–∏–¥–µ–æ)
            while len(product_data.videos) < video_count:
                product_data.videos.append({
                    "tiktok_link": "N/A",
                    "impression": 0,
                    "script": "N/A",
                    "hook": "N/A",
                    "audience_age": "N/A",
                    "country": "N/A",
                    "first_seen": "N/A",
                })
            
            log.info(f"\n‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {len(product_data.videos)} –≤–∏–¥–µ–æ –¥–ª—è —Ç–æ–≤–∞—Ä–∞")
            
            # –®–ê–ì 9: –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ –≤ Google Sheets (–µ—Å–ª–∏ sheets_writer –ø–µ—Ä–µ–¥–∞–Ω)
            if sheets_writer:
                if hasattr(product_data, '_sheets_row') and product_data._sheets_row > 0:
                    log.info(f"\nüìå –®–ê–ì 9: –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {product_data._sheets_row})...")
                    log.info(f"  ‚Üí –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ –¥–ª—è –∑–∞–ø–∏—Å–∏: {len(product_data.videos)}")
                    
                    # –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é
                    for i, video in enumerate(product_data.videos[:3], 1):
                        log.info(f"  ‚Üí –í–∏–¥–µ–æ {i}: tiktok={video.get('tiktok_link', 'N/A')[:50]}, "
                                f"impression={video.get('impression', 'N/A')}, "
                                f"script={len(str(video.get('script', 'N/A')))} —Å–∏–º–≤–æ–ª–æ–≤, "
                                f"hook={len(str(video.get('hook', 'N/A')))} —Å–∏–º–≤–æ–ª–æ–≤, "
                                f"audience={video.get('audience_age', 'N/A')}, "
                                f"country={video.get('country', 'N/A')}, "
                                f"first_seen={video.get('first_seen', 'N/A')}")
                    
                    try:
                        # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏
                        video_data_dict = {
                            "product_name": product_data.product_name,
                            "category": product_data.category,
                            "pipiads_link": product_data.pipiads_link,
                            "videos": product_data.videos
                        }
                        
                        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (update_basic=False - –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ F-Z)
                        success = sheets_writer.write_product_data(
                            product_data._sheets_row,
                            video_data_dict,
                            update_basic=False
                        )
                        
                        if success:
                            log.info(f"  ‚úÖ –î–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {product_data._sheets_row}, —Å—Ç–æ–ª–±—Ü—ã F-Z)")
                        else:
                            log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –≤ Google Sheets")
                    except Exception as e:
                        log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ: {e}")
                        import traceback
                        log.error(traceback.format_exc())
                else:
                    log.warning(f"  ‚ö†Ô∏è –ù–µ—Ç –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö (_sheets_row –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)")
            
            log.info("=" * 80)
            log.info("‚úÖ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û")
            log.info("=" * 80)
            return product_data
            
        except Exception as e:
            log.error("\n" + "=" * 80)
            log.error(f"‚ùå –û–®–ò–ë–ö–ê –ü–†–ò –û–ë–†–ê–ë–û–¢–ö–ï –¢–û–í–ê–†–ê: {e}")
            log.error("=" * 80)
            import traceback
            log.error(traceback.format_exc())
            return product_data
    
    async def return_to_main_page(self, main_page_url: str) -> bool:
        """
        –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–æ–≤–∞—Ä–æ–≤
        
        Args:
            main_page_url: URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ —Ç–æ–≤–∞—Ä)
        
        Returns:
            True –µ—Å–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç —É—Å–ø–µ—à–µ–Ω, False –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        """
        try:
            log.info("\nüîô –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–æ–≤–∞—Ä–æ–≤...")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π URL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            current_url = self.page.url
            log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
            log.info(f"  ‚Üí –¶–µ–ª–µ–≤–æ–π URL: {main_page_url}")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            if current_url == main_page_url:
                log.info("  ‚ÑπÔ∏è  –£–∂–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
                return True
            
            # –ú–ï–¢–û–î 1: –ü—Ä—è–º–æ–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π URL (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            await self.page.goto(main_page_url, wait_until="domcontentloaded", timeout=30000)  # –£–≤–µ–ª–∏—á–µ–Ω –¥–æ 30 —Å–µ–∫
            await self.human_delay(1, 2)
            
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ë–ï–ó networkidle - –æ–Ω –≤—ã–∑—ã–≤–∞–µ—Ç —Ç–∞–π–º–∞—É—Ç—ã!)
            await self.page.wait_for_load_state("domcontentloaded", timeout=5000)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞
            new_url = self.page.url
            log.info(f"  ‚Üí –ù–æ–≤—ã–π URL: {new_url}")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤
            try:
                await self.page.wait_for_selector('a[href*="/tiktok-shop-product/"]', timeout=10000)
                
                # –î–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ä–µ–º—è –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
                await self.human_delay(2, 3)
                
                log.info("  ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —É—Å–ø–µ—à–µ–Ω")
                return True
            except:
                log.warning("  ‚ö†Ô∏è –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞")
                return False
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É: {e}")
            import traceback
            log.error(traceback.format_exc())
            return False
    
    async def get_product_details_with_return(self, product_index: int, sheets_writer=None, banned_products=None):
        """
        –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        
        –ê–ª–≥–æ—Ä–∏—Ç–º:
        1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        2. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É
        3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ban-list (–µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω)
        4. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–≤–∞—Ä (get_product_details)
        5. –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        
        Args:
            product_index: –ò–Ω–¥–µ–∫—Å —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–Ω–∞—á–∏–Ω–∞—è —Å 0)
            sheets_writer: –û–±—ä–µ–∫—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ Google Sheets
            banned_products: –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö URL (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
        
        Returns:
            ProductData –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ
            Dict —Å–æ status="insufficient_videos" –µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ
            Dict —Å–æ status="duplicate" –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
            None –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        """
        log.info(f"\n{'='*80}")
        log.info(f"üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ü–û –ò–ù–î–ï–ö–°–£ {product_index}")
        log.info(f"{'='*80}")
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        main_page_url = self.page.url
        log.info(f"  ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {main_page_url}")
        
        def normalize_url(url: str) -> str:
            """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL (—É–±—Ä–∞—Ç—å —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É)"""
            if not url:
                return ""
            url = url.strip().rstrip('/')
            # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if '?' in url:
                url = url.split('?')[0]
            return url
        
        try:
            # –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É
            log.info(f"\nüìå –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É {product_index}...")
            
            try:
                # –ò—â–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
                product_links = await self.page.query_selector_all('a[href*="/tiktok-shop-product/"]')
                
                if not product_links:
                    log.error("  ‚ùå –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
                    return None
                
                if product_index >= len(product_links):
                    log.error(f"  ‚ùå –ò–Ω–¥–µ–∫—Å {product_index} –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã (–≤—Å–µ–≥–æ {len(product_links)} —Ç–æ–≤–∞—Ä–æ–≤)")
                    return None
                
                # –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Ç–æ–≤–∞—Ä–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É
                product_link = product_links[product_index]
                
                # –ü–æ–ª—É—á–∞–µ–º URL —Ç–æ–≤–∞—Ä–∞
                href = await product_link.get_attribute("href")
                if not href:
                    log.error(f"  ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å URL –¥–ª—è —Ç–æ–≤–∞—Ä–∞ {product_index}")
                    return None
                
                # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π URL
                if href.startswith("/"):
                    product_url = f"https://www.pipiads.com{href}"
                elif href.startswith("http"):
                    product_url = href
                else:
                    product_url = f"https://www.pipiads.com/{href}"
                
                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º URL (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
                product_url = normalize_url(product_url)
                
                if not product_url:
                    log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                    return None
                
                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
                if banned_products is not None and product_url in banned_products:
                    log.warning(f"  üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: {product_url}")
                    log.warning(f"     –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.")
                    return {"status": "duplicate", "product_url": product_url}
                
                log.info(f"  ‚úÖ –ü–æ–ª—É—á–µ–Ω URL —Ç–æ–≤–∞—Ä–∞: {product_url}")
                
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ URL —Ç–æ–≤–∞—Ä–∞: {e}")
                return None
            
            # –®–ê–ì 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ get_product_details
            log.info(f"\nüìå –®–ê–ì 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞...")
            product_data = await self.get_product_details(product_url, sheets_writer=sheets_writer)
            
            # –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–¥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é)
            log.info(f"\nüìå –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞...")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∏ –µ—Å—Ç—å –≤–∏–¥–µ–æ
            if not product_data:
                log.warning("  ‚ö†Ô∏è product_data –ø—É—Å—Ç")
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                await self.return_to_main_page(main_page_url)
                return None
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ —Ç–æ–≤–∞—Ä –ø—Ä–æ–ø—É—â–µ–Ω –∏–∑-–∑–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
            if hasattr(product_data, '_insufficient_videos') and product_data._insufficient_videos:
                videos_found = getattr(product_data, '_videos_found', 0)
                log.warning(f"  ‚ö†Ô∏è –¢–æ–≤–∞—Ä –ø—Ä–æ–ø—É—â–µ–Ω: –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ (–Ω–∞–π–¥–µ–Ω–æ –≤—Å–µ–≥–æ: {videos_found})")
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                await self.return_to_main_page(main_page_url)
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª–æ–≤–∞—Ä—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "insufficient_videos"
                return {
                    "status": "insufficient_videos",
                    "product_name": getattr(product_data, 'product_name', 'N/A'),
                    "videos_found": videos_found,
                    "videos_required": 3,
                    "reason": f"–ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (>= {config.MIN_IMPRESSIONS} impressions, <= {config.DAYS_BACK} –¥–Ω–µ–π) –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ"
                }
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ
            videos_count = len(product_data.videos) if hasattr(product_data, 'videos') else 0
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ –≤–∏–¥–µ–æ: {videos_count}")
            
            # –ï—Å–ª–∏ –≤–∏–¥–µ–æ –º–µ–Ω—å—à–µ 3 - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
            if videos_count < 3:
                log.warning(f"  ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ: {videos_count} < 3")
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                await self.return_to_main_page(main_page_url)
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª–æ–≤–∞—Ä—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "insufficient_videos"
                return {
                    "status": "insufficient_videos",
                    "product_name": getattr(product_data, 'product_name', 'N/A'),
                    "videos_found": videos_count,
                    "videos_required": 3,
                    "reason": f"–ù–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ {videos_count} –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏"
                }
            
            # –®–ê–ì 4: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            log.info(f"\nüìå –®–ê–ì 4: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É...")
            await self.return_to_main_page(main_page_url)
            
            # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä
            log.info(f"  ‚úÖ –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ ({videos_count} –≤–∏–¥–µ–æ)")
            return product_data
            
        except Exception as e:
            log.error(f"\n‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É {product_index}: {e}")
            import traceback
            log.error(traceback.format_exc())
            
            # –ü—ã—Ç–∞–µ–º—Å—è –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
            try:
                await self.return_to_main_page(main_page_url)
            except:
                log.error("  ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏")
            
            return None
    
    async def _set_sort_by_first_seen(self) -> bool:
        """
        –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É "First seen" –≤ dropdown
        
        Returns:
            True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
        """
        log.info("  ‚Üí –ü–æ–∏—Å–∫ dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏...")
        try:
            # –ò—â–µ–º dropdown "Sort by"
            sort_selectors = [
                'select:has-text("Sort by")',
                'select',
                '[class*="sort"]',
                'text="Sort by: First seen"',
                'text="Sort by"',
            ]
            
            dropdown = None
            for selector in sort_selectors:
                try:
                    dropdown = await self.page.query_selector(selector)
                    if dropdown:
                        is_visible = await dropdown.is_visible()
                        if is_visible:
                            log.debug(f"–ù–∞–π–¥–µ–Ω dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: {selector}")
                            break
                        else:
                            dropdown = None
                except:
                    continue
            
            if not dropdown:
                # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ —Ç–µ–∫—Å—Ç—É "Sort by: First seen"
                try:
                    sort_text = await self.page.query_selector('text="Sort by: First seen"')
                    if sort_text:
                        # –ö–ª–∏–∫–∞–µ–º –Ω–∞ —Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å dropdown
                        await sort_text.click()
                        await self.human_delay(0.5, 1)
                        
                        # –ò—â–µ–º –æ–ø—Ü–∏—é "First seen"
                        first_seen_option = await self.page.query_selector('text="First seen"')
                        if first_seen_option:
                            await first_seen_option.click()
                            await self.human_delay(1, 2)
                            log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (—á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç)")
                            return True
                except:
                    pass
                
                log.warning("Dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å")
                return False
            
            # –ï—Å–ª–∏ —ç—Ç–æ select —ç–ª–µ–º–µ–Ω—Ç
            tag_name = await dropdown.evaluate("el => el.tagName.toLowerCase()")
            if tag_name == "select":
                # –í—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é —á–µ—Ä–µ–∑ value –∏–ª–∏ —Ç–µ–∫—Å—Ç
                try:
                    log.info("  ‚Üí –ù–∞–π–¥–µ–Ω select —ç–ª–µ–º–µ–Ω—Ç, –≤—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é 'First seen'...")
                    await dropdown.select_option(label="First seen")
                    await self.human_delay(1, 2)
                    log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (select)")
                    return True
                except:
                    pass
            
            # –ï—Å–ª–∏ —ç—Ç–æ –∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown - –∫–ª–∏–∫–∞–µ–º –∏ –≤—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é
            log.info("  ‚Üí –ù–∞–π–¥–µ–Ω –∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown, –æ—Ç–∫—Ä—ã–≤–∞–µ–º...")
            await dropdown.click()
            await self.human_delay(0.5, 1)
            
            # –ò—â–µ–º –æ–ø—Ü–∏—é "First seen"
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –æ–ø—Ü–∏–∏ 'First seen'...")
            option_selectors = [
                'text="First seen"',
                'text="Sort by: First seen"',
                '[role="option"]:has-text("First seen")',
            ]
            
            for opt_sel in option_selectors:
                try:
                    option = await self.page.query_selector(opt_sel)
                    if option:
                        await option.click()
                        await self.human_delay(1, 2)
                        log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (–∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown)")
                        return True
                except:
                    continue
            
            log.warning("  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É 'First seen'")
            return False
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: {e}")
            return False
    
    async def _get_videos_from_tiktok_ads_block(self) -> List[Dict[str, Any]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ TikTok Ads
        
        Returns:
            –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        videos = []
        
        try:
            log.info("  ‚Üí –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ...")
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ
            await self.human_delay(0.5, 1)
            
            # –ò—â–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ - –ø—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã...")
            video_card_selectors = [
                '[class*="video"]',
                '[class*="card"]',
                '[class*="ad"]',
                'div[class*="item"]',
                'a[href*="/ad-search/"]',
            ]
            
            video_elements = []
            for selector in video_card_selectors:
                try:
                    elements = await self.page.query_selector_all(selector)
                    if elements:
                        log.debug(f"–ù–∞–π–¥–µ–Ω–æ {len(elements)} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º {selector}")
                        # –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ, —á—Ç–æ —Å–æ–¥–µ—Ä–∂–∞—Ç –≤–∏–¥–µ–æ (–∏–º–µ—é—Ç thumbnail –∏–ª–∏ play button)
                        for elem in elements:
                            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –∫–∞—Ä—Ç–æ—á–∫–∞ –≤–∏–¥–µ–æ
                            has_play_button = await elem.query_selector('[class*="play"], svg, [class*="thumbnail"]')
                            if has_play_button or '/ad-search/' in str(await elem.get_attribute("href") or ""):
                                video_elements.append(elem)
                        if video_elements:
                            break
                except:
                    continue
            
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ")
            
            # –û–ì–†–ê–ù–ò–ß–ï–ù–ò–ï: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 50 –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
            max_cards = 50
            if len(video_elements) > max_cards:
                log.info(f"  ‚Üí –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ {max_cards} –∏–∑ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫")
                video_elements = video_elements[:max_cards]
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
            log.info("  ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–µ–∫...")
            log.info(f"  ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∞ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫...")
            
            successful_extractions = 0
            for i, card in enumerate(video_elements, 1):
                try:
                    video_data = await self._extract_video_data_from_card(card, i)
                    if video_data:
                        videos.append(video_data)
                        impression = video_data.get('impression', 0)
                        first_seen = video_data.get('first_seen', 'N/A')
                        
                        # –õ–û–ì–ò–†–£–ï–ú –ö–ê–ñ–î–û–ï –í–ò–î–ï–û (–∫–∞–∫ –ø—Ä–æ—Å–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
                        log.info(f"  üìπ –í–∏–¥–µ–æ {i}: impression={impression}, first_seen={first_seen}")
                        
                        if impression > 0 or first_seen != 'N/A':
                            successful_extractions += 1
                except Exception as e:
                    log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ {i}: {e}")
                    continue
            
            log.info(f"  ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–æ {len(videos)} –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ (—É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–æ: {successful_extractions})")
            return videos
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤–∏–¥–µ–æ: {e}")
            return []
    
    async def _extract_video_data_from_card(self, card_element, card_index: int = 0) -> Optional[Dict[str, Any]]:
        """
        –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ
        
        Args:
            card_element: –≠–ª–µ–º–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ
            card_index: –ò–Ω–¥–µ–∫—Å –∫–∞—Ä—Ç–æ—á–∫–∏ (–¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ –∏–ª–∏ None
        """
        try:
            video_data = {
                "ad_search_url": None,
                "impression": 0,
                "first_seen": None,
                "card_element": card_element,  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –∫–ª–∏–∫–∞
            }
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï IMPRESSION ==========
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ HTML-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
            # –ò—â–µ–º div.data-count > div.item –≥–¥–µ caption = "Impression"
            try:
                # –ò—â–µ–º –≤—Å–µ –±–ª–æ–∫–∏ data-count
                data_count_items = await card_element.query_selector_all('div.data-count div.item')
                
                if card_index <= 3:
                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –Ω–∞–π–¥–µ–Ω–æ {len(data_count_items)} –±–ª–æ–∫–æ–≤ div.item")
                
                for idx, item in enumerate(data_count_items):
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å impression
                    caption_elem = await item.query_selector('p.caption')
                    if caption_elem:
                        caption_text = await caption_elem.inner_text()
                        
                        if card_index <= 3:
                            log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}, –±–ª–æ–∫ {idx}: caption = '{caption_text}'")
                        
                        if 'Impression' in caption_text or '–ü–æ–∫–∞–∑' in caption_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
                            value_elem = await item.query_selector('p.value')
                            if value_elem:
                                # –ü–æ–ø—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
                                impression_str_inner = (await value_elem.inner_text()).strip()
                                impression_str_html = (await value_elem.inner_html()).strip()
                                impression_str_content = (await value_elem.text_content()).strip()
                                
                                # –í–°–ï–ì–î–ê –ª–æ–≥–∏—Ä—É–µ–º RAW-–∑–Ω–∞—á–µ–Ω–∏–µ (–¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–∞—Ä—Ç–æ—á–µ–∫)
                                if card_index <= 3:
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (inner_text) = '{impression_str_inner}'")
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (inner_html) = '{impression_str_html}'")
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (text_content) = '{impression_str_content}'")
                                
                                # –ò—Å–ø–æ–ª—å–∑—É–µ–º inner_text –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫
                                impression_str = impression_str_inner
                                impression = validator.parse_impressions(impression_str)
                                if impression:
                                    video_data["impression"] = impression
                                    if card_index <= 3:
                                        log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression PARSED = {impression}")
                                    break
                                else:
                                    if card_index <= 3:
                                        log.warning(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: parse_impressions –≤–µ—Ä–Ω—É–ª None –¥–ª—è '{impression_str}'")
            except Exception as e:
                if card_index <= 3:
                    log.error(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ impression: {e}")
                    import traceback
                    log.error(traceback.format_exc())
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï FIRST SEEN ==========
            # –ò—â–µ–º div.create-time > span —Å –¥–∞—Ç–æ–π
            try:
                create_time_elem = await card_element.query_selector('div.create-time span')
                if create_time_elem:
                    date_text = (await create_time_elem.inner_text()).strip()
                    # –õ–æ–≥–∏—Ä—É–µ–º RAW-–∑–Ω–∞—á–µ–Ω–∏–µ
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: first_seen RAW='{date_text}'")
                    
                    # –§–æ—Ä–º–∞—Ç: "Nov 05 2025-Nov 11 2025" - –±–µ—Ä–µ–º –ü–ï–†–í–£–Æ –¥–∞—Ç—É (–¥–æ –¥–µ—Ñ–∏—Å–∞)
                    # –ò—Å–ø–æ–ª—å–∑—É–µ–º regex –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–µ—Ä–≤–æ–π –¥–∞—Ç—ã
                    match = re.match(r'([A-Z][a-z]{2}\s+\d{1,2}\s+\d{4})', date_text)
                    if match:
                        first_seen_str = match.group(1)
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –¥–∞—Ç—ã
                        parsed_date = validator.parse_video_date(first_seen_str)
                        if parsed_date:
                            video_data["first_seen"] = first_seen_str
                            log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: first_seen parsed='{first_seen_str}'")
            except Exception as e:
                if card_index <= 3:
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ first_seen —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä: {e}")
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï AD-SEARCH –°–°–´–õ–ö–ò ==========
            try:
                link_element = await card_element.query_selector('a.btn-detail[href*="/ad-search/"]')
                if link_element:
                    href = await link_element.get_attribute("href")
                    if href:
                        if href.startswith("/"):
                            video_data["ad_search_url"] = f"https://www.pipiads.com{href}"
                        elif href.startswith("http"):
                            video_data["ad_search_url"] = href
                        else:
                            video_data["ad_search_url"] = f"https://www.pipiads.com/{href}"
                        if card_index <= 3:
                            log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: ad_search_url = {video_data['ad_search_url']}")
            except Exception as e:
                if card_index <= 3:
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ ad_search_url: {e}")
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Å—Å—ã–ª–∫—É, –Ω–æ –µ—Å—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∞ - –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –Ω–µ—ë
            if not video_data["ad_search_url"]:
                video_data["card_element"] = card_element
            
            # –õ–æ–≥–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–∞—Ä—Ç–æ—á–µ–∫
            if card_index <= 3:
                log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –∏—Ç–æ–≥–æ - impression={video_data['impression']}, first_seen={video_data['first_seen']}, ad_search_url={bool(video_data['ad_search_url'])}")
            
            return video_data
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ {card_index}: {e}")
            import traceback
            log.debug(traceback.format_exc())
            return None
    
    async def _filter_videos(self, videos: List[Dict[str, Any]]) -> List[Dict[str, Any]]:
        """
        –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
        
        Args:
            videos: –°–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        
        Returns:
            –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ
        """
        filtered = []
        
        for video in videos:
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ impression (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π "170.6K" –∏–ª–∏ —á–∏—Å–ª–æ–º)
            impression = video.get("impression", 0)
            impression_num = 0
            if isinstance(impression, str):
                # –ü–∞—Ä—Å–∏–º —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                impression_num = validator.parse_impressions(impression) or 0
            elif isinstance(impression, (int, float)):
                impression_num = int(impression)
            
            if not validator.validate_impressions(impression_num, config.MIN_IMPRESSIONS):
                log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: impression {impression} ({impression_num}) < {config.MIN_IMPRESSIONS}")
                continue
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
            first_seen = video.get("first_seen")
            if first_seen and first_seen != "N/A" and first_seen is not None:
                parsed_date = validator.parse_video_date(first_seen)
                if parsed_date:
                    if not validator.is_date_within_days(parsed_date, config.DAYS_BACK):
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –¥–∞—Ç–∞ {first_seen} —Å—Ç–∞—Ä—à–µ {config.DAYS_BACK} –¥–Ω–µ–π")
                        continue
                else:
                    # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å, –Ω–æ –µ—Å—Ç—å impression >= 50k, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –¥–∞—Ç—ã
                    if impression >= config.MIN_IMPRESSIONS:
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–∏–Ω—è—Ç–æ: –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É {first_seen}, –Ω–æ impression {impression} >= {config.MIN_IMPRESSIONS}")
                    else:
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É {first_seen} –∏ impression {impression} < {config.MIN_IMPRESSIONS}")
                        continue
            # –ï—Å–ª–∏ –¥–∞—Ç—ã –Ω–µ—Ç, –Ω–æ impression >= 50k, –ø—Ä–∏–Ω–∏–º–∞–µ–º –≤–∏–¥–µ–æ
            elif impression >= config.MIN_IMPRESSIONS:
                log.debug(f"–í–∏–¥–µ–æ –ø—Ä–∏–Ω—è—Ç–æ: –Ω–µ—Ç –¥–∞—Ç—ã, –Ω–æ impression {impression} >= {config.MIN_IMPRESSIONS}")
            else:
                log.debug("–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –Ω–µ—Ç –¥–∞—Ç—ã first_seen –∏ impression < –º–∏–Ω–∏–º—É–º–∞")
                continue
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
            video["_impression_num"] = impression_num
            filtered.append(video)
        
        # –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: —Å–Ω–∞—á–∞–ª–∞ –ø–æ –¥–∞—Ç–µ (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ), –ø–æ—Ç–æ–º –ø–æ impressions (—Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ)
        # –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ ad_search_url (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π), –∑–∞—Ç–µ–º tiktok_link, –∑–∞—Ç–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—è
        seen_videos = set()
        unique_videos = []
        for video in filtered:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)
            # 1. ad_search_url (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ)
            # 2. tiktok_link (–µ—Å–ª–∏ ad_search_url –Ω–µ—Ç)
            # 3. –ö–æ–º–±–∏–Ω–∞—Ü–∏—è impression + first_seen (fallback)
            video_id = None
            
            # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º ad_search_url (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ)
            ad_search_url = video.get("ad_search_url", "")
            if ad_search_url and ad_search_url != "N/A":
                ad_search_url = ad_search_url.rstrip('/')
                video_id = f"ad_search:{ad_search_url}"
            elif video.get("tiktok_link") and video.get("tiktok_link") != "N/A":
                video_id = f"tiktok:{video.get('tiktok_link')}"
            else:
                # Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—é impression + first_seen
                impression = video.get("impression", 0)
                first_seen = video.get("first_seen", "N/A")
                video_id = f"fallback:{impression}:{first_seen}"
            
            if video_id and video_id not in seen_videos:
                seen_videos.add(video_id)
                unique_videos.append(video)
            else:
                log.info(f"‚è≠Ô∏è  –í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ –∫–∞–∫ –¥—É–±–ª–∏–∫–∞—Ç: {video_id}")
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º: —Å–Ω–∞—á–∞–ª–∞ –ø–æ –¥–∞—Ç–µ (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ), –ø–æ—Ç–æ–º –ø–æ impressions (—Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ)
        def sort_key(v):
            parsed_date = validator.parse_video_date(v.get("first_seen", ""))
            if parsed_date:
                date_timestamp = -parsed_date.timestamp()  # –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ —É–±—ã–≤–∞–Ω–∏—é (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ)
            else:
                date_timestamp = 0  # –í–∏–¥–µ–æ –±–µ–∑ –¥–∞—Ç—ã –≤ –∫–æ–Ω–µ—Ü
            return (date_timestamp, -v.get("_impression_num", 0))
        
        unique_videos.sort(key=sort_key)
        
        # –ë–µ—Ä–µ–º —Ç–æ–ø-3
        top_videos = unique_videos[:3]
        
        log.info(f"‚úÖ –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ {len(filtered)} –≤–∏–¥–µ–æ –∏–∑ {len(videos)}, —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö: {len(unique_videos)}, —Ç–æ–ø-3: {len(top_videos)}")
        return top_videos
    
    async def _get_video_details(self, video: Dict[str, Any]) -> Optional[Dict[str, Any]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –≤–∏–¥–µ–æ
        
        Args:
            video: –°–ª–æ–≤–∞—Ä—å —Å –±–∞–∑–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ (–∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        try:
            # –ï—Å–ª–∏ –µ—Å—Ç—å ad_search_url, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞–ø—Ä—è–º—É—é
            if video.get("ad_search_url"):
                log.info(f"    ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É ad-search: {video['ad_search_url']}")
                await self.page.goto(video["ad_search_url"], wait_until="domcontentloaded", timeout=30000)
                await self.human_delay(0.5, 1)
                log.info("    ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ad-search –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            else:
                # –ï—Å–ª–∏ –Ω–µ—Ç URL, –∫–ª–∏–∫–∞–µ–º –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É
                # –í–ê–ñ–ù–û: –≠–ª–µ–º–µ–Ω—Ç –º–æ–∂–µ—Ç –∏—Å—á–µ–∑–Ω—É—Ç—å –∏–∑ DOM, –ø–æ—ç—Ç–æ–º—É –∏—â–µ–º –µ–≥–æ –∑–∞–Ω–æ–≤–æ
                card_element = video.get("card_element")
                if not card_element:
                    log.error("    ‚ùå –ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ –ø–µ—Ä–µ–π—Ç–∏ –∫ –≤–∏–¥–µ–æ (–Ω–µ—Ç URL –∏ —ç–ª–µ–º–µ–Ω—Ç–∞)")
                    return None
                
                log.info("    ‚Üí –ö–ª–∏–∫ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –≤–∏–¥–µ–æ...")
                try:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –µ—â–µ –≤ DOM
                    is_attached = await card_element.evaluate("el => el.isConnected")
                    if not is_attached:
                        log.warning("    ‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç –∏—Å—á–µ–∑ –∏–∑ DOM, –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∑–∞–Ω–æ–≤–æ...")
                        # –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ –ø–æ ad_search_url –∏–ª–∏ –¥—Ä—É–≥–∏–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º
                        # –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None
                        log.error("    ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ")
                        return None
                    
                    await card_element.click()
                    await self.human_delay(0.5, 1)
                    log.info("    ‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ –≤–∏–¥–µ–æ –æ—Ç–∫—Ä—ã—Ç–∞")
                except Exception as e:
                    log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É: {e}")
                    log.warning("    ‚ö†Ô∏è –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ...")
                    # –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –∏—Å—á–µ–∑, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None
                    return None
                
                # –ñ–¥–µ–º –æ—Ç–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞/–º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                # –ò—â–µ–º –∫–Ω–æ–ø–∫—É "More detail"
                log.info("    ‚Üí –ü–æ–∏—Å–∫ –∫–Ω–æ–ø–∫–∏ 'More detail'...")
                more_detail_selectors = [
                    'text="More detail"',
                    'text="More Detail"',
                    'button:has-text("More detail")',
                    'a:has-text("More detail")',
                ]
                
                more_detail_button = None
                for selector in more_detail_selectors:
                    try:
                        more_detail_button = await self.page.wait_for_selector(selector, timeout=5000, state="visible")
                        if more_detail_button:
                            log.info(f"    ‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ 'More detail' (—Å–µ–ª–µ–∫—Ç–æ—Ä: {selector})")
                            break
                    except:
                        continue
                
                if not more_detail_button:
                    log.error("    ‚ùå –ö–Ω–æ–ø–∫–∞ 'More detail' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
                    return None
                
                # –ö–ª–∏–∫–∞–µ–º –Ω–∞ "More detail"
                log.info("    ‚Üí –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É 'More detail'...")
                await more_detail_button.click()
                await self.human_delay(0.5, 1)
                
                # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
                log.info("    ‚Üí –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search...")
                await self.page.wait_for_load_state("domcontentloaded", timeout=10000)
                await self.human_delay(0.3, 0.5)
                log.info("    ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ad-search –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
            # –ü–µ—Ä–µ–¥–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏) –¥–ª—è fallback
            log.info("    ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search...")
            
            # –í–ê–ñ–ù–û: –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö
            try:
                await self.page.wait_for_load_state("networkidle", timeout=15000)
                await self.human_delay(1, 2)  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                log.info("    ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ad-search –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–∞ (networkidle)")
            except:
                log.warning("    ‚ö†Ô∏è –¢–∞–π–º–∞—É—Ç networkidle, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å domcontentloaded...")
                await self.page.wait_for_load_state("domcontentloaded", timeout=10000)
                await self.human_delay(2, 3)  # –£–≤–µ–ª–∏—á–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞
            
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (Script, Hook, Audience)
            try:
                # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                await self.page.wait_for_selector('li#ai-script, li#ai-hook, div.addel-info-item', timeout=10000, state="visible")
                log.info("    ‚úÖ –ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search")
            except:
                log.warning("    ‚ö†Ô∏è –ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ...")
            
            return await self._extract_ad_search_data(video)
            
        except Exception as e:
            log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–µ—Ç–∞–ª–µ–π –≤–∏–¥–µ–æ: {e}")
            import traceback
            log.error(traceback.format_exc())
            return None
    
    async def _extract_ad_search_data(self, original_video: Optional[Dict[str, Any]] = None) -> Dict[str, Any]:
        """
        –ò–∑–≤–ª–µ—á—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
        
        Args:
            original_video: –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (–¥–ª—è fallback impressions)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        video_data = {
            "tiktok_link": "N/A",
            "impression": 0,
            "script": "N/A",
            "hook": "N/A",
            "audience_age": "N/A",
            "country": "N/A",
            "first_seen": "N/A",
        }
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è fallback
        if original_video:
            original_impression = original_video.get("impression")
            if original_impression:
                video_data["_original_impression"] = original_impression
        
        try:
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            await self.page.wait_for_load_state("domcontentloaded")
            await self.human_delay(0.3, 0.5)
            
            # –ü–æ–ª—É—á–∞–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ø–æ–∏—Å–∫–∞
            page_text = await self.page.content()
            
            # 1. TikTok —Å—Å—ã–ª–∫–∞ (–∏–∑ –ø–æ–ª—è "TikTok Post" (–∞–Ω–≥–ª.) –∏–ª–∏ "–ü–æ—Å—Ç TikTok" (—Ä—É—Å.))
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ TikTok —Å—Å—ã–ª–∫–∏...")
            
            # –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –ø–æ —Ç–µ–∫—Å—Ç—É "TikTok Post" –∏–ª–∏ "–ü–æ—Å—Ç TikTok"
            tiktok_post_selectors = [
                'text=/TikTok Post/i',  # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
                'text=/–ü–æ—Å—Ç TikTok/i',  # –†—É—Å—Å–∫–∏–π fallback
            ]
            
            for selector in tiktok_post_selectors:
                try:
                    locator = self.page.locator(selector).first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Å—Å—ã–ª–∫—É —Ä—è–¥–æ–º
                        try:
                            parent_locator = locator.locator("..")
                            # –ò—â–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å—Å—ã–ª–∫–∞–º —Å /v/)
                            link = await parent_locator.locator('a[href*="m.tiktok.com/v/"]').first.element_handle()
                            if not link:
                                link = await parent_locator.locator('a[href*="tiktok.com/v/"]').first.element_handle()
                            if not link:
                                link = await parent_locator.locator('a[href*="tiktok.com"]').first.element_handle()
                            if link:
                                href = await link.get_attribute("href")
                                if href:
                                    # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä—ã –≤ TikTok Shop
                                    if "shop.tiktok.com/view/product" in href or "/view/product" in href:
                                        log.debug(f"      ‚Üí –ü—Ä–æ–ø—É—â–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä: {href[:50]}...")
                                        continue
                                    # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ
                                    if "/v/" in href or "m.tiktok.com" in href:
                                        video_data["tiktok_link"] = href
                                        log.info(f"      ‚úÖ TikTok —Å—Å—ã–ª–∫–∞ –Ω–∞–π–¥–µ–Ω–∞: {href[:50]}...")
                                        break
                        except:
                            pass
                except:
                    continue
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç, –∏—â–µ–º –≤—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ TikTok
            # –í–ê–ñ–ù–û: –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ (m.tiktok.com/v/...), –ù–ï –Ω–∞ —Ç–æ–≤–∞—Ä—ã (shop.tiktok.com/view/product/...)
            if video_data["tiktok_link"] == "N/A":
                tiktok_link_selectors = [
                    'a[href*="m.tiktok.com/v/"]',  # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ
                    'a[href*="tiktok.com/v/"]',    # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                    'a[href*="tiktok.com"]',       # Fallback
                ]
                
                for selector in tiktok_link_selectors:
                    try:
                        links = await self.page.query_selector_all(selector)
                        for link in links:
                            href = await link.get_attribute("href")
                            if href and "tiktok.com" in href:
                                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä—ã –≤ TikTok Shop
                                if "shop.tiktok.com/view/product" in href or "/view/product" in href:
                                    log.debug(f"      ‚Üí –ü—Ä–æ–ø—É—â–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä: {href[:50]}...")
                                    continue
                                
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ (—Å–æ–¥–µ—Ä–∂–∞—Ç /v/ –≤ –ø—É—Ç–∏)
                                if "/v/" in href or "m.tiktok.com" in href:
                                    video_data["tiktok_link"] = href
                                    log.info(f"      ‚úÖ TikTok —Å—Å—ã–ª–∫–∞ –Ω–∞–π–¥–µ–Ω–∞: {href[:50]}...")
                                    break
                        if video_data["tiktok_link"] != "N/A":
                            break
                    except:
                        continue
            
            if video_data["tiktok_link"] == "N/A":
                log.warning("      ‚ö†Ô∏è TikTok —Å—Å—ã–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
            
            # 2. Impressions - –ö–†–ò–¢–ò–ß–ù–û: "Impressions" (–∞–Ω–≥–ª.) –∏–ª–∏ "–ü–æ–∫–∞–∑—ã" (—Ä—É—Å.), –Ω–µ "Likes" –∏–ª–∏ "–ù—Ä–∞–≤–∏—Ç—Å—è"!
            # –ò—â–µ–º –≤ —Ä–∞–∑–¥–µ–ª–µ "Data/–î–∞–Ω–Ω—ã–µ" –≤ –ø—É–Ω–∫—Ç–µ "Impression/–ü–æ–∫–∞–∑"
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ impressions...")
            impression_text = await self._extract_impressions()
            if impression_text:
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–µ—Å–ª–∏ –æ–Ω —É–∂–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "170.6K" –∏–ª–∏ "339.9M")
                if impression_text.upper().endswith(('K', 'M')):
                    video_data["impression"] = impression_text
                    log.info(f"      ‚úÖ Impressions (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç): {impression_text}")
                else:
                    # –ü–∞—Ä—Å–∏–º —á–∏—Å–ª–æ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞—Ç–Ω–æ
                    impression_num = validator.parse_impressions(impression_text) or 0
                    video_data["impression"] = validator.format_impressions(impression_num)
                    log.info(f"      ‚úÖ Impressions (—Å—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–æ): {video_data['impression']}")
            else:
                # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ–Ω–∏ –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                # (–∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞)
                original_impression = video_data.get("_original_impression")
                if original_impression:
                    if isinstance(original_impression, (int, float)) and original_impression > 0:
                        video_data["impression"] = validator.format_impressions(int(original_impression))
                        log.info(f"      ‚úÖ Impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏: {video_data['impression']}")
                    elif isinstance(original_impression, str) and original_impression != "N/A":
                        video_data["impression"] = original_impression
                        log.info(f"      ‚úÖ Impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (—Å—Ç—Ä–æ–∫–∞): {original_impression}")
                    else:
                        video_data["impression"] = "N/A"
                        log.warning("      ‚ö†Ô∏è Impressions –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –Ω–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ")
                else:
                    video_data["impression"] = "N/A"
                    log.warning("      ‚ö†Ô∏è Impressions –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
            
            # 3. Script (–∏–∑ "Transcript" –∏–ª–∏ "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞")
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è (script)...")
            log.info(f"      ‚Üí –¢–µ–∫—É—â–∏–π URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {self.page.url}")
            script = await self._extract_script()
            if script:
                video_data["script"] = script
                log.info(f"      ‚úÖ Script –Ω–∞–π–¥–µ–Ω ({len(script)} —Å–∏–º–≤–æ–ª–æ–≤): {script[:100]}...")
            else:
                video_data["script"] = "N/A"
                log.warning("      ‚ö†Ô∏è Script –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-script p.content-text –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 4. Hook (–∏–∑ —Å–µ–∫—Ü–∏–∏ Hook –∏–ª–∏ Hooks)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ hook...")
            hook = await self._extract_hook()
            if not hook:
                # –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω
                log.warning("      ‚ö†Ô∏è Hook –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫...")
                await self.human_delay(1, 2)  # –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É
                hook = await self._extract_hook()
            
            if hook:
                video_data["hook"] = hook
                log.info(f"      ‚úÖ Hook –Ω–∞–π–¥–µ–Ω ({len(hook)} —Å–∏–º–≤–æ–ª–æ–≤): {hook[:100]}...")
            else:
                video_data["hook"] = "N/A"
                log.warning("      ‚ö†Ô∏è Hook –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook p.content-text –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 5. Audience Age (–∏–∑ –ø–æ–ª—è Audience/–ê—É–¥–∏—Ç–æ—Ä–∏—è)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∞—É–¥–∏—Ç–æ—Ä–∏–∏...")
            audience_data = await self._extract_audience()
            if audience_data:
                age = audience_data.get("age", "N/A")
                platform = audience_data.get("platform", "N/A")
                # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ "35-45" –∏–ª–∏ "35-45 Android" (–µ—Å–ª–∏ –µ—Å—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞)
                # –í —Å—Ç—Ä–æ–∫–µ 6 —Ç–æ–ª—å–∫–æ –≤–æ–∑—Ä–∞—Å—Ç "25-35", –±–µ–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
                video_data["audience_age"] = age if age != "N/A" else "N/A"
                log.info(f"      ‚úÖ Audience: {video_data['audience_age']}")
            else:
                video_data["audience_age"] = "N/A"
                log.info("      ‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
            
            # 6. Country (–∏–∑ –ø–æ–ª—è "Country/Region" –∏–ª–∏ "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω" - –û–¢–î–ï–õ–¨–ù–û –æ—Ç Audience!)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã...")
            country = await self._extract_country()
            if country:
                video_data["country"] = country
                log.info(f"      ‚úÖ Country: {country}")
            else:
                video_data["country"] = "N/A"
                log.warning("      ‚ö†Ô∏è Country –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä div.addel-info-item —Å 'Country/Region' –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 7. First seen (—Ñ–æ—Ä–º–∞—Ç "Oct 27 2025" - –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ "Oct 28 2025 ~ Nov 10 2025")
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞—Ç—ã First seen...")
            first_seen = await self._extract_first_seen()
            if first_seen:
                video_data["first_seen"] = first_seen
                log.info(f"      ‚úÖ First seen: {first_seen}")
            else:
                video_data["first_seen"] = "N/A"
                log.info("      ‚ö†Ô∏è First seen –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
            
            log.info(f"    ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ—á–µ–Ω—ã: impression={video_data['impression']}, first_seen={video_data['first_seen']}")
            return video_data
            
        except Exception as e:
            log.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö ad-search: {e}")
            return video_data
    
    async def _extract_impressions(self) -> Optional[str]:
        """
        –ò–∑–≤–ª–µ—á—å impressions - –ö–†–ò–¢–ò–ß–ù–û: –≤ —Ä–∞–∑–¥–µ–ª–µ "Data/–î–∞–Ω–Ω—ã–µ" –≤ –ø—É–Ω–∫—Ç–µ "Impression/–ü–æ–∫–∞–∑"
        –í–ê–ñ–ù–û: –ù–ï –±—Ä–∞—Ç—å —à–∞–±–ª–æ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã!
        
        Returns:
            –°—Ç—Ä–æ–∫–∞ —Å impressions (–Ω–∞–ø—Ä–∏–º–µ—Ä "170.6K", "339.9M") –∏–ª–∏ None
        """
        try:
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM (–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ)
            try:
                impression_data = await self.page.evaluate("""
                    () => {
                        // –ò—â–µ–º —Ä–∞–∑–¥–µ–ª "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                        const dataKeywords = ['Data', '–î–∞–Ω–Ω—ã–µ'];
                        const impressionKeywords = ['Impression', '–ü–æ–∫–∞–∑', '–ü–æ–∫–∞–∑—ã'];
                        
                        // –ò—â–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —ç–ª–µ–º–µ–Ω—Ç "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                            for (const dataKeyword of dataKeywords) {
                                if (text.includes(dataKeyword)) {
                                    // –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –∏—â–µ–º "Impression" –∏–ª–∏ "–ü–æ–∫–∞–∑"
                                    for (const impKeyword of impressionKeywords) {
                                        if (text.includes(impKeyword)) {
                                            // –ò—â–µ–º —á–∏—Å–ª–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "170.6K", "403.2M" –∏ —Ç.–¥.
                                            const patterns = [
                                                new RegExp(impKeyword + '[\\s:]*([\\d.,]+[KM]?)', 'i'),
                                                new RegExp('([\\d.,]+[KM]?)\\s*' + impKeyword, 'i')
                                            ];
                                            
                                            for (const pattern of patterns) {
                                                const match = text.match(pattern);
                                                if (match && match[1]) {
                                                    const value = match[1];
                                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ —á–∏—Å–ª–æ (–Ω–µ —à–∞–±–ª–æ–Ω–Ω–æ–µ)
                                                    // –û–±—ã—á–Ω–æ —Ä–µ–∞–ª—å–Ω—ã–µ impressions –æ—Ç 50K –¥–æ 500M
                                                    const numValue = parseFloat(value.replace(/[KM]/i, ''));
                                                    if (numValue >= 0.05 && numValue <= 1000) {
                                                        return value;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        
                        // Fallback: –∏—â–µ–º –Ω–∞–ø—Ä—è–º—É—é "Impression" –∏–ª–∏ "–ü–æ–∫–∞–∑" (–ù–ï "Likes"!)
                        for (const impKeyword of impressionKeywords) {
                            const elements = Array.from(document.querySelectorAll('*')).filter(el => {
                                const text = el.innerText || '';
                                return text.includes(impKeyword) && !text.toLowerCase().includes('likes') && !text.toLowerCase().includes('–Ω—Ä–∞–≤–∏—Ç—Å—è');
                            });
                            
                            for (const el of elements) {
                                const text = el.innerText || '';
                                const patterns = [
                                    new RegExp(impKeyword + '[\\s:]*([\\d.,]+[KM]?)', 'i'),
                                    new RegExp('([\\d.,]+[KM]?)\\s*' + impKeyword, 'i')
                                ];
                                
                                for (const pattern of patterns) {
                                    const match = text.match(pattern);
                                    if (match && match[1]) {
                                        const value = match[1];
                                        const numValue = parseFloat(value.replace(/[KM]/i, ''));
                                        if (numValue >= 0.05 && numValue <= 1000) {
                                            return value;
                                        }
                                    }
                                }
                            }
                        }
                        
                        return null;
                    }
                """)
                
                if impression_data:
                    log.debug(f"–ù–∞–π–¥–µ–Ω–æ impressions —á–µ—Ä–µ–∑ JavaScript: {impression_data}")
                    return impression_data
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ impressions —á–µ—Ä–µ–∑ JS: {e}")
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (fallback)
            data_keywords = ["Data", "–î–∞–Ω–Ω—ã–µ"]
            
            for keyword in data_keywords:
                try:
                    data_locator = self.page.locator(f'text=/{keyword}/i').first
                    if await data_locator.count() > 0:
                        impression_keywords = ["Impression", "–ü–æ–∫–∞–∑", "–ü–æ–∫–∞–∑—ã"]
                        for imp_keyword in impression_keywords:
                            try:
                                parent_text = await data_locator.locator("..").inner_text()
                                if imp_keyword in parent_text and "Likes" not in parent_text and "–ù—Ä–∞–≤–∏—Ç—Å—è" not in parent_text:
                                    pattern = rf'{imp_keyword}[:\s]*([\d.,]+[KM]?)'
                                    match = re.search(pattern, parent_text, re.IGNORECASE)
                                    if match:
                                        impression_str = match.group(1)
                                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —à–∞–±–ª–æ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                                        num_value = validator.parse_impressions(impression_str)
                                        if num_value and 50000 <= num_value <= 1000000000:  # –û—Ç 50K –¥–æ 1B
                                            log.debug(f"–ù–∞–π–¥–µ–Ω–æ impressions –≤ —Ä–∞–∑–¥–µ–ª–µ Data: {impression_str}")
                                            return impression_str
                            except:
                                continue
                except:
                    continue
            
            log.warning("–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ 'Impression' –∏–ª–∏ '–ü–æ–∫–∞–∑' –≤ —Ä–∞–∑–¥–µ–ª–µ Data")
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ impressions: {e}")
            return None
    
    async def _extract_script(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å —Å—Ü–µ–Ω–∞—Ä–∏–π –∏–∑ —Å–µ–∫—Ü–∏–∏ 'Script' –∏–ª–∏ '–°—Ü–µ–Ω–∞—Ä–∏–π' (–∏–ª–∏ 'Transcript' –∏–ª–∏ '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞')
        
        –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
        <li id="ai-script">
            <div class="li-title">...</div>
            <div class="control-content li-content">
                <p class="content-text slot-wrap">...</p>
            </div>
        </li>
        """
        try:
            # –ú–ï–¢–û–î 0: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä—É –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                # –°–Ω–∞—á–∞–ª–∞ –∂–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
                try:
                    await self.page.wait_for_selector('li#ai-script', timeout=5000, state="visible")
                except:
                    log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-script –Ω–µ –ø–æ—è–≤–∏–ª—Å—è –∑–∞ 5 —Å–µ–∫—É–Ω–¥")
                
                script_element = await self.page.query_selector('li#ai-script p.content-text')
                if script_element:
                    script = await script_element.inner_text()
                    if script and len(script.strip()) > 10:
                        log.info(f"      ‚úÖ Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-script p.content-text ({len(script)} —Å–∏–º–≤–æ–ª–æ–≤)")
                        return script.strip()
                else:
                    log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-script p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω")
            except Exception as e:
                log.debug(f"      ‚Üí –°–µ–ª–µ–∫—Ç–æ—Ä li#ai-script –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: {e}")
            
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
            script_keywords = ["Script", "–°—Ü–µ–Ω–∞—Ä–∏–π", "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞", "–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç"]
            
            for keyword in script_keywords:
                try:
                    # –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å —Ç–µ–∫—Å—Ç–æ–º
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            parent_text = await locator.locator("..").inner_text()
                            if keyword in parent_text:
                                parts = parent_text.split(keyword, 1)
                                if len(parts) > 1:
                                    script = parts[1].strip()
                                    # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –º–µ—Ç–∫–∏
                                    stop_words = ["Hook", "–•—É–∫", "Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", 
                                                "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", "Impressions", "–ü–æ–∫–∞–∑—ã",
                                                "Limited Time Offer", "Annual Plan", "Promotion Period", "50% OFF",
                                                "Privacy", "Terms", "Copyright", "PIPIADS", "All Rights Reserved",
                                                "AI-agent", "cosmobeauty", "credits", "subscription", "invoice",
                                                "Monthly Credits", "Extra Credits", "data cost", "detail costs",
                                                "Team Setting", "Affiliate Dashboard", "Logout"]
                                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                           "cosmobeauty", "credits", "subscription", "invoice", 
                                                           "Monthly Credits", "Extra Credits", "@gmail.com"]
                                    is_footer_menu = any(keyword in script for keyword in footer_menu_keywords)
                                    
                                    for stop_word in stop_words:
                                        if stop_word in script:
                                            script = script.split(stop_word)[0].strip()
                                    # –§–∏–ª—å—Ç—Ä—É–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (Video Text Translator, Quality, Size –∏ —Ç.–¥.)
                                    metadata_keywords = ["Video Text Translator", "Translator", "Quality", "Size", "Resolution", 
                                                        "Width", "Height", "Duration", "Format", "Codec", "Frame Rate"]
                                    is_metadata = any(keyword in script for keyword in metadata_keywords)
                                    
                                    # –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                    lines = script.split('\n')
                                    cleaned_lines = []
                                    skip_words = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook']
                                    for line in lines:
                                        line = line.strip()
                                        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                        if line and not line.startswith('#') and not any(skip in line for skip in skip_words):
                                            cleaned_lines.append(line)
                                    script = '\n'.join(cleaned_lines).strip()
                                    
                                    if script and len(script) > 10 and not is_footer_menu and not is_metadata:
                                        log.debug(f"Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Ä–æ–¥–∏—Ç–µ–ª—å)")
                                        return script
                        except:
                            pass
                        
                        # –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            next_sibling = await locator.evaluate_handle("el => el.nextElementSibling")
                            if next_sibling:
                                script = await next_sibling.as_element().inner_text()
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                       "cosmobeauty", "credits", "subscription", "invoice", 
                                                       "Monthly Credits", "Extra Credits", "@gmail.com"]
                                is_footer_menu = any(keyword in script for keyword in footer_menu_keywords)
                                # –§–∏–ª—å—Ç—Ä—É–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                metadata_keywords = ["Video Text Translator", "Translator", "Quality", "Size", "Resolution"]
                                is_metadata = any(keyword in script for keyword in metadata_keywords)
                                
                                # –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                lines = script.split('\n')
                                cleaned_lines = []
                                skip_words = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook']
                                for line in lines:
                                    line = line.strip()
                                    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                    if line and not line.startswith('#') and not any(skip in line for skip in skip_words):
                                        cleaned_lines.append(line)
                                script = '\n'.join(cleaned_lines).strip()
                                
                                if script and len(script) > 10 and not is_footer_menu and not is_metadata:
                                    log.debug(f"Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç)")
                                    return script.strip()
                        except:
                            pass
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                script = await self.page.evaluate("""
                    () => {
                        const keywords = ['Script', '–°—Ü–µ–Ω–∞—Ä–∏–π', 'Transcript', '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞', '–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç'];
                        const stopWords = ['Hook', '–•—É–∫', 'Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 
                                          'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 'Impressions', '–ü–æ–∫–∞–∑—ã',
                                          'Analysis', 'Advertiser', 'Display Name', 'Ad Copy',
                                          'Limited Time Offer', 'Annual Plan', 'Promotion Period', '50% OFF'];
                        
                        // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    // –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ (–æ–±—ã—á–Ω–æ —ç—Ç–æ —Å–∞–º script)
                                    let scriptText = null;
                                    
                                    // –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ sibling —ç–ª–µ–º–µ–Ω—Ç–∞
                                    let nextSibling = el.nextElementSibling;
                                    if (nextSibling) {
                                        scriptText = nextSibling.innerText || '';
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    if (!scriptText || scriptText.length < 10) {
                                        const parentText = el.parentElement ? el.parentElement.innerText || '' : '';
                                        if (parentText.includes(keyword)) {
                                            const parts = parentText.split(keyword);
                                            if (parts.length > 1) {
                                                scriptText = parts[1].trim();
                                            }
                                        }
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 3: –ò—â–µ–º –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö (–æ–±—ã—á–Ω–æ script –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –±–ª–æ–∫–µ)
                                    if (!scriptText || scriptText.length < 10) {
                                        const children = el.querySelectorAll('p, div, span');
                                        for (const child of children) {
                                            const childText = child.innerText || '';
                                            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç—ã
                                            if (childText.length > 20 && 
                                                !childText.includes('Advertiser') && 
                                                !childText.includes('Display Name') &&
                                                !childText.includes('Analysis') &&
                                                !childText.includes('Generator') &&
                                                !childText.includes('Limited Time Offer') &&
                                                !childText.includes('Annual Plan') &&
                                                !childText.includes('Promotion Period') &&
                                                !childText.includes('50% OFF')) {
                                                scriptText = childText;
                                                break;
                                            }
                                        }
                                    }
                                    
                                    if (scriptText) {
                                        // –£–±–∏—Ä–∞–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                        for (const stopWord of stopWords) {
                                            if (scriptText.includes(stopWord)) {
                                                scriptText = scriptText.split(stopWord)[0];
                                            }
                                        }
                                        
                                        scriptText = scriptText.trim();
                                        
                                        // –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                        const skipWords = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook'];
                                        const lines = scriptText.split('\\n');
                                        const cleanedLines = [];
                                        for (const line of lines) {
                                            const trimmedLine = line.trim();
                                            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                            if (trimmedLine && !trimmedLine.startsWith('#') && 
                                                !skipWords.some(word => trimmedLine.includes(word))) {
                                                cleanedLines.push(trimmedLine);
                                            }
                                        }
                                        scriptText = cleanedLines.join('\\n').trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π script (–Ω–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –Ω–µ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç, –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é)
                                        const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                                   'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                                   'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                                   'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                                   'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                        const isFooterMenu = footerMenuKeywords.some(keyword => scriptText.includes(keyword));
                                        
                                        // –§–∏–ª—å—Ç—Ä—É–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                    const metadataKeywords = ['Video Text Translator', 'Translator', 'Quality', 'Size', 'Resolution', 
                                                             'Width', 'Height', 'Duration', 'Format', 'Codec', 'Frame Rate'];
                                    const isMetadata = metadataKeywords.some(keyword => scriptText.includes(keyword));
                                    
                                    if (scriptText && scriptText.length > 20 && 
                                            !scriptText.startsWith('Analysis') &&
                                            !scriptText.includes('shop.tiktok.com') &&
                                            !scriptText.includes('Generator Image') &&
                                            !scriptText.includes('Limited Time Offer') &&
                                            !scriptText.includes('Annual Plan') &&
                                            !scriptText.includes('Promotion Period') &&
                                            !scriptText.includes('50% OFF') &&
                                            !scriptText.toLowerCase().includes('q4') &&
                                            !scriptText.toLowerCase().includes('monthly plan') &&
                                            !isFooterMenu &&
                                            !isMetadata) {
                                            return scriptText;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if script and len(script) > 10:
                    log.debug("Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript")
                    return script.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ script —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è: {e}")
            return None
    
    async def _extract_hook(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å hook –∏–∑ —Å–µ–∫—Ü–∏–∏ Hook/Hooks (–∞–Ω–≥–ª.) –∏–ª–∏ –•—É–∫/–•—É–∫–∏ (—Ä—É—Å.)
        –í–ê–ñ–ù–û: Hook –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ Script –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ!
        
        –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
        <li id="ai-hook">
            <div class="li-title">...</div>
            <div class="control-content li-content">
                <p class="content-text slot-wrap">...</p>
            </div>
        </li>
        """
        try:
            # –ú–ï–¢–û–î 0: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä—É –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                # –°–Ω–∞—á–∞–ª–∞ –∂–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
                try:
                    await self.page.wait_for_selector('li#ai-hook', timeout=5000, state="visible")
                except:
                    log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-hook –Ω–µ –ø–æ—è–≤–∏–ª—Å—è –∑–∞ 5 —Å–µ–∫—É–Ω–¥")
                
                hook_element = await self.page.query_selector('li#ai-hook p.content-text')
                if hook_element:
                    hook = await hook_element.inner_text()
                    if hook and len(hook.strip()) > 5:
                        log.info(f"      ‚úÖ Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook p.content-text ({len(hook)} —Å–∏–º–≤–æ–ª–æ–≤)")
                        return hook.strip()
                else:
                    log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-hook p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω")
            except Exception as e:
                log.debug(f"      ‚Üí –°–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: {e}")
            
            # –ù–û–í–´–ô –ú–ï–¢–û–î: –ò—â–µ–º Script, –∑–∞—Ç–µ–º –∏—â–µ–º Hook –≤ —Å–ª–µ–¥—É—é—â–µ–º —ç–ª–µ–º–µ–Ω—Ç–µ/—Å–µ–∫—Ü–∏–∏
            try:
                # –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏–º Script
                script_keywords = ["Script", "–°—Ü–µ–Ω–∞—Ä–∏–π", "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞"]
                for script_keyword in script_keywords:
                    try:
                        script_locator = self.page.locator(f'text=/{script_keyword}/i').first
                        if await script_locator.count() > 0:
                            # –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ Script, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç "Hook" –∏–ª–∏ "Hooks"
                            # –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ –ø–æ—Å–ª–µ Script
                            try:
                                # –°–ø–æ—Å–æ–± 1: –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å "Hook" –∏–ª–∏ "Hooks" –ø–æ—Å–ª–µ Script
                                parent = script_locator.locator("..")
                                parent_text = await parent.inner_text()
                                
                                # –ò—â–µ–º "Hook" –∏–ª–∏ "Hooks" –≤ —Ç–æ–º –∂–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ
                                if "Hook" in parent_text or "Hooks" in parent_text or "–•—É–∫" in parent_text or "–•—É–∫–∏" in parent_text:
                                    # –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é Script –∏ Hook –≤ —Ç–µ–∫—Å—Ç–µ
                                    script_pos = parent_text.find(script_keyword)
                                    hook_pos = -1
                                    for hook_word in ["Hook", "Hooks", "–•—É–∫", "–•—É–∫–∏"]:
                                        pos = parent_text.find(hook_word, script_pos)
                                        if pos > script_pos:
                                            hook_pos = pos
                                            break
                                    
                                    if hook_pos > script_pos:
                                        # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ "Hook" –∏–ª–∏ "Hooks"
                                        hook_section = parent_text[hook_pos:]
                                        # –£–±–∏—Ä–∞–µ–º "Hook" –∏–ª–∏ "Hooks" –∏–∑ –Ω–∞—á–∞–ª–∞
                                        hook_section = re.sub(r'^Hooks?\s*:?\s*', '', hook_section, flags=re.IGNORECASE)
                                        hook_section = re.sub(r'^–•—É–∫–∏?\s*:?\s*', '', hook_section, flags=re.IGNORECASE)
                                        hook_text = hook_section.strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏ (Target Audience, First seen –∏ —Ç.–¥.)
                                        stop_words = ["Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", 
                                                    "Impressions", "–ü–æ–∫–∞–∑—ã", "Country", "–°—Ç—Ä–∞–Ω–∞", "Country/Region", "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω"]
                                        for stop_word in stop_words:
                                            if stop_word in hook_text:
                                                hook_text = hook_text.split(stop_word)[0].strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                        hook_text = re.sub(r'Quality\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'Size\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'Resolution\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'--', '', hook_text)
                                        hook_text = re.sub(r'\n{2,}', '\n', hook_text).strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞ –≤ –Ω–∞—á–∞–ª–µ
                                        hook_text = re.sub(r'^(Tags|Script|Hooks?)\s*:?\s*', '', hook_text, flags=re.IGNORECASE)
                                        
                                        if hook_text and len(hook_text) > 5 and len(hook_text) < 500:
                                            log.debug(f"Hook –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ Script —á–µ—Ä–µ–∑ '{script_keyword}'")
                                            return hook_text
                            except:
                                pass
                            
                            # –°–ø–æ—Å–æ–± 2: –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π sibling —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ Script
                            try:
                                script_element = await script_locator.element_handle()
                                if script_element:
                                    # –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å —Ç–µ–∫—Å—Ç–æ–º "Hook" –∏–ª–∏ "Hooks"
                                    next_elements = await self.page.evaluate("""
                                        (scriptEl) => {
                                            let current = scriptEl;
                                            // –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å "Hook" –∏–ª–∏ "Hooks"
                                            for (let i = 0; i < 10; i++) {
                                                current = current.nextElementSibling;
                                                if (!current) break;
                                                const text = current.innerText || '';
                                                if (text.includes('Hook') || text.includes('Hooks') || 
                                                    text.includes('–•—É–∫') || text.includes('–•—É–∫–∏')) {
                                                    // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ "Hook" –∏–ª–∏ "Hooks"
                                                    const parts = text.split(/Hooks?\\s*:?\\s*|–•—É–∫–∏?\\s*:?\\s*/i);
                                                    if (parts.length > 1) {
                                                        let hookText = parts[1].trim();
                                                        // –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏
                                                        const stopWords = ['Target Audience', 'First seen', 'Impressions', 'Country'];
                                                        for (const stop of stopWords) {
                                                            if (hookText.includes(stop)) {
                                                                hookText = hookText.split(stop)[0];
                                                            }
                                                        }
                                                        hookText = hookText.replace(/Quality\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/Size\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/Resolution\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/--/g, '');
                                                        hookText = hookText.replace(/\\n{2,}/g, '\\n').trim();
                                                        if (hookText && hookText.length > 5 && hookText.length < 500) {
                                                            return hookText;
                                                        }
                                                    }
                                                }
                                            }
                                            return null;
                                        }
                                    """, script_element)
                                    
                                    if next_elements:
                                        log.debug(f"Hook –Ω–∞–π–¥–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–º —ç–ª–µ–º–µ–Ω—Ç–µ –ø–æ—Å–ª–µ Script")
                                        return next_elements
                            except:
                                pass
                            
                            # –°–ø–æ—Å–æ–± 3: –ò—â–µ–º Hook –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –ø–æ—Å–ª–µ Script
                            try:
                                # –ü–æ–ª—É—á–∞–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –∏—â–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω "Script...Hook"
                                page_text = await self.page.content()
                                # –ò—â–µ–º —á–µ—Ä–µ–∑ JavaScript –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ
                                hook_text = await self.page.evaluate("""
                                    () => {
                                        // –ò—â–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Script"
                                        const allElements = Array.from(document.querySelectorAll('*'));
                                        for (const el of allElements) {
                                            const text = el.innerText || '';
                                            if (text.includes('Script') || text.includes('–°—Ü–µ–Ω–∞—Ä–∏–π')) {
                                                // –ò—â–µ–º –≤ —ç—Ç–æ–º –∂–µ —ç–ª–µ–º–µ–Ω—Ç–µ –∏–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º "Hook" –∏–ª–∏ "Hooks"
                                                let searchEl = el;
                                                for (let depth = 0; depth < 3; depth++) {
                                                    const searchText = searchEl.innerText || '';
                                                    if (searchText.includes('Hook') || searchText.includes('Hooks') || 
                                                        searchText.includes('–•—É–∫') || searchText.includes('–•—É–∫–∏')) {
                                                        // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –º–µ–∂–¥—É Script –∏ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Å–µ–∫—Ü–∏—è–º–∏
                                                        const scriptIndex = searchText.indexOf('Script');
                                                        const hookIndex = searchText.indexOf('Hook', scriptIndex);
                                                        if (hookIndex > scriptIndex) {
                                                            let hookText = searchText.substring(hookIndex);
                                                            // –£–±–∏—Ä–∞–µ–º "Hook" –∏–ª–∏ "Hooks" –∏–∑ –Ω–∞—á–∞–ª–∞
                                                            hookText = hookText.replace(/^Hooks?\\s*:?\\s*/i, '');
                                                            hookText = hookText.replace(/^–•—É–∫–∏?\\s*:?\\s*/i, '');
                                                            // –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏
                                                            const stopWords = ['Target Audience', 'First seen', 'Impressions', 'Country'];
                                                            for (const stop of stopWords) {
                                                                if (hookText.includes(stop)) {
                                                                    hookText = hookText.split(stop)[0];
                                                                }
                                                            }
                                                            hookText = hookText.replace(/Quality\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/Size\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/Resolution\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/--/g, '');
                                                            hookText = hookText.replace(/\\n{2,}/g, '\\n').trim();
                                                            if (hookText && hookText.length > 5 && hookText.length < 500) {
                                                                return hookText;
                                                            }
                                                        }
                                                    }
                                                    searchEl = searchEl.parentElement;
                                                    if (!searchEl) break;
                                                }
                                            }
                                        }
                                        return null;
                                    }
                                """)
                                
                                if hook_text:
                                    log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ—Å–ª–µ Script")
                                    return hook_text
                            except:
                                pass
                    except:
                        continue
            except:
                pass
            
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (—Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±, –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ fallback)
            hook_keywords = ["Hooks", "Hook", "–•—É–∫–∏", "–•—É–∫"]
            
            for keyword in hook_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            parent_text = await locator.locator("..").inner_text()
                            if keyword in parent_text:
                                parts = parent_text.split(keyword, 1)
                                if len(parts) > 1:
                                    hook = parts[1].strip()
                                    # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –º–µ—Ç–∫–∏
                                    stop_words = ["Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", 
                                                "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞", "Impressions", "–ü–æ–∫–∞–∑—ã",
                                                "Limited Time Offer", "Annual Plan", "Promotion Period", "50% OFF",
                                                "Privacy", "Terms", "Copyright", "PIPIADS", "All Rights Reserved",
                                                "AI-agent", "cosmobeauty", "credits", "subscription", "invoice",
                                                "Monthly Credits", "Extra Credits", "data cost", "detail costs",
                                                "Team Setting", "Affiliate Dashboard", "Logout"]
                                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                           "cosmobeauty", "credits", "subscription", "invoice", 
                                                           "Monthly Credits", "Extra Credits", "@gmail.com"]
                                    is_footer_menu = any(keyword in hook for keyword in footer_menu_keywords)
                                    
                                    for stop_word in stop_words:
                                        if stop_word in hook:
                                            hook = hook.split(stop_word)[0].strip()
                                    
                                    # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                    metadata_patterns = [
                                        r'Quality\s*:?\s*[^\n]*',
                                        r'Size\s*:?\s*[^\n]*',
                                        r'Resolution\s*:?\s*[^\n]*',
                                        r'Width\s*:?\s*[^\n]*',
                                        r'Height\s*:?\s*[^\n]*',
                                        r'Duration\s*:?\s*[^\n]*',
                                        r'Format\s*:?\s*[^\n]*',
                                        r'Codec\s*:?\s*[^\n]*',
                                        r'Frame Rate\s*:?\s*[^\n]*',
                                        r'--',  # –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                    ]
                                    for pattern in metadata_patterns:
                                        hook = re.sub(pattern, '', hook, flags=re.IGNORECASE)
                                    hook = re.sub(r'\n{2,}', '\n', hook).strip()  # –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                    
                                    if hook and len(hook) > 5 and not is_footer_menu:
                                        log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Ä–æ–¥–∏—Ç–µ–ª—å)")
                                        return hook
                        except:
                            pass
                        
                        # –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            next_sibling = await locator.evaluate_handle("el => el.nextElementSibling")
                            if next_sibling:
                                hook = await next_sibling.as_element().inner_text()
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                       "cosmobeauty", "credits", "subscription", "invoice", 
                                                       "Monthly Credits", "Extra Credits", "@gmail.com"]
                                is_footer_menu = any(keyword in hook for keyword in footer_menu_keywords)
                                
                                # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                metadata_patterns = [
                                    r'Quality\s*:?\s*[^\n]*',
                                    r'Size\s*:?\s*[^\n]*',
                                    r'Resolution\s*:?\s*[^\n]*',
                                    r'Width\s*:?\s*[^\n]*',
                                    r'Height\s*:?\s*[^\n]*',
                                    r'Duration\s*:?\s*[^\n]*',
                                    r'Format\s*:?\s*[^\n]*',
                                    r'Codec\s*:?\s*[^\n]*',
                                    r'Frame Rate\s*:?\s*[^\n]*',
                                    r'--',  # –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                ]
                                for pattern in metadata_patterns:
                                    hook = re.sub(pattern, '', hook, flags=re.IGNORECASE)
                                hook = re.sub(r'\n{2,}', '\n', hook).strip()  # –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                
                                if hook and len(hook) > 5 and not is_footer_menu:
                                    log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç)")
                                    return hook.strip()
                        except:
                            pass
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                hook = await self.page.evaluate("""
                    () => {
                        const keywords = ['Hooks', 'Hook', '–•—É–∫–∏', '–•—É–∫'];
                        const stopWords = ['Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 
                                         'Transcript', '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞', 'Impressions', '–ü–æ–∫–∞–∑—ã',
                                         'Script', '–°—Ü–µ–Ω–∞—Ä–∏–π', 'Analysis',
                                         'Limited Time Offer', 'Annual Plan', 'Promotion Period', '50% OFF'];
                        
                        // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    let hookText = null;
                                    
                                    // –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ sibling —ç–ª–µ–º–µ–Ω—Ç–∞
                                    let nextSibling = el.nextElementSibling;
                                    if (nextSibling) {
                                        hookText = nextSibling.innerText || '';
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    if (!hookText || hookText.length < 5) {
                                        const parentText = el.parentElement ? el.parentElement.innerText || '' : '';
                                        if (parentText.includes(keyword)) {
                                            const parts = parentText.split(keyword);
                                            if (parts.length > 1) {
                                                hookText = parts[1].trim();
                                            }
                                        }
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 3: –ò—â–µ–º –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö
                                    if (!hookText || hookText.length < 5) {
                                        const children = el.querySelectorAll('p, div, span');
                                        for (const child of children) {
                                            const childText = child.innerText || '';
                                            if (childText.length > 5 && childText.length < 200) {
                                                hookText = childText;
                                                break;
                                            }
                                        }
                                    }
                                    
                                    if (hookText) {
                                        // –£–±–∏—Ä–∞–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞
                                        for (const stopWord of stopWords) {
                                            if (hookText.includes(stopWord)) {
                                                hookText = hookText.split(stopWord)[0];
                                            }
                                        }
                                        
                                        hookText = hookText.trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π hook (–∫–æ—Ä–æ—Ç–∫–∞—è —Ñ—Ä–∞–∑–∞, –Ω–µ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç, –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é)
                                        const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                                   'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                                   'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                                   'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                                   'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                        const isFooterMenu = footerMenuKeywords.some(keyword => hookText.includes(keyword));
                                        
                                        // –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                        const metadataPatterns = [
                                            /Quality\s*:?\s*[^\n]*/gi,
                                            /Size\s*:?\s*[^\n]*/gi,
                                            /Resolution\s*:?\s*[^\n]*/gi,
                                            /Width\s*:?\s*[^\n]*/gi,
                                            /Height\s*:?\s*[^\n]*/gi,
                                            /Duration\s*:?\s*[^\n]*/gi,
                                            /Format\s*:?\s*[^\n]*/gi,
                                            /Codec\s*:?\s*[^\n]*/gi,
                                            /Frame Rate\s*:?\s*[^\n]*/gi,
                                            /--/g,  // –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                        ];
                                        let cleanedHook = hookText;
                                        for (const pattern of metadataPatterns) {
                                            cleanedHook = cleanedHook.replace(pattern, '');
                                        }
                                        cleanedHook = cleanedHook.replace(/\n{2,}/g, '\n').trim();  // –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                        
                                        if (cleanedHook && cleanedHook.length > 5 && cleanedHook.length < 300 &&
                                            !cleanedHook.includes('Limited Time Offer') &&
                                            !cleanedHook.includes('Annual Plan') &&
                                            !cleanedHook.includes('Promotion Period') &&
                                            !cleanedHook.includes('50% OFF') &&
                                            !cleanedHook.toLowerCase().includes('q4') &&
                                            !cleanedHook.toLowerCase().includes('monthly plan') &&
                                            !isFooterMenu) {
                                            return cleanedHook;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if hook and len(hook) > 5:
                    log.debug("Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript")
                    return hook.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ hook —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ hook: {e}")
            return None
    
    async def _extract_audience(self) -> Optional[Dict[str, str]]:
        """
        –ò–∑–≤–ª–µ—á—å –≤–æ–∑—Ä–∞—Å—Ç –∏–∑ –ø–æ–ª—è Audience
        
        –°—Ç—Ä—É–∫—Ç—É—Ä–∞ HTML:
        <div class="addel-info-item">
            <div class="name"> Audience </div>
            <div class="value">
                <div class="audience-info">
                    <div class="audience-info-info">45-55 ... Android...</div>
                </div>
            </div>
        </div>
        """
        try:
            audience_data = {"age": "N/A", "platform": "N/A"}
            
            # –ú–ï–¢–û–î 1: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                # –ò—â–µ–º –±–ª–æ–∫ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "Audience"
                audience_items = await self.page.query_selector_all('div.addel-info-item')
                
                for item in audience_items:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å Audience
                    name_elem = await item.query_selector('div.name')
                    if name_elem:
                        name_text = await name_elem.inner_text()
                        if 'Audience' in name_text or '–ê—É–¥–∏—Ç–æ—Ä–∏—è' in name_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ audience-info-info
                            audience_info = await item.query_selector('div.audience-info-info')
                            if audience_info:
                                text = await audience_info.inner_text()
                                # –ò–∑–≤–ª–µ–∫–∞–µ–º –≤–æ–∑—Ä–∞—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ "45-55" (–º–æ–∂–µ—Ç –±—ã—Ç—å 2 —Ü–∏—Ñ—Ä—ã)
                                age_match = re.search(r'(\d{1,2}-\d{1,2})', text)
                                if age_match:
                                    audience_data["age"] = age_match.group(1)
                                    log.debug(f"      ‚Üí Audience age –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä: {audience_data['age']}")
                                    return audience_data
            except Exception as e:
                log.debug(f"      ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–º –ø–æ–∏—Å–∫–µ audience: {e}")
            
            # –ú–ï–¢–û–î 2: Fallback —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (–µ—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª)
            audience_keywords = ["Audience", "–ê—É–¥–∏—Ç–æ—Ä–∏—è", "Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è"]
            
            for keyword in audience_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç –∞—É–¥–∏—Ç–æ—Ä–∏–∏ —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º –≤–æ–∑—Ä–∞—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ "25-35" –∏–ª–∏ "45-55"
                        age_patterns = [
                            r'–í–æ–∑—Ä–∞—Å—Ç[:\s]+(\d{1,2}-\d{1,2})',
                            r'Age[:\s]+(\d{1,2}-\d{1,2})',
                            r'(\d{1,2}-\d{1,2})',  # –ü—Ä–æ—Å—Ç–æ –≤–æ–∑—Ä–∞—Å—Ç
                        ]
                        
                        for pattern in age_patterns:
                            age_match = re.search(pattern, text, re.IGNORECASE)
                            if age_match:
                                audience_data["age"] = age_match.group(1)
                                log.debug(f"      ‚Üí Audience age –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä: {audience_data['age']}")
                                break
                        
                        if audience_data["age"] != "N/A":
                            return audience_data
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π)
            try:
                result = await self.page.evaluate("""
                    () => {
                        const keywords = ['Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 'Audience', '–ê—É–¥–∏—Ç–æ—Ä–∏—è'];
                        const agePattern = /(\\d{1,2}-\\d{1,2})/;
                        const platformKeywords = ['Android', 'iOS', 'iPhone', 'iPad'];
                        const countryKeywords = ['USA', 'US', 'United States', '–†–æ—Å—Å–∏—è', 'Russia', 'Philippines', 
                                                '–§–∏–ª–∏–ø–ø–∏–Ω—ã', 'China', '–ö–∏—Ç–∞–π', 'India', '–ò–Ω–¥–∏—è'];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    const result = {age: 'N/A', platform: 'N/A', country: 'N/A'};
                                    
                                    // –ò—â–µ–º –≤–æ–∑—Ä–∞—Å—Ç
                                    const ageMatch = text.match(agePattern);
                                    if (ageMatch) {
                                        result.age = ageMatch[1];
                                    }
                                    
                                    // –ò—â–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
                                    for (const platform of platformKeywords) {
                                        if (text.includes(platform)) {
                                            result.platform = (platform === 'iOS' || platform === 'iPhone' || platform === 'iPad') ? 'iOS' : 'Android';
                                            break;
                                        }
                                    }
                                    
                                    // –ò—â–µ–º —Å—Ç—Ä–∞–Ω—É
                                    for (const country of countryKeywords) {
                                        if (text.includes(country)) {
                                            result.country = country;
                                            break;
                                        }
                                    }
                                    
                                    if (result.age !== 'N/A' || result.platform !== 'N/A' || result.country !== 'N/A') {
                                        return result;
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if result:
                    audience_data.update(result)
                    return audience_data
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ audience —á–µ—Ä–µ–∑ JS: {e}")
            
            return audience_data
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–∏: {e}")
            return None
    
    async def _extract_country(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å —Å—Ç—Ä–∞–Ω—É –∏–∑ –ø–æ–ª—è 'Country/Region' –∏–ª–∏ '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω' (–û–¢–î–ï–õ–¨–ù–û –æ—Ç Audience!)"""
        try:
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            try:
                await self.page.wait_for_selector('div.addel-info-item', timeout=5000, state="visible")
            except:
                log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç—ã div.addel-info-item –Ω–µ –ø–æ—è–≤–∏–ª–∏—Å—å –∑–∞ 5 —Å–µ–∫—É–Ω–¥")
            
            country_keywords = ["Country/Region", "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω", "Country", "–°—Ç—Ä–∞–Ω–∞", "Region", "–†–µ–≥–∏–æ–Ω"]
            
            # –ú–ï–¢–û–î 0: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                country_items = await self.page.query_selector_all('div.addel-info-item')
                
                for item in country_items:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å Country/Region
                    name_elem = await item.query_selector('div.name')
                    if name_elem:
                        name_text = await name_elem.inner_text()
                        if 'Country/Region' in name_text or '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω' in name_text or 'Country' in name_text or '–°—Ç—Ä–∞–Ω–∞' in name_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º —Å—Ç—Ä–∞–Ω—É
                            value_elem = await item.query_selector('div.ellipsis, div.value')
                            if value_elem:
                                country_text = await value_elem.inner_text()
                                # –£–±–∏—Ä–∞–µ–º (1) –∏ —Ç.–¥.
                                country = re.sub(r'\([0-9]+\)', '', country_text).strip()
                                if country and len(country) > 0:
                                    log.info(f"      ‚úÖ Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä: {country}")
                                    return country
            except Exception as e:
                log.debug(f"      ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–º –ø–æ–∏—Å–∫–µ country: {e}")
            
            for keyword in country_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω—ã —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º —Å—Ç—Ä–∞–Ω—É (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫)
                        country_patterns = [
                            r'United States(?:\([0-9]+\))?',  # United States(1)
                            r'USA(?:\([0-9]+\))?',
                            r'US(?:\([0-9]+\))?',
                            r'Philippines(?:\([0-9]+\))?',
                            r'–§–∏–ª–∏–ø–ø–∏–Ω—ã(?:\([0-9]+\))?',
                            r'Russia(?:\([0-9]+\))?',
                            r'–†–æ—Å—Å–∏—è(?:\([0-9]+\))?',
                            r'China(?:\([0-9]+\))?',
                            r'–ö–∏—Ç–∞–π(?:\([0-9]+\))?',
                            r'India(?:\([0-9]+\))?',
                            r'–ò–Ω–¥–∏—è(?:\([0-9]+\))?',
                            r'Brazil(?:\([0-9]+\))?',
                            r'–ë—Ä–∞–∑–∏–ª–∏—è(?:\([0-9]+\))?',
                            r'Germany(?:\([0-9]+\))?',
                            r'–ì–µ—Ä–º–∞–Ω–∏—è(?:\([0-9]+\))?',
                            r'France(?:\([0-9]+\))?',
                            r'–§—Ä–∞–Ω—Ü–∏—è(?:\([0-9]+\))?',
                            r'UK(?:\([0-9]+\))?',
                            r'United Kingdom(?:\([0-9]+\))?',
                        ]
                        
                        for pattern in country_patterns:
                            match = re.search(pattern, text, re.IGNORECASE)
                            if match:
                                country = match.group(0)
                                # –£–±–∏—Ä–∞–µ–º (1) –∏ —Ç.–¥.
                                country = re.sub(r'\([0-9]+\)', '', country).strip()
                                log.debug(f"Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}': {country}")
                                return country
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript
            try:
                country = await self.page.evaluate("""
                    () => {
                        const keywords = ['Country/Region', '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω', 'Country', '–°—Ç—Ä–∞–Ω–∞'];
                        const countryPatterns = [
                            /United States(?:\\([0-9]+\\))?/i,
                            /USA(?:\\([0-9]+\\))?/i,
                            /Philippines(?:\\([0-9]+\\))?/i,
                            /Russia(?:\\([0-9]+\\))?/i,
                            /China(?:\\([0-9]+\\))?/i,
                            /India(?:\\([0-9]+\\))?/i
                        ];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    for (const pattern of countryPatterns) {
                                        const match = text.match(pattern);
                                        if (match) {
                                            return match[0].replace(/\\([0-9]+\\)/g, '').trim();
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if country:
                    log.debug(f"Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript: {country}")
                    return country.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ country —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ country: {e}")
            return None
    
    async def _extract_first_seen(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å First seen –≤ —Ñ–æ—Ä–º–∞—Ç–µ 'Oct 27 2025' - —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ 'Oct 28 2025 ~ Nov 10 2025'"""
        try:
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã
            first_seen_keywords = ["First seen - Last seen", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", "First Seen"]
            
            for keyword in first_seen_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç –¥–∞—Ç—ã —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ "Oct 27 2025" –∏–ª–∏ "Oct 27, 2025"
                        # –ò—â–µ–º –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ "Oct 28 2025 ~ Nov 10 2025"
                        date_patterns = [
                            r'([A-Z][a-z]{2}\s+\d{1,2}\s+\d{4})',  # Oct 27 2025
                            r'([A-Z][a-z]{2}\s+\d{1,2},\s+\d{4})',  # Oct 27, 2025
                            r'(\d{1,2}\s+[A-Z][a-z]{2}\s+\d{4})',  # 27 Oct 2025
                        ]
                        
                        for pattern in date_patterns:
                            # –ò—â–µ–º –ø–µ—Ä–≤—É—é –¥–∞—Ç—É (–¥–æ ~ –∏–ª–∏ –∫–æ–Ω—Ü–∞ —Å—Ç—Ä–æ–∫–∏)
                            date_match = re.search(pattern, text)
                            if date_match:
                                date_str = date_match.group(1)
                                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ñ–æ—Ä–º–∞—Ç (—É–±–∏—Ä–∞–µ–º –∑–∞–ø—è—Ç—É—é –µ—Å–ª–∏ –µ—Å—Ç—å)
                                date_str = date_str.replace(',', '').strip()
                                log.debug(f"First seen –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}': {date_str}")
                                return date_str
                        
                        # –¢–∞–∫–∂–µ –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –¥–∞—Ç—É –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
                        if keyword in text:
                            parts = text.split(keyword, 1)
                            if len(parts) > 1:
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–æ ~ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω)
                                after_keyword = parts[1].split('~')[0].strip()
                                for pattern in date_patterns:
                                    date_match = re.search(pattern, after_keyword)
                                    if date_match:
                                        date_str = date_match.group(1).replace(',', '').strip()
                                        log.debug(f"First seen –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ '{keyword}': {date_str}")
                                        return date_str
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                first_seen = await self.page.evaluate("""
                    () => {
                        const keywords = ['First seen - Last seen', 'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 'First Seen'];
                        const datePatterns = [
                            /([A-Z][a-z]{2}\\s+\\d{1,2}\\s+\\d{4})/,  // Oct 27 2025
                            /([A-Z][a-z]{2}\\s+\\d{1,2},\\s+\\d{4})/,  // Oct 27, 2025
                            /(\\d{1,2}\\s+[A-Z][a-z]{2}\\s+\\d{4})/   // 27 Oct 2025
                        ];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    // –ò—â–µ–º –¥–∞—Ç—É –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    const index = text.indexOf(keyword);
                                    let afterKeyword = text.substring(index + keyword.length);
                                    
                                    // –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–æ ~ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω)
                                    if (afterKeyword.includes('~')) {
                                        afterKeyword = afterKeyword.split('~')[0];
                                    }
                                    
                                    for (const pattern of datePatterns) {
                                        const match = afterKeyword.match(pattern);
                                        if (match) {
                                            const dateStr = match[1].replace(',', '').trim();
                                            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤—É—é –Ω–∞–π–¥–µ–Ω–Ω—É—é –¥–∞—Ç—É (–±–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫ - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç –≤ _filter_videos)
                                            return dateStr;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if first_seen:
                    log.debug(f"First seen –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript: {first_seen}")
                    return first_seen.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ first_seen —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ first_seen: {e}")
            return None


```

```python
"""
Parser Engine - –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö —Å Pipiads
"""

import asyncio
import re
import time
from typing import List, Dict, Optional, Any
from datetime import datetime

from playwright.async_api import Page, TimeoutError as PlaywrightTimeoutError

from . import config
from . import logger
from . import validator

log = logger.get_logger("ParserEngine")


class ProductData:
    """–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞"""
    def __init__(self):
        self.product_name: str = ""
        self.category: str = ""
        self.pipiads_link: str = ""
        self.videos: List[Dict[str, Any]] = []


class ParserEngine:
    """–ü–∞—Ä—Å–µ—Ä –¥–∞–Ω–Ω—ã—Ö —Å Pipiads"""
    
    def __init__(self, page: Page):
        self.page = page
        self.browser_manager = None  # –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ human_delay
    
    def set_browser_manager(self, browser_manager):
        """–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ browser_manager –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è human_delay"""
        self.browser_manager = browser_manager
    
    async def human_delay(self, min_seconds: float = 1, max_seconds: float = 3):
        """–ò–º–∏—Ç–∞—Ü–∏—è —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏"""
        if self.browser_manager:
            await self.browser_manager.human_delay(min_seconds, max_seconds)
        else:
            delay = asyncio.sleep(1)  # Fallback
            await delay
    
    async def scroll_to_element(self, selector: str, timeout: int = 10000):
        """
        –°–∫—Ä–æ–ª–ª–∏—Ç—å –¥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
        
        Args:
            selector: –°–µ–ª–µ–∫—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞
            timeout: –¢–∞–π–º–∞—É—Ç –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
        """
        try:
            element = await self.page.wait_for_selector(selector, timeout=timeout, state="visible")
            if element:
                await element.scroll_into_view_if_needed()
                await self.human_delay(0.5, 1)
                return True
        except:
            pass
        return False
    
    async def get_products_from_search_page(self, count: int = 3) -> List[Dict[str, str]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞
        
        Args:
            count: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ (–¥–ª—è MVP-0: 1, –ø–æ—Ç–æ–º —Ä–∞—Å—à–∏—Ä–∏–º –¥–æ 3)
        
        Returns:
            –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–æ–≤: [{"name": "...", "category": "...", "url": "..."}]
        """
        log.info(f"–ü–æ–ª—É—á–µ–Ω–∏–µ {count} —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞...")
        
        try:
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (domcontentloaded –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º networkidle)
            await self.page.wait_for_load_state("domcontentloaded")
            await self.human_delay(2, 3)
            
            # –°–∫—Ä–æ–ª–ª–∏–º –≤–Ω–∏–∑, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
            log.info("–°–∫—Ä–æ–ª–ª–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤...")
            for i in range(3):  # –°–∫—Ä–æ–ª–ª–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
                await self.page.evaluate("window.scrollBy(0, 500)")
                await self.human_delay(1, 2)
            
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤
            await self.human_delay(2, 3)
            
            # –ò—â–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ - –ø—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
            product_selectors = [
                'a[href*="/tiktok-shop-product/"]',
                '[class*="product"]',
                '[class*="card"]',
                'div[class*="item"]',
            ]
            
            products = []
            product_ids = set()  # –î–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ product_id
            
            def extract_product_id(url: str) -> str:
                """–ò–∑–≤–ª–µ—á—å product_id –∏–∑ URL"""
                # https://www.pipiads.com/tiktok-shop-product/1729732622305364547/
                # ‚Üí 1729732622305364547
                url_normalized = url.rstrip('/')
                parts = url_normalized.split('/')
                return parts[-1] if parts else ""
            
            for selector in product_selectors:
                try:
                    elements = await self.page.query_selector_all(selector)
                    log.info(f"üîç –ù–∞–π–¥–µ–Ω–æ {len(elements)} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º '{selector}'")
                    
                    for element in elements:
                        if len(products) >= count:
                            break
                        
                        try:
                            # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É
                            href = await element.get_attribute("href")
                            if not href:
                                # –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ —Å—Å—ã–ª–∫–∞, –∏—â–µ–º —Å—Å—ã–ª–∫—É –≤–Ω—É—Ç—Ä–∏
                                link_element = await element.query_selector('a[href*="/tiktok-shop-product/"]')
                                if link_element:
                                    href = await link_element.get_attribute("href")
                            
                            if href and "/tiktok-shop-product/" in href:
                                # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π URL
                                if href.startswith("/"):
                                    url = f"https://www.pipiads.com{href}"
                                elif href.startswith("http"):
                                    url = href
                                else:
                                    url = f"https://www.pipiads.com/{href}"
                                
                                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º URL (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ)
                                url = url.rstrip('/')
                                
                                # –ò–∑–≤–ª–µ–∫–∞–µ–º product_id –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
                                product_id = extract_product_id(url)
                                
                                if not product_id:
                                    log.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å product_id –∏–∑ URL: {url}")
                                    continue
                                
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä (–ø–æ product_id)
                                if product_id in product_ids:
                                    log.info(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id={product_id}): {url}")
                                    continue
                                
                                product_ids.add(product_id)
                                log.info(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #{len(products) + 1}: product_id={product_id}, url={url}")
                                
                                # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
                                name = ""
                                name_selectors = [
                                    'h1', 'h2', 'h3',
                                    '[class*="title"]',
                                    '[class*="name"]',
                                    'a',
                                ]
                                
                                for name_sel in name_selectors:
                                    try:
                                        name_elem = await element.query_selector(name_sel)
                                        if name_elem:
                                            name = await name_elem.inner_text()
                                            if name and len(name) > 5:  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏—è
                                                break
                                    except:
                                        continue
                                
                                # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                                category = ""
                                category_selectors = [
                                    '[class*="category"]',
                                    '[class*="tag"]',
                                    'span',
                                ]
                                
                                for cat_sel in category_selectors:
                                    try:
                                        cat_elem = await element.query_selector(cat_sel)
                                        if cat_elem:
                                            text = await cat_elem.inner_text()
                                            if text and len(text) < 50:  # –ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±—ã—á–Ω–æ –∫–æ—Ä–æ—Ç–∫–∞—è
                                                category = text
                                                break
                                    except:
                                        continue
                                
                                if url and product_id:
                                    products.append({
                                        "name": name.strip() if name else "N/A",
                                        "category": category.strip() if category else "N/A",
                                        "url": url,
                                        "product_id": product_id  # –î–æ–±–∞–≤–ª—è–µ–º product_id –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
                                    })
                                    log.info(f"   üì¶ –¢–æ–≤–∞—Ä {len(products)}: {name[:50] if name else 'N/A'}... (ID: {product_id})")
                                
                        except Exception as e:
                            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —ç–ª–µ–º–µ–Ω—Ç–∞: {e}")
                            continue
                    
                    if len(products) >= count:
                        break
                        
                except Exception as e:
                    log.debug(f"–û—à–∏–±–∫–∞ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º {selector}: {e}")
                    continue
            
            if len(products) < count:
                log.warning(f"–ù–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ {count} –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã—Ö")
            
            log.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤")
            return products[:count]
            
        except Exception as e:
            log.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
            import traceback
            log.error(traceback.format_exc())
            return []
    
    async def get_product_details(self, product_url: str, sheets_writer=None) -> ProductData:
        """
        –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞ –∏ –≤–∏–¥–µ–æ
        
        Args:
            product_url: URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞
        
        Returns:
            ProductData —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞ –∏ –≤–∏–¥–µ–æ
        """
        log.info("=" * 80)
        log.info(f"üîÑ –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–ê")
        log.info(f"URL: {product_url}")
        log.info("=" * 80)
        
        product_data = ProductData()
        product_data.pipiads_link = product_url
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è page
        if not self.page:
            log.error("‚ùå –û–®–ò–ë–ö–ê: page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
            return product_data
        
        try:
            # –®–ê–ì 1: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞
            log.info("\nüìå –®–ê–ì 1: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞...")
            try:
                log.info(f"  ‚Üí –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {product_url}")
                if not self.page:
                    raise Exception("Page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
                await self.page.goto(product_url, wait_until="domcontentloaded", timeout=30000)
                log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            except Exception as e:
                log.error(f"  ‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {e}")
                log.error(f"  ‚Üí –¢–∏–ø –æ—à–∏–±–∫–∏: {type(e).__name__}")
                import traceback
                log.error(f"  ‚Üí –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:\n{traceback.format_exc()}")
                # –ü—Ä–æ–±—É–µ–º –ø–æ–¥–æ–∂–¥–∞—Ç—å –µ—â–µ –Ω–µ–º–Ω–æ–≥–æ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                try:
                    await self.human_delay(2, 3)
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Å–µ –µ—â–µ –¥–æ—Å—Ç—É–ø–Ω–∞
                    if self.page:
                        current_url = self.page.url
                        log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
                except Exception as e2:
                    log.error(f"  ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e2}")
                    return product_data
            
            try:
                await self.human_delay(0.5, 1)
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–¥–µ—Ä–∂–∫–µ: {e}")
            
            # –®–ê–ì 1.5: –ü–µ—Ä–µ–≤–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫
            log.info("\nüìå –®–ê–ì 1.5: –ü–µ—Ä–µ–≤–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫...")
            try:
                current_url = self.page.url
                log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
                
                # –ï—Å–ª–∏ URL —Å–æ–¥–µ—Ä–∂–∏—Ç /ru/, –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ /en/
                if "/ru/" in current_url:
                    english_url = current_url.replace("/ru/", "/en/")
                    log.info(f"  ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫—É—é –≤–µ—Ä—Å–∏—é: {english_url}")
                    await self.page.goto(english_url, wait_until="domcontentloaded", timeout=30000)
                    await self.human_delay(1, 2)
                    log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π")
                else:
                    # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞
                    log.info("  ‚Üí –ü–æ–∏—Å–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —è–∑—ã–∫–∞...")
                    lang_selectors = [
                        'a[href*="/en/"]',
                        'button:has-text("English")',
                        '[class*="language"]',
                        '[class*="lang"]',
                        'select[name*="lang"]',
                    ]
                    
                    lang_found = False
                    for selector in lang_selectors:
                        try:
                            lang_element = await self.page.query_selector(selector)
                            if lang_element:
                                is_visible = await lang_element.is_visible()
                                if is_visible:
                                    await lang_element.click()
                                    await self.human_delay(1, 2)
                                    log.info(f"  ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ –Ω–∞–π–¥–µ–Ω –∏ –Ω–∞–∂–∞—Ç: {selector}")
                                    lang_found = True
                                    break
                        except:
                            continue
                    
                    if not lang_found:
                        log.warning("  ‚ö†Ô∏è –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –Ω–∞ —Ç–µ–∫—É—â–µ–º —è–∑—ã–∫–µ")
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            # –®–ê–ì 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Product Name
            log.info("\nüìå –®–ê–ì 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Product Name...")
            try:
                # –°–∫—Ä–æ–ª–ª–∏–º –≤–≤–µ—Ä—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
                log.info("  ‚Üí –°–∫—Ä–æ–ª–ª–∏–º –≤–≤–µ—Ä—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞...")
                if not self.page:
                    raise Exception("Page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
                await self.page.evaluate("window.scrollTo(0, 0)")
                await self.human_delay(0.3, 0.5)
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ: {e}")
                # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É
            
            # –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ - –ø—Ä–æ–±—É–µ–º –±–æ–ª—å—à–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –∏ –º–µ—Ç–æ–¥–æ–≤
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã...")
            try:
                # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
                name_selectors = [
                    'h1:first-of-type',
                    'h1[class*="product"]',
                    'h1[class*="title"]',
                    '[class*="product-title"]',
                    '[class*="product-name"]',
                    '[class*="product_title"]',
                    '[class*="product_name"]',
                    'h1',
                    'h2:first-of-type',
                    '[data-testid*="title"]',
                    '[data-testid*="name"]',
                    '[data-testid*="product-title"]',
                ]
                
                for selector in name_selectors:
                    try:
                        elements = await self.page.query_selector_all(selector)
                        for element in elements:
                            name = await element.inner_text()
                            if name and len(name) > 3:
                                # –§–∏–ª—å—Ç—Ä—É–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã
                                name_lower = name.lower()
                                skip_words = ['–æ—Å—Ç–∞—Ç–æ–∫', 'remain', 'stock', '–º–µ—Å—è—Ü', 'month', '–∫–æ–º–∏—Å—Å–∏—è', 'commission', 
                                            'tiktok shop product detail', 'category', '–∫–∞—Ç–µ–≥–æ—Ä–∏—è']
                                if any(skip in name_lower for skip in skip_words):
                                    continue
                                # –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å "TikTok Shop Product Detail:" –µ—Å–ª–∏ –µ—Å—Ç—å
                                if "TikTok Shop Product Detail:" in name:
                                    name = name.split("TikTok Shop Product Detail:")[-1].strip()
                                # –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
                                if name.lower().startswith('tiktok shop product'):
                                    name = re.sub(r'^tiktok shop product\s*:?\s*', '', name, flags=re.IGNORECASE).strip()
                                if name.lower().endswith('tiktok shop product'):
                                    name = re.sub(r'\s*tiktok shop product\s*$', '', name, flags=re.IGNORECASE).strip()
                                # –£–±–∏—Ä–∞–µ–º, –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ "TikTok Shop Product"
                                if name.lower() == 'tiktok shop product' or name.lower() == 'tiktok shop product detail':
                                    continue
                                if ":" in name and len(name.split(":")[0]) < 20:
                                    name = name.split(":", 1)[-1].strip()
                                product_data.product_name = name.strip()
                                if len(product_data.product_name) > 5:
                                    log.info(f"  ‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞–π–¥–µ–Ω–æ: {product_data.product_name[:50]}...")
                                    break
                        if product_data.product_name and len(product_data.product_name) > 5:
                            break
                    except:
                        continue
                
                # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
                if not product_data.product_name or len(product_data.product_name) <= 5:
                    try:
                        product_name = await self.page.evaluate("""
                            () => {
                                // –ò—â–µ–º h1
                                const h1 = document.querySelector('h1');
                                if (h1) {
                                    const text = h1.innerText.trim();
                                    if (text && text.length > 5 && !text.toLowerCase().includes('tiktok shop product detail')) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º –≤ —ç–ª–µ–º–µ–Ω—Ç–∞—Ö —Å –∫–ª–∞—Å—Å–æ–º product
                                const productElements = document.querySelectorAll('[class*="product"][class*="title"], [class*="product"][class*="name"]');
                                for (const el of productElements) {
                                    const text = el.innerText.trim();
                                    if (text && text.length > 5) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º —Å–∞–º—ã–π –±–æ–ª—å—à–æ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–æ–±—ã—á–Ω–æ —ç—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞)
                                // –ù–û –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã —Ç–∏–ø–∞ "Ad Analysis"
                                const headings = document.querySelectorAll('h1, h2, h3');
                                let maxLength = 0;
                                let bestHeading = null;
                                for (const h of headings) {
                                    const text = h.innerText.trim();
                                    const skipWords = ['tiktok', 'shop', 'product', 'detail', 'category', 'commission', 
                                                      '–æ—Å—Ç–∞—Ç–æ–∫', 'remain', 'stock', 'ad analysis', 'analysis', 
                                                      'limited time', 'promotion', 'annual plan', 'tiktok shop product'];
                                    const textLower = text.toLowerCase();
                                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã (–º–µ–Ω—å—à–µ 20 —Å–∏–º–≤–æ–ª–æ–≤) - —ç—Ç–æ –æ–±—ã—á–Ω–æ –Ω–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
                                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º "TikTok Shop Product" –∏ –ø–æ—Ö–æ–∂–∏–µ —Ç–µ–∫—Å—Ç—ã
                                    if (!skipWords.some(word => textLower.includes(word)) && 
                                        text.length > maxLength && text.length > 20 &&
                                        !textLower.includes('tiktok shop product')) {
                                        maxLength = text.length;
                                        bestHeading = text;
                                    }
                                }
                                if (bestHeading) {
                                    return bestHeading;
                                }
                                
                                // –ò—â–µ–º –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–∞—Ö - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ–±—ã—á–Ω–æ –¥–ª–∏–Ω–Ω–æ–µ
                                // –ù–∞–ø—Ä–∏–º–µ—Ä: "[BUY 1 TAKE 11] SHEEureka Scrub Facial Cleanser..."
                                // –ù–û –∏—Å–∫–ª—é—á–∞–µ–º —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                           'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                           'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                           'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                           'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                const textBlocks = document.querySelectorAll('p, div, span');
                                for (const block of textBlocks) {
                                    const text = block.innerText.trim();
                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    const isFooterMenu = footerMenuKeywords.some(keyword => text.includes(keyword));
                                    if (isFooterMenu) continue;
                                    
                                    // –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ–±—ã—á–Ω–æ –¥–ª–∏–Ω–Ω–æ–µ (–±–æ–ª—å—à–µ 30 —Å–∏–º–≤–æ–ª–æ–≤) –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–æ–≤–∞ —Ç–∏–ø–∞ "Set", "Kit", "Mask" –∏ —Ç.–¥.
                                    // –ò–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å "[" (–Ω–∞–ø—Ä–∏–º–µ—Ä "[BUY 1 TAKE 11]")
                                    if (text.length > 30 && text.length < 500 && 
                                        !text.toLowerCase().includes('ad analysis') &&
                                        !text.toLowerCase().includes('limited time') &&
                                        !text.toLowerCase().includes('promotion') &&
                                        !text.toLowerCase().includes('annual plan') &&
                                        (text.startsWith('[') || text.includes('Set') || text.includes('Kit') || 
                                         text.includes('Mask') || text.includes('Cleanser') || text.includes('Gift') ||
                                         text.includes('Scrub') || text.includes('Facial') || text.includes('Repairing'))) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º –≤ –º–µ—Ç–∞-—Ç–µ–≥–∞—Ö
                                const ogTitle = document.querySelector('meta[property="og:title"]');
                                if (ogTitle && ogTitle.content) {
                                    let title = ogTitle.content;
                                    if (title.includes('TikTok Shop Product Detail:')) {
                                        title = title.split('TikTok Shop Product Detail:')[1].trim();
                                    }
                                    // –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞
                                    if (title.toLowerCase().startsWith('tiktok shop product')) {
                                        title = title.replace(/^tiktok shop product\s*:?\s*/i, '').trim();
                                    }
                                    if (title && title.length > 5 && !title.toLowerCase().includes('tiktok shop product')) {
                                        return title;
                                    }
                                }
                                
                                return null;
                            }
                        """)
                        if product_name and len(product_name) > 5:
                            product_name = product_name.strip()
                            # –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
                            if product_name.lower().startswith('tiktok shop product'):
                                product_name = re.sub(r'^tiktok shop product\s*:?\s*', '', product_name, flags=re.IGNORECASE).strip()
                            if product_name.lower().endswith('tiktok shop product'):
                                product_name = re.sub(r'\s*tiktok shop product\s*$', '', product_name, flags=re.IGNORECASE).strip()
                            # –£–±–∏—Ä–∞–µ–º, –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ "TikTok Shop Product"
                            if product_name.lower() == 'tiktok shop product' or product_name.lower() == 'tiktok shop product detail':
                                product_name = None
                            if product_name and len(product_name) > 5:
                                product_data.product_name = product_name
                                log.info(f"  ‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞–π–¥–µ–Ω–æ (—á–µ—Ä–µ–∑ JS): {product_data.product_name[:50]}...")
                    except Exception as e:
                        log.debug(f"  ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —á–µ—Ä–µ–∑ JS: {e}")
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞: {e}")
            
            if not product_data.product_name or len(product_data.product_name) <= 5:
                log.warning("  ‚ö†Ô∏è –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                product_data.product_name = "N/A"
            
            # –®–ê–ì 3: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Category
            log.info("\nüìå –®–ê–ì 3: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Category...")
            try:
                log.info("  ‚Üí –ü–æ–∏—Å–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–∞...")
                
                # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
                category_selectors = [
                    '[class*="category"]',
                    '[class*="tag"]',
                    'span:has-text("Category")',
                    'span:has-text("–ö–∞—Ç–µ–≥–æ—Ä–∏—è")',
                    'text=/Category/i',
                    'text=/–ö–∞—Ç–µ–≥–æ—Ä–∏—è/i',
                    'div:has-text("Category")',
                    'div:has-text("–ö–∞—Ç–µ–≥–æ—Ä–∏—è")',
                ]
                
                for selector in category_selectors:
                    try:
                        elements = await self.page.query_selector_all(selector)
                        for element in elements:
                            category = await element.inner_text()
                            if category:
                                # –û—á–∏—â–∞–µ–º –æ—Ç –ª–∏—à–Ω–µ–≥–æ —Ç–µ–∫—Å—Ç–∞
                                category = re.sub(r'Category\s*:', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'–ö–∞—Ç–µ–≥–æ—Ä–∏—è\s*:', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'Commission\s*Rate\s*:.*', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'–ö–æ–º–∏—Å—Å–∏—è\s*:.*', '', category, flags=re.IGNORECASE)
                                # –£–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä "15.00%")
                                category = re.sub(r'\s*\d+\.?\d*\s*%', '', category)
                                # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ —Å–∏–º–≤–æ–ª—ã > –∏ –ø—Ä–æ–±–µ–ª—ã
                                category = re.sub(r'\s*>\s*', ' > ', category)
                                category = category.strip()
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é —á–∞—Å—Ç—å –¥–æ "Commission" –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É
                                if "Commission" in category or "–ö–æ–º–∏—Å—Å–∏—è" in category:
                                    category = category.split("Commission")[0].split("–ö–æ–º–∏—Å—Å–∏—è")[0].strip()
                                if len(category) > 100:
                                    category = category[:100]
                                if category and len(category) > 3:
                                    product_data.category = category
                                    log.info(f"  ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–∞: {product_data.category}")
                                    break
                        if product_data.category:
                            break
                    except:
                        continue
                
                # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π)
                if not product_data.category:
                    try:
                        category = await self.page.evaluate("""
                            () => {
                                // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Category" –∏–ª–∏ "–ö–∞—Ç–µ–≥–æ—Ä–∏—è"
                                const allElements = document.querySelectorAll('*');
                                for (const el of allElements) {
                                    const text = el.innerText || '';
                                    if (text.includes('Category') || text.includes('–ö–∞—Ç–µ–≥–æ—Ä–∏—è')) {
                                        // –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ—Å–ª–µ "Category:" –∏–ª–∏ "–ö–∞—Ç–µ–≥–æ—Ä–∏—è:"
                                        let categoryText = text;
                                        if (categoryText.includes('Category:')) {
                                            categoryText = categoryText.split('Category:')[1];
                                        } else if (categoryText.includes('–ö–∞—Ç–µ–≥–æ—Ä–∏—è:')) {
                                            categoryText = categoryText.split('–ö–∞—Ç–µ–≥–æ—Ä–∏—è:')[1];
                                        }
                                        
                                        // –£–±–∏—Ä–∞–µ–º "Commission Rate" –∏ –≤—Å–µ –ø–æ—Å–ª–µ
                                        if (categoryText.includes('Commission Rate') || categoryText.includes('–ö–æ–º–∏—Å—Å–∏—è')) {
                                            categoryText = categoryText.split('Commission Rate')[0].split('–ö–æ–º–∏—Å—Å–∏—è')[0];
                                        }
                                        
                                        // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä "15.00%")
                                        categoryText = categoryText.replace(/\s*\d+\.?\d*\s*%/g, '');
                                        
                                        categoryText = categoryText.trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é (—Å–æ–¥–µ—Ä–∂–∏—Ç ">" –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–æ–≤)
                                        if (categoryText && categoryText.length > 3 && 
                                            (categoryText.includes('>') || categoryText.split(' ').length >= 2)) {
                                            return categoryText.substring(0, 100);
                                        }
                                    }
                                }
                                return null;
                            }
                        """)
                        if category and len(category) > 3:
                            product_data.category = category.strip()
                            log.info(f"  ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–∞ (—á–µ—Ä–µ–∑ JS): {product_data.category}")
                    except Exception as e:
                        log.debug(f"  ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ JS: {e}")
                
                if not product_data.category:
                    log.warning("  ‚ö†Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ 'N/A'")
                    product_data.category = "N/A"
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {e}")
                product_data.category = "N/A"
            
            # –®–ê–ì 3.5: –ó–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets (–µ—Å–ª–∏ sheets_writer –ø–µ—Ä–µ–¥–∞–Ω)
            # –í–ê–ñ–ù–û: –ï—Å–ª–∏ —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ
            if sheets_writer:
                log.info("\nüìå –®–ê–ì 3.5: –ó–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets...")
                try:
                    row_number = sheets_writer.write_basic_product_data(
                        product_data.product_name,
                        product_data.category,
                        product_data.pipiads_link
                    )
                    if row_number > 0:
                        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ
                        product_data._sheets_row = row_number
                        log.info(f"  ‚úÖ –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {row_number})")
                    else:
                        # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–≤–æ–∑–º–æ–∂–Ω–æ, —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã),
                        # –Ω–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö
                        log.warning("  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–≤–æ–∑–º–æ–∂–Ω–æ, —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã)")
                        log.info("  ‚Üí –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö...")
                        row_number = sheets_writer.find_next_empty_row()
                        product_data._sheets_row = row_number
                        log.info(f"  ‚úÖ –ë—É–¥–µ–º –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫—É {row_number}")
                except Exception as e:
                    log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö: {e}")
                    # –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ
                    try:
                        row_number = sheets_writer.find_next_empty_row()
                        product_data._sheets_row = row_number
                        log.info(f"  ‚Üí –ë—É–¥–µ–º –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫—É {row_number}")
                    except:
                        pass
            
            # –®–ê–ì 4: –ü–æ–∏—Å–∫ –±–ª–æ–∫–∞ "TikTok Ads"
            log.info("\nüìå –®–ê–ì 4: –ü–æ–∏—Å–∫ –±–ª–æ–∫–∞ 'TikTok Ads'...")
            log.info("  ‚Üí –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–Ω–∏–∑ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞...")
            
            # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–Ω–∏–∑, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç
            # –ë–ª–æ–∫ "TikTok Ads" –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            try:
                log.info("  ‚Üí –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–Ω–∏–∑ (–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ)...")
                # –ü–æ–ª—É—á–∞–µ–º –≤—ã—Å–æ—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                page_height = await self.page.evaluate("document.body.scrollHeight")
                viewport_height = await self.page.evaluate("window.innerHeight")
                log.info(f"  ‚Üí –í—ã—Å–æ—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {page_height}px, –≤—ã—Å–æ—Ç–∞ viewport: {viewport_height}px")
                
                # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ (–∫–∞–∫ —á–µ–ª–æ–≤–µ–∫)
                scroll_steps = max(3, page_height // viewport_height)
                scroll_step = page_height // scroll_steps
                
                for step in range(scroll_steps):
                    scroll_position = scroll_step * (step + 1)
                    await self.page.evaluate(f"window.scrollTo(0, {scroll_position})")
                    await self.human_delay(0.3, 0.5)
                    log.debug(f"  ‚Üí –ü—Ä–æ–∫—Ä—É—Ç–∫–∞: {scroll_position}/{page_height}px")
                
                # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ —Å–∞–º–æ–≥–æ –Ω–∏–∑–∞
                await self.page.evaluate("window.scrollTo(0, document.body.scrollHeight)")
                await self.human_delay(1, 2)  # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–∫—Ä—É—á–µ–Ω–∞ –≤–Ω–∏–∑")
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            log.info("  ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (–∫–∞–∫ Ctrl+F)...")
            tiktok_ads_found = False
            tiktok_ads_element = None
            
            # –°–Ω–∞—á–∞–ª–∞ –∂–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            await self.human_delay(0.5, 1)
            
            # –í–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
            tiktok_ads_texts = [
                "TikTok Ads",  # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π
                "–†–µ–∫–ª–∞–º–∞ –¢–∏–∫–¢–æ–∫",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 1
                "–†–µ–∫–ª–∞–º–∞ TikTok",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 2
                "TikTok –†–µ–∫–ª–∞–º–∞",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 3
            ]
            
            # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –±–ª–æ–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä —Å —Ç–µ–∫—Å—Ç–æ–º (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±)
            log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ Playwright locator...")
            for text_variant in tiktok_ads_texts:
                try:
                    # –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Ç–µ–∫—Å—Ç (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ)
                    locator = self.page.locator(f'text=/{text_variant}/i').first
                    if await locator.count() > 0:
                        tiktok_ads_element = await locator.element_handle()
                        if tiktok_ads_element:
                            # –°–∫—Ä–æ–ª–ª–∏–º –∫ —ç–ª–µ–º–µ–Ω—Ç—É
                            await tiktok_ads_element.scroll_into_view_if_needed()
                            await self.human_delay(0.3, 0.5)
                            tiktok_ads_found = True
                            log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ Playwright locator")
                            break
                except Exception as e:
                    log.debug(f"–ü–æ–∏—Å–∫ '{text_variant}' —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä –Ω–µ —É–¥–∞–ª—Å—è: {e}")
                    continue
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ JavaScript –ø–æ–∏—Å–∫ (–∫–∞–∫ Ctrl+F)
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript TreeWalker...")
                for text_variant in tiktok_ads_texts:
                    try:
                        # –ò—Å–ø–æ–ª—å–∑—É–µ–º JavaScript –¥–ª—è –ø–æ–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å —Ç–µ–∫—Å—Ç–æ–º
                        # –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è regex
                        escaped_text = text_variant.replace("\\", "\\\\").replace("/", "\\/")
                        tiktok_ads_element = await self.page.evaluate_handle(f"""
                            () => {{
                                const walker = document.createTreeWalker(
                                    document.body,
                                    NodeFilter.SHOW_TEXT,
                                    null,
                                    false
                                );
                                
                                let node;
                                while (node = walker.nextNode()) {{
                                    if (node.textContent && /{escaped_text}/i.test(node.textContent)) {{
                                        // –ù–∞—Ö–æ–¥–∏–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç
                                        let parent = node.parentElement;
                                        while (parent && parent !== document.body) {{
                                            if (parent.offsetHeight > 0 && parent.offsetWidth > 0) {{
                                                return parent;
                                            }}
                                            parent = parent.parentElement;
                                        }}
                                    }}
                                }}
                                return null;
                            }}
                        """)
                        
                        if tiktok_ads_element and await tiktok_ads_element.as_element():
                            element = await tiktok_ads_element.as_element()
                            await element.scroll_into_view_if_needed()
                            await self.human_delay(0.3, 0.5)
                            tiktok_ads_found = True
                            log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript TreeWalker")
                            break
                    except Exception as e:
                        log.debug(f"JavaScript –ø–æ–∏—Å–∫ '{text_variant}' –Ω–µ —É–¥–∞–ª—Å—è: {e}")
                        continue
            
            # –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ query_selector
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 3: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ query_selector —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ —Ç–µ–∫—Å—Ç–∞...")
                try:
                    # –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
                    text_variants = []
                    for text in tiktok_ads_texts:
                        text_variants.extend([
                            f'text="{text}"',
                            f'text={text}',
                            f'*:has-text("{text}")',
                        ])
                    
                    for variant in text_variants:
                        try:
                            element = await self.page.query_selector(variant)
                            if element:
                                is_visible = await element.is_visible()
                                if is_visible:
                                    await element.scroll_into_view_if_needed()
                                    await self.human_delay(0.3, 0.5)
                                    tiktok_ads_found = True
                                    tiktok_ads_element = element
                                    log.info(f"  ‚úÖ –ë–ª–æ–∫ –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ query_selector: {variant}")
                                    break
                        except:
                            continue
                except Exception as e:
                    log.debug(f"Query selector –ø–æ–∏—Å–∫ –Ω–µ —É–¥–∞–ª—Å—è: {e}")
            
            # –ü–æ–ø—ã—Ç–∫–∞ 4: –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –µ—â–µ —Ä–∞–∑ –∏ –ø–æ–∏—Å–∫–∞—Ç—å —Å–Ω–æ–≤–∞
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 4: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∏ –ø–æ–∏—Å–∫...")
                try:
                    # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –µ—â–µ —Ä–∞–∑ –º–µ–¥–ª–µ–Ω–Ω–æ
                    await self.page.evaluate("window.scrollTo(0, 0)")  # –í –Ω–∞—á–∞–ª–æ
                    await self.human_delay(0.5, 1)
                    
                    # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑ –º–µ–¥–ª–µ–Ω–Ω–æ, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è—Å—å –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
                    page_height = await self.page.evaluate("document.body.scrollHeight")
                    scroll_increment = 300  # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –ø–æ 300px
                    
                    for scroll_pos in range(0, page_height, scroll_increment):
                        await self.page.evaluate(f"window.scrollTo(0, {scroll_pos})")
                        await self.human_delay(0.2, 0.3)
                        
                        # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –Ω–∞ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ (–≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞)
                        for text_variant in tiktok_ads_texts:
                            try:
                                # –ó–∞–º–µ–Ω—è–µ–º –ø—Ä–æ–±–µ–ª—ã –Ω–∞ \s+ –¥–ª—è regex
                                regex_pattern = text_variant.replace(" ", "\\s+")
                                locator = self.page.locator(f'text=/{regex_pattern}/i').first
                                if await locator.count() > 0:
                                    tiktok_ads_element = await locator.element_handle()
                                    if tiktok_ads_element:
                                        await tiktok_ads_element.scroll_into_view_if_needed()
                                        await self.human_delay(0.3, 0.5)
                                        tiktok_ads_found = True
                                        log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ {scroll_pos}px")
                                        break
                            except:
                                continue
                        
                        if tiktok_ads_found:
                            break
                    
                    if not tiktok_ads_found:
                        # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ —Å–∞–º–æ–≥–æ –Ω–∏–∑–∞ –µ—â–µ —Ä–∞–∑
                        await self.page.evaluate("window.scrollTo(0, document.body.scrollHeight)")
                        await self.human_delay(1, 2)
                        
                        # –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–∏—Å–∫–∞ (–≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞)
                        for text_variant in tiktok_ads_texts:
                            try:
                                # –ó–∞–º–µ–Ω—è–µ–º –ø—Ä–æ–±–µ–ª—ã –Ω–∞ \s+ –¥–ª—è regex
                                regex_pattern = text_variant.replace(" ", "\\s+")
                                locator = self.page.locator(f'text=/{regex_pattern}/i').first
                                if await locator.count() > 0:
                                    tiktok_ads_element = await locator.element_handle()
                                    if tiktok_ads_element:
                                        await tiktok_ads_element.scroll_into_view_if_needed()
                                        await self.human_delay(0.3, 0.5)
                                        tiktok_ads_found = True
                                        log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω –≤ —Å–∞–º–æ–º –Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã")
                                        break
                            except:
                                continue
                except Exception as e:
                    log.debug(f"–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –Ω–µ –ø–æ–º–æ–≥–ª–∞: {e}")
            
            if not tiktok_ads_found:
                log.error("  ‚ùå –ë–ª–æ–∫ 'TikTok Ads' –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫")
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                try:
                    screenshot_path = config.SCREENSHOTS_DIR / f"tiktok_ads_not_found_{int(time.time())}.png"
                    await self.page.screenshot(path=str(screenshot_path), full_page=True)
                    log.info(f"  üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {screenshot_path}")
                except:
                    pass
                log.error("  ‚ùå –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: –±–ª–æ–∫ 'TikTok Ads' –Ω–µ –Ω–∞–π–¥–µ–Ω")
                return product_data
            
            log.info("  ‚úÖ –ë–ª–æ–∫ 'TikTok Ads' —É—Å–ø–µ—à–Ω–æ –Ω–∞–π–¥–µ–Ω")
            
            # –®–ê–ì 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ "First seen"
            log.info("\nüìå –®–ê–ì 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ 'First seen'...")
            sort_success = await self._set_sort_by_first_seen()
            if not sort_success:
                log.warning("  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            # –®–ê–ì 6: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–∏–¥–µ–æ
            log.info("\nüìå –®–ê–ì 6: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ 'TikTok Ads'...")
            videos = await self._get_videos_from_tiktok_ads_block()
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ {len(videos)} –≤–∏–¥–µ–æ –≤ –±–ª–æ–∫–µ")
            
            # –®–ê–ì 7: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ
            log.info(f"\nüìå –®–ê–ì 7: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ (impression >= {config.MIN_IMPRESSIONS}, –¥–∞—Ç–∞ <= {config.DAYS_BACK} –¥–Ω–µ–π)...")
            filtered_videos = await self._filter_videos(videos)
            log.info(f"  ‚Üí –ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: {len(filtered_videos)} –≤–∏–¥–µ–æ")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –í–°–ï –≤–∏–¥–µ–æ (–¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏) –≤ ProductData
            product_data._all_videos_raw = videos[:20]  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–≤—ã–µ 20 –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
            
            # –í–ê–ñ–ù–û: –ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ 0 –≤–∏–¥–µ–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä
            if len(filtered_videos) == 0:
                log.warning(f"  ‚ö†Ô∏è –ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ (>= {config.MIN_IMPRESSIONS} impressions, <= {config.DAYS_BACK} –¥–Ω–µ–π)")
                log.warning(f"  ‚ö†Ô∏è –¢–æ–≤–∞—Ä –±—É–¥–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω")
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ —Ç–æ–≤–∞—Ä–∞
                product_data._insufficient_videos = True
                product_data._videos_found = len(videos)
                return product_data
            
            # –í—ã–±–æ—Ä —Ç–æ–ø-3 –≤–∏–¥–µ–æ
            video_count = 3
            selected_videos = filtered_videos[:video_count]
            
            log.info(f"  ‚úÖ –í—ã–±—Ä–∞–Ω–æ {len(selected_videos)} –≤–∏–¥–µ–æ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            
            # –®–ê–ì 8: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
            log.info(f"\nüìå –®–ê–ì 8: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–ª—è {len(selected_videos)} –≤–∏–¥–µ–æ...")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
            product_page_url = self.page.url
            log.info(f"  ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞: {product_page_url}")
            
            for i, video in enumerate(selected_videos, 1):
                log.info(f"\n  üé¨ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ {i}/{len(selected_videos)}...")
                log.info(f"    ‚Üí Impression: {video.get('impression', 0)}, First seen: {video.get('first_seen', 'N/A')}")
                
                # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ (–ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ ad-search –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
                video_details = await self._get_video_details(video)
                
                if video_details:
                    product_data.videos.append(video_details)
                    log.info(f"    ‚úÖ –í–∏–¥–µ–æ {i} –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ")
                else:
                    log.warning(f"    ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –¥–ª—è –≤–∏–¥–µ–æ {i}")
                
                # –í–ê–ñ–ù–û: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
                log.info(f"    ‚Üí –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ {i}...")
                try:
                    await self.page.goto(product_page_url, wait_until="domcontentloaded", timeout=30000)
                    await self.human_delay(1, 2)
                    
                    # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –±–ª–æ–∫–∞ TikTok Ads (—á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ –≤–∏–¥–µ–æ)
                    try:
                        await self.page.wait_for_selector('a[href*="/ad-search/"]', timeout=10000, state="visible")
                        log.info(f"    ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ —É—Å–ø–µ—à–µ–Ω (–≤–∏–¥–µ–æ {i})")
                    except:
                        log.warning(f"    ‚ö†Ô∏è –ë–ª–æ–∫ TikTok Ads –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
                except Exception as e:
                    log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞: {e}")
                    # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–ª–µ–¥—É—é—â–∏—Ö –≤–∏–¥–µ–æ –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤–æ–∑–≤—Ä–∞—Ç–∞
                
                await self.human_delay(0.5, 1)
            
            # –ó–∞–ø–æ–ª–Ω—è–µ–º N/A –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤–∏–¥–µ–æ (–Ω—É–∂–Ω–æ 3 –≤–∏–¥–µ–æ)
            while len(product_data.videos) < video_count:
                product_data.videos.append({
                    "tiktok_link": "N/A",
                    "impression": 0,
                    "script": "N/A",
                    "hook": "N/A",
                    "audience_age": "N/A",
                    "country": "N/A",
                    "first_seen": "N/A",
                })
            
            log.info(f"\n‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {len(product_data.videos)} –≤–∏–¥–µ–æ –¥–ª—è —Ç–æ–≤–∞—Ä–∞")
            
            # –®–ê–ì 9: –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ –≤ Google Sheets (–µ—Å–ª–∏ sheets_writer –ø–µ—Ä–µ–¥–∞–Ω)
            if sheets_writer:
                if hasattr(product_data, '_sheets_row') and product_data._sheets_row > 0:
                    log.info(f"\nüìå –®–ê–ì 9: –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {product_data._sheets_row})...")
                    log.info(f"  ‚Üí –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ –¥–ª—è –∑–∞–ø–∏—Å–∏: {len(product_data.videos)}")
                    
                    # –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é
                    for i, video in enumerate(product_data.videos[:3], 1):
                        log.info(f"  ‚Üí –í–∏–¥–µ–æ {i}: tiktok={video.get('tiktok_link', 'N/A')[:50]}, "
                                f"impression={video.get('impression', 'N/A')}, "
                                f"script={len(str(video.get('script', 'N/A')))} —Å–∏–º–≤–æ–ª–æ–≤, "
                                f"hook={len(str(video.get('hook', 'N/A')))} —Å–∏–º–≤–æ–ª–æ–≤, "
                                f"audience={video.get('audience_age', 'N/A')}, "
                                f"country={video.get('country', 'N/A')}, "
                                f"first_seen={video.get('first_seen', 'N/A')}")
                    
                    try:
                        # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏
                        video_data_dict = {
                            "product_name": product_data.product_name,
                            "category": product_data.category,
                            "pipiads_link": product_data.pipiads_link,
                            "videos": product_data.videos
                        }
                        
                        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (update_basic=False - –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ F-Z)
                        success = sheets_writer.write_product_data(
                            product_data._sheets_row,
                            video_data_dict,
                            update_basic=False
                        )
                        
                        if success:
                            log.info(f"  ‚úÖ –î–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {product_data._sheets_row}, —Å—Ç–æ–ª–±—Ü—ã F-Z)")
                        else:
                            log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –≤ Google Sheets")
                    except Exception as e:
                        log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ: {e}")
                        import traceback
                        log.error(traceback.format_exc())
                else:
                    log.warning(f"  ‚ö†Ô∏è –ù–µ—Ç –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö (_sheets_row –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)")
            
            log.info("=" * 80)
            log.info("‚úÖ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û")
            log.info("=" * 80)
            return product_data
            
        except Exception as e:
            log.error("\n" + "=" * 80)
            log.error(f"‚ùå –û–®–ò–ë–ö–ê –ü–†–ò –û–ë–†–ê–ë–û–¢–ö–ï –¢–û–í–ê–†–ê: {e}")
            log.error("=" * 80)
            import traceback
            log.error(traceback.format_exc())
            return product_data
    
    async def return_to_main_page(self, main_page_url: str) -> bool:
        """
        –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–æ–≤–∞—Ä–æ–≤
        
        Args:
            main_page_url: URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ —Ç–æ–≤–∞—Ä)
        
        Returns:
            True –µ—Å–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç —É—Å–ø–µ—à–µ–Ω, False –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        """
        try:
            log.info("\nüîô –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–æ–≤–∞—Ä–æ–≤...")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π URL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            current_url = self.page.url
            log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
            log.info(f"  ‚Üí –¶–µ–ª–µ–≤–æ–π URL: {main_page_url}")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            if current_url == main_page_url:
                log.info("  ‚ÑπÔ∏è  –£–∂–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
                return True
            
            # –ú–ï–¢–û–î 1: –ü—Ä—è–º–æ–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π URL (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            await self.page.goto(main_page_url, wait_until="domcontentloaded", timeout=30000)  # –£–≤–µ–ª–∏—á–µ–Ω –¥–æ 30 —Å–µ–∫
            await self.human_delay(1, 2)
            
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ë–ï–ó networkidle - –æ–Ω –≤—ã–∑—ã–≤–∞–µ—Ç —Ç–∞–π–º–∞—É—Ç—ã!)
            await self.page.wait_for_load_state("domcontentloaded", timeout=5000)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞
            new_url = self.page.url
            log.info(f"  ‚Üí –ù–æ–≤—ã–π URL: {new_url}")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤
            try:
                await self.page.wait_for_selector('a[href*="/tiktok-shop-product/"]', timeout=10000)
                
                # –î–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ä–µ–º—è –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
                await self.human_delay(2, 3)
                
                log.info("  ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —É—Å–ø–µ—à–µ–Ω")
                return True
            except:
                log.warning("  ‚ö†Ô∏è –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞")
                return False
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É: {e}")
            import traceback
            log.error(traceback.format_exc())
            return False
    
    async def get_product_details_with_return(self, product_index: int, sheets_writer=None, banned_products=None):
        """
        –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        
        –ê–ª–≥–æ—Ä–∏—Ç–º:
        1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        2. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É
        3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ban-list (–µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω)
        4. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–≤–∞—Ä (get_product_details)
        5. –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        
        Args:
            product_index: –ò–Ω–¥–µ–∫—Å —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–Ω–∞—á–∏–Ω–∞—è —Å 0)
            sheets_writer: –û–±—ä–µ–∫—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ Google Sheets
            banned_products: –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö URL (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
        
        Returns:
            ProductData –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ
            Dict —Å–æ status="insufficient_videos" –µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ
            Dict —Å–æ status="duplicate" –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
            None –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        """
        log.info(f"\n{'='*80}")
        log.info(f"üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ü–û –ò–ù–î–ï–ö–°–£ {product_index}")
        log.info(f"{'='*80}")
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        main_page_url = self.page.url
        log.info(f"  ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {main_page_url}")
        
        def normalize_url(url: str) -> str:
            """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL (—É–±—Ä–∞—Ç—å —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É)"""
            if not url:
                return ""
            url = url.strip().rstrip('/')
            # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if '?' in url:
                url = url.split('?')[0]
            return url
        
        try:
            # –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É
            log.info(f"\nüìå –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É {product_index}...")
            
            try:
                # –ò—â–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
                product_links = await self.page.query_selector_all('a[href*="/tiktok-shop-product/"]')
                
                if not product_links:
                    log.error("  ‚ùå –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
                    return None
                
                if product_index >= len(product_links):
                    log.error(f"  ‚ùå –ò–Ω–¥–µ–∫—Å {product_index} –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã (–≤—Å–µ–≥–æ {len(product_links)} —Ç–æ–≤–∞—Ä–æ–≤)")
                    return None
                
                # –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Ç–æ–≤–∞—Ä–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É
                product_link = product_links[product_index]
                
                # –ü–æ–ª—É—á–∞–µ–º URL —Ç–æ–≤–∞—Ä–∞
                href = await product_link.get_attribute("href")
                if not href:
                    log.error(f"  ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å URL –¥–ª—è —Ç–æ–≤–∞—Ä–∞ {product_index}")
                    return None
                
                # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π URL
                if href.startswith("/"):
                    product_url = f"https://www.pipiads.com{href}"
                elif href.startswith("http"):
                    product_url = href
                else:
                    product_url = f"https://www.pipiads.com/{href}"
                
                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º URL (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
                product_url = normalize_url(product_url)
                
                if not product_url:
                    log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                    return None
                
                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
                if banned_products is not None and product_url in banned_products:
                    log.warning(f"  üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: {product_url}")
                    log.warning(f"     –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.")
                    return {"status": "duplicate", "product_url": product_url}
                
                log.info(f"  ‚úÖ –ü–æ–ª—É—á–µ–Ω URL —Ç–æ–≤–∞—Ä–∞: {product_url}")
                
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ URL —Ç–æ–≤–∞—Ä–∞: {e}")
                return None
            
            # –®–ê–ì 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ get_product_details
            log.info(f"\nüìå –®–ê–ì 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞...")
            product_data = await self.get_product_details(product_url, sheets_writer=sheets_writer)
            
            # –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–¥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é)
            log.info(f"\nüìå –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞...")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∏ –µ—Å—Ç—å –≤–∏–¥–µ–æ
            if not product_data:
                log.warning("  ‚ö†Ô∏è product_data –ø—É—Å—Ç")
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                await self.return_to_main_page(main_page_url)
                return None
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ —Ç–æ–≤–∞—Ä –ø—Ä–æ–ø—É—â–µ–Ω –∏–∑-–∑–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
            if hasattr(product_data, '_insufficient_videos') and product_data._insufficient_videos:
                videos_found = getattr(product_data, '_videos_found', 0)
                log.warning(f"  ‚ö†Ô∏è –¢–æ–≤–∞—Ä –ø—Ä–æ–ø—É—â–µ–Ω: –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ (–Ω–∞–π–¥–µ–Ω–æ –≤—Å–µ–≥–æ: {videos_found})")
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                await self.return_to_main_page(main_page_url)
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª–æ–≤–∞—Ä—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "insufficient_videos"
                return {
                    "status": "insufficient_videos",
                    "product_name": getattr(product_data, 'product_name', 'N/A'),
                    "videos_found": videos_found,
                    "videos_required": 3,
                    "reason": f"–ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (>= {config.MIN_IMPRESSIONS} impressions, <= {config.DAYS_BACK} –¥–Ω–µ–π) –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ"
                }
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ
            videos_count = len(product_data.videos) if hasattr(product_data, 'videos') else 0
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ –≤–∏–¥–µ–æ: {videos_count}")
            
            # –ï—Å–ª–∏ –≤–∏–¥–µ–æ –º–µ–Ω—å—à–µ 3 - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
            if videos_count < 3:
                log.warning(f"  ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ: {videos_count} < 3")
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                await self.return_to_main_page(main_page_url)
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª–æ–≤–∞—Ä—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "insufficient_videos"
                return {
                    "status": "insufficient_videos",
                    "product_name": getattr(product_data, 'product_name', 'N/A'),
                    "videos_found": videos_count,
                    "videos_required": 3,
                    "reason": f"–ù–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ {videos_count} –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏"
                }
            
            # –®–ê–ì 4: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            log.info(f"\nüìå –®–ê–ì 4: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É...")
            await self.return_to_main_page(main_page_url)
            
            # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä
            log.info(f"  ‚úÖ –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ ({videos_count} –≤–∏–¥–µ–æ)")
            return product_data
            
        except Exception as e:
            log.error(f"\n‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É {product_index}: {e}")
            import traceback
            log.error(traceback.format_exc())
            
            # –ü—ã—Ç–∞–µ–º—Å—è –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
            try:
                await self.return_to_main_page(main_page_url)
            except:
                log.error("  ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏")
            
            return None
    
    async def _set_sort_by_first_seen(self) -> bool:
        """
        –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É "First seen" –≤ dropdown
        
        Returns:
            True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
        """
        log.info("  ‚Üí –ü–æ–∏—Å–∫ dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏...")
        try:
            # –ò—â–µ–º dropdown "Sort by"
            sort_selectors = [
                'select:has-text("Sort by")',
                'select',
                '[class*="sort"]',
                'text="Sort by: First seen"',
                'text="Sort by"',
            ]
            
            dropdown = None
            for selector in sort_selectors:
                try:
                    dropdown = await self.page.query_selector(selector)
                    if dropdown:
                        is_visible = await dropdown.is_visible()
                        if is_visible:
                            log.debug(f"–ù–∞–π–¥–µ–Ω dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: {selector}")
                            break
                        else:
                            dropdown = None
                except:
                    continue
            
            if not dropdown:
                # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ —Ç–µ–∫—Å—Ç—É "Sort by: First seen"
                try:
                    sort_text = await self.page.query_selector('text="Sort by: First seen"')
                    if sort_text:
                        # –ö–ª–∏–∫–∞–µ–º –Ω–∞ —Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å dropdown
                        await sort_text.click()
                        await self.human_delay(0.5, 1)
                        
                        # –ò—â–µ–º –æ–ø—Ü–∏—é "First seen"
                        first_seen_option = await self.page.query_selector('text="First seen"')
                        if first_seen_option:
                            await first_seen_option.click()
                            await self.human_delay(1, 2)
                            log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (—á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç)")
                            return True
                except:
                    pass
                
                log.warning("Dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å")
                return False
            
            # –ï—Å–ª–∏ —ç—Ç–æ select —ç–ª–µ–º–µ–Ω—Ç
            tag_name = await dropdown.evaluate("el => el.tagName.toLowerCase()")
            if tag_name == "select":
                # –í—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é —á–µ—Ä–µ–∑ value –∏–ª–∏ —Ç–µ–∫—Å—Ç
                try:
                    log.info("  ‚Üí –ù–∞–π–¥–µ–Ω select —ç–ª–µ–º–µ–Ω—Ç, –≤—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é 'First seen'...")
                    await dropdown.select_option(label="First seen")
                    await self.human_delay(1, 2)
                    log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (select)")
                    return True
                except:
                    pass
            
            # –ï—Å–ª–∏ —ç—Ç–æ –∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown - –∫–ª–∏–∫–∞–µ–º –∏ –≤—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é
            log.info("  ‚Üí –ù–∞–π–¥–µ–Ω –∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown, –æ—Ç–∫—Ä—ã–≤–∞–µ–º...")
            await dropdown.click()
            await self.human_delay(0.5, 1)
            
            # –ò—â–µ–º –æ–ø—Ü–∏—é "First seen"
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –æ–ø—Ü–∏–∏ 'First seen'...")
            option_selectors = [
                'text="First seen"',
                'text="Sort by: First seen"',
                '[role="option"]:has-text("First seen")',
            ]
            
            for opt_sel in option_selectors:
                try:
                    option = await self.page.query_selector(opt_sel)
                    if option:
                        await option.click()
                        await self.human_delay(1, 2)
                        log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (–∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown)")
                        return True
                except:
                    continue
            
            log.warning("  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É 'First seen'")
            return False
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: {e}")
            return False
    
    async def _get_videos_from_tiktok_ads_block(self) -> List[Dict[str, Any]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ TikTok Ads
        
        Returns:
            –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        videos = []
        
        try:
            log.info("  ‚Üí –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ...")
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ
            await self.human_delay(0.5, 1)
            
            # –ò—â–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ - –ø—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã...")
            video_card_selectors = [
                '[class*="video"]',
                '[class*="card"]',
                '[class*="ad"]',
                'div[class*="item"]',
                'a[href*="/ad-search/"]',
            ]
            
            video_elements = []
            for selector in video_card_selectors:
                try:
                    elements = await self.page.query_selector_all(selector)
                    if elements:
                        log.debug(f"–ù–∞–π–¥–µ–Ω–æ {len(elements)} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º {selector}")
                        # –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ, —á—Ç–æ —Å–æ–¥–µ—Ä–∂–∞—Ç –≤–∏–¥–µ–æ (–∏–º–µ—é—Ç thumbnail –∏–ª–∏ play button)
                        for elem in elements:
                            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –∫–∞—Ä—Ç–æ—á–∫–∞ –≤–∏–¥–µ–æ
                            has_play_button = await elem.query_selector('[class*="play"], svg, [class*="thumbnail"]')
                            if has_play_button or '/ad-search/' in str(await elem.get_attribute("href") or ""):
                                video_elements.append(elem)
                        if video_elements:
                            break
                except:
                    continue
            
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ")
            
            # –û–ì–†–ê–ù–ò–ß–ï–ù–ò–ï: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 50 –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
            max_cards = 50
            if len(video_elements) > max_cards:
                log.info(f"  ‚Üí –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ {max_cards} –∏–∑ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫")
                video_elements = video_elements[:max_cards]
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
            log.info("  ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–µ–∫...")
            log.info(f"  ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∞ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫...")
            
            successful_extractions = 0
            for i, card in enumerate(video_elements, 1):
                try:
                    video_data = await self._extract_video_data_from_card(card, i)
                    if video_data:
                        videos.append(video_data)
                        impression = video_data.get('impression', 0)
                        first_seen = video_data.get('first_seen', 'N/A')
                        
                        # –õ–û–ì–ò–†–£–ï–ú –ö–ê–ñ–î–û–ï –í–ò–î–ï–û (–∫–∞–∫ –ø—Ä–æ—Å–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
                        log.info(f"  üìπ –í–∏–¥–µ–æ {i}: impression={impression}, first_seen={first_seen}")
                        
                        if impression > 0 or first_seen != 'N/A':
                            successful_extractions += 1
                except Exception as e:
                    log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ {i}: {e}")
                    continue
            
            log.info(f"  ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–æ {len(videos)} –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ (—É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–æ: {successful_extractions})")
            return videos
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤–∏–¥–µ–æ: {e}")
            return []
    
    async def _extract_video_data_from_card(self, card_element, card_index: int = 0) -> Optional[Dict[str, Any]]:
        """
        –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ
        
        Args:
            card_element: –≠–ª–µ–º–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ
            card_index: –ò–Ω–¥–µ–∫—Å –∫–∞—Ä—Ç–æ—á–∫–∏ (–¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ –∏–ª–∏ None
        """
        try:
            video_data = {
                "ad_search_url": None,
                "impression": 0,
                "first_seen": None,
                "card_element": card_element,  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –∫–ª–∏–∫–∞
            }
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï IMPRESSION ==========
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ HTML-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
            # –ò—â–µ–º div.data-count > div.item –≥–¥–µ caption = "Impression"
            try:
                # –ò—â–µ–º –≤—Å–µ –±–ª–æ–∫–∏ data-count
                data_count_items = await card_element.query_selector_all('div.data-count div.item')
                
                if card_index <= 3:
                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –Ω–∞–π–¥–µ–Ω–æ {len(data_count_items)} –±–ª–æ–∫–æ–≤ div.item")
                
                for idx, item in enumerate(data_count_items):
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å impression
                    caption_elem = await item.query_selector('p.caption')
                    if caption_elem:
                        caption_text = await caption_elem.inner_text()
                        
                        if card_index <= 3:
                            log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}, –±–ª–æ–∫ {idx}: caption = '{caption_text}'")
                        
                        if 'Impression' in caption_text or '–ü–æ–∫–∞–∑' in caption_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
                            value_elem = await item.query_selector('p.value')
                            if value_elem:
                                # –ü–æ–ø—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
                                impression_str_inner = (await value_elem.inner_text()).strip()
                                impression_str_html = (await value_elem.inner_html()).strip()
                                impression_str_content = (await value_elem.text_content()).strip()
                                
                                # –í–°–ï–ì–î–ê –ª–æ–≥–∏—Ä—É–µ–º RAW-–∑–Ω–∞—á–µ–Ω–∏–µ (–¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–∞—Ä—Ç–æ—á–µ–∫)
                                if card_index <= 3:
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (inner_text) = '{impression_str_inner}'")
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (inner_html) = '{impression_str_html}'")
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (text_content) = '{impression_str_content}'")
                                
                                # –ò—Å–ø–æ–ª—å–∑—É–µ–º inner_text –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫
                                impression_str = impression_str_inner
                                impression = validator.parse_impressions(impression_str)
                                if impression:
                                    video_data["impression"] = impression
                                    if card_index <= 3:
                                        log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression PARSED = {impression}")
                                    break
                                else:
                                    if card_index <= 3:
                                        log.warning(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: parse_impressions –≤–µ—Ä–Ω—É–ª None –¥–ª—è '{impression_str}'")
            except Exception as e:
                if card_index <= 3:
                    log.error(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ impression: {e}")
                    import traceback
                    log.error(traceback.format_exc())
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï FIRST SEEN ==========
            # –ò—â–µ–º div.create-time > span —Å –¥–∞—Ç–æ–π
            try:
                create_time_elem = await card_element.query_selector('div.create-time span')
                if create_time_elem:
                    date_text = (await create_time_elem.inner_text()).strip()
                    # –õ–æ–≥–∏—Ä—É–µ–º RAW-–∑–Ω–∞—á–µ–Ω–∏–µ
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: first_seen RAW='{date_text}'")
                    
                    # –§–æ—Ä–º–∞—Ç: "Nov 05 2025-Nov 11 2025" - –±–µ—Ä–µ–º –ü–ï–†–í–£–Æ –¥–∞—Ç—É (–¥–æ –¥–µ—Ñ–∏—Å–∞)
                    # –ò—Å–ø–æ–ª—å–∑—É–µ–º regex –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–µ—Ä–≤–æ–π –¥–∞—Ç—ã
                    match = re.match(r'([A-Z][a-z]{2}\s+\d{1,2}\s+\d{4})', date_text)
                    if match:
                        first_seen_str = match.group(1)
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –¥–∞—Ç—ã
                        parsed_date = validator.parse_video_date(first_seen_str)
                        if parsed_date:
                            video_data["first_seen"] = first_seen_str
                            log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: first_seen parsed='{first_seen_str}'")
            except Exception as e:
                if card_index <= 3:
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ first_seen —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä: {e}")
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï AD-SEARCH –°–°–´–õ–ö–ò ==========
            try:
                link_element = await card_element.query_selector('a.btn-detail[href*="/ad-search/"]')
                if link_element:
                    href = await link_element.get_attribute("href")
                    if href:
                        if href.startswith("/"):
                            video_data["ad_search_url"] = f"https://www.pipiads.com{href}"
                        elif href.startswith("http"):
                            video_data["ad_search_url"] = href
                        else:
                            video_data["ad_search_url"] = f"https://www.pipiads.com/{href}"
                        if card_index <= 3:
                            log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: ad_search_url = {video_data['ad_search_url']}")
            except Exception as e:
                if card_index <= 3:
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ ad_search_url: {e}")
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Å—Å—ã–ª–∫—É, –Ω–æ –µ—Å—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∞ - –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –Ω–µ—ë
            if not video_data["ad_search_url"]:
                video_data["card_element"] = card_element
            
            # –õ–æ–≥–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–∞—Ä—Ç–æ—á–µ–∫
            if card_index <= 3:
                log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –∏—Ç–æ–≥–æ - impression={video_data['impression']}, first_seen={video_data['first_seen']}, ad_search_url={bool(video_data['ad_search_url'])}")
            
            return video_data
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ {card_index}: {e}")
            import traceback
            log.debug(traceback.format_exc())
            return None
    
    async def _filter_videos(self, videos: List[Dict[str, Any]]) -> List[Dict[str, Any]]:
        """
        –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
        
        Args:
            videos: –°–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        
        Returns:
            –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ
        """
        filtered = []
        
        for video in videos:
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ impression (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π "170.6K" –∏–ª–∏ —á–∏—Å–ª–æ–º)
            impression = video.get("impression", 0)
            impression_num = 0
            if isinstance(impression, str):
                # –ü–∞—Ä—Å–∏–º —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                impression_num = validator.parse_impressions(impression) or 0
            elif isinstance(impression, (int, float)):
                impression_num = int(impression)
            
            if not validator.validate_impressions(impression_num, config.MIN_IMPRESSIONS):
                log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: impression {impression} ({impression_num}) < {config.MIN_IMPRESSIONS}")
                continue
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
            first_seen = video.get("first_seen")
            if first_seen and first_seen != "N/A" and first_seen is not None:
                parsed_date = validator.parse_video_date(first_seen)
                if parsed_date:
                    if not validator.is_date_within_days(parsed_date, config.DAYS_BACK):
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –¥–∞—Ç–∞ {first_seen} —Å—Ç–∞—Ä—à–µ {config.DAYS_BACK} –¥–Ω–µ–π")
                        continue
                else:
                    # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å, –Ω–æ –µ—Å—Ç—å impression >= 50k, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –¥–∞—Ç—ã
                    if impression >= config.MIN_IMPRESSIONS:
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–∏–Ω—è—Ç–æ: –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É {first_seen}, –Ω–æ impression {impression} >= {config.MIN_IMPRESSIONS}")
                    else:
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É {first_seen} –∏ impression {impression} < {config.MIN_IMPRESSIONS}")
                        continue
            # –ï—Å–ª–∏ –¥–∞—Ç—ã –Ω–µ—Ç, –Ω–æ impression >= 50k, –ø—Ä–∏–Ω–∏–º–∞–µ–º –≤–∏–¥–µ–æ
            elif impression >= config.MIN_IMPRESSIONS:
                log.debug(f"–í–∏–¥–µ–æ –ø—Ä–∏–Ω—è—Ç–æ: –Ω–µ—Ç –¥–∞—Ç—ã, –Ω–æ impression {impression} >= {config.MIN_IMPRESSIONS}")
            else:
                log.debug("–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –Ω–µ—Ç –¥–∞—Ç—ã first_seen –∏ impression < –º–∏–Ω–∏–º—É–º–∞")
                continue
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
            video["_impression_num"] = impression_num
            filtered.append(video)
        
        # –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: —Å–Ω–∞—á–∞–ª–∞ –ø–æ –¥–∞—Ç–µ (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ), –ø–æ—Ç–æ–º –ø–æ impressions (—Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ)
        # –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ ad_search_url (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π), –∑–∞—Ç–µ–º tiktok_link, –∑–∞—Ç–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—è
        seen_videos = set()
        unique_videos = []
        for video in filtered:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)
            # 1. ad_search_url (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ)
            # 2. tiktok_link (–µ—Å–ª–∏ ad_search_url –Ω–µ—Ç)
            # 3. –ö–æ–º–±–∏–Ω–∞—Ü–∏—è impression + first_seen (fallback)
            video_id = None
            
            # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º ad_search_url (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ)
            ad_search_url = video.get("ad_search_url", "")
            if ad_search_url and ad_search_url != "N/A":
                ad_search_url = ad_search_url.rstrip('/')
                video_id = f"ad_search:{ad_search_url}"
            elif video.get("tiktok_link") and video.get("tiktok_link") != "N/A":
                video_id = f"tiktok:{video.get('tiktok_link')}"
            else:
                # Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—é impression + first_seen
                impression = video.get("impression", 0)
                first_seen = video.get("first_seen", "N/A")
                video_id = f"fallback:{impression}:{first_seen}"
            
            if video_id and video_id not in seen_videos:
                seen_videos.add(video_id)
                unique_videos.append(video)
            else:
                log.info(f"‚è≠Ô∏è  –í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ –∫–∞–∫ –¥—É–±–ª–∏–∫–∞—Ç: {video_id}")
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º: —Å–Ω–∞—á–∞–ª–∞ –ø–æ –¥–∞—Ç–µ (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ), –ø–æ—Ç–æ–º –ø–æ impressions (—Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ)
        def sort_key(v):
            parsed_date = validator.parse_video_date(v.get("first_seen", ""))
            if parsed_date:
                date_timestamp = -parsed_date.timestamp()  # –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ —É–±—ã–≤–∞–Ω–∏—é (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ)
            else:
                date_timestamp = 0  # –í–∏–¥–µ–æ –±–µ–∑ –¥–∞—Ç—ã –≤ –∫–æ–Ω–µ—Ü
            return (date_timestamp, -v.get("_impression_num", 0))
        
        unique_videos.sort(key=sort_key)
        
        # –ë–µ—Ä–µ–º —Ç–æ–ø-3
        top_videos = unique_videos[:3]
        
        log.info(f"‚úÖ –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ {len(filtered)} –≤–∏–¥–µ–æ –∏–∑ {len(videos)}, —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö: {len(unique_videos)}, —Ç–æ–ø-3: {len(top_videos)}")
        return top_videos
    
    async def _get_video_details(self, video: Dict[str, Any]) -> Optional[Dict[str, Any]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –≤–∏–¥–µ–æ
        
        Args:
            video: –°–ª–æ–≤–∞—Ä—å —Å –±–∞–∑–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ (–∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        try:
            # –ï—Å–ª–∏ –µ—Å—Ç—å ad_search_url, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞–ø—Ä—è–º—É—é
            if video.get("ad_search_url"):
                log.info(f"    ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É ad-search: {video['ad_search_url']}")
                await self.page.goto(video["ad_search_url"], wait_until="domcontentloaded", timeout=30000)
                await self.human_delay(0.5, 1)
                log.info("    ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ad-search –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            else:
                # –ï—Å–ª–∏ –Ω–µ—Ç URL, –∫–ª–∏–∫–∞–µ–º –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É
                # –í–ê–ñ–ù–û: –≠–ª–µ–º–µ–Ω—Ç –º–æ–∂–µ—Ç –∏—Å—á–µ–∑–Ω—É—Ç—å –∏–∑ DOM, –ø–æ—ç—Ç–æ–º—É –∏—â–µ–º –µ–≥–æ –∑–∞–Ω–æ–≤–æ
                card_element = video.get("card_element")
                if not card_element:
                    log.error("    ‚ùå –ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ –ø–µ—Ä–µ–π—Ç–∏ –∫ –≤–∏–¥–µ–æ (–Ω–µ—Ç URL –∏ —ç–ª–µ–º–µ–Ω—Ç–∞)")
                    return None
                
                log.info("    ‚Üí –ö–ª–∏–∫ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –≤–∏–¥–µ–æ...")
                try:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –µ—â–µ –≤ DOM
                    is_attached = await card_element.evaluate("el => el.isConnected")
                    if not is_attached:
                        log.warning("    ‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç –∏—Å—á–µ–∑ –∏–∑ DOM, –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∑–∞–Ω–æ–≤–æ...")
                        # –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ –ø–æ ad_search_url –∏–ª–∏ –¥—Ä—É–≥–∏–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º
                        # –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None
                        log.error("    ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ")
                        return None
                    
                    await card_element.click()
                    await self.human_delay(0.5, 1)
                    log.info("    ‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ –≤–∏–¥–µ–æ –æ—Ç–∫—Ä—ã—Ç–∞")
                except Exception as e:
                    log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É: {e}")
                    log.warning("    ‚ö†Ô∏è –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ...")
                    # –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –∏—Å—á–µ–∑, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None
                    return None
                
                # –ñ–¥–µ–º –æ—Ç–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞/–º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                # –ò—â–µ–º –∫–Ω–æ–ø–∫—É "More detail"
                log.info("    ‚Üí –ü–æ–∏—Å–∫ –∫–Ω–æ–ø–∫–∏ 'More detail'...")
                more_detail_selectors = [
                    'text="More detail"',
                    'text="More Detail"',
                    'button:has-text("More detail")',
                    'a:has-text("More detail")',
                ]
                
                more_detail_button = None
                for selector in more_detail_selectors:
                    try:
                        more_detail_button = await self.page.wait_for_selector(selector, timeout=5000, state="visible")
                        if more_detail_button:
                            log.info(f"    ‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ 'More detail' (—Å–µ–ª–µ–∫—Ç–æ—Ä: {selector})")
                            break
                    except:
                        continue
                
                if not more_detail_button:
                    log.error("    ‚ùå –ö–Ω–æ–ø–∫–∞ 'More detail' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
                    return None
                
                # –ö–ª–∏–∫–∞–µ–º –Ω–∞ "More detail"
                log.info("    ‚Üí –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É 'More detail'...")
                await more_detail_button.click()
                await self.human_delay(0.5, 1)
                
                # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
                log.info("    ‚Üí –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search...")
                await self.page.wait_for_load_state("domcontentloaded", timeout=10000)
                await self.human_delay(0.3, 0.5)
                log.info("    ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ad-search –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
            # –ü–µ—Ä–µ–¥–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏) –¥–ª—è fallback
            log.info("    ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search...")
            
            # –í–ê–ñ–ù–û: –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º domcontentloaded (–±—ã—Å—Ç—Ä–µ–µ) + –∑–∞–¥–µ—Ä–∂–∫–∞ + –æ–∂–∏–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            await self.page.wait_for_load_state("domcontentloaded", timeout=10000)
            await self.human_delay(2, 3)  # –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (Script, Hook, Audience) —Å retry
            elements_found = False
            for attempt in range(3):  # 3 –ø–æ–ø—ã—Ç–∫–∏
                try:
                    # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                    await self.page.wait_for_selector('li#ai-script, li#ai-hook, div.addel-info-item', timeout=5000, state="visible")
                    log.info(f"    ‚úÖ –ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search (–ø–æ–ø—ã—Ç–∫–∞ {attempt + 1})")
                    elements_found = True
                    break
                except:
                    if attempt < 2:
                        log.debug(f"    ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∂–¥–µ–º –µ—â–µ...")
                        await self.human_delay(2, 3)
                    else:
                        log.warning("    ‚ö†Ô∏è –ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ 3 –ø–æ–ø—ã—Ç–æ–∫, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ...")
            
            return await self._extract_ad_search_data(video)
            
        except Exception as e:
            log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–µ—Ç–∞–ª–µ–π –≤–∏–¥–µ–æ: {e}")
            import traceback
            log.error(traceback.format_exc())
            return None
    
    async def _extract_ad_search_data(self, original_video: Optional[Dict[str, Any]] = None) -> Dict[str, Any]:
        """
        –ò–∑–≤–ª–µ—á—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
        
        Args:
            original_video: –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (–¥–ª—è fallback impressions)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        video_data = {
            "tiktok_link": "N/A",
            "impression": 0,
            "script": "N/A",
            "hook": "N/A",
            "audience_age": "N/A",
            "country": "N/A",
            "first_seen": "N/A",
        }
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è fallback
        if original_video:
            original_impression = original_video.get("impression")
            if original_impression:
                video_data["_original_impression"] = original_impression
        
        try:
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            await self.page.wait_for_load_state("domcontentloaded")
            await self.human_delay(0.3, 0.5)
            
            # –ü–æ–ª—É—á–∞–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ø–æ–∏—Å–∫–∞
            page_text = await self.page.content()
            
            # 1. TikTok —Å—Å—ã–ª–∫–∞ (–∏–∑ –ø–æ–ª—è "TikTok Post" (–∞–Ω–≥–ª.) –∏–ª–∏ "–ü–æ—Å—Ç TikTok" (—Ä—É—Å.))
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ TikTok —Å—Å—ã–ª–∫–∏...")
            
            # –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –ø–æ —Ç–µ–∫—Å—Ç—É "TikTok Post" –∏–ª–∏ "–ü–æ—Å—Ç TikTok"
            tiktok_post_selectors = [
                'text=/TikTok Post/i',  # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
                'text=/–ü–æ—Å—Ç TikTok/i',  # –†—É—Å—Å–∫–∏–π fallback
            ]
            
            for selector in tiktok_post_selectors:
                try:
                    locator = self.page.locator(selector).first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Å—Å—ã–ª–∫—É —Ä—è–¥–æ–º
                        try:
                            parent_locator = locator.locator("..")
                            # –ò—â–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å—Å—ã–ª–∫–∞–º —Å /v/)
                            link = await parent_locator.locator('a[href*="m.tiktok.com/v/"]').first.element_handle()
                            if not link:
                                link = await parent_locator.locator('a[href*="tiktok.com/v/"]').first.element_handle()
                            if not link:
                                link = await parent_locator.locator('a[href*="tiktok.com"]').first.element_handle()
                            if link:
                                href = await link.get_attribute("href")
                                if href:
                                    # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä—ã –≤ TikTok Shop
                                    if "shop.tiktok.com/view/product" in href or "/view/product" in href:
                                        log.debug(f"      ‚Üí –ü—Ä–æ–ø—É—â–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä: {href[:50]}...")
                                        continue
                                    # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ
                                    if "/v/" in href or "m.tiktok.com" in href:
                                        video_data["tiktok_link"] = href
                                        log.info(f"      ‚úÖ TikTok —Å—Å—ã–ª–∫–∞ –Ω–∞–π–¥–µ–Ω–∞: {href[:50]}...")
                                        break
                        except:
                            pass
                except:
                    continue
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç, –∏—â–µ–º –≤—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ TikTok
            # –í–ê–ñ–ù–û: –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ (m.tiktok.com/v/...), –ù–ï –Ω–∞ —Ç–æ–≤–∞—Ä—ã (shop.tiktok.com/view/product/...)
            if video_data["tiktok_link"] == "N/A":
                tiktok_link_selectors = [
                    'a[href*="m.tiktok.com/v/"]',  # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ
                    'a[href*="tiktok.com/v/"]',    # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                    'a[href*="tiktok.com"]',       # Fallback
                ]
                
                for selector in tiktok_link_selectors:
                    try:
                        links = await self.page.query_selector_all(selector)
                        for link in links:
                            href = await link.get_attribute("href")
                            if href and "tiktok.com" in href:
                                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä—ã –≤ TikTok Shop
                                if "shop.tiktok.com/view/product" in href or "/view/product" in href:
                                    log.debug(f"      ‚Üí –ü—Ä–æ–ø—É—â–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä: {href[:50]}...")
                                    continue
                                
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ (—Å–æ–¥–µ—Ä–∂–∞—Ç /v/ –≤ –ø—É—Ç–∏)
                                if "/v/" in href or "m.tiktok.com" in href:
                                    video_data["tiktok_link"] = href
                                    log.info(f"      ‚úÖ TikTok —Å—Å—ã–ª–∫–∞ –Ω–∞–π–¥–µ–Ω–∞: {href[:50]}...")
                                    break
                        if video_data["tiktok_link"] != "N/A":
                            break
                    except:
                        continue
            
            if video_data["tiktok_link"] == "N/A":
                log.warning("      ‚ö†Ô∏è TikTok —Å—Å—ã–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
            
            # 2. Impressions - –ö–†–ò–¢–ò–ß–ù–û: "Impressions" (–∞–Ω–≥–ª.) –∏–ª–∏ "–ü–æ–∫–∞–∑—ã" (—Ä—É—Å.), –Ω–µ "Likes" –∏–ª–∏ "–ù—Ä–∞–≤–∏—Ç—Å—è"!
            # –ò—â–µ–º –≤ —Ä–∞–∑–¥–µ–ª–µ "Data/–î–∞–Ω–Ω—ã–µ" –≤ –ø—É–Ω–∫—Ç–µ "Impression/–ü–æ–∫–∞–∑"
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ impressions...")
            impression_text = await self._extract_impressions()
            if impression_text:
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–µ—Å–ª–∏ –æ–Ω —É–∂–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "170.6K" –∏–ª–∏ "339.9M")
                if impression_text.upper().endswith(('K', 'M')):
                    video_data["impression"] = impression_text
                    log.info(f"      ‚úÖ Impressions (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç): {impression_text}")
                else:
                    # –ü–∞—Ä—Å–∏–º —á–∏—Å–ª–æ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞—Ç–Ω–æ
                    impression_num = validator.parse_impressions(impression_text) or 0
                    video_data["impression"] = validator.format_impressions(impression_num)
                    log.info(f"      ‚úÖ Impressions (—Å—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–æ): {video_data['impression']}")
            else:
                # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ–Ω–∏ –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                # (–∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞)
                original_impression = video_data.get("_original_impression")
                if original_impression:
                    if isinstance(original_impression, (int, float)) and original_impression > 0:
                        video_data["impression"] = validator.format_impressions(int(original_impression))
                        log.info(f"      ‚úÖ Impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏: {video_data['impression']}")
                    elif isinstance(original_impression, str) and original_impression != "N/A":
                        video_data["impression"] = original_impression
                        log.info(f"      ‚úÖ Impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (—Å—Ç—Ä–æ–∫–∞): {original_impression}")
                    else:
                        video_data["impression"] = "N/A"
                        log.warning("      ‚ö†Ô∏è Impressions –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –Ω–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ")
                else:
                    video_data["impression"] = "N/A"
                    log.warning("      ‚ö†Ô∏è Impressions –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
            
            # 3. Script (–∏–∑ "Transcript" –∏–ª–∏ "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞")
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è (script)...")
            log.info(f"      ‚Üí –¢–µ–∫—É—â–∏–π URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {self.page.url}")
            script = await self._extract_script()
            if script:
                video_data["script"] = script
                log.info(f"      ‚úÖ Script –Ω–∞–π–¥–µ–Ω ({len(script)} —Å–∏–º–≤–æ–ª–æ–≤): {script[:100]}...")
            else:
                video_data["script"] = "N/A"
                log.warning("      ‚ö†Ô∏è Script –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-script p.content-text –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 4. Hook (–∏–∑ —Å–µ–∫—Ü–∏–∏ Hook –∏–ª–∏ Hooks)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ hook...")
            hook = await self._extract_hook()
            if not hook:
                # –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω
                log.warning("      ‚ö†Ô∏è Hook –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫...")
                await self.human_delay(1, 2)  # –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É
                hook = await self._extract_hook()
            
            if hook:
                video_data["hook"] = hook
                log.info(f"      ‚úÖ Hook –Ω–∞–π–¥–µ–Ω ({len(hook)} —Å–∏–º–≤–æ–ª–æ–≤): {hook[:100]}...")
            else:
                video_data["hook"] = "N/A"
                log.warning("      ‚ö†Ô∏è Hook –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook p.content-text –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 5. Audience Age (–∏–∑ –ø–æ–ª—è Audience/–ê—É–¥–∏—Ç–æ—Ä–∏—è)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∞—É–¥–∏—Ç–æ—Ä–∏–∏...")
            audience_data = await self._extract_audience()
            if audience_data:
                age = audience_data.get("age", "N/A")
                platform = audience_data.get("platform", "N/A")
                # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ "35-45" –∏–ª–∏ "35-45 Android" (–µ—Å–ª–∏ –µ—Å—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞)
                # –í —Å—Ç—Ä–æ–∫–µ 6 —Ç–æ–ª—å–∫–æ –≤–æ–∑—Ä–∞—Å—Ç "25-35", –±–µ–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
                video_data["audience_age"] = age if age != "N/A" else "N/A"
                log.info(f"      ‚úÖ Audience: {video_data['audience_age']}")
            else:
                video_data["audience_age"] = "N/A"
                log.info("      ‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
            
            # 6. Country (–∏–∑ –ø–æ–ª—è "Country/Region" –∏–ª–∏ "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω" - –û–¢–î–ï–õ–¨–ù–û –æ—Ç Audience!)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã...")
            country = await self._extract_country()
            if country:
                video_data["country"] = country
                log.info(f"      ‚úÖ Country: {country}")
            else:
                video_data["country"] = "N/A"
                log.warning("      ‚ö†Ô∏è Country –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä div.addel-info-item —Å 'Country/Region' –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 7. First seen (—Ñ–æ—Ä–º–∞—Ç "Oct 27 2025" - –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ "Oct 28 2025 ~ Nov 10 2025")
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞—Ç—ã First seen...")
            first_seen = await self._extract_first_seen()
            if first_seen:
                video_data["first_seen"] = first_seen
                log.info(f"      ‚úÖ First seen: {first_seen}")
            else:
                video_data["first_seen"] = "N/A"
                log.info("      ‚ö†Ô∏è First seen –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
            
            log.info(f"    ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ—á–µ–Ω—ã: impression={video_data['impression']}, first_seen={video_data['first_seen']}")
            return video_data
            
        except Exception as e:
            log.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö ad-search: {e}")
            return video_data
    
    async def _extract_impressions(self) -> Optional[str]:
        """
        –ò–∑–≤–ª–µ—á—å impressions - –ö–†–ò–¢–ò–ß–ù–û: –≤ —Ä–∞–∑–¥–µ–ª–µ "Data/–î–∞–Ω–Ω—ã–µ" –≤ –ø—É–Ω–∫—Ç–µ "Impression/–ü–æ–∫–∞–∑"
        –í–ê–ñ–ù–û: –ù–ï –±—Ä–∞—Ç—å —à–∞–±–ª–æ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã!
        
        Returns:
            –°—Ç—Ä–æ–∫–∞ —Å impressions (–Ω–∞–ø—Ä–∏–º–µ—Ä "170.6K", "339.9M") –∏–ª–∏ None
        """
        try:
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM (–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ)
            try:
                impression_data = await self.page.evaluate("""
                    () => {
                        // –ò—â–µ–º —Ä–∞–∑–¥–µ–ª "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                        const dataKeywords = ['Data', '–î–∞–Ω–Ω—ã–µ'];
                        const impressionKeywords = ['Impression', '–ü–æ–∫–∞–∑', '–ü–æ–∫–∞–∑—ã'];
                        
                        // –ò—â–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —ç–ª–µ–º–µ–Ω—Ç "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                            for (const dataKeyword of dataKeywords) {
                                if (text.includes(dataKeyword)) {
                                    // –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –∏—â–µ–º "Impression" –∏–ª–∏ "–ü–æ–∫–∞–∑"
                                    for (const impKeyword of impressionKeywords) {
                                        if (text.includes(impKeyword)) {
                                            // –ò—â–µ–º —á–∏—Å–ª–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "170.6K", "403.2M" –∏ —Ç.–¥.
                                            const patterns = [
                                                new RegExp(impKeyword + '[\\s:]*([\\d.,]+[KM]?)', 'i'),
                                                new RegExp('([\\d.,]+[KM]?)\\s*' + impKeyword, 'i')
                                            ];
                                            
                                            for (const pattern of patterns) {
                                                const match = text.match(pattern);
                                                if (match && match[1]) {
                                                    const value = match[1];
                                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ —á–∏—Å–ª–æ (–Ω–µ —à–∞–±–ª–æ–Ω–Ω–æ–µ)
                                                    // –û–±—ã—á–Ω–æ —Ä–µ–∞–ª—å–Ω—ã–µ impressions –æ—Ç 50K –¥–æ 500M
                                                    const numValue = parseFloat(value.replace(/[KM]/i, ''));
                                                    if (numValue >= 0.05 && numValue <= 1000) {
                                                        return value;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        
                        // Fallback: –∏—â–µ–º –Ω–∞–ø—Ä—è–º—É—é "Impression" –∏–ª–∏ "–ü–æ–∫–∞–∑" (–ù–ï "Likes"!)
                        for (const impKeyword of impressionKeywords) {
                            const elements = Array.from(document.querySelectorAll('*')).filter(el => {
                                const text = el.innerText || '';
                                return text.includes(impKeyword) && !text.toLowerCase().includes('likes') && !text.toLowerCase().includes('–Ω—Ä–∞–≤–∏—Ç—Å—è');
                            });
                            
                            for (const el of elements) {
                                const text = el.innerText || '';
                                const patterns = [
                                    new RegExp(impKeyword + '[\\s:]*([\\d.,]+[KM]?)', 'i'),
                                    new RegExp('([\\d.,]+[KM]?)\\s*' + impKeyword, 'i')
                                ];
                                
                                for (const pattern of patterns) {
                                    const match = text.match(pattern);
                                    if (match && match[1]) {
                                        const value = match[1];
                                        const numValue = parseFloat(value.replace(/[KM]/i, ''));
                                        if (numValue >= 0.05 && numValue <= 1000) {
                                            return value;
                                        }
                                    }
                                }
                            }
                        }
                        
                        return null;
                    }
                """)
                
                if impression_data:
                    log.debug(f"–ù–∞–π–¥–µ–Ω–æ impressions —á–µ—Ä–µ–∑ JavaScript: {impression_data}")
                    return impression_data
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ impressions —á–µ—Ä–µ–∑ JS: {e}")
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (fallback)
            data_keywords = ["Data", "–î–∞–Ω–Ω—ã–µ"]
            
            for keyword in data_keywords:
                try:
                    data_locator = self.page.locator(f'text=/{keyword}/i').first
                    if await data_locator.count() > 0:
                        impression_keywords = ["Impression", "–ü–æ–∫–∞–∑", "–ü–æ–∫–∞–∑—ã"]
                        for imp_keyword in impression_keywords:
                            try:
                                parent_text = await data_locator.locator("..").inner_text()
                                if imp_keyword in parent_text and "Likes" not in parent_text and "–ù—Ä–∞–≤–∏—Ç—Å—è" not in parent_text:
                                    pattern = rf'{imp_keyword}[:\s]*([\d.,]+[KM]?)'
                                    match = re.search(pattern, parent_text, re.IGNORECASE)
                                    if match:
                                        impression_str = match.group(1)
                                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —à–∞–±–ª–æ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                                        num_value = validator.parse_impressions(impression_str)
                                        if num_value and 50000 <= num_value <= 1000000000:  # –û—Ç 50K –¥–æ 1B
                                            log.debug(f"–ù–∞–π–¥–µ–Ω–æ impressions –≤ —Ä–∞–∑–¥–µ–ª–µ Data: {impression_str}")
                                            return impression_str
                            except:
                                continue
                except:
                    continue
            
            log.warning("–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ 'Impression' –∏–ª–∏ '–ü–æ–∫–∞–∑' –≤ —Ä–∞–∑–¥–µ–ª–µ Data")
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ impressions: {e}")
            return None
    
    async def _extract_script(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å —Å—Ü–µ–Ω–∞—Ä–∏–π –∏–∑ —Å–µ–∫—Ü–∏–∏ 'Script' –∏–ª–∏ '–°—Ü–µ–Ω–∞—Ä–∏–π' (–∏–ª–∏ 'Transcript' –∏–ª–∏ '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞')
        
        –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
        <li id="ai-script">
            <div class="li-title">...</div>
            <div class="control-content li-content">
                <p class="content-text slot-wrap">...</p>
            </div>
        </li>
        """
        try:
            # –ú–ï–¢–û–î 0: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä—É –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                # –°–Ω–∞—á–∞–ª–∞ –∂–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
                try:
                    await self.page.wait_for_selector('li#ai-script', timeout=5000, state="visible")
                except:
                    log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-script –Ω–µ –ø–æ—è–≤–∏–ª—Å—è –∑–∞ 5 —Å–µ–∫—É–Ω–¥")
                
                script_element = await self.page.query_selector('li#ai-script p.content-text')
                if script_element:
                    script = await script_element.inner_text()
                    if script and len(script.strip()) > 10:
                        log.info(f"      ‚úÖ Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-script p.content-text ({len(script)} —Å–∏–º–≤–æ–ª–æ–≤)")
                        return script.strip()
                else:
                    log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-script p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω")
            except Exception as e:
                log.debug(f"      ‚Üí –°–µ–ª–µ–∫—Ç–æ—Ä li#ai-script –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: {e}")
            
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
            script_keywords = ["Script", "–°—Ü–µ–Ω–∞—Ä–∏–π", "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞", "–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç"]
            
            for keyword in script_keywords:
                try:
                    # –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å —Ç–µ–∫—Å—Ç–æ–º
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            parent_text = await locator.locator("..").inner_text()
                            if keyword in parent_text:
                                parts = parent_text.split(keyword, 1)
                                if len(parts) > 1:
                                    script = parts[1].strip()
                                    # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –º–µ—Ç–∫–∏
                                    stop_words = ["Hook", "–•—É–∫", "Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", 
                                                "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", "Impressions", "–ü–æ–∫–∞–∑—ã",
                                                "Limited Time Offer", "Annual Plan", "Promotion Period", "50% OFF",
                                                "Privacy", "Terms", "Copyright", "PIPIADS", "All Rights Reserved",
                                                "AI-agent", "cosmobeauty", "credits", "subscription", "invoice",
                                                "Monthly Credits", "Extra Credits", "data cost", "detail costs",
                                                "Team Setting", "Affiliate Dashboard", "Logout"]
                                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                           "cosmobeauty", "credits", "subscription", "invoice", 
                                                           "Monthly Credits", "Extra Credits", "@gmail.com"]
                                    is_footer_menu = any(keyword in script for keyword in footer_menu_keywords)
                                    
                                    for stop_word in stop_words:
                                        if stop_word in script:
                                            script = script.split(stop_word)[0].strip()
                                    # –§–∏–ª—å—Ç—Ä—É–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (Video Text Translator, Quality, Size –∏ —Ç.–¥.)
                                    metadata_keywords = ["Video Text Translator", "Translator", "Quality", "Size", "Resolution", 
                                                        "Width", "Height", "Duration", "Format", "Codec", "Frame Rate"]
                                    is_metadata = any(keyword in script for keyword in metadata_keywords)
                                    
                                    # –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                    lines = script.split('\n')
                                    cleaned_lines = []
                                    skip_words = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook']
                                    for line in lines:
                                        line = line.strip()
                                        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                        if line and not line.startswith('#') and not any(skip in line for skip in skip_words):
                                            cleaned_lines.append(line)
                                    script = '\n'.join(cleaned_lines).strip()
                                    
                                    if script and len(script) > 10 and not is_footer_menu and not is_metadata:
                                        log.debug(f"Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Ä–æ–¥–∏—Ç–µ–ª—å)")
                                        return script
                        except:
                            pass
                        
                        # –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            next_sibling = await locator.evaluate_handle("el => el.nextElementSibling")
                            if next_sibling:
                                script = await next_sibling.as_element().inner_text()
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                       "cosmobeauty", "credits", "subscription", "invoice", 
                                                       "Monthly Credits", "Extra Credits", "@gmail.com"]
                                is_footer_menu = any(keyword in script for keyword in footer_menu_keywords)
                                # –§–∏–ª—å—Ç—Ä—É–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                metadata_keywords = ["Video Text Translator", "Translator", "Quality", "Size", "Resolution"]
                                is_metadata = any(keyword in script for keyword in metadata_keywords)
                                
                                # –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                lines = script.split('\n')
                                cleaned_lines = []
                                skip_words = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook']
                                for line in lines:
                                    line = line.strip()
                                    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                    if line and not line.startswith('#') and not any(skip in line for skip in skip_words):
                                        cleaned_lines.append(line)
                                script = '\n'.join(cleaned_lines).strip()
                                
                                if script and len(script) > 10 and not is_footer_menu and not is_metadata:
                                    log.debug(f"Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç)")
                                    return script.strip()
                        except:
                            pass
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                script = await self.page.evaluate("""
                    () => {
                        const keywords = ['Script', '–°—Ü–µ–Ω–∞—Ä–∏–π', 'Transcript', '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞', '–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç'];
                        const stopWords = ['Hook', '–•—É–∫', 'Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 
                                          'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 'Impressions', '–ü–æ–∫–∞–∑—ã',
                                          'Analysis', 'Advertiser', 'Display Name', 'Ad Copy',
                                          'Limited Time Offer', 'Annual Plan', 'Promotion Period', '50% OFF'];
                        
                        // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    // –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ (–æ–±—ã—á–Ω–æ —ç—Ç–æ —Å–∞–º script)
                                    let scriptText = null;
                                    
                                    // –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ sibling —ç–ª–µ–º–µ–Ω—Ç–∞
                                    let nextSibling = el.nextElementSibling;
                                    if (nextSibling) {
                                        scriptText = nextSibling.innerText || '';
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    if (!scriptText || scriptText.length < 10) {
                                        const parentText = el.parentElement ? el.parentElement.innerText || '' : '';
                                        if (parentText.includes(keyword)) {
                                            const parts = parentText.split(keyword);
                                            if (parts.length > 1) {
                                                scriptText = parts[1].trim();
                                            }
                                        }
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 3: –ò—â–µ–º –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö (–æ–±—ã—á–Ω–æ script –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –±–ª–æ–∫–µ)
                                    if (!scriptText || scriptText.length < 10) {
                                        const children = el.querySelectorAll('p, div, span');
                                        for (const child of children) {
                                            const childText = child.innerText || '';
                                            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç—ã
                                            if (childText.length > 20 && 
                                                !childText.includes('Advertiser') && 
                                                !childText.includes('Display Name') &&
                                                !childText.includes('Analysis') &&
                                                !childText.includes('Generator') &&
                                                !childText.includes('Limited Time Offer') &&
                                                !childText.includes('Annual Plan') &&
                                                !childText.includes('Promotion Period') &&
                                                !childText.includes('50% OFF')) {
                                                scriptText = childText;
                                                break;
                                            }
                                        }
                                    }
                                    
                                    if (scriptText) {
                                        // –£–±–∏—Ä–∞–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                        for (const stopWord of stopWords) {
                                            if (scriptText.includes(stopWord)) {
                                                scriptText = scriptText.split(stopWord)[0];
                                            }
                                        }
                                        
                                        scriptText = scriptText.trim();
                                        
                                        // –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                        const skipWords = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook'];
                                        const lines = scriptText.split('\\n');
                                        const cleanedLines = [];
                                        for (const line of lines) {
                                            const trimmedLine = line.trim();
                                            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                            if (trimmedLine && !trimmedLine.startsWith('#') && 
                                                !skipWords.some(word => trimmedLine.includes(word))) {
                                                cleanedLines.push(trimmedLine);
                                            }
                                        }
                                        scriptText = cleanedLines.join('\\n').trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π script (–Ω–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –Ω–µ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç, –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é)
                                        const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                                   'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                                   'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                                   'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                                   'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                        const isFooterMenu = footerMenuKeywords.some(keyword => scriptText.includes(keyword));
                                        
                                        // –§–∏–ª—å—Ç—Ä—É–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                    const metadataKeywords = ['Video Text Translator', 'Translator', 'Quality', 'Size', 'Resolution', 
                                                             'Width', 'Height', 'Duration', 'Format', 'Codec', 'Frame Rate'];
                                    const isMetadata = metadataKeywords.some(keyword => scriptText.includes(keyword));
                                    
                                    if (scriptText && scriptText.length > 20 && 
                                            !scriptText.startsWith('Analysis') &&
                                            !scriptText.includes('shop.tiktok.com') &&
                                            !scriptText.includes('Generator Image') &&
                                            !scriptText.includes('Limited Time Offer') &&
                                            !scriptText.includes('Annual Plan') &&
                                            !scriptText.includes('Promotion Period') &&
                                            !scriptText.includes('50% OFF') &&
                                            !scriptText.toLowerCase().includes('q4') &&
                                            !scriptText.toLowerCase().includes('monthly plan') &&
                                            !isFooterMenu &&
                                            !isMetadata) {
                                            return scriptText;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if script and len(script) > 10:
                    log.debug("Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript")
                    return script.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ script —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è: {e}")
            return None
    
    async def _extract_hook(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å hook –∏–∑ —Å–µ–∫—Ü–∏–∏ Hook/Hooks (–∞–Ω–≥–ª.) –∏–ª–∏ –•—É–∫/–•—É–∫–∏ (—Ä—É—Å.)
        –í–ê–ñ–ù–û: Hook –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ Script –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ!
        
        –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
        <li id="ai-hook">
            <div class="li-title">...</div>
            <div class="control-content li-content">
                <p class="content-text slot-wrap">...</p>
            </div>
        </li>
        """
        try:
            # –ú–ï–¢–û–î 0: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä—É –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                # –°–Ω–∞—á–∞–ª–∞ –∂–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
                try:
                    await self.page.wait_for_selector('li#ai-hook', timeout=5000, state="visible")
                except:
                    log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-hook –Ω–µ –ø–æ—è–≤–∏–ª—Å—è –∑–∞ 5 —Å–µ–∫—É–Ω–¥")
                
                hook_element = await self.page.query_selector('li#ai-hook p.content-text')
                if hook_element:
                    hook = await hook_element.inner_text()
                    if hook and len(hook.strip()) > 5:
                        log.info(f"      ‚úÖ Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook p.content-text ({len(hook)} —Å–∏–º–≤–æ–ª–æ–≤)")
                        return hook.strip()
                else:
                    log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-hook p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω")
            except Exception as e:
                log.debug(f"      ‚Üí –°–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: {e}")
            
            # –ù–û–í–´–ô –ú–ï–¢–û–î: –ò—â–µ–º Script, –∑–∞—Ç–µ–º –∏—â–µ–º Hook –≤ —Å–ª–µ–¥—É—é—â–µ–º —ç–ª–µ–º–µ–Ω—Ç–µ/—Å–µ–∫—Ü–∏–∏
            try:
                # –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏–º Script
                script_keywords = ["Script", "–°—Ü–µ–Ω–∞—Ä–∏–π", "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞"]
                for script_keyword in script_keywords:
                    try:
                        script_locator = self.page.locator(f'text=/{script_keyword}/i').first
                        if await script_locator.count() > 0:
                            # –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ Script, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç "Hook" –∏–ª–∏ "Hooks"
                            # –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ –ø–æ—Å–ª–µ Script
                            try:
                                # –°–ø–æ—Å–æ–± 1: –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å "Hook" –∏–ª–∏ "Hooks" –ø–æ—Å–ª–µ Script
                                parent = script_locator.locator("..")
                                parent_text = await parent.inner_text()
                                
                                # –ò—â–µ–º "Hook" –∏–ª–∏ "Hooks" –≤ —Ç–æ–º –∂–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ
                                if "Hook" in parent_text or "Hooks" in parent_text or "–•—É–∫" in parent_text or "–•—É–∫–∏" in parent_text:
                                    # –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é Script –∏ Hook –≤ —Ç–µ–∫—Å—Ç–µ
                                    script_pos = parent_text.find(script_keyword)
                                    hook_pos = -1
                                    for hook_word in ["Hook", "Hooks", "–•—É–∫", "–•—É–∫–∏"]:
                                        pos = parent_text.find(hook_word, script_pos)
                                        if pos > script_pos:
                                            hook_pos = pos
                                            break
                                    
                                    if hook_pos > script_pos:
                                        # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ "Hook" –∏–ª–∏ "Hooks"
                                        hook_section = parent_text[hook_pos:]
                                        # –£–±–∏—Ä–∞–µ–º "Hook" –∏–ª–∏ "Hooks" –∏–∑ –Ω–∞—á–∞–ª–∞
                                        hook_section = re.sub(r'^Hooks?\s*:?\s*', '', hook_section, flags=re.IGNORECASE)
                                        hook_section = re.sub(r'^–•—É–∫–∏?\s*:?\s*', '', hook_section, flags=re.IGNORECASE)
                                        hook_text = hook_section.strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏ (Target Audience, First seen –∏ —Ç.–¥.)
                                        stop_words = ["Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", 
                                                    "Impressions", "–ü–æ–∫–∞–∑—ã", "Country", "–°—Ç—Ä–∞–Ω–∞", "Country/Region", "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω"]
                                        for stop_word in stop_words:
                                            if stop_word in hook_text:
                                                hook_text = hook_text.split(stop_word)[0].strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                        hook_text = re.sub(r'Quality\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'Size\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'Resolution\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'--', '', hook_text)
                                        hook_text = re.sub(r'\n{2,}', '\n', hook_text).strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞ –≤ –Ω–∞—á–∞–ª–µ
                                        hook_text = re.sub(r'^(Tags|Script|Hooks?)\s*:?\s*', '', hook_text, flags=re.IGNORECASE)
                                        
                                        if hook_text and len(hook_text) > 5 and len(hook_text) < 500:
                                            log.debug(f"Hook –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ Script —á–µ—Ä–µ–∑ '{script_keyword}'")
                                            return hook_text
                            except:
                                pass
                            
                            # –°–ø–æ—Å–æ–± 2: –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π sibling —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ Script
                            try:
                                script_element = await script_locator.element_handle()
                                if script_element:
                                    # –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å —Ç–µ–∫—Å—Ç–æ–º "Hook" –∏–ª–∏ "Hooks"
                                    next_elements = await self.page.evaluate("""
                                        (scriptEl) => {
                                            let current = scriptEl;
                                            // –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å "Hook" –∏–ª–∏ "Hooks"
                                            for (let i = 0; i < 10; i++) {
                                                current = current.nextElementSibling;
                                                if (!current) break;
                                                const text = current.innerText || '';
                                                if (text.includes('Hook') || text.includes('Hooks') || 
                                                    text.includes('–•—É–∫') || text.includes('–•—É–∫–∏')) {
                                                    // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ "Hook" –∏–ª–∏ "Hooks"
                                                    const parts = text.split(/Hooks?\\s*:?\\s*|–•—É–∫–∏?\\s*:?\\s*/i);
                                                    if (parts.length > 1) {
                                                        let hookText = parts[1].trim();
                                                        // –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏
                                                        const stopWords = ['Target Audience', 'First seen', 'Impressions', 'Country'];
                                                        for (const stop of stopWords) {
                                                            if (hookText.includes(stop)) {
                                                                hookText = hookText.split(stop)[0];
                                                            }
                                                        }
                                                        hookText = hookText.replace(/Quality\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/Size\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/Resolution\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/--/g, '');
                                                        hookText = hookText.replace(/\\n{2,}/g, '\\n').trim();
                                                        if (hookText && hookText.length > 5 && hookText.length < 500) {
                                                            return hookText;
                                                        }
                                                    }
                                                }
                                            }
                                            return null;
                                        }
                                    """, script_element)
                                    
                                    if next_elements:
                                        log.debug(f"Hook –Ω–∞–π–¥–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–º —ç–ª–µ–º–µ–Ω—Ç–µ –ø–æ—Å–ª–µ Script")
                                        return next_elements
                            except:
                                pass
                            
                            # –°–ø–æ—Å–æ–± 3: –ò—â–µ–º Hook –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –ø–æ—Å–ª–µ Script
                            try:
                                # –ü–æ–ª—É—á–∞–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –∏—â–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω "Script...Hook"
                                page_text = await self.page.content()
                                # –ò—â–µ–º —á–µ—Ä–µ–∑ JavaScript –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ
                                hook_text = await self.page.evaluate("""
                                    () => {
                                        // –ò—â–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Script"
                                        const allElements = Array.from(document.querySelectorAll('*'));
                                        for (const el of allElements) {
                                            const text = el.innerText || '';
                                            if (text.includes('Script') || text.includes('–°—Ü–µ–Ω–∞—Ä–∏–π')) {
                                                // –ò—â–µ–º –≤ —ç—Ç–æ–º –∂–µ —ç–ª–µ–º–µ–Ω—Ç–µ –∏–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º "Hook" –∏–ª–∏ "Hooks"
                                                let searchEl = el;
                                                for (let depth = 0; depth < 3; depth++) {
                                                    const searchText = searchEl.innerText || '';
                                                    if (searchText.includes('Hook') || searchText.includes('Hooks') || 
                                                        searchText.includes('–•—É–∫') || searchText.includes('–•—É–∫–∏')) {
                                                        // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –º–µ–∂–¥—É Script –∏ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Å–µ–∫—Ü–∏—è–º–∏
                                                        const scriptIndex = searchText.indexOf('Script');
                                                        const hookIndex = searchText.indexOf('Hook', scriptIndex);
                                                        if (hookIndex > scriptIndex) {
                                                            let hookText = searchText.substring(hookIndex);
                                                            // –£–±–∏—Ä–∞–µ–º "Hook" –∏–ª–∏ "Hooks" –∏–∑ –Ω–∞—á–∞–ª–∞
                                                            hookText = hookText.replace(/^Hooks?\\s*:?\\s*/i, '');
                                                            hookText = hookText.replace(/^–•—É–∫–∏?\\s*:?\\s*/i, '');
                                                            // –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏
                                                            const stopWords = ['Target Audience', 'First seen', 'Impressions', 'Country'];
                                                            for (const stop of stopWords) {
                                                                if (hookText.includes(stop)) {
                                                                    hookText = hookText.split(stop)[0];
                                                                }
                                                            }
                                                            hookText = hookText.replace(/Quality\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/Size\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/Resolution\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/--/g, '');
                                                            hookText = hookText.replace(/\\n{2,}/g, '\\n').trim();
                                                            if (hookText && hookText.length > 5 && hookText.length < 500) {
                                                                return hookText;
                                                            }
                                                        }
                                                    }
                                                    searchEl = searchEl.parentElement;
                                                    if (!searchEl) break;
                                                }
                                            }
                                        }
                                        return null;
                                    }
                                """)
                                
                                if hook_text:
                                    log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ—Å–ª–µ Script")
                                    return hook_text
                            except:
                                pass
                    except:
                        continue
            except:
                pass
            
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (—Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±, –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ fallback)
            hook_keywords = ["Hooks", "Hook", "–•—É–∫–∏", "–•—É–∫"]
            
            for keyword in hook_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            parent_text = await locator.locator("..").inner_text()
                            if keyword in parent_text:
                                parts = parent_text.split(keyword, 1)
                                if len(parts) > 1:
                                    hook = parts[1].strip()
                                    # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –º–µ—Ç–∫–∏
                                    stop_words = ["Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", 
                                                "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞", "Impressions", "–ü–æ–∫–∞–∑—ã",
                                                "Limited Time Offer", "Annual Plan", "Promotion Period", "50% OFF",
                                                "Privacy", "Terms", "Copyright", "PIPIADS", "All Rights Reserved",
                                                "AI-agent", "cosmobeauty", "credits", "subscription", "invoice",
                                                "Monthly Credits", "Extra Credits", "data cost", "detail costs",
                                                "Team Setting", "Affiliate Dashboard", "Logout"]
                                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                           "cosmobeauty", "credits", "subscription", "invoice", 
                                                           "Monthly Credits", "Extra Credits", "@gmail.com"]
                                    is_footer_menu = any(keyword in hook for keyword in footer_menu_keywords)
                                    
                                    for stop_word in stop_words:
                                        if stop_word in hook:
                                            hook = hook.split(stop_word)[0].strip()
                                    
                                    # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                    metadata_patterns = [
                                        r'Quality\s*:?\s*[^\n]*',
                                        r'Size\s*:?\s*[^\n]*',
                                        r'Resolution\s*:?\s*[^\n]*',
                                        r'Width\s*:?\s*[^\n]*',
                                        r'Height\s*:?\s*[^\n]*',
                                        r'Duration\s*:?\s*[^\n]*',
                                        r'Format\s*:?\s*[^\n]*',
                                        r'Codec\s*:?\s*[^\n]*',
                                        r'Frame Rate\s*:?\s*[^\n]*',
                                        r'--',  # –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                    ]
                                    for pattern in metadata_patterns:
                                        hook = re.sub(pattern, '', hook, flags=re.IGNORECASE)
                                    hook = re.sub(r'\n{2,}', '\n', hook).strip()  # –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                    
                                    if hook and len(hook) > 5 and not is_footer_menu:
                                        log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Ä–æ–¥–∏—Ç–µ–ª—å)")
                                        return hook
                        except:
                            pass
                        
                        # –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            next_sibling = await locator.evaluate_handle("el => el.nextElementSibling")
                            if next_sibling:
                                hook = await next_sibling.as_element().inner_text()
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                       "cosmobeauty", "credits", "subscription", "invoice", 
                                                       "Monthly Credits", "Extra Credits", "@gmail.com"]
                                is_footer_menu = any(keyword in hook for keyword in footer_menu_keywords)
                                
                                # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                metadata_patterns = [
                                    r'Quality\s*:?\s*[^\n]*',
                                    r'Size\s*:?\s*[^\n]*',
                                    r'Resolution\s*:?\s*[^\n]*',
                                    r'Width\s*:?\s*[^\n]*',
                                    r'Height\s*:?\s*[^\n]*',
                                    r'Duration\s*:?\s*[^\n]*',
                                    r'Format\s*:?\s*[^\n]*',
                                    r'Codec\s*:?\s*[^\n]*',
                                    r'Frame Rate\s*:?\s*[^\n]*',
                                    r'--',  # –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                ]
                                for pattern in metadata_patterns:
                                    hook = re.sub(pattern, '', hook, flags=re.IGNORECASE)
                                hook = re.sub(r'\n{2,}', '\n', hook).strip()  # –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                
                                if hook and len(hook) > 5 and not is_footer_menu:
                                    log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç)")
                                    return hook.strip()
                        except:
                            pass
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                hook = await self.page.evaluate("""
                    () => {
                        const keywords = ['Hooks', 'Hook', '–•—É–∫–∏', '–•—É–∫'];
                        const stopWords = ['Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 
                                         'Transcript', '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞', 'Impressions', '–ü–æ–∫–∞–∑—ã',
                                         'Script', '–°—Ü–µ–Ω–∞—Ä–∏–π', 'Analysis',
                                         'Limited Time Offer', 'Annual Plan', 'Promotion Period', '50% OFF'];
                        
                        // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    let hookText = null;
                                    
                                    // –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ sibling —ç–ª–µ–º–µ–Ω—Ç–∞
                                    let nextSibling = el.nextElementSibling;
                                    if (nextSibling) {
                                        hookText = nextSibling.innerText || '';
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    if (!hookText || hookText.length < 5) {
                                        const parentText = el.parentElement ? el.parentElement.innerText || '' : '';
                                        if (parentText.includes(keyword)) {
                                            const parts = parentText.split(keyword);
                                            if (parts.length > 1) {
                                                hookText = parts[1].trim();
                                            }
                                        }
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 3: –ò—â–µ–º –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö
                                    if (!hookText || hookText.length < 5) {
                                        const children = el.querySelectorAll('p, div, span');
                                        for (const child of children) {
                                            const childText = child.innerText || '';
                                            if (childText.length > 5 && childText.length < 200) {
                                                hookText = childText;
                                                break;
                                            }
                                        }
                                    }
                                    
                                    if (hookText) {
                                        // –£–±–∏—Ä–∞–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞
                                        for (const stopWord of stopWords) {
                                            if (hookText.includes(stopWord)) {
                                                hookText = hookText.split(stopWord)[0];
                                            }
                                        }
                                        
                                        hookText = hookText.trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π hook (–∫–æ—Ä–æ—Ç–∫–∞—è —Ñ—Ä–∞–∑–∞, –Ω–µ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç, –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é)
                                        const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                                   'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                                   'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                                   'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                                   'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                        const isFooterMenu = footerMenuKeywords.some(keyword => hookText.includes(keyword));
                                        
                                        // –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                        const metadataPatterns = [
                                            /Quality\s*:?\s*[^\n]*/gi,
                                            /Size\s*:?\s*[^\n]*/gi,
                                            /Resolution\s*:?\s*[^\n]*/gi,
                                            /Width\s*:?\s*[^\n]*/gi,
                                            /Height\s*:?\s*[^\n]*/gi,
                                            /Duration\s*:?\s*[^\n]*/gi,
                                            /Format\s*:?\s*[^\n]*/gi,
                                            /Codec\s*:?\s*[^\n]*/gi,
                                            /Frame Rate\s*:?\s*[^\n]*/gi,
                                            /--/g,  // –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                        ];
                                        let cleanedHook = hookText;
                                        for (const pattern of metadataPatterns) {
                                            cleanedHook = cleanedHook.replace(pattern, '');
                                        }
                                        cleanedHook = cleanedHook.replace(/\n{2,}/g, '\n').trim();  // –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                        
                                        if (cleanedHook && cleanedHook.length > 5 && cleanedHook.length < 300 &&
                                            !cleanedHook.includes('Limited Time Offer') &&
                                            !cleanedHook.includes('Annual Plan') &&
                                            !cleanedHook.includes('Promotion Period') &&
                                            !cleanedHook.includes('50% OFF') &&
                                            !cleanedHook.toLowerCase().includes('q4') &&
                                            !cleanedHook.toLowerCase().includes('monthly plan') &&
                                            !isFooterMenu) {
                                            return cleanedHook;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if hook and len(hook) > 5:
                    log.debug("Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript")
                    return hook.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ hook —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ hook: {e}")
            return None
    
    async def _extract_audience(self) -> Optional[Dict[str, str]]:
        """
        –ò–∑–≤–ª–µ—á—å –≤–æ–∑—Ä–∞—Å—Ç –∏–∑ –ø–æ–ª—è Audience
        
        –°—Ç—Ä—É–∫—Ç—É—Ä–∞ HTML:
        <div class="addel-info-item">
            <div class="name"> Audience </div>
            <div class="value">
                <div class="audience-info">
                    <div class="audience-info-info">45-55 ... Android...</div>
                </div>
            </div>
        </div>
        """
        try:
            audience_data = {"age": "N/A", "platform": "N/A"}
            
            # –ú–ï–¢–û–î 1: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                # –ò—â–µ–º –±–ª–æ–∫ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "Audience"
                audience_items = await self.page.query_selector_all('div.addel-info-item')
                
                for item in audience_items:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å Audience
                    name_elem = await item.query_selector('div.name')
                    if name_elem:
                        name_text = await name_elem.inner_text()
                        if 'Audience' in name_text or '–ê—É–¥–∏—Ç–æ—Ä–∏—è' in name_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ audience-info-info
                            audience_info = await item.query_selector('div.audience-info-info')
                            if audience_info:
                                text = await audience_info.inner_text()
                                # –ò–∑–≤–ª–µ–∫–∞–µ–º –≤–æ–∑—Ä–∞—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ "45-55" (–º–æ–∂–µ—Ç –±—ã—Ç—å 2 —Ü–∏—Ñ—Ä—ã)
                                age_match = re.search(r'(\d{1,2}-\d{1,2})', text)
                                if age_match:
                                    audience_data["age"] = age_match.group(1)
                                    log.debug(f"      ‚Üí Audience age –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä: {audience_data['age']}")
                                    return audience_data
            except Exception as e:
                log.debug(f"      ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–º –ø–æ–∏—Å–∫–µ audience: {e}")
            
            # –ú–ï–¢–û–î 2: Fallback —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (–µ—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª)
            audience_keywords = ["Audience", "–ê—É–¥–∏—Ç–æ—Ä–∏—è", "Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è"]
            
            for keyword in audience_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç –∞—É–¥–∏—Ç–æ—Ä–∏–∏ —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º –≤–æ–∑—Ä–∞—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ "25-35" –∏–ª–∏ "45-55"
                        age_patterns = [
                            r'–í–æ–∑—Ä–∞—Å—Ç[:\s]+(\d{1,2}-\d{1,2})',
                            r'Age[:\s]+(\d{1,2}-\d{1,2})',
                            r'(\d{1,2}-\d{1,2})',  # –ü—Ä–æ—Å—Ç–æ –≤–æ–∑—Ä–∞—Å—Ç
                        ]
                        
                        for pattern in age_patterns:
                            age_match = re.search(pattern, text, re.IGNORECASE)
                            if age_match:
                                audience_data["age"] = age_match.group(1)
                                log.debug(f"      ‚Üí Audience age –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä: {audience_data['age']}")
                                break
                        
                        if audience_data["age"] != "N/A":
                            return audience_data
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π)
            try:
                result = await self.page.evaluate("""
                    () => {
                        const keywords = ['Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 'Audience', '–ê—É–¥–∏—Ç–æ—Ä–∏—è'];
                        const agePattern = /(\\d{1,2}-\\d{1,2})/;
                        const platformKeywords = ['Android', 'iOS', 'iPhone', 'iPad'];
                        const countryKeywords = ['USA', 'US', 'United States', '–†–æ—Å—Å–∏—è', 'Russia', 'Philippines', 
                                                '–§–∏–ª–∏–ø–ø–∏–Ω—ã', 'China', '–ö–∏—Ç–∞–π', 'India', '–ò–Ω–¥–∏—è'];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    const result = {age: 'N/A', platform: 'N/A', country: 'N/A'};
                                    
                                    // –ò—â–µ–º –≤–æ–∑—Ä–∞—Å—Ç
                                    const ageMatch = text.match(agePattern);
                                    if (ageMatch) {
                                        result.age = ageMatch[1];
                                    }
                                    
                                    // –ò—â–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
                                    for (const platform of platformKeywords) {
                                        if (text.includes(platform)) {
                                            result.platform = (platform === 'iOS' || platform === 'iPhone' || platform === 'iPad') ? 'iOS' : 'Android';
                                            break;
                                        }
                                    }
                                    
                                    // –ò—â–µ–º —Å—Ç—Ä–∞–Ω—É
                                    for (const country of countryKeywords) {
                                        if (text.includes(country)) {
                                            result.country = country;
                                            break;
                                        }
                                    }
                                    
                                    if (result.age !== 'N/A' || result.platform !== 'N/A' || result.country !== 'N/A') {
                                        return result;
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if result:
                    audience_data.update(result)
                    return audience_data
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ audience —á–µ—Ä–µ–∑ JS: {e}")
            
            return audience_data
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–∏: {e}")
            return None
    
    async def _extract_country(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å —Å—Ç—Ä–∞–Ω—É –∏–∑ –ø–æ–ª—è 'Country/Region' –∏–ª–∏ '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω' (–û–¢–î–ï–õ–¨–ù–û –æ—Ç Audience!)"""
        try:
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            try:
                await self.page.wait_for_selector('div.addel-info-item', timeout=5000, state="visible")
            except:
                log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç—ã div.addel-info-item –Ω–µ –ø–æ—è–≤–∏–ª–∏—Å—å –∑–∞ 5 —Å–µ–∫—É–Ω–¥")
            
            country_keywords = ["Country/Region", "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω", "Country", "–°—Ç—Ä–∞–Ω–∞", "Region", "–†–µ–≥–∏–æ–Ω"]
            
            # –ú–ï–¢–û–î 0: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                country_items = await self.page.query_selector_all('div.addel-info-item')
                
                for item in country_items:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å Country/Region
                    name_elem = await item.query_selector('div.name')
                    if name_elem:
                        name_text = await name_elem.inner_text()
                        if 'Country/Region' in name_text or '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω' in name_text or 'Country' in name_text or '–°—Ç—Ä–∞–Ω–∞' in name_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º —Å—Ç—Ä–∞–Ω—É
                            value_elem = await item.query_selector('div.ellipsis, div.value')
                            if value_elem:
                                country_text = await value_elem.inner_text()
                                # –£–±–∏—Ä–∞–µ–º (1) –∏ —Ç.–¥.
                                country = re.sub(r'\([0-9]+\)', '', country_text).strip()
                                if country and len(country) > 0:
                                    log.info(f"      ‚úÖ Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä: {country}")
                                    return country
            except Exception as e:
                log.debug(f"      ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–º –ø–æ–∏—Å–∫–µ country: {e}")
            
            for keyword in country_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω—ã —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º —Å—Ç—Ä–∞–Ω—É (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫)
                        country_patterns = [
                            r'United States(?:\([0-9]+\))?',  # United States(1)
                            r'USA(?:\([0-9]+\))?',
                            r'US(?:\([0-9]+\))?',
                            r'Philippines(?:\([0-9]+\))?',
                            r'–§–∏–ª–∏–ø–ø–∏–Ω—ã(?:\([0-9]+\))?',
                            r'Russia(?:\([0-9]+\))?',
                            r'–†–æ—Å—Å–∏—è(?:\([0-9]+\))?',
                            r'China(?:\([0-9]+\))?',
                            r'–ö–∏—Ç–∞–π(?:\([0-9]+\))?',
                            r'India(?:\([0-9]+\))?',
                            r'–ò–Ω–¥–∏—è(?:\([0-9]+\))?',
                            r'Brazil(?:\([0-9]+\))?',
                            r'–ë—Ä–∞–∑–∏–ª–∏—è(?:\([0-9]+\))?',
                            r'Germany(?:\([0-9]+\))?',
                            r'–ì–µ—Ä–º–∞–Ω–∏—è(?:\([0-9]+\))?',
                            r'France(?:\([0-9]+\))?',
                            r'–§—Ä–∞–Ω—Ü–∏—è(?:\([0-9]+\))?',
                            r'UK(?:\([0-9]+\))?',
                            r'United Kingdom(?:\([0-9]+\))?',
                        ]
                        
                        for pattern in country_patterns:
                            match = re.search(pattern, text, re.IGNORECASE)
                            if match:
                                country = match.group(0)
                                # –£–±–∏—Ä–∞–µ–º (1) –∏ —Ç.–¥.
                                country = re.sub(r'\([0-9]+\)', '', country).strip()
                                log.debug(f"Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}': {country}")
                                return country
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript
            try:
                country = await self.page.evaluate("""
                    () => {
                        const keywords = ['Country/Region', '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω', 'Country', '–°—Ç—Ä–∞–Ω–∞'];
                        const countryPatterns = [
                            /United States(?:\\([0-9]+\\))?/i,
                            /USA(?:\\([0-9]+\\))?/i,
                            /Philippines(?:\\([0-9]+\\))?/i,
                            /Russia(?:\\([0-9]+\\))?/i,
                            /China(?:\\([0-9]+\\))?/i,
                            /India(?:\\([0-9]+\\))?/i
                        ];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    for (const pattern of countryPatterns) {
                                        const match = text.match(pattern);
                                        if (match) {
                                            return match[0].replace(/\\([0-9]+\\)/g, '').trim();
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if country:
                    log.debug(f"Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript: {country}")
                    return country.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ country —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ country: {e}")
            return None
    
    async def _extract_first_seen(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å First seen –≤ —Ñ–æ—Ä–º–∞—Ç–µ 'Oct 27 2025' - —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ 'Oct 28 2025 ~ Nov 10 2025'"""
        try:
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã
            first_seen_keywords = ["First seen - Last seen", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", "First Seen"]
            
            for keyword in first_seen_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç –¥–∞—Ç—ã —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ "Oct 27 2025" –∏–ª–∏ "Oct 27, 2025"
                        # –ò—â–µ–º –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ "Oct 28 2025 ~ Nov 10 2025"
                        date_patterns = [
                            r'([A-Z][a-z]{2}\s+\d{1,2}\s+\d{4})',  # Oct 27 2025
                            r'([A-Z][a-z]{2}\s+\d{1,2},\s+\d{4})',  # Oct 27, 2025
                            r'(\d{1,2}\s+[A-Z][a-z]{2}\s+\d{4})',  # 27 Oct 2025
                        ]
                        
                        for pattern in date_patterns:
                            # –ò—â–µ–º –ø–µ—Ä–≤—É—é –¥–∞—Ç—É (–¥–æ ~ –∏–ª–∏ –∫–æ–Ω—Ü–∞ —Å—Ç—Ä–æ–∫–∏)
                            date_match = re.search(pattern, text)
                            if date_match:
                                date_str = date_match.group(1)
                                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ñ–æ—Ä–º–∞—Ç (—É–±–∏—Ä–∞–µ–º –∑–∞–ø—è—Ç—É—é –µ—Å–ª–∏ –µ—Å—Ç—å)
                                date_str = date_str.replace(',', '').strip()
                                log.debug(f"First seen –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}': {date_str}")
                                return date_str
                        
                        # –¢–∞–∫–∂–µ –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –¥–∞—Ç—É –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
                        if keyword in text:
                            parts = text.split(keyword, 1)
                            if len(parts) > 1:
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–æ ~ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω)
                                after_keyword = parts[1].split('~')[0].strip()
                                for pattern in date_patterns:
                                    date_match = re.search(pattern, after_keyword)
                                    if date_match:
                                        date_str = date_match.group(1).replace(',', '').strip()
                                        log.debug(f"First seen –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ '{keyword}': {date_str}")
                                        return date_str
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                first_seen = await self.page.evaluate("""
                    () => {
                        const keywords = ['First seen - Last seen', 'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 'First Seen'];
                        const datePatterns = [
                            /([A-Z][a-z]{2}\\s+\\d{1,2}\\s+\\d{4})/,  // Oct 27 2025
                            /([A-Z][a-z]{2}\\s+\\d{1,2},\\s+\\d{4})/,  // Oct 27, 2025
                            /(\\d{1,2}\\s+[A-Z][a-z]{2}\\s+\\d{4})/   // 27 Oct 2025
                        ];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    // –ò—â–µ–º –¥–∞—Ç—É –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    const index = text.indexOf(keyword);
                                    let afterKeyword = text.substring(index + keyword.length);
                                    
                                    // –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–æ ~ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω)
                                    if (afterKeyword.includes('~')) {
                                        afterKeyword = afterKeyword.split('~')[0];
                                    }
                                    
                                    for (const pattern of datePatterns) {
                                        const match = afterKeyword.match(pattern);
                                        if (match) {
                                            const dateStr = match[1].replace(',', '').trim();
                                            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤—É—é –Ω–∞–π–¥–µ–Ω–Ω—É—é –¥–∞—Ç—É (–±–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫ - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç –≤ _filter_videos)
                                            return dateStr;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if first_seen:
                    log.debug(f"First seen –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript: {first_seen}")
                    return first_seen.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ first_seen —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ first_seen: {e}")
            return None


```

```python
"""
Parser Engine - –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö —Å Pipiads
"""

import asyncio
import re
import time
from typing import List, Dict, Optional, Any
from datetime import datetime

from playwright.async_api import Page, TimeoutError as PlaywrightTimeoutError

from . import config
from . import logger
from . import validator

log = logger.get_logger("ParserEngine")


class ProductData:
    """–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞"""
    def __init__(self):
        self.product_name: str = ""
        self.category: str = ""
        self.pipiads_link: str = ""
        self.videos: List[Dict[str, Any]] = []


class ParserEngine:
    """–ü–∞—Ä—Å–µ—Ä –¥–∞–Ω–Ω—ã—Ö —Å Pipiads"""
    
    def __init__(self, page: Page):
        self.page = page
        self.browser_manager = None  # –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ human_delay
    
    def set_browser_manager(self, browser_manager):
        """–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ browser_manager –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è human_delay"""
        self.browser_manager = browser_manager
    
    async def human_delay(self, min_seconds: float = 1, max_seconds: float = 3):
        """–ò–º–∏—Ç–∞—Ü–∏—è —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏"""
        if self.browser_manager:
            await self.browser_manager.human_delay(min_seconds, max_seconds)
        else:
            delay = asyncio.sleep(1)  # Fallback
            await delay
    
    async def scroll_to_element(self, selector: str, timeout: int = 10000):
        """
        –°–∫—Ä–æ–ª–ª–∏—Ç—å –¥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
        
        Args:
            selector: –°–µ–ª–µ–∫—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞
            timeout: –¢–∞–π–º–∞—É—Ç –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
        """
        try:
            element = await self.page.wait_for_selector(selector, timeout=timeout, state="visible")
            if element:
                await element.scroll_into_view_if_needed()
                await self.human_delay(0.5, 1)
                return True
        except:
            pass
        return False
    
    async def get_products_from_search_page(self, count: int = 3) -> List[Dict[str, str]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞
        
        Args:
            count: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ (–¥–ª—è MVP-0: 1, –ø–æ—Ç–æ–º —Ä–∞—Å—à–∏—Ä–∏–º –¥–æ 3)
        
        Returns:
            –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–æ–≤: [{"name": "...", "category": "...", "url": "..."}]
        """
        log.info(f"–ü–æ–ª—É—á–µ–Ω–∏–µ {count} —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞...")
        
        try:
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (domcontentloaded –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º networkidle)
            await self.page.wait_for_load_state("domcontentloaded")
            await self.human_delay(2, 3)
            
            # –°–∫—Ä–æ–ª–ª–∏–º –≤–Ω–∏–∑, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
            log.info("–°–∫—Ä–æ–ª–ª–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤...")
            for i in range(3):  # –°–∫—Ä–æ–ª–ª–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
                await self.page.evaluate("window.scrollBy(0, 500)")
                await self.human_delay(1, 2)
            
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤
            await self.human_delay(2, 3)
            
            # –ò—â–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ - –ø—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
            product_selectors = [
                'a[href*="/tiktok-shop-product/"]',
                '[class*="product"]',
                '[class*="card"]',
                'div[class*="item"]',
            ]
            
            products = []
            product_ids = set()  # –î–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ product_id
            
            def extract_product_id(url: str) -> str:
                """–ò–∑–≤–ª–µ—á—å product_id –∏–∑ URL"""
                # https://www.pipiads.com/tiktok-shop-product/1729732622305364547/
                # ‚Üí 1729732622305364547
                url_normalized = url.rstrip('/')
                parts = url_normalized.split('/')
                return parts[-1] if parts else ""
            
            for selector in product_selectors:
                try:
                    elements = await self.page.query_selector_all(selector)
                    log.info(f"üîç –ù–∞–π–¥–µ–Ω–æ {len(elements)} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º '{selector}'")
                    
                    for element in elements:
                        if len(products) >= count:
                            break
                        
                        try:
                            # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É
                            href = await element.get_attribute("href")
                            if not href:
                                # –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ —Å—Å—ã–ª–∫–∞, –∏—â–µ–º —Å—Å—ã–ª–∫—É –≤–Ω—É—Ç—Ä–∏
                                link_element = await element.query_selector('a[href*="/tiktok-shop-product/"]')
                                if link_element:
                                    href = await link_element.get_attribute("href")
                            
                            if href and "/tiktok-shop-product/" in href:
                                # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π URL
                                if href.startswith("/"):
                                    url = f"https://www.pipiads.com{href}"
                                elif href.startswith("http"):
                                    url = href
                                else:
                                    url = f"https://www.pipiads.com/{href}"
                                
                                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º URL (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ)
                                url = url.rstrip('/')
                                
                                # –ò–∑–≤–ª–µ–∫–∞–µ–º product_id –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
                                product_id = extract_product_id(url)
                                
                                if not product_id:
                                    log.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å product_id –∏–∑ URL: {url}")
                                    continue
                                
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä (–ø–æ product_id)
                                if product_id in product_ids:
                                    log.info(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id={product_id}): {url}")
                                    continue
                                
                                product_ids.add(product_id)
                                log.info(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #{len(products) + 1}: product_id={product_id}, url={url}")
                                
                                # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
                                name = ""
                                name_selectors = [
                                    'h1', 'h2', 'h3',
                                    '[class*="title"]',
                                    '[class*="name"]',
                                    'a',
                                ]
                                
                                for name_sel in name_selectors:
                                    try:
                                        name_elem = await element.query_selector(name_sel)
                                        if name_elem:
                                            name = await name_elem.inner_text()
                                            if name and len(name) > 5:  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏—è
                                                break
                                    except:
                                        continue
                                
                                # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                                category = ""
                                category_selectors = [
                                    '[class*="category"]',
                                    '[class*="tag"]',
                                    'span',
                                ]
                                
                                for cat_sel in category_selectors:
                                    try:
                                        cat_elem = await element.query_selector(cat_sel)
                                        if cat_elem:
                                            text = await cat_elem.inner_text()
                                            if text and len(text) < 50:  # –ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±—ã—á–Ω–æ –∫–æ—Ä–æ—Ç–∫–∞—è
                                                category = text
                                                break
                                    except:
                                        continue
                                
                                if url and product_id:
                                    products.append({
                                        "name": name.strip() if name else "N/A",
                                        "category": category.strip() if category else "N/A",
                                        "url": url,
                                        "product_id": product_id  # –î–æ–±–∞–≤–ª—è–µ–º product_id –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
                                    })
                                    log.info(f"   üì¶ –¢–æ–≤–∞—Ä {len(products)}: {name[:50] if name else 'N/A'}... (ID: {product_id})")
                                
                        except Exception as e:
                            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —ç–ª–µ–º–µ–Ω—Ç–∞: {e}")
                            continue
                    
                    if len(products) >= count:
                        break
                        
                except Exception as e:
                    log.debug(f"–û—à–∏–±–∫–∞ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º {selector}: {e}")
                    continue
            
            if len(products) < count:
                log.warning(f"–ù–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ {count} –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã—Ö")
            
            log.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤")
            return products[:count]
            
        except Exception as e:
            log.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
            import traceback
            log.error(traceback.format_exc())
            return []
    
    async def get_product_details(self, product_url: str, sheets_writer=None) -> ProductData:
        """
        –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞ –∏ –≤–∏–¥–µ–æ
        
        Args:
            product_url: URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞
        
        Returns:
            ProductData —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞ –∏ –≤–∏–¥–µ–æ
        """
        log.info("=" * 80)
        log.info(f"üîÑ –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–ê")
        log.info(f"URL: {product_url}")
        log.info("=" * 80)
        
        product_data = ProductData()
        product_data.pipiads_link = product_url
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è page
        if not self.page:
            log.error("‚ùå –û–®–ò–ë–ö–ê: page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
            return product_data
        
        try:
            # –®–ê–ì 1: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞
            log.info("\nüìå –®–ê–ì 1: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞...")
            try:
                log.info(f"  ‚Üí –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {product_url}")
                if not self.page:
                    raise Exception("Page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
                await self.page.goto(product_url, wait_until="domcontentloaded", timeout=30000)
                log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            except Exception as e:
                log.error(f"  ‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {e}")
                log.error(f"  ‚Üí –¢–∏–ø –æ—à–∏–±–∫–∏: {type(e).__name__}")
                import traceback
                log.error(f"  ‚Üí –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:\n{traceback.format_exc()}")
                # –ü—Ä–æ–±—É–µ–º –ø–æ–¥–æ–∂–¥–∞—Ç—å –µ—â–µ –Ω–µ–º–Ω–æ–≥–æ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                try:
                    await self.human_delay(2, 3)
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Å–µ –µ—â–µ –¥–æ—Å—Ç—É–ø–Ω–∞
                    if self.page:
                        current_url = self.page.url
                        log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
                except Exception as e2:
                    log.error(f"  ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e2}")
                    return product_data
            
            try:
                await self.human_delay(0.5, 1)
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–¥–µ—Ä–∂–∫–µ: {e}")
            
            # –®–ê–ì 1.5: –ü–µ—Ä–µ–≤–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫
            log.info("\nüìå –®–ê–ì 1.5: –ü–µ—Ä–µ–≤–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫...")
            try:
                current_url = self.page.url
                log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
                
                # –ï—Å–ª–∏ URL —Å–æ–¥–µ—Ä–∂–∏—Ç /ru/, –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ /en/
                if "/ru/" in current_url:
                    english_url = current_url.replace("/ru/", "/en/")
                    log.info(f"  ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫—É—é –≤–µ—Ä—Å–∏—é: {english_url}")
                    await self.page.goto(english_url, wait_until="domcontentloaded", timeout=30000)
                    await self.human_delay(1, 2)
                    log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π")
                else:
                    # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞
                    log.info("  ‚Üí –ü–æ–∏—Å–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —è–∑—ã–∫–∞...")
                    lang_selectors = [
                        'a[href*="/en/"]',
                        'button:has-text("English")',
                        '[class*="language"]',
                        '[class*="lang"]',
                        'select[name*="lang"]',
                    ]
                    
                    lang_found = False
                    for selector in lang_selectors:
                        try:
                            lang_element = await self.page.query_selector(selector)
                            if lang_element:
                                is_visible = await lang_element.is_visible()
                                if is_visible:
                                    await lang_element.click()
                                    await self.human_delay(1, 2)
                                    log.info(f"  ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ –Ω–∞–π–¥–µ–Ω –∏ –Ω–∞–∂–∞—Ç: {selector}")
                                    lang_found = True
                                    break
                        except:
                            continue
                    
                    if not lang_found:
                        log.warning("  ‚ö†Ô∏è –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –Ω–∞ —Ç–µ–∫—É—â–µ–º —è–∑—ã–∫–µ")
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            # –®–ê–ì 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Product Name
            log.info("\nüìå –®–ê–ì 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Product Name...")
            try:
                # –°–∫—Ä–æ–ª–ª–∏–º –≤–≤–µ—Ä—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
                log.info("  ‚Üí –°–∫—Ä–æ–ª–ª–∏–º –≤–≤–µ—Ä—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞...")
                if not self.page:
                    raise Exception("Page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
                await self.page.evaluate("window.scrollTo(0, 0)")
                await self.human_delay(0.3, 0.5)
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ: {e}")
                # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É
            
            # –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ - –ø—Ä–æ–±—É–µ–º –±–æ–ª—å—à–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –∏ –º–µ—Ç–æ–¥–æ–≤
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã...")
            try:
                # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
                name_selectors = [
                    'h1:first-of-type',
                    'h1[class*="product"]',
                    'h1[class*="title"]',
                    '[class*="product-title"]',
                    '[class*="product-name"]',
                    '[class*="product_title"]',
                    '[class*="product_name"]',
                    'h1',
                    'h2:first-of-type',
                    '[data-testid*="title"]',
                    '[data-testid*="name"]',
                    '[data-testid*="product-title"]',
                ]
                
                for selector in name_selectors:
                    try:
                        elements = await self.page.query_selector_all(selector)
                        for element in elements:
                            name = await element.inner_text()
                            if name and len(name) > 3:
                                # –§–∏–ª—å—Ç—Ä—É–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã
                                name_lower = name.lower()
                                skip_words = ['–æ—Å—Ç–∞—Ç–æ–∫', 'remain', 'stock', '–º–µ—Å—è—Ü', 'month', '–∫–æ–º–∏—Å—Å–∏—è', 'commission', 
                                            'tiktok shop product detail', 'category', '–∫–∞—Ç–µ–≥–æ—Ä–∏—è']
                                if any(skip in name_lower for skip in skip_words):
                                    continue
                                # –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å "TikTok Shop Product Detail:" –µ—Å–ª–∏ –µ—Å—Ç—å
                                if "TikTok Shop Product Detail:" in name:
                                    name = name.split("TikTok Shop Product Detail:")[-1].strip()
                                # –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
                                if name.lower().startswith('tiktok shop product'):
                                    name = re.sub(r'^tiktok shop product\s*:?\s*', '', name, flags=re.IGNORECASE).strip()
                                if name.lower().endswith('tiktok shop product'):
                                    name = re.sub(r'\s*tiktok shop product\s*$', '', name, flags=re.IGNORECASE).strip()
                                # –£–±–∏—Ä–∞–µ–º, –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ "TikTok Shop Product"
                                if name.lower() == 'tiktok shop product' or name.lower() == 'tiktok shop product detail':
                                    continue
                                if ":" in name and len(name.split(":")[0]) < 20:
                                    name = name.split(":", 1)[-1].strip()
                                product_data.product_name = name.strip()
                                if len(product_data.product_name) > 5:
                                    log.info(f"  ‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞–π–¥–µ–Ω–æ: {product_data.product_name[:50]}...")
                                    break
                        if product_data.product_name and len(product_data.product_name) > 5:
                            break
                    except:
                        continue
                
                # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
                if not product_data.product_name or len(product_data.product_name) <= 5:
                    try:
                        product_name = await self.page.evaluate("""
                            () => {
                                // –ò—â–µ–º h1
                                const h1 = document.querySelector('h1');
                                if (h1) {
                                    const text = h1.innerText.trim();
                                    if (text && text.length > 5 && !text.toLowerCase().includes('tiktok shop product detail')) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º –≤ —ç–ª–µ–º–µ–Ω—Ç–∞—Ö —Å –∫–ª–∞—Å—Å–æ–º product
                                const productElements = document.querySelectorAll('[class*="product"][class*="title"], [class*="product"][class*="name"]');
                                for (const el of productElements) {
                                    const text = el.innerText.trim();
                                    if (text && text.length > 5) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º —Å–∞–º—ã–π –±–æ–ª—å—à–æ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–æ–±—ã—á–Ω–æ —ç—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞)
                                // –ù–û –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã —Ç–∏–ø–∞ "Ad Analysis"
                                const headings = document.querySelectorAll('h1, h2, h3');
                                let maxLength = 0;
                                let bestHeading = null;
                                for (const h of headings) {
                                    const text = h.innerText.trim();
                                    const skipWords = ['tiktok', 'shop', 'product', 'detail', 'category', 'commission', 
                                                      '–æ—Å—Ç–∞—Ç–æ–∫', 'remain', 'stock', 'ad analysis', 'analysis', 
                                                      'limited time', 'promotion', 'annual plan', 'tiktok shop product'];
                                    const textLower = text.toLowerCase();
                                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã (–º–µ–Ω—å—à–µ 20 —Å–∏–º–≤–æ–ª–æ–≤) - —ç—Ç–æ –æ–±—ã—á–Ω–æ –Ω–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
                                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º "TikTok Shop Product" –∏ –ø–æ—Ö–æ–∂–∏–µ —Ç–µ–∫—Å—Ç—ã
                                    if (!skipWords.some(word => textLower.includes(word)) && 
                                        text.length > maxLength && text.length > 20 &&
                                        !textLower.includes('tiktok shop product')) {
                                        maxLength = text.length;
                                        bestHeading = text;
                                    }
                                }
                                if (bestHeading) {
                                    return bestHeading;
                                }
                                
                                // –ò—â–µ–º –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–∞—Ö - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ–±—ã—á–Ω–æ –¥–ª–∏–Ω–Ω–æ–µ
                                // –ù–∞–ø—Ä–∏–º–µ—Ä: "[BUY 1 TAKE 11] SHEEureka Scrub Facial Cleanser..."
                                // –ù–û –∏—Å–∫–ª—é—á–∞–µ–º —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                           'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                           'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                           'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                           'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                const textBlocks = document.querySelectorAll('p, div, span');
                                for (const block of textBlocks) {
                                    const text = block.innerText.trim();
                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    const isFooterMenu = footerMenuKeywords.some(keyword => text.includes(keyword));
                                    if (isFooterMenu) continue;
                                    
                                    // –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ–±—ã—á–Ω–æ –¥–ª–∏–Ω–Ω–æ–µ (–±–æ–ª—å—à–µ 30 —Å–∏–º–≤–æ–ª–æ–≤) –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–æ–≤–∞ —Ç–∏–ø–∞ "Set", "Kit", "Mask" –∏ —Ç.–¥.
                                    // –ò–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å "[" (–Ω–∞–ø—Ä–∏–º–µ—Ä "[BUY 1 TAKE 11]")
                                    if (text.length > 30 && text.length < 500 && 
                                        !text.toLowerCase().includes('ad analysis') &&
                                        !text.toLowerCase().includes('limited time') &&
                                        !text.toLowerCase().includes('promotion') &&
                                        !text.toLowerCase().includes('annual plan') &&
                                        (text.startsWith('[') || text.includes('Set') || text.includes('Kit') || 
                                         text.includes('Mask') || text.includes('Cleanser') || text.includes('Gift') ||
                                         text.includes('Scrub') || text.includes('Facial') || text.includes('Repairing'))) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º –≤ –º–µ—Ç–∞-—Ç–µ–≥–∞—Ö
                                const ogTitle = document.querySelector('meta[property="og:title"]');
                                if (ogTitle && ogTitle.content) {
                                    let title = ogTitle.content;
                                    if (title.includes('TikTok Shop Product Detail:')) {
                                        title = title.split('TikTok Shop Product Detail:')[1].trim();
                                    }
                                    // –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞
                                    if (title.toLowerCase().startsWith('tiktok shop product')) {
                                        title = title.replace(/^tiktok shop product\s*:?\s*/i, '').trim();
                                    }
                                    if (title && title.length > 5 && !title.toLowerCase().includes('tiktok shop product')) {
                                        return title;
                                    }
                                }
                                
                                return null;
                            }
                        """)
                        if product_name and len(product_name) > 5:
                            product_name = product_name.strip()
                            # –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
                            if product_name.lower().startswith('tiktok shop product'):
                                product_name = re.sub(r'^tiktok shop product\s*:?\s*', '', product_name, flags=re.IGNORECASE).strip()
                            if product_name.lower().endswith('tiktok shop product'):
                                product_name = re.sub(r'\s*tiktok shop product\s*$', '', product_name, flags=re.IGNORECASE).strip()
                            # –£–±–∏—Ä–∞–µ–º, –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ "TikTok Shop Product"
                            if product_name.lower() == 'tiktok shop product' or product_name.lower() == 'tiktok shop product detail':
                                product_name = None
                            if product_name and len(product_name) > 5:
                                product_data.product_name = product_name
                                log.info(f"  ‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞–π–¥–µ–Ω–æ (—á–µ—Ä–µ–∑ JS): {product_data.product_name[:50]}...")
                    except Exception as e:
                        log.debug(f"  ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —á–µ—Ä–µ–∑ JS: {e}")
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞: {e}")
            
            if not product_data.product_name or len(product_data.product_name) <= 5:
                log.warning("  ‚ö†Ô∏è –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                product_data.product_name = "N/A"
            
            # –®–ê–ì 3: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Category
            log.info("\nüìå –®–ê–ì 3: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Category...")
            try:
                log.info("  ‚Üí –ü–æ–∏—Å–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–∞...")
                
                # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
                category_selectors = [
                    '[class*="category"]',
                    '[class*="tag"]',
                    'span:has-text("Category")',
                    'span:has-text("–ö–∞—Ç–µ–≥–æ—Ä–∏—è")',
                    'text=/Category/i',
                    'text=/–ö–∞—Ç–µ–≥–æ—Ä–∏—è/i',
                    'div:has-text("Category")',
                    'div:has-text("–ö–∞—Ç–µ–≥–æ—Ä–∏—è")',
                ]
                
                for selector in category_selectors:
                    try:
                        elements = await self.page.query_selector_all(selector)
                        for element in elements:
                            category = await element.inner_text()
                            if category:
                                # –û—á–∏—â–∞–µ–º –æ—Ç –ª–∏—à–Ω–µ–≥–æ —Ç–µ–∫—Å—Ç–∞
                                category = re.sub(r'Category\s*:', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'–ö–∞—Ç–µ–≥–æ—Ä–∏—è\s*:', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'Commission\s*Rate\s*:.*', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'–ö–æ–º–∏—Å—Å–∏—è\s*:.*', '', category, flags=re.IGNORECASE)
                                # –£–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä "15.00%")
                                category = re.sub(r'\s*\d+\.?\d*\s*%', '', category)
                                # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ —Å–∏–º–≤–æ–ª—ã > –∏ –ø—Ä–æ–±–µ–ª—ã
                                category = re.sub(r'\s*>\s*', ' > ', category)
                                category = category.strip()
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é —á–∞—Å—Ç—å –¥–æ "Commission" –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É
                                if "Commission" in category or "–ö–æ–º–∏—Å—Å–∏—è" in category:
                                    category = category.split("Commission")[0].split("–ö–æ–º–∏—Å—Å–∏—è")[0].strip()
                                if len(category) > 100:
                                    category = category[:100]
                                if category and len(category) > 3:
                                    product_data.category = category
                                    log.info(f"  ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–∞: {product_data.category}")
                                    break
                        if product_data.category:
                            break
                    except:
                        continue
                
                # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π)
                if not product_data.category:
                    try:
                        category = await self.page.evaluate("""
                            () => {
                                // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Category" –∏–ª–∏ "–ö–∞—Ç–µ–≥–æ—Ä–∏—è"
                                const allElements = document.querySelectorAll('*');
                                for (const el of allElements) {
                                    const text = el.innerText || '';
                                    if (text.includes('Category') || text.includes('–ö–∞—Ç–µ–≥–æ—Ä–∏—è')) {
                                        // –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ—Å–ª–µ "Category:" –∏–ª–∏ "–ö–∞—Ç–µ–≥–æ—Ä–∏—è:"
                                        let categoryText = text;
                                        if (categoryText.includes('Category:')) {
                                            categoryText = categoryText.split('Category:')[1];
                                        } else if (categoryText.includes('–ö–∞—Ç–µ–≥–æ—Ä–∏—è:')) {
                                            categoryText = categoryText.split('–ö–∞—Ç–µ–≥–æ—Ä–∏—è:')[1];
                                        }
                                        
                                        // –£–±–∏—Ä–∞–µ–º "Commission Rate" –∏ –≤—Å–µ –ø–æ—Å–ª–µ
                                        if (categoryText.includes('Commission Rate') || categoryText.includes('–ö–æ–º–∏—Å—Å–∏—è')) {
                                            categoryText = categoryText.split('Commission Rate')[0].split('–ö–æ–º–∏—Å—Å–∏—è')[0];
                                        }
                                        
                                        // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä "15.00%")
                                        categoryText = categoryText.replace(/\s*\d+\.?\d*\s*%/g, '');
                                        
                                        categoryText = categoryText.trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é (—Å–æ–¥–µ—Ä–∂–∏—Ç ">" –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–æ–≤)
                                        if (categoryText && categoryText.length > 3 && 
                                            (categoryText.includes('>') || categoryText.split(' ').length >= 2)) {
                                            return categoryText.substring(0, 100);
                                        }
                                    }
                                }
                                return null;
                            }
                        """)
                        if category and len(category) > 3:
                            product_data.category = category.strip()
                            log.info(f"  ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–∞ (—á–µ—Ä–µ–∑ JS): {product_data.category}")
                    except Exception as e:
                        log.debug(f"  ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ JS: {e}")
                
                if not product_data.category:
                    log.warning("  ‚ö†Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ 'N/A'")
                    product_data.category = "N/A"
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {e}")
                product_data.category = "N/A"
            
            # –®–ê–ì 3.5: –ó–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets (–µ—Å–ª–∏ sheets_writer –ø–µ—Ä–µ–¥–∞–Ω)
            # –í–ê–ñ–ù–û: –ï—Å–ª–∏ —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ
            if sheets_writer:
                log.info("\nüìå –®–ê–ì 3.5: –ó–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets...")
                try:
                    row_number = sheets_writer.write_basic_product_data(
                        product_data.product_name,
                        product_data.category,
                        product_data.pipiads_link
                    )
                    if row_number > 0:
                        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ
                        product_data._sheets_row = row_number
                        log.info(f"  ‚úÖ –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {row_number})")
                    else:
                        # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–≤–æ–∑–º–æ–∂–Ω–æ, —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã),
                        # –Ω–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö
                        log.warning("  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–≤–æ–∑–º–æ–∂–Ω–æ, —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã)")
                        log.info("  ‚Üí –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö...")
                        row_number = sheets_writer.find_next_empty_row()
                        product_data._sheets_row = row_number
                        log.info(f"  ‚úÖ –ë—É–¥–µ–º –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫—É {row_number}")
                except Exception as e:
                    log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö: {e}")
                    # –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ
                    try:
                        row_number = sheets_writer.find_next_empty_row()
                        product_data._sheets_row = row_number
                        log.info(f"  ‚Üí –ë—É–¥–µ–º –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫—É {row_number}")
                    except:
                        pass
            
            # –®–ê–ì 4: –ü–æ–∏—Å–∫ –±–ª–æ–∫–∞ "TikTok Ads"
            log.info("\nüìå –®–ê–ì 4: –ü–æ–∏—Å–∫ –±–ª–æ–∫–∞ 'TikTok Ads'...")
            log.info("  ‚Üí –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–Ω–∏–∑ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞...")
            
            # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–Ω–∏–∑, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç
            # –ë–ª–æ–∫ "TikTok Ads" –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            try:
                log.info("  ‚Üí –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–Ω–∏–∑ (–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ)...")
                # –ü–æ–ª—É—á–∞–µ–º –≤—ã—Å–æ—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                page_height = await self.page.evaluate("document.body.scrollHeight")
                viewport_height = await self.page.evaluate("window.innerHeight")
                log.info(f"  ‚Üí –í—ã—Å–æ—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {page_height}px, –≤—ã—Å–æ—Ç–∞ viewport: {viewport_height}px")
                
                # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ (–∫–∞–∫ —á–µ–ª–æ–≤–µ–∫)
                scroll_steps = max(3, page_height // viewport_height)
                scroll_step = page_height // scroll_steps
                
                for step in range(scroll_steps):
                    scroll_position = scroll_step * (step + 1)
                    await self.page.evaluate(f"window.scrollTo(0, {scroll_position})")
                    await self.human_delay(0.3, 0.5)
                    log.debug(f"  ‚Üí –ü—Ä–æ–∫—Ä—É—Ç–∫–∞: {scroll_position}/{page_height}px")
                
                # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ —Å–∞–º–æ–≥–æ –Ω–∏–∑–∞
                await self.page.evaluate("window.scrollTo(0, document.body.scrollHeight)")
                await self.human_delay(1, 2)  # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–∫—Ä—É—á–µ–Ω–∞ –≤–Ω–∏–∑")
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            log.info("  ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (–∫–∞–∫ Ctrl+F)...")
            tiktok_ads_found = False
            tiktok_ads_element = None
            
            # –°–Ω–∞—á–∞–ª–∞ –∂–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            await self.human_delay(0.5, 1)
            
            # –í–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
            tiktok_ads_texts = [
                "TikTok Ads",  # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π
                "–†–µ–∫–ª–∞–º–∞ –¢–∏–∫–¢–æ–∫",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 1
                "–†–µ–∫–ª–∞–º–∞ TikTok",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 2
                "TikTok –†–µ–∫–ª–∞–º–∞",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 3
            ]
            
            # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –±–ª–æ–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä —Å —Ç–µ–∫—Å—Ç–æ–º (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±)
            log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ Playwright locator...")
            for text_variant in tiktok_ads_texts:
                try:
                    # –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Ç–µ–∫—Å—Ç (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ)
                    locator = self.page.locator(f'text=/{text_variant}/i').first
                    if await locator.count() > 0:
                        tiktok_ads_element = await locator.element_handle()
                        if tiktok_ads_element:
                            # –°–∫—Ä–æ–ª–ª–∏–º –∫ —ç–ª–µ–º–µ–Ω—Ç—É
                            await tiktok_ads_element.scroll_into_view_if_needed()
                            await self.human_delay(0.3, 0.5)
                            tiktok_ads_found = True
                            log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ Playwright locator")
                            break
                except Exception as e:
                    log.debug(f"–ü–æ–∏—Å–∫ '{text_variant}' —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä –Ω–µ —É–¥–∞–ª—Å—è: {e}")
                    continue
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ JavaScript –ø–æ–∏—Å–∫ (–∫–∞–∫ Ctrl+F)
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript TreeWalker...")
                for text_variant in tiktok_ads_texts:
                    try:
                        # –ò—Å–ø–æ–ª—å–∑—É–µ–º JavaScript –¥–ª—è –ø–æ–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å —Ç–µ–∫—Å—Ç–æ–º
                        # –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è regex
                        escaped_text = text_variant.replace("\\", "\\\\").replace("/", "\\/")
                        tiktok_ads_element = await self.page.evaluate_handle(f"""
                            () => {{
                                const walker = document.createTreeWalker(
                                    document.body,
                                    NodeFilter.SHOW_TEXT,
                                    null,
                                    false
                                );
                                
                                let node;
                                while (node = walker.nextNode()) {{
                                    if (node.textContent && /{escaped_text}/i.test(node.textContent)) {{
                                        // –ù–∞—Ö–æ–¥–∏–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç
                                        let parent = node.parentElement;
                                        while (parent && parent !== document.body) {{
                                            if (parent.offsetHeight > 0 && parent.offsetWidth > 0) {{
                                                return parent;
                                            }}
                                            parent = parent.parentElement;
                                        }}
                                    }}
                                }}
                                return null;
                            }}
                        """)
                        
                        if tiktok_ads_element and await tiktok_ads_element.as_element():
                            element = await tiktok_ads_element.as_element()
                            await element.scroll_into_view_if_needed()
                            await self.human_delay(0.3, 0.5)
                            tiktok_ads_found = True
                            log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript TreeWalker")
                            break
                    except Exception as e:
                        log.debug(f"JavaScript –ø–æ–∏—Å–∫ '{text_variant}' –Ω–µ —É–¥–∞–ª—Å—è: {e}")
                        continue
            
            # –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ query_selector
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 3: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ query_selector —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ —Ç–µ–∫—Å—Ç–∞...")
                try:
                    # –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
                    text_variants = []
                    for text in tiktok_ads_texts:
                        text_variants.extend([
                            f'text="{text}"',
                            f'text={text}',
                            f'*:has-text("{text}")',
                        ])
                    
                    for variant in text_variants:
                        try:
                            element = await self.page.query_selector(variant)
                            if element:
                                is_visible = await element.is_visible()
                                if is_visible:
                                    await element.scroll_into_view_if_needed()
                                    await self.human_delay(0.3, 0.5)
                                    tiktok_ads_found = True
                                    tiktok_ads_element = element
                                    log.info(f"  ‚úÖ –ë–ª–æ–∫ –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ query_selector: {variant}")
                                    break
                        except:
                            continue
                except Exception as e:
                    log.debug(f"Query selector –ø–æ–∏—Å–∫ –Ω–µ —É–¥–∞–ª—Å—è: {e}")
            
            # –ü–æ–ø—ã—Ç–∫–∞ 4: –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –µ—â–µ —Ä–∞–∑ –∏ –ø–æ–∏—Å–∫–∞—Ç—å —Å–Ω–æ–≤–∞
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 4: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∏ –ø–æ–∏—Å–∫...")
                try:
                    # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –µ—â–µ —Ä–∞–∑ –º–µ–¥–ª–µ–Ω–Ω–æ
                    await self.page.evaluate("window.scrollTo(0, 0)")  # –í –Ω–∞—á–∞–ª–æ
                    await self.human_delay(0.5, 1)
                    
                    # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑ –º–µ–¥–ª–µ–Ω–Ω–æ, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è—Å—å –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
                    page_height = await self.page.evaluate("document.body.scrollHeight")
                    scroll_increment = 300  # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –ø–æ 300px
                    
                    for scroll_pos in range(0, page_height, scroll_increment):
                        await self.page.evaluate(f"window.scrollTo(0, {scroll_pos})")
                        await self.human_delay(0.2, 0.3)
                        
                        # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –Ω–∞ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ (–≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞)
                        for text_variant in tiktok_ads_texts:
                            try:
                                # –ó–∞–º–µ–Ω—è–µ–º –ø—Ä–æ–±–µ–ª—ã –Ω–∞ \s+ –¥–ª—è regex
                                regex_pattern = text_variant.replace(" ", "\\s+")
                                locator = self.page.locator(f'text=/{regex_pattern}/i').first
                                if await locator.count() > 0:
                                    tiktok_ads_element = await locator.element_handle()
                                    if tiktok_ads_element:
                                        await tiktok_ads_element.scroll_into_view_if_needed()
                                        await self.human_delay(0.3, 0.5)
                                        tiktok_ads_found = True
                                        log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ {scroll_pos}px")
                                        break
                            except:
                                continue
                        
                        if tiktok_ads_found:
                            break
                    
                    if not tiktok_ads_found:
                        # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ —Å–∞–º–æ–≥–æ –Ω–∏–∑–∞ –µ—â–µ —Ä–∞–∑
                        await self.page.evaluate("window.scrollTo(0, document.body.scrollHeight)")
                        await self.human_delay(1, 2)
                        
                        # –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–∏—Å–∫–∞ (–≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞)
                        for text_variant in tiktok_ads_texts:
                            try:
                                # –ó–∞–º–µ–Ω—è–µ–º –ø—Ä–æ–±–µ–ª—ã –Ω–∞ \s+ –¥–ª—è regex
                                regex_pattern = text_variant.replace(" ", "\\s+")
                                locator = self.page.locator(f'text=/{regex_pattern}/i').first
                                if await locator.count() > 0:
                                    tiktok_ads_element = await locator.element_handle()
                                    if tiktok_ads_element:
                                        await tiktok_ads_element.scroll_into_view_if_needed()
                                        await self.human_delay(0.3, 0.5)
                                        tiktok_ads_found = True
                                        log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω –≤ —Å–∞–º–æ–º –Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã")
                                        break
                            except:
                                continue
                except Exception as e:
                    log.debug(f"–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –Ω–µ –ø–æ–º–æ–≥–ª–∞: {e}")
            
            if not tiktok_ads_found:
                log.error("  ‚ùå –ë–ª–æ–∫ 'TikTok Ads' –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫")
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                try:
                    screenshot_path = config.SCREENSHOTS_DIR / f"tiktok_ads_not_found_{int(time.time())}.png"
                    await self.page.screenshot(path=str(screenshot_path), full_page=True)
                    log.info(f"  üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {screenshot_path}")
                except:
                    pass
                log.error("  ‚ùå –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: –±–ª–æ–∫ 'TikTok Ads' –Ω–µ –Ω–∞–π–¥–µ–Ω")
                return product_data
            
            log.info("  ‚úÖ –ë–ª–æ–∫ 'TikTok Ads' —É—Å–ø–µ—à–Ω–æ –Ω–∞–π–¥–µ–Ω")
            
            # –®–ê–ì 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ "First seen"
            log.info("\nüìå –®–ê–ì 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ 'First seen'...")
            sort_success = await self._set_sort_by_first_seen()
            if not sort_success:
                log.warning("  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            # –®–ê–ì 6: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–∏–¥–µ–æ
            log.info("\nüìå –®–ê–ì 6: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ 'TikTok Ads'...")
            videos = await self._get_videos_from_tiktok_ads_block()
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ {len(videos)} –≤–∏–¥–µ–æ –≤ –±–ª–æ–∫–µ")
            
            # –®–ê–ì 7: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ
            log.info(f"\nüìå –®–ê–ì 7: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ (impression >= {config.MIN_IMPRESSIONS}, –¥–∞—Ç–∞ <= {config.DAYS_BACK} –¥–Ω–µ–π)...")
            filtered_videos = await self._filter_videos(videos)
            log.info(f"  ‚Üí –ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: {len(filtered_videos)} –≤–∏–¥–µ–æ")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –í–°–ï –≤–∏–¥–µ–æ (–¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏) –≤ ProductData
            product_data._all_videos_raw = videos[:20]  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–≤—ã–µ 20 –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
            
            # –í–ê–ñ–ù–û: –ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ 0 –≤–∏–¥–µ–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä
            if len(filtered_videos) == 0:
                log.warning(f"  ‚ö†Ô∏è –ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ (>= {config.MIN_IMPRESSIONS} impressions, <= {config.DAYS_BACK} –¥–Ω–µ–π)")
                log.warning(f"  ‚ö†Ô∏è –¢–æ–≤–∞—Ä –±—É–¥–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω")
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ —Ç–æ–≤–∞—Ä–∞
                product_data._insufficient_videos = True
                product_data._videos_found = len(videos)
                return product_data
            
            # –í—ã–±–æ—Ä —Ç–æ–ø-3 –≤–∏–¥–µ–æ
            video_count = 3
            selected_videos = filtered_videos[:video_count]
            
            log.info(f"  ‚úÖ –í—ã–±—Ä–∞–Ω–æ {len(selected_videos)} –≤–∏–¥–µ–æ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            
            # –®–ê–ì 8: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
            log.info(f"\nüìå –®–ê–ì 8: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–ª—è {len(selected_videos)} –≤–∏–¥–µ–æ...")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
            product_page_url = self.page.url
            log.info(f"  ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞: {product_page_url}")
            
            for i, video in enumerate(selected_videos, 1):
                log.info(f"\n  üé¨ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ {i}/{len(selected_videos)}...")
                log.info(f"    ‚Üí Impression: {video.get('impression', 0)}, First seen: {video.get('first_seen', 'N/A')}")
                
                # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ (–ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ ad-search –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
                video_details = await self._get_video_details(video)
                
                if video_details:
                    product_data.videos.append(video_details)
                    log.info(f"    ‚úÖ –í–∏–¥–µ–æ {i} –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ")
                else:
                    log.warning(f"    ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –¥–ª—è –≤–∏–¥–µ–æ {i}")
                
                # –í–ê–ñ–ù–û: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
                log.info(f"    ‚Üí –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ {i}...")
                try:
                    await self.page.goto(product_page_url, wait_until="domcontentloaded", timeout=30000)
                    await self.human_delay(1, 2)
                    
                    # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –±–ª–æ–∫–∞ TikTok Ads (—á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ –≤–∏–¥–µ–æ)
                    try:
                        await self.page.wait_for_selector('a[href*="/ad-search/"]', timeout=10000, state="visible")
                        log.info(f"    ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ —É—Å–ø–µ—à–µ–Ω (–≤–∏–¥–µ–æ {i})")
                    except:
                        log.warning(f"    ‚ö†Ô∏è –ë–ª–æ–∫ TikTok Ads –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
                except Exception as e:
                    log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞: {e}")
                    # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–ª–µ–¥—É—é—â–∏—Ö –≤–∏–¥–µ–æ –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤–æ–∑–≤—Ä–∞—Ç–∞
                
                await self.human_delay(0.5, 1)
            
            # –ó–∞–ø–æ–ª–Ω—è–µ–º N/A –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤–∏–¥–µ–æ (–Ω—É–∂–Ω–æ 3 –≤–∏–¥–µ–æ)
            while len(product_data.videos) < video_count:
                product_data.videos.append({
                    "tiktok_link": "N/A",
                    "impression": 0,
                    "script": "N/A",
                    "hook": "N/A",
                    "audience_age": "N/A",
                    "country": "N/A",
                    "first_seen": "N/A",
                })
            
            log.info(f"\n‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {len(product_data.videos)} –≤–∏–¥–µ–æ –¥–ª—è —Ç–æ–≤–∞—Ä–∞")
            
            # –®–ê–ì 9: –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ –≤ Google Sheets (–µ—Å–ª–∏ sheets_writer –ø–µ—Ä–µ–¥–∞–Ω)
            if sheets_writer:
                if hasattr(product_data, '_sheets_row') and product_data._sheets_row > 0:
                    log.info(f"\nüìå –®–ê–ì 9: –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {product_data._sheets_row})...")
                    log.info(f"  ‚Üí –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ –¥–ª—è –∑–∞–ø–∏—Å–∏: {len(product_data.videos)}")
                    
                    # –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é
                    for i, video in enumerate(product_data.videos[:3], 1):
                        log.info(f"  ‚Üí –í–∏–¥–µ–æ {i}: tiktok={video.get('tiktok_link', 'N/A')[:50]}, "
                                f"impression={video.get('impression', 'N/A')}, "
                                f"script={len(str(video.get('script', 'N/A')))} —Å–∏–º–≤–æ–ª–æ–≤, "
                                f"hook={len(str(video.get('hook', 'N/A')))} —Å–∏–º–≤–æ–ª–æ–≤, "
                                f"audience={video.get('audience_age', 'N/A')}, "
                                f"country={video.get('country', 'N/A')}, "
                                f"first_seen={video.get('first_seen', 'N/A')}")
                    
                    try:
                        # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏
                        video_data_dict = {
                            "product_name": product_data.product_name,
                            "category": product_data.category,
                            "pipiads_link": product_data.pipiads_link,
                            "videos": product_data.videos
                        }
                        
                        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (update_basic=False - –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ F-Z)
                        success = sheets_writer.write_product_data(
                            product_data._sheets_row,
                            video_data_dict,
                            update_basic=False
                        )
                        
                        if success:
                            log.info(f"  ‚úÖ –î–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {product_data._sheets_row}, —Å—Ç–æ–ª–±—Ü—ã F-Z)")
                        else:
                            log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –≤ Google Sheets")
                    except Exception as e:
                        log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ: {e}")
                        import traceback
                        log.error(traceback.format_exc())
                else:
                    log.warning(f"  ‚ö†Ô∏è –ù–µ—Ç –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö (_sheets_row –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)")
            
            log.info("=" * 80)
            log.info("‚úÖ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û")
            log.info("=" * 80)
            return product_data
            
        except Exception as e:
            log.error("\n" + "=" * 80)
            log.error(f"‚ùå –û–®–ò–ë–ö–ê –ü–†–ò –û–ë–†–ê–ë–û–¢–ö–ï –¢–û–í–ê–†–ê: {e}")
            log.error("=" * 80)
            import traceback
            log.error(traceback.format_exc())
            return product_data
    
    async def return_to_main_page(self, main_page_url: str) -> bool:
        """
        –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–æ–≤–∞—Ä–æ–≤
        
        Args:
            main_page_url: URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ —Ç–æ–≤–∞—Ä)
        
        Returns:
            True –µ—Å–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç —É—Å–ø–µ—à–µ–Ω, False –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        """
        try:
            log.info("\nüîô –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–æ–≤–∞—Ä–æ–≤...")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π URL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            current_url = self.page.url
            log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
            log.info(f"  ‚Üí –¶–µ–ª–µ–≤–æ–π URL: {main_page_url}")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            if current_url == main_page_url:
                log.info("  ‚ÑπÔ∏è  –£–∂–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
                return True
            
            # –ú–ï–¢–û–î 1: –ü—Ä—è–º–æ–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π URL (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            await self.page.goto(main_page_url, wait_until="domcontentloaded", timeout=30000)  # –£–≤–µ–ª–∏—á–µ–Ω –¥–æ 30 —Å–µ–∫
            await self.human_delay(1, 2)
            
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ë–ï–ó networkidle - –æ–Ω –≤—ã–∑—ã–≤–∞–µ—Ç —Ç–∞–π–º–∞—É—Ç—ã!)
            await self.page.wait_for_load_state("domcontentloaded", timeout=5000)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞
            new_url = self.page.url
            log.info(f"  ‚Üí –ù–æ–≤—ã–π URL: {new_url}")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤
            try:
                await self.page.wait_for_selector('a[href*="/tiktok-shop-product/"]', timeout=10000)
                
                # –î–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ä–µ–º—è –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
                await self.human_delay(2, 3)
                
                log.info("  ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —É—Å–ø–µ—à–µ–Ω")
                return True
            except:
                log.warning("  ‚ö†Ô∏è –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞")
                return False
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É: {e}")
            import traceback
            log.error(traceback.format_exc())
            return False
    
    async def get_product_details_with_return(self, product_index: int, sheets_writer=None, banned_products=None):
        """
        –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        
        –ê–ª–≥–æ—Ä–∏—Ç–º:
        1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        2. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É
        3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ban-list (–µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω)
        4. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–≤–∞—Ä (get_product_details)
        5. –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        
        Args:
            product_index: –ò–Ω–¥–µ–∫—Å —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–Ω–∞—á–∏–Ω–∞—è —Å 0)
            sheets_writer: –û–±—ä–µ–∫—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ Google Sheets
            banned_products: –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö URL (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
        
        Returns:
            ProductData –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ
            Dict —Å–æ status="insufficient_videos" –µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ
            Dict —Å–æ status="duplicate" –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
            None –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        """
        log.info(f"\n{'='*80}")
        log.info(f"üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ü–û –ò–ù–î–ï–ö–°–£ {product_index}")
        log.info(f"{'='*80}")
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        main_page_url = self.page.url
        log.info(f"  ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {main_page_url}")
        
        def normalize_url(url: str) -> str:
            """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL (—É–±—Ä–∞—Ç—å —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É)"""
            if not url:
                return ""
            url = url.strip().rstrip('/')
            # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if '?' in url:
                url = url.split('?')[0]
            return url
        
        try:
            # –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É
            log.info(f"\nüìå –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É {product_index}...")
            
            try:
                # –ò—â–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
                product_links = await self.page.query_selector_all('a[href*="/tiktok-shop-product/"]')
                
                if not product_links:
                    log.error("  ‚ùå –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
                    return None
                
                if product_index >= len(product_links):
                    log.error(f"  ‚ùå –ò–Ω–¥–µ–∫—Å {product_index} –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã (–≤—Å–µ–≥–æ {len(product_links)} —Ç–æ–≤–∞—Ä–æ–≤)")
                    return None
                
                # –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Ç–æ–≤–∞—Ä–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É
                product_link = product_links[product_index]
                
                # –ü–æ–ª—É—á–∞–µ–º URL —Ç–æ–≤–∞—Ä–∞
                href = await product_link.get_attribute("href")
                if not href:
                    log.error(f"  ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å URL –¥–ª—è —Ç–æ–≤–∞—Ä–∞ {product_index}")
                    return None
                
                # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π URL
                if href.startswith("/"):
                    product_url = f"https://www.pipiads.com{href}"
                elif href.startswith("http"):
                    product_url = href
                else:
                    product_url = f"https://www.pipiads.com/{href}"
                
                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º URL (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
                product_url = normalize_url(product_url)
                
                if not product_url:
                    log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                    return None
                
                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
                if banned_products is not None and product_url in banned_products:
                    log.warning(f"  üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: {product_url}")
                    log.warning(f"     –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.")
                    return {"status": "duplicate", "product_url": product_url}
                
                log.info(f"  ‚úÖ –ü–æ–ª—É—á–µ–Ω URL —Ç–æ–≤–∞—Ä–∞: {product_url}")
                
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ URL —Ç–æ–≤–∞—Ä–∞: {e}")
                return None
            
            # –®–ê–ì 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ get_product_details
            log.info(f"\nüìå –®–ê–ì 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞...")
            product_data = await self.get_product_details(product_url, sheets_writer=sheets_writer)
            
            # –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–¥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é)
            log.info(f"\nüìå –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞...")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∏ –µ—Å—Ç—å –≤–∏–¥–µ–æ
            if not product_data:
                log.warning("  ‚ö†Ô∏è product_data –ø—É—Å—Ç")
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                await self.return_to_main_page(main_page_url)
                return None
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ —Ç–æ–≤–∞—Ä –ø—Ä–æ–ø—É—â–µ–Ω –∏–∑-–∑–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
            if hasattr(product_data, '_insufficient_videos') and product_data._insufficient_videos:
                videos_found = getattr(product_data, '_videos_found', 0)
                log.warning(f"  ‚ö†Ô∏è –¢–æ–≤–∞—Ä –ø—Ä–æ–ø—É—â–µ–Ω: –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ (–Ω–∞–π–¥–µ–Ω–æ –≤—Å–µ–≥–æ: {videos_found})")
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                await self.return_to_main_page(main_page_url)
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª–æ–≤–∞—Ä—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "insufficient_videos"
                return {
                    "status": "insufficient_videos",
                    "product_name": getattr(product_data, 'product_name', 'N/A'),
                    "videos_found": videos_found,
                    "videos_required": 3,
                    "reason": f"–ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (>= {config.MIN_IMPRESSIONS} impressions, <= {config.DAYS_BACK} –¥–Ω–µ–π) –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ"
                }
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ
            videos_count = len(product_data.videos) if hasattr(product_data, 'videos') else 0
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ –≤–∏–¥–µ–æ: {videos_count}")
            
            # –ï—Å–ª–∏ –≤–∏–¥–µ–æ –º–µ–Ω—å—à–µ 3 - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
            if videos_count < 3:
                log.warning(f"  ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ: {videos_count} < 3")
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                await self.return_to_main_page(main_page_url)
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª–æ–≤–∞—Ä—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "insufficient_videos"
                return {
                    "status": "insufficient_videos",
                    "product_name": getattr(product_data, 'product_name', 'N/A'),
                    "videos_found": videos_count,
                    "videos_required": 3,
                    "reason": f"–ù–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ {videos_count} –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏"
                }
            
            # –®–ê–ì 4: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            log.info(f"\nüìå –®–ê–ì 4: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É...")
            await self.return_to_main_page(main_page_url)
            
            # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä
            log.info(f"  ‚úÖ –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ ({videos_count} –≤–∏–¥–µ–æ)")
            return product_data
            
        except Exception as e:
            log.error(f"\n‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É {product_index}: {e}")
            import traceback
            log.error(traceback.format_exc())
            
            # –ü—ã—Ç–∞–µ–º—Å—è –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
            try:
                await self.return_to_main_page(main_page_url)
            except:
                log.error("  ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏")
            
            return None
    
    async def _set_sort_by_first_seen(self) -> bool:
        """
        –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É "First seen" –≤ dropdown
        
        Returns:
            True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
        """
        log.info("  ‚Üí –ü–æ–∏—Å–∫ dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏...")
        try:
            # –ò—â–µ–º dropdown "Sort by"
            sort_selectors = [
                'select:has-text("Sort by")',
                'select',
                '[class*="sort"]',
                'text="Sort by: First seen"',
                'text="Sort by"',
            ]
            
            dropdown = None
            for selector in sort_selectors:
                try:
                    dropdown = await self.page.query_selector(selector)
                    if dropdown:
                        is_visible = await dropdown.is_visible()
                        if is_visible:
                            log.debug(f"–ù–∞–π–¥–µ–Ω dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: {selector}")
                            break
                        else:
                            dropdown = None
                except:
                    continue
            
            if not dropdown:
                # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ —Ç–µ–∫—Å—Ç—É "Sort by: First seen"
                try:
                    sort_text = await self.page.query_selector('text="Sort by: First seen"')
                    if sort_text:
                        # –ö–ª–∏–∫–∞–µ–º –Ω–∞ —Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å dropdown
                        await sort_text.click()
                        await self.human_delay(0.5, 1)
                        
                        # –ò—â–µ–º –æ–ø—Ü–∏—é "First seen"
                        first_seen_option = await self.page.query_selector('text="First seen"')
                        if first_seen_option:
                            await first_seen_option.click()
                            await self.human_delay(1, 2)
                            log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (—á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç)")
                            return True
                except:
                    pass
                
                log.warning("Dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å")
                return False
            
            # –ï—Å–ª–∏ —ç—Ç–æ select —ç–ª–µ–º–µ–Ω—Ç
            tag_name = await dropdown.evaluate("el => el.tagName.toLowerCase()")
            if tag_name == "select":
                # –í—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é —á–µ—Ä–µ–∑ value –∏–ª–∏ —Ç–µ–∫—Å—Ç
                try:
                    log.info("  ‚Üí –ù–∞–π–¥–µ–Ω select —ç–ª–µ–º–µ–Ω—Ç, –≤—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é 'First seen'...")
                    await dropdown.select_option(label="First seen")
                    await self.human_delay(1, 2)
                    log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (select)")
                    return True
                except:
                    pass
            
            # –ï—Å–ª–∏ —ç—Ç–æ –∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown - –∫–ª–∏–∫–∞–µ–º –∏ –≤—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é
            log.info("  ‚Üí –ù–∞–π–¥–µ–Ω –∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown, –æ—Ç–∫—Ä—ã–≤–∞–µ–º...")
            await dropdown.click()
            await self.human_delay(0.5, 1)
            
            # –ò—â–µ–º –æ–ø—Ü–∏—é "First seen"
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –æ–ø—Ü–∏–∏ 'First seen'...")
            option_selectors = [
                'text="First seen"',
                'text="Sort by: First seen"',
                '[role="option"]:has-text("First seen")',
            ]
            
            for opt_sel in option_selectors:
                try:
                    option = await self.page.query_selector(opt_sel)
                    if option:
                        await option.click()
                        await self.human_delay(1, 2)
                        log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (–∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown)")
                        return True
                except:
                    continue
            
            log.warning("  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É 'First seen'")
            return False
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: {e}")
            return False
    
    async def _get_videos_from_tiktok_ads_block(self) -> List[Dict[str, Any]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ TikTok Ads
        
        Returns:
            –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        videos = []
        
        try:
            log.info("  ‚Üí –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ...")
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ
            await self.human_delay(0.5, 1)
            
            # –ò—â–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ - –ø—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã...")
            video_card_selectors = [
                '[class*="video"]',
                '[class*="card"]',
                '[class*="ad"]',
                'div[class*="item"]',
                'a[href*="/ad-search/"]',
            ]
            
            video_elements = []
            for selector in video_card_selectors:
                try:
                    elements = await self.page.query_selector_all(selector)
                    if elements:
                        log.debug(f"–ù–∞–π–¥–µ–Ω–æ {len(elements)} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º {selector}")
                        # –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ, —á—Ç–æ —Å–æ–¥–µ—Ä–∂–∞—Ç –≤–∏–¥–µ–æ (–∏–º–µ—é—Ç thumbnail –∏–ª–∏ play button)
                        for elem in elements:
                            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –∫–∞—Ä—Ç–æ—á–∫–∞ –≤–∏–¥–µ–æ
                            has_play_button = await elem.query_selector('[class*="play"], svg, [class*="thumbnail"]')
                            if has_play_button or '/ad-search/' in str(await elem.get_attribute("href") or ""):
                                video_elements.append(elem)
                        if video_elements:
                            break
                except:
                    continue
            
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ")
            
            # –û–ì–†–ê–ù–ò–ß–ï–ù–ò–ï: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 50 –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
            max_cards = 50
            if len(video_elements) > max_cards:
                log.info(f"  ‚Üí –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ {max_cards} –∏–∑ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫")
                video_elements = video_elements[:max_cards]
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
            log.info("  ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–µ–∫...")
            log.info(f"  ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∞ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫...")
            
            successful_extractions = 0
            for i, card in enumerate(video_elements, 1):
                try:
                    video_data = await self._extract_video_data_from_card(card, i)
                    if video_data:
                        videos.append(video_data)
                        impression = video_data.get('impression', 0)
                        first_seen = video_data.get('first_seen', 'N/A')
                        
                        # –õ–û–ì–ò–†–£–ï–ú –ö–ê–ñ–î–û–ï –í–ò–î–ï–û (–∫–∞–∫ –ø—Ä–æ—Å–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
                        log.info(f"  üìπ –í–∏–¥–µ–æ {i}: impression={impression}, first_seen={first_seen}")
                        
                        if impression > 0 or first_seen != 'N/A':
                            successful_extractions += 1
                except Exception as e:
                    log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ {i}: {e}")
                    continue
            
            log.info(f"  ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–æ {len(videos)} –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ (—É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–æ: {successful_extractions})")
            return videos
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤–∏–¥–µ–æ: {e}")
            return []
    
    async def _extract_video_data_from_card(self, card_element, card_index: int = 0) -> Optional[Dict[str, Any]]:
        """
        –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ
        
        Args:
            card_element: –≠–ª–µ–º–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ
            card_index: –ò–Ω–¥–µ–∫—Å –∫–∞—Ä—Ç–æ—á–∫–∏ (–¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ –∏–ª–∏ None
        """
        try:
            video_data = {
                "ad_search_url": None,
                "impression": 0,
                "first_seen": None,
                "card_element": card_element,  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –∫–ª–∏–∫–∞
            }
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï IMPRESSION ==========
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ HTML-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
            # –ò—â–µ–º div.data-count > div.item –≥–¥–µ caption = "Impression"
            try:
                # –ò—â–µ–º –≤—Å–µ –±–ª–æ–∫–∏ data-count
                data_count_items = await card_element.query_selector_all('div.data-count div.item')
                
                if card_index <= 3:
                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –Ω–∞–π–¥–µ–Ω–æ {len(data_count_items)} –±–ª–æ–∫–æ–≤ div.item")
                
                for idx, item in enumerate(data_count_items):
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å impression
                    caption_elem = await item.query_selector('p.caption')
                    if caption_elem:
                        caption_text = await caption_elem.inner_text()
                        
                        if card_index <= 3:
                            log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}, –±–ª–æ–∫ {idx}: caption = '{caption_text}'")
                        
                        if 'Impression' in caption_text or '–ü–æ–∫–∞–∑' in caption_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
                            value_elem = await item.query_selector('p.value')
                            if value_elem:
                                # –ü–æ–ø—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
                                impression_str_inner = (await value_elem.inner_text()).strip()
                                impression_str_html = (await value_elem.inner_html()).strip()
                                impression_str_content = (await value_elem.text_content()).strip()
                                
                                # –í–°–ï–ì–î–ê –ª–æ–≥–∏—Ä—É–µ–º RAW-–∑–Ω–∞—á–µ–Ω–∏–µ (–¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–∞—Ä—Ç–æ—á–µ–∫)
                                if card_index <= 3:
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (inner_text) = '{impression_str_inner}'")
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (inner_html) = '{impression_str_html}'")
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (text_content) = '{impression_str_content}'")
                                
                                # –ò—Å–ø–æ–ª—å–∑—É–µ–º inner_text –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫
                                impression_str = impression_str_inner
                                impression = validator.parse_impressions(impression_str)
                                if impression:
                                    video_data["impression"] = impression
                                    if card_index <= 3:
                                        log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression PARSED = {impression}")
                                    break
                                else:
                                    if card_index <= 3:
                                        log.warning(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: parse_impressions –≤–µ—Ä–Ω—É–ª None –¥–ª—è '{impression_str}'")
            except Exception as e:
                if card_index <= 3:
                    log.error(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ impression: {e}")
                    import traceback
                    log.error(traceback.format_exc())
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï FIRST SEEN ==========
            # –ò—â–µ–º div.create-time > span —Å –¥–∞—Ç–æ–π
            try:
                create_time_elem = await card_element.query_selector('div.create-time span')
                if create_time_elem:
                    date_text = (await create_time_elem.inner_text()).strip()
                    # –õ–æ–≥–∏—Ä—É–µ–º RAW-–∑–Ω–∞—á–µ–Ω–∏–µ
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: first_seen RAW='{date_text}'")
                    
                    # –§–æ—Ä–º–∞—Ç: "Nov 05 2025-Nov 11 2025" - –±–µ—Ä–µ–º –ü–ï–†–í–£–Æ –¥–∞—Ç—É (–¥–æ –¥–µ—Ñ–∏—Å–∞)
                    # –ò—Å–ø–æ–ª—å–∑—É–µ–º regex –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–µ—Ä–≤–æ–π –¥–∞—Ç—ã
                    match = re.match(r'([A-Z][a-z]{2}\s+\d{1,2}\s+\d{4})', date_text)
                    if match:
                        first_seen_str = match.group(1)
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –¥–∞—Ç—ã
                        parsed_date = validator.parse_video_date(first_seen_str)
                        if parsed_date:
                            video_data["first_seen"] = first_seen_str
                            log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: first_seen parsed='{first_seen_str}'")
            except Exception as e:
                if card_index <= 3:
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ first_seen —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä: {e}")
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï AD-SEARCH –°–°–´–õ–ö–ò ==========
            try:
                link_element = await card_element.query_selector('a.btn-detail[href*="/ad-search/"]')
                if link_element:
                    href = await link_element.get_attribute("href")
                    if href:
                        if href.startswith("/"):
                            video_data["ad_search_url"] = f"https://www.pipiads.com{href}"
                        elif href.startswith("http"):
                            video_data["ad_search_url"] = href
                        else:
                            video_data["ad_search_url"] = f"https://www.pipiads.com/{href}"
                        if card_index <= 3:
                            log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: ad_search_url = {video_data['ad_search_url']}")
            except Exception as e:
                if card_index <= 3:
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ ad_search_url: {e}")
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Å—Å—ã–ª–∫—É, –Ω–æ –µ—Å—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∞ - –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –Ω–µ—ë
            if not video_data["ad_search_url"]:
                video_data["card_element"] = card_element
            
            # –õ–æ–≥–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–∞—Ä—Ç–æ—á–µ–∫
            if card_index <= 3:
                log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –∏—Ç–æ–≥–æ - impression={video_data['impression']}, first_seen={video_data['first_seen']}, ad_search_url={bool(video_data['ad_search_url'])}")
            
            return video_data
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ {card_index}: {e}")
            import traceback
            log.debug(traceback.format_exc())
            return None
    
    async def _filter_videos(self, videos: List[Dict[str, Any]]) -> List[Dict[str, Any]]:
        """
        –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
        
        Args:
            videos: –°–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        
        Returns:
            –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ
        """
        filtered = []
        
        for video in videos:
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ impression (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π "170.6K" –∏–ª–∏ —á–∏—Å–ª–æ–º)
            impression = video.get("impression", 0)
            impression_num = 0
            if isinstance(impression, str):
                # –ü–∞—Ä—Å–∏–º —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                impression_num = validator.parse_impressions(impression) or 0
            elif isinstance(impression, (int, float)):
                impression_num = int(impression)
            
            if not validator.validate_impressions(impression_num, config.MIN_IMPRESSIONS):
                log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: impression {impression} ({impression_num}) < {config.MIN_IMPRESSIONS}")
                continue
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
            first_seen = video.get("first_seen")
            if first_seen and first_seen != "N/A" and first_seen is not None:
                parsed_date = validator.parse_video_date(first_seen)
                if parsed_date:
                    if not validator.is_date_within_days(parsed_date, config.DAYS_BACK):
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –¥–∞—Ç–∞ {first_seen} —Å—Ç–∞—Ä—à–µ {config.DAYS_BACK} –¥–Ω–µ–π")
                        continue
                else:
                    # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å, –Ω–æ –µ—Å—Ç—å impression >= 50k, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –¥–∞—Ç—ã
                    if impression >= config.MIN_IMPRESSIONS:
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–∏–Ω—è—Ç–æ: –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É {first_seen}, –Ω–æ impression {impression} >= {config.MIN_IMPRESSIONS}")
                    else:
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É {first_seen} –∏ impression {impression} < {config.MIN_IMPRESSIONS}")
                        continue
            # –ï—Å–ª–∏ –¥–∞—Ç—ã –Ω–µ—Ç, –Ω–æ impression >= 50k, –ø—Ä–∏–Ω–∏–º–∞–µ–º –≤–∏–¥–µ–æ
            elif impression >= config.MIN_IMPRESSIONS:
                log.debug(f"–í–∏–¥–µ–æ –ø—Ä–∏–Ω—è—Ç–æ: –Ω–µ—Ç –¥–∞—Ç—ã, –Ω–æ impression {impression} >= {config.MIN_IMPRESSIONS}")
            else:
                log.debug("–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –Ω–µ—Ç –¥–∞—Ç—ã first_seen –∏ impression < –º–∏–Ω–∏–º—É–º–∞")
                continue
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
            video["_impression_num"] = impression_num
            filtered.append(video)
        
        # –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: —Å–Ω–∞—á–∞–ª–∞ –ø–æ –¥–∞—Ç–µ (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ), –ø–æ—Ç–æ–º –ø–æ impressions (—Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ)
        # –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ ad_search_url (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π), –∑–∞—Ç–µ–º tiktok_link, –∑–∞—Ç–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—è
        seen_videos = set()
        unique_videos = []
        for video in filtered:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)
            # 1. ad_search_url (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ)
            # 2. tiktok_link (–µ—Å–ª–∏ ad_search_url –Ω–µ—Ç)
            # 3. –ö–æ–º–±–∏–Ω–∞—Ü–∏—è impression + first_seen (fallback)
            video_id = None
            
            # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º ad_search_url (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ)
            ad_search_url = video.get("ad_search_url", "")
            if ad_search_url and ad_search_url != "N/A":
                ad_search_url = ad_search_url.rstrip('/')
                video_id = f"ad_search:{ad_search_url}"
            elif video.get("tiktok_link") and video.get("tiktok_link") != "N/A":
                video_id = f"tiktok:{video.get('tiktok_link')}"
            else:
                # Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—é impression + first_seen
                impression = video.get("impression", 0)
                first_seen = video.get("first_seen", "N/A")
                video_id = f"fallback:{impression}:{first_seen}"
            
            if video_id and video_id not in seen_videos:
                seen_videos.add(video_id)
                unique_videos.append(video)
            else:
                log.info(f"‚è≠Ô∏è  –í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ –∫–∞–∫ –¥—É–±–ª–∏–∫–∞—Ç: {video_id}")
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º: —Å–Ω–∞—á–∞–ª–∞ –ø–æ –¥–∞—Ç–µ (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ), –ø–æ—Ç–æ–º –ø–æ impressions (—Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ)
        def sort_key(v):
            parsed_date = validator.parse_video_date(v.get("first_seen", ""))
            if parsed_date:
                date_timestamp = -parsed_date.timestamp()  # –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ —É–±—ã–≤–∞–Ω–∏—é (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ)
            else:
                date_timestamp = 0  # –í–∏–¥–µ–æ –±–µ–∑ –¥–∞—Ç—ã –≤ –∫–æ–Ω–µ—Ü
            return (date_timestamp, -v.get("_impression_num", 0))
        
        unique_videos.sort(key=sort_key)
        
        # –ë–µ—Ä–µ–º —Ç–æ–ø-3
        top_videos = unique_videos[:3]
        
        log.info(f"‚úÖ –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ {len(filtered)} –≤–∏–¥–µ–æ –∏–∑ {len(videos)}, —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö: {len(unique_videos)}, —Ç–æ–ø-3: {len(top_videos)}")
        return top_videos
    
    async def _get_video_details(self, video: Dict[str, Any]) -> Optional[Dict[str, Any]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –≤–∏–¥–µ–æ
        
        Args:
            video: –°–ª–æ–≤–∞—Ä—å —Å –±–∞–∑–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ (–∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        try:
            # –ï—Å–ª–∏ –µ—Å—Ç—å ad_search_url, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞–ø—Ä—è–º—É—é
            if video.get("ad_search_url"):
                log.info(f"    ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É ad-search: {video['ad_search_url']}")
                await self.page.goto(video["ad_search_url"], wait_until="domcontentloaded", timeout=30000)
                await self.human_delay(0.5, 1)
                log.info("    ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ad-search –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            else:
                # –ï—Å–ª–∏ –Ω–µ—Ç URL, –∫–ª–∏–∫–∞–µ–º –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É
                # –í–ê–ñ–ù–û: –≠–ª–µ–º–µ–Ω—Ç –º–æ–∂–µ—Ç –∏—Å—á–µ–∑–Ω—É—Ç—å –∏–∑ DOM, –ø–æ—ç—Ç–æ–º—É –∏—â–µ–º –µ–≥–æ –∑–∞–Ω–æ–≤–æ
                card_element = video.get("card_element")
                if not card_element:
                    log.error("    ‚ùå –ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ –ø–µ—Ä–µ–π—Ç–∏ –∫ –≤–∏–¥–µ–æ (–Ω–µ—Ç URL –∏ —ç–ª–µ–º–µ–Ω—Ç–∞)")
                    return None
                
                log.info("    ‚Üí –ö–ª–∏–∫ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –≤–∏–¥–µ–æ...")
                try:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –µ—â–µ –≤ DOM
                    is_attached = await card_element.evaluate("el => el.isConnected")
                    if not is_attached:
                        log.warning("    ‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç –∏—Å—á–µ–∑ –∏–∑ DOM, –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∑–∞–Ω–æ–≤–æ...")
                        # –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ –ø–æ ad_search_url –∏–ª–∏ –¥—Ä—É–≥–∏–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º
                        # –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None
                        log.error("    ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ")
                        return None
                    
                    await card_element.click()
                    await self.human_delay(0.5, 1)
                    log.info("    ‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ –≤–∏–¥–µ–æ –æ—Ç–∫—Ä—ã—Ç–∞")
                except Exception as e:
                    log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É: {e}")
                    log.warning("    ‚ö†Ô∏è –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ...")
                    # –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –∏—Å—á–µ–∑, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None
                    return None
                
                # –ñ–¥–µ–º –æ—Ç–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞/–º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                # –ò—â–µ–º –∫–Ω–æ–ø–∫—É "More detail"
                log.info("    ‚Üí –ü–æ–∏—Å–∫ –∫–Ω–æ–ø–∫–∏ 'More detail'...")
                more_detail_selectors = [
                    'text="More detail"',
                    'text="More Detail"',
                    'button:has-text("More detail")',
                    'a:has-text("More detail")',
                ]
                
                more_detail_button = None
                for selector in more_detail_selectors:
                    try:
                        more_detail_button = await self.page.wait_for_selector(selector, timeout=5000, state="visible")
                        if more_detail_button:
                            log.info(f"    ‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ 'More detail' (—Å–µ–ª–µ–∫—Ç–æ—Ä: {selector})")
                            break
                    except:
                        continue
                
                if not more_detail_button:
                    log.error("    ‚ùå –ö–Ω–æ–ø–∫–∞ 'More detail' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
                    return None
                
                # –ö–ª–∏–∫–∞–µ–º –Ω–∞ "More detail"
                log.info("    ‚Üí –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É 'More detail'...")
                await more_detail_button.click()
                await self.human_delay(0.5, 1)
                
                # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
                log.info("    ‚Üí –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search...")
                await self.page.wait_for_load_state("domcontentloaded", timeout=10000)
                await self.human_delay(0.3, 0.5)
                log.info("    ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ad-search –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
            # –ü–µ—Ä–µ–¥–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏) –¥–ª—è fallback
            log.info("    ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search...")
            
            # –í–ê–ñ–ù–û: –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º domcontentloaded (–±—ã—Å—Ç—Ä–µ–µ) + –∑–∞–¥–µ—Ä–∂–∫–∞ + –æ–∂–∏–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            await self.page.wait_for_load_state("domcontentloaded", timeout=10000)
            await self.human_delay(2, 3)  # –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (Script, Hook, Audience) —Å retry
            elements_found = False
            for attempt in range(3):  # 3 –ø–æ–ø—ã—Ç–∫–∏
                try:
                    # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                    await self.page.wait_for_selector('li#ai-script, li#ai-hook, div.addel-info-item', timeout=5000, state="visible")
                    log.info(f"    ‚úÖ –ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search (–ø–æ–ø—ã—Ç–∫–∞ {attempt + 1})")
                    elements_found = True
                    break
                except:
                    if attempt < 2:
                        log.debug(f"    ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∂–¥–µ–º –µ—â–µ...")
                        await self.human_delay(2, 3)
                    else:
                        log.warning("    ‚ö†Ô∏è –ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ 3 –ø–æ–ø—ã—Ç–æ–∫, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ...")
            
            return await self._extract_ad_search_data(video)
            
        except Exception as e:
            log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–µ—Ç–∞–ª–µ–π –≤–∏–¥–µ–æ: {e}")
            import traceback
            log.error(traceback.format_exc())
            return None
    
    async def _extract_ad_search_data(self, original_video: Optional[Dict[str, Any]] = None) -> Dict[str, Any]:
        """
        –ò–∑–≤–ª–µ—á—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
        
        Args:
            original_video: –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (–¥–ª—è fallback impressions)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        video_data = {
            "tiktok_link": "N/A",
            "impression": 0,
            "script": "N/A",
            "hook": "N/A",
            "audience_age": "N/A",
            "country": "N/A",
            "first_seen": "N/A",
        }
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è fallback
        if original_video:
            original_impression = original_video.get("impression")
            if original_impression:
                video_data["_original_impression"] = original_impression
        
        try:
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            await self.page.wait_for_load_state("domcontentloaded")
            await self.human_delay(0.3, 0.5)
            
            # –ü–æ–ª—É—á–∞–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ø–æ–∏—Å–∫–∞
            page_text = await self.page.content()
            
            # 1. TikTok —Å—Å—ã–ª–∫–∞ (–∏–∑ –ø–æ–ª—è "TikTok Post" (–∞–Ω–≥–ª.) –∏–ª–∏ "–ü–æ—Å—Ç TikTok" (—Ä—É—Å.))
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ TikTok —Å—Å—ã–ª–∫–∏...")
            
            # –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –ø–æ —Ç–µ–∫—Å—Ç—É "TikTok Post" –∏–ª–∏ "–ü–æ—Å—Ç TikTok"
            tiktok_post_selectors = [
                'text=/TikTok Post/i',  # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
                'text=/–ü–æ—Å—Ç TikTok/i',  # –†—É—Å—Å–∫–∏–π fallback
            ]
            
            for selector in tiktok_post_selectors:
                try:
                    locator = self.page.locator(selector).first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Å—Å—ã–ª–∫—É —Ä—è–¥–æ–º
                        try:
                            parent_locator = locator.locator("..")
                            # –ò—â–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å—Å—ã–ª–∫–∞–º —Å /v/)
                            link = await parent_locator.locator('a[href*="m.tiktok.com/v/"]').first.element_handle()
                            if not link:
                                link = await parent_locator.locator('a[href*="tiktok.com/v/"]').first.element_handle()
                            if not link:
                                link = await parent_locator.locator('a[href*="tiktok.com"]').first.element_handle()
                            if link:
                                href = await link.get_attribute("href")
                                if href:
                                    # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä—ã –≤ TikTok Shop
                                    if "shop.tiktok.com/view/product" in href or "/view/product" in href:
                                        log.debug(f"      ‚Üí –ü—Ä–æ–ø—É—â–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä: {href[:50]}...")
                                        continue
                                    # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ
                                    if "/v/" in href or "m.tiktok.com" in href:
                                        video_data["tiktok_link"] = href
                                        log.info(f"      ‚úÖ TikTok —Å—Å—ã–ª–∫–∞ –Ω–∞–π–¥–µ–Ω–∞: {href[:50]}...")
                                        break
                        except:
                            pass
                except:
                    continue
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç, –∏—â–µ–º –≤—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ TikTok
            # –í–ê–ñ–ù–û: –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ (m.tiktok.com/v/...), –ù–ï –Ω–∞ —Ç–æ–≤–∞—Ä—ã (shop.tiktok.com/view/product/...)
            if video_data["tiktok_link"] == "N/A":
                tiktok_link_selectors = [
                    'a[href*="m.tiktok.com/v/"]',  # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ
                    'a[href*="tiktok.com/v/"]',    # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                    'a[href*="tiktok.com"]',       # Fallback
                ]
                
                for selector in tiktok_link_selectors:
                    try:
                        links = await self.page.query_selector_all(selector)
                        for link in links:
                            href = await link.get_attribute("href")
                            if href and "tiktok.com" in href:
                                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä—ã –≤ TikTok Shop
                                if "shop.tiktok.com/view/product" in href or "/view/product" in href:
                                    log.debug(f"      ‚Üí –ü—Ä–æ–ø—É—â–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä: {href[:50]}...")
                                    continue
                                
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ (—Å–æ–¥–µ—Ä–∂–∞—Ç /v/ –≤ –ø—É—Ç–∏)
                                if "/v/" in href or "m.tiktok.com" in href:
                                    video_data["tiktok_link"] = href
                                    log.info(f"      ‚úÖ TikTok —Å—Å—ã–ª–∫–∞ –Ω–∞–π–¥–µ–Ω–∞: {href[:50]}...")
                                    break
                        if video_data["tiktok_link"] != "N/A":
                            break
                    except:
                        continue
            
            if video_data["tiktok_link"] == "N/A":
                log.warning("      ‚ö†Ô∏è TikTok —Å—Å—ã–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
            
            # 2. Impressions - –ö–†–ò–¢–ò–ß–ù–û: "Impressions" (–∞–Ω–≥–ª.) –∏–ª–∏ "–ü–æ–∫–∞–∑—ã" (—Ä—É—Å.), –Ω–µ "Likes" –∏–ª–∏ "–ù—Ä–∞–≤–∏—Ç—Å—è"!
            # –ò—â–µ–º –≤ —Ä–∞–∑–¥–µ–ª–µ "Data/–î–∞–Ω–Ω—ã–µ" –≤ –ø—É–Ω–∫—Ç–µ "Impression/–ü–æ–∫–∞–∑"
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ impressions...")
            impression_text = await self._extract_impressions()
            if impression_text:
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–µ—Å–ª–∏ –æ–Ω —É–∂–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "170.6K" –∏–ª–∏ "339.9M")
                if impression_text.upper().endswith(('K', 'M')):
                    video_data["impression"] = impression_text
                    log.info(f"      ‚úÖ Impressions (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç): {impression_text}")
                else:
                    # –ü–∞—Ä—Å–∏–º —á–∏—Å–ª–æ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞—Ç–Ω–æ
                    impression_num = validator.parse_impressions(impression_text) or 0
                    video_data["impression"] = validator.format_impressions(impression_num)
                    log.info(f"      ‚úÖ Impressions (—Å—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–æ): {video_data['impression']}")
            else:
                # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ–Ω–∏ –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                # (–∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞)
                original_impression = video_data.get("_original_impression")
                if original_impression:
                    if isinstance(original_impression, (int, float)) and original_impression > 0:
                        video_data["impression"] = validator.format_impressions(int(original_impression))
                        log.info(f"      ‚úÖ Impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏: {video_data['impression']}")
                    elif isinstance(original_impression, str) and original_impression != "N/A":
                        video_data["impression"] = original_impression
                        log.info(f"      ‚úÖ Impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (—Å—Ç—Ä–æ–∫–∞): {original_impression}")
                    else:
                        video_data["impression"] = "N/A"
                        log.warning("      ‚ö†Ô∏è Impressions –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –Ω–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ")
                else:
                    video_data["impression"] = "N/A"
                    log.warning("      ‚ö†Ô∏è Impressions –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
            
            # 3. Script (–∏–∑ "Transcript" –∏–ª–∏ "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞")
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è (script)...")
            log.info(f"      ‚Üí –¢–µ–∫—É—â–∏–π URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {self.page.url}")
            script = await self._extract_script()
            if script:
                video_data["script"] = script
                log.info(f"      ‚úÖ Script –Ω–∞–π–¥–µ–Ω ({len(script)} —Å–∏–º–≤–æ–ª–æ–≤): {script[:100]}...")
            else:
                video_data["script"] = "N/A"
                log.warning("      ‚ö†Ô∏è Script –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-script p.content-text –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 4. Hook (–∏–∑ —Å–µ–∫—Ü–∏–∏ Hook –∏–ª–∏ Hooks)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ hook...")
            hook = await self._extract_hook()
            if not hook:
                # –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω
                log.warning("      ‚ö†Ô∏è Hook –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫...")
                await self.human_delay(1, 2)  # –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É
                hook = await self._extract_hook()
            
            if hook:
                video_data["hook"] = hook
                log.info(f"      ‚úÖ Hook –Ω–∞–π–¥–µ–Ω ({len(hook)} —Å–∏–º–≤–æ–ª–æ–≤): {hook[:100]}...")
            else:
                video_data["hook"] = "N/A"
                log.warning("      ‚ö†Ô∏è Hook –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook p.content-text –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 5. Audience Age (–∏–∑ –ø–æ–ª—è Audience/–ê—É–¥–∏—Ç–æ—Ä–∏—è)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∞—É–¥–∏—Ç–æ—Ä–∏–∏...")
            audience_data = await self._extract_audience()
            if audience_data:
                age = audience_data.get("age", "N/A")
                platform = audience_data.get("platform", "N/A")
                # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ "35-45" –∏–ª–∏ "35-45 Android" (–µ—Å–ª–∏ –µ—Å—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞)
                # –í —Å—Ç—Ä–æ–∫–µ 6 —Ç–æ–ª—å–∫–æ –≤–æ–∑—Ä–∞—Å—Ç "25-35", –±–µ–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
                video_data["audience_age"] = age if age != "N/A" else "N/A"
                log.info(f"      ‚úÖ Audience: {video_data['audience_age']}")
            else:
                video_data["audience_age"] = "N/A"
                log.info("      ‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
            
            # 6. Country (–∏–∑ –ø–æ–ª—è "Country/Region" –∏–ª–∏ "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω" - –û–¢–î–ï–õ–¨–ù–û –æ—Ç Audience!)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã...")
            country = await self._extract_country()
            if country:
                video_data["country"] = country
                log.info(f"      ‚úÖ Country: {country}")
            else:
                video_data["country"] = "N/A"
                log.warning("      ‚ö†Ô∏è Country –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä div.addel-info-item —Å 'Country/Region' –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 7. First seen (—Ñ–æ—Ä–º–∞—Ç "Oct 27 2025" - –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ "Oct 28 2025 ~ Nov 10 2025")
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞—Ç—ã First seen...")
            first_seen = await self._extract_first_seen()
            if first_seen:
                video_data["first_seen"] = first_seen
                log.info(f"      ‚úÖ First seen: {first_seen}")
            else:
                video_data["first_seen"] = "N/A"
                log.info("      ‚ö†Ô∏è First seen –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
            
            log.info(f"    ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ—á–µ–Ω—ã: impression={video_data['impression']}, first_seen={video_data['first_seen']}")
            return video_data
            
        except Exception as e:
            log.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö ad-search: {e}")
            return video_data
    
    async def _extract_impressions(self) -> Optional[str]:
        """
        –ò–∑–≤–ª–µ—á—å impressions - –ö–†–ò–¢–ò–ß–ù–û: –≤ —Ä–∞–∑–¥–µ–ª–µ "Data/–î–∞–Ω–Ω—ã–µ" –≤ –ø—É–Ω–∫—Ç–µ "Impression/–ü–æ–∫–∞–∑"
        –í–ê–ñ–ù–û: –ù–ï –±—Ä–∞—Ç—å —à–∞–±–ª–æ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã!
        
        Returns:
            –°—Ç—Ä–æ–∫–∞ —Å impressions (–Ω–∞–ø—Ä–∏–º–µ—Ä "170.6K", "339.9M") –∏–ª–∏ None
        """
        try:
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM (–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ)
            try:
                impression_data = await self.page.evaluate("""
                    () => {
                        // –ò—â–µ–º —Ä–∞–∑–¥–µ–ª "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                        const dataKeywords = ['Data', '–î–∞–Ω–Ω—ã–µ'];
                        const impressionKeywords = ['Impression', '–ü–æ–∫–∞–∑', '–ü–æ–∫–∞–∑—ã'];
                        
                        // –ò—â–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —ç–ª–µ–º–µ–Ω—Ç "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                            for (const dataKeyword of dataKeywords) {
                                if (text.includes(dataKeyword)) {
                                    // –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –∏—â–µ–º "Impression" –∏–ª–∏ "–ü–æ–∫–∞–∑"
                                    for (const impKeyword of impressionKeywords) {
                                        if (text.includes(impKeyword)) {
                                            // –ò—â–µ–º —á–∏—Å–ª–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "170.6K", "403.2M" –∏ —Ç.–¥.
                                            const patterns = [
                                                new RegExp(impKeyword + '[\\s:]*([\\d.,]+[KM]?)', 'i'),
                                                new RegExp('([\\d.,]+[KM]?)\\s*' + impKeyword, 'i')
                                            ];
                                            
                                            for (const pattern of patterns) {
                                                const match = text.match(pattern);
                                                if (match && match[1]) {
                                                    const value = match[1];
                                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ —á–∏—Å–ª–æ (–Ω–µ —à–∞–±–ª–æ–Ω–Ω–æ–µ)
                                                    // –û–±—ã—á–Ω–æ —Ä–µ–∞–ª—å–Ω—ã–µ impressions –æ—Ç 50K –¥–æ 500M
                                                    const numValue = parseFloat(value.replace(/[KM]/i, ''));
                                                    if (numValue >= 0.05 && numValue <= 1000) {
                                                        return value;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        
                        // Fallback: –∏—â–µ–º –Ω–∞–ø—Ä—è–º—É—é "Impression" –∏–ª–∏ "–ü–æ–∫–∞–∑" (–ù–ï "Likes"!)
                        for (const impKeyword of impressionKeywords) {
                            const elements = Array.from(document.querySelectorAll('*')).filter(el => {
                                const text = el.innerText || '';
                                return text.includes(impKeyword) && !text.toLowerCase().includes('likes') && !text.toLowerCase().includes('–Ω—Ä–∞–≤–∏—Ç—Å—è');
                            });
                            
                            for (const el of elements) {
                                const text = el.innerText || '';
                                const patterns = [
                                    new RegExp(impKeyword + '[\\s:]*([\\d.,]+[KM]?)', 'i'),
                                    new RegExp('([\\d.,]+[KM]?)\\s*' + impKeyword, 'i')
                                ];
                                
                                for (const pattern of patterns) {
                                    const match = text.match(pattern);
                                    if (match && match[1]) {
                                        const value = match[1];
                                        const numValue = parseFloat(value.replace(/[KM]/i, ''));
                                        if (numValue >= 0.05 && numValue <= 1000) {
                                            return value;
                                        }
                                    }
                                }
                            }
                        }
                        
                        return null;
                    }
                """)
                
                if impression_data:
                    log.debug(f"–ù–∞–π–¥–µ–Ω–æ impressions —á–µ—Ä–µ–∑ JavaScript: {impression_data}")
                    return impression_data
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ impressions —á–µ—Ä–µ–∑ JS: {e}")
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (fallback)
            data_keywords = ["Data", "–î–∞–Ω–Ω—ã–µ"]
            
            for keyword in data_keywords:
                try:
                    data_locator = self.page.locator(f'text=/{keyword}/i').first
                    if await data_locator.count() > 0:
                        impression_keywords = ["Impression", "–ü–æ–∫–∞–∑", "–ü–æ–∫–∞–∑—ã"]
                        for imp_keyword in impression_keywords:
                            try:
                                parent_text = await data_locator.locator("..").inner_text()
                                if imp_keyword in parent_text and "Likes" not in parent_text and "–ù—Ä–∞–≤–∏—Ç—Å—è" not in parent_text:
                                    pattern = rf'{imp_keyword}[:\s]*([\d.,]+[KM]?)'
                                    match = re.search(pattern, parent_text, re.IGNORECASE)
                                    if match:
                                        impression_str = match.group(1)
                                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —à–∞–±–ª–æ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                                        num_value = validator.parse_impressions(impression_str)
                                        if num_value and 50000 <= num_value <= 1000000000:  # –û—Ç 50K –¥–æ 1B
                                            log.debug(f"–ù–∞–π–¥–µ–Ω–æ impressions –≤ —Ä–∞–∑–¥–µ–ª–µ Data: {impression_str}")
                                            return impression_str
                            except:
                                continue
                except:
                    continue
            
            log.warning("–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ 'Impression' –∏–ª–∏ '–ü–æ–∫–∞–∑' –≤ —Ä–∞–∑–¥–µ–ª–µ Data")
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ impressions: {e}")
            return None
    
    async def _extract_script(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å —Å—Ü–µ–Ω–∞—Ä–∏–π –∏–∑ —Å–µ–∫—Ü–∏–∏ 'Script' –∏–ª–∏ '–°—Ü–µ–Ω–∞—Ä–∏–π' (–∏–ª–∏ 'Transcript' –∏–ª–∏ '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞')
        
        –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
        <li id="ai-script">
            <div class="li-title">...</div>
            <div class="control-content li-content">
                <p class="content-text slot-wrap">...</p>
            </div>
        </li>
        """
        try:
            # –ú–ï–¢–û–î 0: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä—É –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            # –ü—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º (—ç–ª–µ–º–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
            for attempt in range(3):
                try:
                    # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
                    try:
                        await self.page.wait_for_selector('li#ai-script', timeout=5000, state="visible")
                    except:
                        if attempt < 2:
                            log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç li#ai-script –Ω–µ –ø–æ—è–≤–∏–ª—Å—è, –∂–¥–µ–º –µ—â–µ...")
                            await self.human_delay(1, 2)
                            continue
                        else:
                            log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-script –Ω–µ –ø–æ—è–≤–∏–ª—Å—è –∑–∞ 15 —Å–µ–∫—É–Ω–¥")
                    
                    script_element = await self.page.query_selector('li#ai-script p.content-text')
                    if script_element:
                        script = await script_element.inner_text()
                        if script and len(script.strip()) > 10:
                            log.info(f"      ‚úÖ Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-script p.content-text ({len(script)} —Å–∏–º–≤–æ–ª–æ–≤)")
                            return script.strip()
                    else:
                        if attempt < 2:
                            log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω, –∂–¥–µ–º –µ—â–µ...")
                            await self.human_delay(1, 2)
                            continue
                        else:
                            log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-script p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω")
                except Exception as e:
                    if attempt < 2:
                        log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: –æ—à–∏–±–∫–∞ {e}, –ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑...")
                        await self.human_delay(1, 2)
                        continue
                    else:
                        log.debug(f"      ‚Üí –°–µ–ª–µ–∫—Ç–æ—Ä li#ai-script –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: {e}")
            
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
            script_keywords = ["Script", "–°—Ü–µ–Ω–∞—Ä–∏–π", "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞", "–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç"]
            
            for keyword in script_keywords:
                try:
                    # –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å —Ç–µ–∫—Å—Ç–æ–º
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            parent_text = await locator.locator("..").inner_text()
                            if keyword in parent_text:
                                parts = parent_text.split(keyword, 1)
                                if len(parts) > 1:
                                    script = parts[1].strip()
                                    # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –º–µ—Ç–∫–∏
                                    stop_words = ["Hook", "–•—É–∫", "Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", 
                                                "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", "Impressions", "–ü–æ–∫–∞–∑—ã",
                                                "Limited Time Offer", "Annual Plan", "Promotion Period", "50% OFF",
                                                "Privacy", "Terms", "Copyright", "PIPIADS", "All Rights Reserved",
                                                "AI-agent", "cosmobeauty", "credits", "subscription", "invoice",
                                                "Monthly Credits", "Extra Credits", "data cost", "detail costs",
                                                "Team Setting", "Affiliate Dashboard", "Logout"]
                                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                           "cosmobeauty", "credits", "subscription", "invoice", 
                                                           "Monthly Credits", "Extra Credits", "@gmail.com"]
                                    is_footer_menu = any(keyword in script for keyword in footer_menu_keywords)
                                    
                                    for stop_word in stop_words:
                                        if stop_word in script:
                                            script = script.split(stop_word)[0].strip()
                                    # –§–∏–ª—å—Ç—Ä—É–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (Video Text Translator, Quality, Size –∏ —Ç.–¥.)
                                    metadata_keywords = ["Video Text Translator", "Translator", "Quality", "Size", "Resolution", 
                                                        "Width", "Height", "Duration", "Format", "Codec", "Frame Rate"]
                                    is_metadata = any(keyword in script for keyword in metadata_keywords)
                                    
                                    # –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                    lines = script.split('\n')
                                    cleaned_lines = []
                                    skip_words = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook']
                                    for line in lines:
                                        line = line.strip()
                                        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                        if line and not line.startswith('#') and not any(skip in line for skip in skip_words):
                                            cleaned_lines.append(line)
                                    script = '\n'.join(cleaned_lines).strip()
                                    
                                    if script and len(script) > 10 and not is_footer_menu and not is_metadata:
                                        log.debug(f"Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Ä–æ–¥–∏—Ç–µ–ª—å)")
                                        return script
                        except:
                            pass
                        
                        # –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            next_sibling = await locator.evaluate_handle("el => el.nextElementSibling")
                            if next_sibling:
                                script = await next_sibling.as_element().inner_text()
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                       "cosmobeauty", "credits", "subscription", "invoice", 
                                                       "Monthly Credits", "Extra Credits", "@gmail.com"]
                                is_footer_menu = any(keyword in script for keyword in footer_menu_keywords)
                                # –§–∏–ª—å—Ç—Ä—É–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                metadata_keywords = ["Video Text Translator", "Translator", "Quality", "Size", "Resolution"]
                                is_metadata = any(keyword in script for keyword in metadata_keywords)
                                
                                # –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                lines = script.split('\n')
                                cleaned_lines = []
                                skip_words = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook']
                                for line in lines:
                                    line = line.strip()
                                    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                    if line and not line.startswith('#') and not any(skip in line for skip in skip_words):
                                        cleaned_lines.append(line)
                                script = '\n'.join(cleaned_lines).strip()
                                
                                if script and len(script) > 10 and not is_footer_menu and not is_metadata:
                                    log.debug(f"Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç)")
                                    return script.strip()
                        except:
                            pass
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                script = await self.page.evaluate("""
                    () => {
                        const keywords = ['Script', '–°—Ü–µ–Ω–∞—Ä–∏–π', 'Transcript', '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞', '–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç'];
                        const stopWords = ['Hook', '–•—É–∫', 'Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 
                                          'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 'Impressions', '–ü–æ–∫–∞–∑—ã',
                                          'Analysis', 'Advertiser', 'Display Name', 'Ad Copy',
                                          'Limited Time Offer', 'Annual Plan', 'Promotion Period', '50% OFF'];
                        
                        // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    // –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ (–æ–±—ã—á–Ω–æ —ç—Ç–æ —Å–∞–º script)
                                    let scriptText = null;
                                    
                                    // –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ sibling —ç–ª–µ–º–µ–Ω—Ç–∞
                                    let nextSibling = el.nextElementSibling;
                                    if (nextSibling) {
                                        scriptText = nextSibling.innerText || '';
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    if (!scriptText || scriptText.length < 10) {
                                        const parentText = el.parentElement ? el.parentElement.innerText || '' : '';
                                        if (parentText.includes(keyword)) {
                                            const parts = parentText.split(keyword);
                                            if (parts.length > 1) {
                                                scriptText = parts[1].trim();
                                            }
                                        }
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 3: –ò—â–µ–º –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö (–æ–±—ã—á–Ω–æ script –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –±–ª–æ–∫–µ)
                                    if (!scriptText || scriptText.length < 10) {
                                        const children = el.querySelectorAll('p, div, span');
                                        for (const child of children) {
                                            const childText = child.innerText || '';
                                            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç—ã
                                            if (childText.length > 20 && 
                                                !childText.includes('Advertiser') && 
                                                !childText.includes('Display Name') &&
                                                !childText.includes('Analysis') &&
                                                !childText.includes('Generator') &&
                                                !childText.includes('Limited Time Offer') &&
                                                !childText.includes('Annual Plan') &&
                                                !childText.includes('Promotion Period') &&
                                                !childText.includes('50% OFF')) {
                                                scriptText = childText;
                                                break;
                                            }
                                        }
                                    }
                                    
                                    if (scriptText) {
                                        // –£–±–∏—Ä–∞–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                        for (const stopWord of stopWords) {
                                            if (scriptText.includes(stopWord)) {
                                                scriptText = scriptText.split(stopWord)[0];
                                            }
                                        }
                                        
                                        scriptText = scriptText.trim();
                                        
                                        // –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                        const skipWords = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook'];
                                        const lines = scriptText.split('\\n');
                                        const cleanedLines = [];
                                        for (const line of lines) {
                                            const trimmedLine = line.trim();
                                            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                            if (trimmedLine && !trimmedLine.startsWith('#') && 
                                                !skipWords.some(word => trimmedLine.includes(word))) {
                                                cleanedLines.push(trimmedLine);
                                            }
                                        }
                                        scriptText = cleanedLines.join('\\n').trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π script (–Ω–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –Ω–µ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç, –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é)
                                        const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                                   'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                                   'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                                   'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                                   'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                        const isFooterMenu = footerMenuKeywords.some(keyword => scriptText.includes(keyword));
                                        
                                        // –§–∏–ª—å—Ç—Ä—É–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                    const metadataKeywords = ['Video Text Translator', 'Translator', 'Quality', 'Size', 'Resolution', 
                                                             'Width', 'Height', 'Duration', 'Format', 'Codec', 'Frame Rate'];
                                    const isMetadata = metadataKeywords.some(keyword => scriptText.includes(keyword));
                                    
                                    if (scriptText && scriptText.length > 20 && 
                                            !scriptText.startsWith('Analysis') &&
                                            !scriptText.includes('shop.tiktok.com') &&
                                            !scriptText.includes('Generator Image') &&
                                            !scriptText.includes('Limited Time Offer') &&
                                            !scriptText.includes('Annual Plan') &&
                                            !scriptText.includes('Promotion Period') &&
                                            !scriptText.includes('50% OFF') &&
                                            !scriptText.toLowerCase().includes('q4') &&
                                            !scriptText.toLowerCase().includes('monthly plan') &&
                                            !isFooterMenu &&
                                            !isMetadata) {
                                            return scriptText;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if script and len(script) > 10:
                    log.debug("Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript")
                    return script.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ script —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è: {e}")
            return None
    
    async def _extract_hook(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å hook –∏–∑ —Å–µ–∫—Ü–∏–∏ Hook/Hooks (–∞–Ω–≥–ª.) –∏–ª–∏ –•—É–∫/–•—É–∫–∏ (—Ä—É—Å.)
        –í–ê–ñ–ù–û: Hook –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ Script –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ!
        
        –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
        <li id="ai-hook">
            <div class="li-title">...</div>
            <div class="control-content li-content">
                <p class="content-text slot-wrap">...</p>
            </div>
        </li>
        """
        try:
            # –ú–ï–¢–û–î 0: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä—É –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                # –°–Ω–∞—á–∞–ª–∞ –∂–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
                try:
                    await self.page.wait_for_selector('li#ai-hook', timeout=5000, state="visible")
                except:
                    log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-hook –Ω–µ –ø–æ—è–≤–∏–ª—Å—è –∑–∞ 5 —Å–µ–∫—É–Ω–¥")
                
                hook_element = await self.page.query_selector('li#ai-hook p.content-text')
                if hook_element:
                    hook = await hook_element.inner_text()
                    if hook and len(hook.strip()) > 5:
                        log.info(f"      ‚úÖ Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook p.content-text ({len(hook)} —Å–∏–º–≤–æ–ª–æ–≤)")
                        return hook.strip()
                else:
                    log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-hook p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω")
            except Exception as e:
                log.debug(f"      ‚Üí –°–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: {e}")
            
            # –ù–û–í–´–ô –ú–ï–¢–û–î: –ò—â–µ–º Script, –∑–∞—Ç–µ–º –∏—â–µ–º Hook –≤ —Å–ª–µ–¥—É—é—â–µ–º —ç–ª–µ–º–µ–Ω—Ç–µ/—Å–µ–∫—Ü–∏–∏
            try:
                # –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏–º Script
                script_keywords = ["Script", "–°—Ü–µ–Ω–∞—Ä–∏–π", "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞"]
                for script_keyword in script_keywords:
                    try:
                        script_locator = self.page.locator(f'text=/{script_keyword}/i').first
                        if await script_locator.count() > 0:
                            # –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ Script, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç "Hook" –∏–ª–∏ "Hooks"
                            # –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ –ø–æ—Å–ª–µ Script
                            try:
                                # –°–ø–æ—Å–æ–± 1: –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å "Hook" –∏–ª–∏ "Hooks" –ø–æ—Å–ª–µ Script
                                parent = script_locator.locator("..")
                                parent_text = await parent.inner_text()
                                
                                # –ò—â–µ–º "Hook" –∏–ª–∏ "Hooks" –≤ —Ç–æ–º –∂–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ
                                if "Hook" in parent_text or "Hooks" in parent_text or "–•—É–∫" in parent_text or "–•—É–∫–∏" in parent_text:
                                    # –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é Script –∏ Hook –≤ —Ç–µ–∫—Å—Ç–µ
                                    script_pos = parent_text.find(script_keyword)
                                    hook_pos = -1
                                    for hook_word in ["Hook", "Hooks", "–•—É–∫", "–•—É–∫–∏"]:
                                        pos = parent_text.find(hook_word, script_pos)
                                        if pos > script_pos:
                                            hook_pos = pos
                                            break
                                    
                                    if hook_pos > script_pos:
                                        # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ "Hook" –∏–ª–∏ "Hooks"
                                        hook_section = parent_text[hook_pos:]
                                        # –£–±–∏—Ä–∞–µ–º "Hook" –∏–ª–∏ "Hooks" –∏–∑ –Ω–∞—á–∞–ª–∞
                                        hook_section = re.sub(r'^Hooks?\s*:?\s*', '', hook_section, flags=re.IGNORECASE)
                                        hook_section = re.sub(r'^–•—É–∫–∏?\s*:?\s*', '', hook_section, flags=re.IGNORECASE)
                                        hook_text = hook_section.strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏ (Target Audience, First seen –∏ —Ç.–¥.)
                                        stop_words = ["Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", 
                                                    "Impressions", "–ü–æ–∫–∞–∑—ã", "Country", "–°—Ç—Ä–∞–Ω–∞", "Country/Region", "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω"]
                                        for stop_word in stop_words:
                                            if stop_word in hook_text:
                                                hook_text = hook_text.split(stop_word)[0].strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                        hook_text = re.sub(r'Quality\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'Size\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'Resolution\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'--', '', hook_text)
                                        hook_text = re.sub(r'\n{2,}', '\n', hook_text).strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞ –≤ –Ω–∞—á–∞–ª–µ
                                        hook_text = re.sub(r'^(Tags|Script|Hooks?)\s*:?\s*', '', hook_text, flags=re.IGNORECASE)
                                        
                                        if hook_text and len(hook_text) > 5 and len(hook_text) < 500:
                                            log.debug(f"Hook –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ Script —á–µ—Ä–µ–∑ '{script_keyword}'")
                                            return hook_text
                            except:
                                pass
                            
                            # –°–ø–æ—Å–æ–± 2: –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π sibling —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ Script
                            try:
                                script_element = await script_locator.element_handle()
                                if script_element:
                                    # –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å —Ç–µ–∫—Å—Ç–æ–º "Hook" –∏–ª–∏ "Hooks"
                                    next_elements = await self.page.evaluate("""
                                        (scriptEl) => {
                                            let current = scriptEl;
                                            // –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å "Hook" –∏–ª–∏ "Hooks"
                                            for (let i = 0; i < 10; i++) {
                                                current = current.nextElementSibling;
                                                if (!current) break;
                                                const text = current.innerText || '';
                                                if (text.includes('Hook') || text.includes('Hooks') || 
                                                    text.includes('–•—É–∫') || text.includes('–•—É–∫–∏')) {
                                                    // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ "Hook" –∏–ª–∏ "Hooks"
                                                    const parts = text.split(/Hooks?\\s*:?\\s*|–•—É–∫–∏?\\s*:?\\s*/i);
                                                    if (parts.length > 1) {
                                                        let hookText = parts[1].trim();
                                                        // –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏
                                                        const stopWords = ['Target Audience', 'First seen', 'Impressions', 'Country'];
                                                        for (const stop of stopWords) {
                                                            if (hookText.includes(stop)) {
                                                                hookText = hookText.split(stop)[0];
                                                            }
                                                        }
                                                        hookText = hookText.replace(/Quality\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/Size\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/Resolution\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/--/g, '');
                                                        hookText = hookText.replace(/\\n{2,}/g, '\\n').trim();
                                                        if (hookText && hookText.length > 5 && hookText.length < 500) {
                                                            return hookText;
                                                        }
                                                    }
                                                }
                                            }
                                            return null;
                                        }
                                    """, script_element)
                                    
                                    if next_elements:
                                        log.debug(f"Hook –Ω–∞–π–¥–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–º —ç–ª–µ–º–µ–Ω—Ç–µ –ø–æ—Å–ª–µ Script")
                                        return next_elements
                            except:
                                pass
                            
                            # –°–ø–æ—Å–æ–± 3: –ò—â–µ–º Hook –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –ø–æ—Å–ª–µ Script
                            try:
                                # –ü–æ–ª—É—á–∞–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –∏—â–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω "Script...Hook"
                                page_text = await self.page.content()
                                # –ò—â–µ–º —á–µ—Ä–µ–∑ JavaScript –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ
                                hook_text = await self.page.evaluate("""
                                    () => {
                                        // –ò—â–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Script"
                                        const allElements = Array.from(document.querySelectorAll('*'));
                                        for (const el of allElements) {
                                            const text = el.innerText || '';
                                            if (text.includes('Script') || text.includes('–°—Ü–µ–Ω–∞—Ä–∏–π')) {
                                                // –ò—â–µ–º –≤ —ç—Ç–æ–º –∂–µ —ç–ª–µ–º–µ–Ω—Ç–µ –∏–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º "Hook" –∏–ª–∏ "Hooks"
                                                let searchEl = el;
                                                for (let depth = 0; depth < 3; depth++) {
                                                    const searchText = searchEl.innerText || '';
                                                    if (searchText.includes('Hook') || searchText.includes('Hooks') || 
                                                        searchText.includes('–•—É–∫') || searchText.includes('–•—É–∫–∏')) {
                                                        // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –º–µ–∂–¥—É Script –∏ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Å–µ–∫—Ü–∏—è–º–∏
                                                        const scriptIndex = searchText.indexOf('Script');
                                                        const hookIndex = searchText.indexOf('Hook', scriptIndex);
                                                        if (hookIndex > scriptIndex) {
                                                            let hookText = searchText.substring(hookIndex);
                                                            // –£–±–∏—Ä–∞–µ–º "Hook" –∏–ª–∏ "Hooks" –∏–∑ –Ω–∞—á–∞–ª–∞
                                                            hookText = hookText.replace(/^Hooks?\\s*:?\\s*/i, '');
                                                            hookText = hookText.replace(/^–•—É–∫–∏?\\s*:?\\s*/i, '');
                                                            // –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏
                                                            const stopWords = ['Target Audience', 'First seen', 'Impressions', 'Country'];
                                                            for (const stop of stopWords) {
                                                                if (hookText.includes(stop)) {
                                                                    hookText = hookText.split(stop)[0];
                                                                }
                                                            }
                                                            hookText = hookText.replace(/Quality\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/Size\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/Resolution\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/--/g, '');
                                                            hookText = hookText.replace(/\\n{2,}/g, '\\n').trim();
                                                            if (hookText && hookText.length > 5 && hookText.length < 500) {
                                                                return hookText;
                                                            }
                                                        }
                                                    }
                                                    searchEl = searchEl.parentElement;
                                                    if (!searchEl) break;
                                                }
                                            }
                                        }
                                        return null;
                                    }
                                """)
                                
                                if hook_text:
                                    log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ—Å–ª–µ Script")
                                    return hook_text
                            except:
                                pass
                    except:
                        continue
            except:
                pass
            
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (—Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±, –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ fallback)
            hook_keywords = ["Hooks", "Hook", "–•—É–∫–∏", "–•—É–∫"]
            
            for keyword in hook_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            parent_text = await locator.locator("..").inner_text()
                            if keyword in parent_text:
                                parts = parent_text.split(keyword, 1)
                                if len(parts) > 1:
                                    hook = parts[1].strip()
                                    # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –º–µ—Ç–∫–∏
                                    stop_words = ["Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", 
                                                "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞", "Impressions", "–ü–æ–∫–∞–∑—ã",
                                                "Limited Time Offer", "Annual Plan", "Promotion Period", "50% OFF",
                                                "Privacy", "Terms", "Copyright", "PIPIADS", "All Rights Reserved",
                                                "AI-agent", "cosmobeauty", "credits", "subscription", "invoice",
                                                "Monthly Credits", "Extra Credits", "data cost", "detail costs",
                                                "Team Setting", "Affiliate Dashboard", "Logout"]
                                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                           "cosmobeauty", "credits", "subscription", "invoice", 
                                                           "Monthly Credits", "Extra Credits", "@gmail.com"]
                                    is_footer_menu = any(keyword in hook for keyword in footer_menu_keywords)
                                    
                                    for stop_word in stop_words:
                                        if stop_word in hook:
                                            hook = hook.split(stop_word)[0].strip()
                                    
                                    # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                    metadata_patterns = [
                                        r'Quality\s*:?\s*[^\n]*',
                                        r'Size\s*:?\s*[^\n]*',
                                        r'Resolution\s*:?\s*[^\n]*',
                                        r'Width\s*:?\s*[^\n]*',
                                        r'Height\s*:?\s*[^\n]*',
                                        r'Duration\s*:?\s*[^\n]*',
                                        r'Format\s*:?\s*[^\n]*',
                                        r'Codec\s*:?\s*[^\n]*',
                                        r'Frame Rate\s*:?\s*[^\n]*',
                                        r'--',  # –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                    ]
                                    for pattern in metadata_patterns:
                                        hook = re.sub(pattern, '', hook, flags=re.IGNORECASE)
                                    hook = re.sub(r'\n{2,}', '\n', hook).strip()  # –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                    
                                    if hook and len(hook) > 5 and not is_footer_menu:
                                        log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Ä–æ–¥–∏—Ç–µ–ª—å)")
                                        return hook
                        except:
                            pass
                        
                        # –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            next_sibling = await locator.evaluate_handle("el => el.nextElementSibling")
                            if next_sibling:
                                hook = await next_sibling.as_element().inner_text()
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                       "cosmobeauty", "credits", "subscription", "invoice", 
                                                       "Monthly Credits", "Extra Credits", "@gmail.com"]
                                is_footer_menu = any(keyword in hook for keyword in footer_menu_keywords)
                                
                                # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                metadata_patterns = [
                                    r'Quality\s*:?\s*[^\n]*',
                                    r'Size\s*:?\s*[^\n]*',
                                    r'Resolution\s*:?\s*[^\n]*',
                                    r'Width\s*:?\s*[^\n]*',
                                    r'Height\s*:?\s*[^\n]*',
                                    r'Duration\s*:?\s*[^\n]*',
                                    r'Format\s*:?\s*[^\n]*',
                                    r'Codec\s*:?\s*[^\n]*',
                                    r'Frame Rate\s*:?\s*[^\n]*',
                                    r'--',  # –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                ]
                                for pattern in metadata_patterns:
                                    hook = re.sub(pattern, '', hook, flags=re.IGNORECASE)
                                hook = re.sub(r'\n{2,}', '\n', hook).strip()  # –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                
                                if hook and len(hook) > 5 and not is_footer_menu:
                                    log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç)")
                                    return hook.strip()
                        except:
                            pass
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                hook = await self.page.evaluate("""
                    () => {
                        const keywords = ['Hooks', 'Hook', '–•—É–∫–∏', '–•—É–∫'];
                        const stopWords = ['Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 
                                         'Transcript', '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞', 'Impressions', '–ü–æ–∫–∞–∑—ã',
                                         'Script', '–°—Ü–µ–Ω–∞—Ä–∏–π', 'Analysis',
                                         'Limited Time Offer', 'Annual Plan', 'Promotion Period', '50% OFF'];
                        
                        // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    let hookText = null;
                                    
                                    // –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ sibling —ç–ª–µ–º–µ–Ω—Ç–∞
                                    let nextSibling = el.nextElementSibling;
                                    if (nextSibling) {
                                        hookText = nextSibling.innerText || '';
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    if (!hookText || hookText.length < 5) {
                                        const parentText = el.parentElement ? el.parentElement.innerText || '' : '';
                                        if (parentText.includes(keyword)) {
                                            const parts = parentText.split(keyword);
                                            if (parts.length > 1) {
                                                hookText = parts[1].trim();
                                            }
                                        }
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 3: –ò—â–µ–º –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö
                                    if (!hookText || hookText.length < 5) {
                                        const children = el.querySelectorAll('p, div, span');
                                        for (const child of children) {
                                            const childText = child.innerText || '';
                                            if (childText.length > 5 && childText.length < 200) {
                                                hookText = childText;
                                                break;
                                            }
                                        }
                                    }
                                    
                                    if (hookText) {
                                        // –£–±–∏—Ä–∞–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞
                                        for (const stopWord of stopWords) {
                                            if (hookText.includes(stopWord)) {
                                                hookText = hookText.split(stopWord)[0];
                                            }
                                        }
                                        
                                        hookText = hookText.trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π hook (–∫–æ—Ä–æ—Ç–∫–∞—è —Ñ—Ä–∞–∑–∞, –Ω–µ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç, –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é)
                                        const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                                   'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                                   'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                                   'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                                   'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                        const isFooterMenu = footerMenuKeywords.some(keyword => hookText.includes(keyword));
                                        
                                        // –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                        const metadataPatterns = [
                                            /Quality\s*:?\s*[^\n]*/gi,
                                            /Size\s*:?\s*[^\n]*/gi,
                                            /Resolution\s*:?\s*[^\n]*/gi,
                                            /Width\s*:?\s*[^\n]*/gi,
                                            /Height\s*:?\s*[^\n]*/gi,
                                            /Duration\s*:?\s*[^\n]*/gi,
                                            /Format\s*:?\s*[^\n]*/gi,
                                            /Codec\s*:?\s*[^\n]*/gi,
                                            /Frame Rate\s*:?\s*[^\n]*/gi,
                                            /--/g,  // –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                        ];
                                        let cleanedHook = hookText;
                                        for (const pattern of metadataPatterns) {
                                            cleanedHook = cleanedHook.replace(pattern, '');
                                        }
                                        cleanedHook = cleanedHook.replace(/\n{2,}/g, '\n').trim();  // –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                        
                                        if (cleanedHook && cleanedHook.length > 5 && cleanedHook.length < 300 &&
                                            !cleanedHook.includes('Limited Time Offer') &&
                                            !cleanedHook.includes('Annual Plan') &&
                                            !cleanedHook.includes('Promotion Period') &&
                                            !cleanedHook.includes('50% OFF') &&
                                            !cleanedHook.toLowerCase().includes('q4') &&
                                            !cleanedHook.toLowerCase().includes('monthly plan') &&
                                            !isFooterMenu) {
                                            return cleanedHook;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if hook and len(hook) > 5:
                    log.debug("Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript")
                    return hook.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ hook —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ hook: {e}")
            return None
    
    async def _extract_audience(self) -> Optional[Dict[str, str]]:
        """
        –ò–∑–≤–ª–µ—á—å –≤–æ–∑—Ä–∞—Å—Ç –∏–∑ –ø–æ–ª—è Audience
        
        –°—Ç—Ä—É–∫—Ç—É—Ä–∞ HTML:
        <div class="addel-info-item">
            <div class="name"> Audience </div>
            <div class="value">
                <div class="audience-info">
                    <div class="audience-info-info">45-55 ... Android...</div>
                </div>
            </div>
        </div>
        """
        try:
            audience_data = {"age": "N/A", "platform": "N/A"}
            
            # –ú–ï–¢–û–î 1: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                # –ò—â–µ–º –±–ª–æ–∫ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "Audience"
                audience_items = await self.page.query_selector_all('div.addel-info-item')
                
                for item in audience_items:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å Audience
                    name_elem = await item.query_selector('div.name')
                    if name_elem:
                        name_text = await name_elem.inner_text()
                        if 'Audience' in name_text or '–ê—É–¥–∏—Ç–æ—Ä–∏—è' in name_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ audience-info-info
                            audience_info = await item.query_selector('div.audience-info-info')
                            if audience_info:
                                text = await audience_info.inner_text()
                                # –ò–∑–≤–ª–µ–∫–∞–µ–º –≤–æ–∑—Ä–∞—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ "45-55" (–º–æ–∂–µ—Ç –±—ã—Ç—å 2 —Ü–∏—Ñ—Ä—ã)
                                age_match = re.search(r'(\d{1,2}-\d{1,2})', text)
                                if age_match:
                                    audience_data["age"] = age_match.group(1)
                                    log.debug(f"      ‚Üí Audience age –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä: {audience_data['age']}")
                                    return audience_data
            except Exception as e:
                log.debug(f"      ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–º –ø–æ–∏—Å–∫–µ audience: {e}")
            
            # –ú–ï–¢–û–î 2: Fallback —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (–µ—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª)
            audience_keywords = ["Audience", "–ê—É–¥–∏—Ç–æ—Ä–∏—è", "Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è"]
            
            for keyword in audience_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç –∞—É–¥–∏—Ç–æ—Ä–∏–∏ —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º –≤–æ–∑—Ä–∞—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ "25-35" –∏–ª–∏ "45-55"
                        age_patterns = [
                            r'–í–æ–∑—Ä–∞—Å—Ç[:\s]+(\d{1,2}-\d{1,2})',
                            r'Age[:\s]+(\d{1,2}-\d{1,2})',
                            r'(\d{1,2}-\d{1,2})',  # –ü—Ä–æ—Å—Ç–æ –≤–æ–∑—Ä–∞—Å—Ç
                        ]
                        
                        for pattern in age_patterns:
                            age_match = re.search(pattern, text, re.IGNORECASE)
                            if age_match:
                                audience_data["age"] = age_match.group(1)
                                log.debug(f"      ‚Üí Audience age –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä: {audience_data['age']}")
                                break
                        
                        if audience_data["age"] != "N/A":
                            return audience_data
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π)
            try:
                result = await self.page.evaluate("""
                    () => {
                        const keywords = ['Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 'Audience', '–ê—É–¥–∏—Ç–æ—Ä–∏—è'];
                        const agePattern = /(\\d{1,2}-\\d{1,2})/;
                        const platformKeywords = ['Android', 'iOS', 'iPhone', 'iPad'];
                        const countryKeywords = ['USA', 'US', 'United States', '–†–æ—Å—Å–∏—è', 'Russia', 'Philippines', 
                                                '–§–∏–ª–∏–ø–ø–∏–Ω—ã', 'China', '–ö–∏—Ç–∞–π', 'India', '–ò–Ω–¥–∏—è'];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    const result = {age: 'N/A', platform: 'N/A', country: 'N/A'};
                                    
                                    // –ò—â–µ–º –≤–æ–∑—Ä–∞—Å—Ç
                                    const ageMatch = text.match(agePattern);
                                    if (ageMatch) {
                                        result.age = ageMatch[1];
                                    }
                                    
                                    // –ò—â–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
                                    for (const platform of platformKeywords) {
                                        if (text.includes(platform)) {
                                            result.platform = (platform === 'iOS' || platform === 'iPhone' || platform === 'iPad') ? 'iOS' : 'Android';
                                            break;
                                        }
                                    }
                                    
                                    // –ò—â–µ–º —Å—Ç—Ä–∞–Ω—É
                                    for (const country of countryKeywords) {
                                        if (text.includes(country)) {
                                            result.country = country;
                                            break;
                                        }
                                    }
                                    
                                    if (result.age !== 'N/A' || result.platform !== 'N/A' || result.country !== 'N/A') {
                                        return result;
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if result:
                    audience_data.update(result)
                    return audience_data
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ audience —á–µ—Ä–µ–∑ JS: {e}")
            
            return audience_data
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–∏: {e}")
            return None
    
    async def _extract_country(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å —Å—Ç—Ä–∞–Ω—É –∏–∑ –ø–æ–ª—è 'Country/Region' –∏–ª–∏ '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω' (–û–¢–î–ï–õ–¨–ù–û –æ—Ç Audience!)"""
        try:
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            try:
                await self.page.wait_for_selector('div.addel-info-item', timeout=5000, state="visible")
            except:
                log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç—ã div.addel-info-item –Ω–µ –ø–æ—è–≤–∏–ª–∏—Å—å –∑–∞ 5 —Å–µ–∫—É–Ω–¥")
            
            country_keywords = ["Country/Region", "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω", "Country", "–°—Ç—Ä–∞–Ω–∞", "Region", "–†–µ–≥–∏–æ–Ω"]
            
            # –ú–ï–¢–û–î 0: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                country_items = await self.page.query_selector_all('div.addel-info-item')
                
                for item in country_items:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å Country/Region
                    name_elem = await item.query_selector('div.name')
                    if name_elem:
                        name_text = await name_elem.inner_text()
                        if 'Country/Region' in name_text or '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω' in name_text or 'Country' in name_text or '–°—Ç—Ä–∞–Ω–∞' in name_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º —Å—Ç—Ä–∞–Ω—É
                            value_elem = await item.query_selector('div.ellipsis, div.value')
                            if value_elem:
                                country_text = await value_elem.inner_text()
                                # –£–±–∏—Ä–∞–µ–º (1) –∏ —Ç.–¥.
                                country = re.sub(r'\([0-9]+\)', '', country_text).strip()
                                if country and len(country) > 0:
                                    log.info(f"      ‚úÖ Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä: {country}")
                                    return country
            except Exception as e:
                log.debug(f"      ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–º –ø–æ–∏—Å–∫–µ country: {e}")
            
            for keyword in country_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω—ã —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º —Å—Ç—Ä–∞–Ω—É (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫)
                        country_patterns = [
                            r'United States(?:\([0-9]+\))?',  # United States(1)
                            r'USA(?:\([0-9]+\))?',
                            r'US(?:\([0-9]+\))?',
                            r'Philippines(?:\([0-9]+\))?',
                            r'–§–∏–ª–∏–ø–ø–∏–Ω—ã(?:\([0-9]+\))?',
                            r'Russia(?:\([0-9]+\))?',
                            r'–†–æ—Å—Å–∏—è(?:\([0-9]+\))?',
                            r'China(?:\([0-9]+\))?',
                            r'–ö–∏—Ç–∞–π(?:\([0-9]+\))?',
                            r'India(?:\([0-9]+\))?',
                            r'–ò–Ω–¥–∏—è(?:\([0-9]+\))?',
                            r'Brazil(?:\([0-9]+\))?',
                            r'–ë—Ä–∞–∑–∏–ª–∏—è(?:\([0-9]+\))?',
                            r'Germany(?:\([0-9]+\))?',
                            r'–ì–µ—Ä–º–∞–Ω–∏—è(?:\([0-9]+\))?',
                            r'France(?:\([0-9]+\))?',
                            r'–§—Ä–∞–Ω—Ü–∏—è(?:\([0-9]+\))?',
                            r'UK(?:\([0-9]+\))?',
                            r'United Kingdom(?:\([0-9]+\))?',
                        ]
                        
                        for pattern in country_patterns:
                            match = re.search(pattern, text, re.IGNORECASE)
                            if match:
                                country = match.group(0)
                                # –£–±–∏—Ä–∞–µ–º (1) –∏ —Ç.–¥.
                                country = re.sub(r'\([0-9]+\)', '', country).strip()
                                log.debug(f"Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}': {country}")
                                return country
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript
            try:
                country = await self.page.evaluate("""
                    () => {
                        const keywords = ['Country/Region', '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω', 'Country', '–°—Ç—Ä–∞–Ω–∞'];
                        const countryPatterns = [
                            /United States(?:\\([0-9]+\\))?/i,
                            /USA(?:\\([0-9]+\\))?/i,
                            /Philippines(?:\\([0-9]+\\))?/i,
                            /Russia(?:\\([0-9]+\\))?/i,
                            /China(?:\\([0-9]+\\))?/i,
                            /India(?:\\([0-9]+\\))?/i
                        ];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    for (const pattern of countryPatterns) {
                                        const match = text.match(pattern);
                                        if (match) {
                                            return match[0].replace(/\\([0-9]+\\)/g, '').trim();
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if country:
                    log.debug(f"Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript: {country}")
                    return country.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ country —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ country: {e}")
            return None
    
    async def _extract_first_seen(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å First seen –≤ —Ñ–æ—Ä–º–∞—Ç–µ 'Oct 27 2025' - —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ 'Oct 28 2025 ~ Nov 10 2025'"""
        try:
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã
            first_seen_keywords = ["First seen - Last seen", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", "First Seen"]
            
            for keyword in first_seen_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç –¥–∞—Ç—ã —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ "Oct 27 2025" –∏–ª–∏ "Oct 27, 2025"
                        # –ò—â–µ–º –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ "Oct 28 2025 ~ Nov 10 2025"
                        date_patterns = [
                            r'([A-Z][a-z]{2}\s+\d{1,2}\s+\d{4})',  # Oct 27 2025
                            r'([A-Z][a-z]{2}\s+\d{1,2},\s+\d{4})',  # Oct 27, 2025
                            r'(\d{1,2}\s+[A-Z][a-z]{2}\s+\d{4})',  # 27 Oct 2025
                        ]
                        
                        for pattern in date_patterns:
                            # –ò—â–µ–º –ø–µ—Ä–≤—É—é –¥–∞—Ç—É (–¥–æ ~ –∏–ª–∏ –∫–æ–Ω—Ü–∞ —Å—Ç—Ä–æ–∫–∏)
                            date_match = re.search(pattern, text)
                            if date_match:
                                date_str = date_match.group(1)
                                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ñ–æ—Ä–º–∞—Ç (—É–±–∏—Ä–∞–µ–º –∑–∞–ø—è—Ç—É—é –µ—Å–ª–∏ –µ—Å—Ç—å)
                                date_str = date_str.replace(',', '').strip()
                                log.debug(f"First seen –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}': {date_str}")
                                return date_str
                        
                        # –¢–∞–∫–∂–µ –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –¥–∞—Ç—É –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
                        if keyword in text:
                            parts = text.split(keyword, 1)
                            if len(parts) > 1:
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–æ ~ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω)
                                after_keyword = parts[1].split('~')[0].strip()
                                for pattern in date_patterns:
                                    date_match = re.search(pattern, after_keyword)
                                    if date_match:
                                        date_str = date_match.group(1).replace(',', '').strip()
                                        log.debug(f"First seen –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ '{keyword}': {date_str}")
                                        return date_str
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                first_seen = await self.page.evaluate("""
                    () => {
                        const keywords = ['First seen - Last seen', 'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 'First Seen'];
                        const datePatterns = [
                            /([A-Z][a-z]{2}\\s+\\d{1,2}\\s+\\d{4})/,  // Oct 27 2025
                            /([A-Z][a-z]{2}\\s+\\d{1,2},\\s+\\d{4})/,  // Oct 27, 2025
                            /(\\d{1,2}\\s+[A-Z][a-z]{2}\\s+\\d{4})/   // 27 Oct 2025
                        ];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    // –ò—â–µ–º –¥–∞—Ç—É –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    const index = text.indexOf(keyword);
                                    let afterKeyword = text.substring(index + keyword.length);
                                    
                                    // –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–æ ~ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω)
                                    if (afterKeyword.includes('~')) {
                                        afterKeyword = afterKeyword.split('~')[0];
                                    }
                                    
                                    for (const pattern of datePatterns) {
                                        const match = afterKeyword.match(pattern);
                                        if (match) {
                                            const dateStr = match[1].replace(',', '').trim();
                                            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤—É—é –Ω–∞–π–¥–µ–Ω–Ω—É—é –¥–∞—Ç—É (–±–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫ - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç –≤ _filter_videos)
                                            return dateStr;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if first_seen:
                    log.debug(f"First seen –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript: {first_seen}")
                    return first_seen.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ first_seen —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ first_seen: {e}")
            return None


```

–ò—Å–ø—Ä–∞–≤–ª—è—é `_extract_hook` –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∏ –ø—Ä–æ–≤–µ—Ä—è—é –ø—Ä–æ–±–ª–µ–º—É —Å –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏ —Ç–æ–≤–∞—Ä–æ–≤:


```python
"""
Parser Engine - –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö —Å Pipiads
"""

import asyncio
import re
import time
from typing import List, Dict, Optional, Any
from datetime import datetime

from playwright.async_api import Page, TimeoutError as PlaywrightTimeoutError

from . import config
from . import logger
from . import validator

log = logger.get_logger("ParserEngine")


class ProductData:
    """–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞"""
    def __init__(self):
        self.product_name: str = ""
        self.category: str = ""
        self.pipiads_link: str = ""
        self.videos: List[Dict[str, Any]] = []


class ParserEngine:
    """–ü–∞—Ä—Å–µ—Ä –¥–∞–Ω–Ω—ã—Ö —Å Pipiads"""
    
    def __init__(self, page: Page):
        self.page = page
        self.browser_manager = None  # –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ human_delay
    
    def set_browser_manager(self, browser_manager):
        """–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ browser_manager –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è human_delay"""
        self.browser_manager = browser_manager
    
    async def human_delay(self, min_seconds: float = 1, max_seconds: float = 3):
        """–ò–º–∏—Ç–∞—Ü–∏—è —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏"""
        if self.browser_manager:
            await self.browser_manager.human_delay(min_seconds, max_seconds)
        else:
            delay = asyncio.sleep(1)  # Fallback
            await delay
    
    async def scroll_to_element(self, selector: str, timeout: int = 10000):
        """
        –°–∫—Ä–æ–ª–ª–∏—Ç—å –¥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
        
        Args:
            selector: –°–µ–ª–µ–∫—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞
            timeout: –¢–∞–π–º–∞—É—Ç –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
        """
        try:
            element = await self.page.wait_for_selector(selector, timeout=timeout, state="visible")
            if element:
                await element.scroll_into_view_if_needed()
                await self.human_delay(0.5, 1)
                return True
        except:
            pass
        return False
    
    async def get_products_from_search_page(self, count: int = 3) -> List[Dict[str, str]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞
        
        Args:
            count: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ (–¥–ª—è MVP-0: 1, –ø–æ—Ç–æ–º —Ä–∞—Å—à–∏—Ä–∏–º –¥–æ 3)
        
        Returns:
            –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–æ–≤: [{"name": "...", "category": "...", "url": "..."}]
        """
        log.info(f"–ü–æ–ª—É—á–µ–Ω–∏–µ {count} —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞...")
        
        try:
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (domcontentloaded –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º networkidle)
            await self.page.wait_for_load_state("domcontentloaded")
            await self.human_delay(2, 3)
            
            # –°–∫—Ä–æ–ª–ª–∏–º –≤–Ω–∏–∑, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
            log.info("–°–∫—Ä–æ–ª–ª–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤...")
            for i in range(3):  # –°–∫—Ä–æ–ª–ª–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
                await self.page.evaluate("window.scrollBy(0, 500)")
                await self.human_delay(1, 2)
            
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤
            await self.human_delay(2, 3)
            
            # –ò—â–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ - –ø—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
            product_selectors = [
                'a[href*="/tiktok-shop-product/"]',
                '[class*="product"]',
                '[class*="card"]',
                'div[class*="item"]',
            ]
            
            products = []
            product_ids = set()  # –î–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ product_id
            
            def extract_product_id(url: str) -> str:
                """–ò–∑–≤–ª–µ—á—å product_id –∏–∑ URL"""
                # https://www.pipiads.com/tiktok-shop-product/1729732622305364547/
                # ‚Üí 1729732622305364547
                url_normalized = url.rstrip('/')
                parts = url_normalized.split('/')
                return parts[-1] if parts else ""
            
            for selector in product_selectors:
                try:
                    elements = await self.page.query_selector_all(selector)
                    log.info(f"üîç –ù–∞–π–¥–µ–Ω–æ {len(elements)} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º '{selector}'")
                    
                    for element in elements:
                        if len(products) >= count:
                            break
                        
                        try:
                            # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É
                            href = await element.get_attribute("href")
                            if not href:
                                # –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ —Å—Å—ã–ª–∫–∞, –∏—â–µ–º —Å—Å—ã–ª–∫—É –≤–Ω—É—Ç—Ä–∏
                                link_element = await element.query_selector('a[href*="/tiktok-shop-product/"]')
                                if link_element:
                                    href = await link_element.get_attribute("href")
                            
                            if href and "/tiktok-shop-product/" in href:
                                # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π URL
                                if href.startswith("/"):
                                    url = f"https://www.pipiads.com{href}"
                                elif href.startswith("http"):
                                    url = href
                                else:
                                    url = f"https://www.pipiads.com/{href}"
                                
                                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º URL (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ)
                                url = url.rstrip('/')
                                
                                # –ò–∑–≤–ª–µ–∫–∞–µ–º product_id –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
                                product_id = extract_product_id(url)
                                
                                if not product_id:
                                    log.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å product_id –∏–∑ URL: {url}")
                                    continue
                                
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä (–ø–æ product_id)
                                if product_id in product_ids:
                                    log.info(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id={product_id}): {url}")
                                    continue
                                
                                product_ids.add(product_id)
                                log.info(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #{len(products) + 1}: product_id={product_id}, url={url}")
                                
                                # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
                                name = ""
                                name_selectors = [
                                    'h1', 'h2', 'h3',
                                    '[class*="title"]',
                                    '[class*="name"]',
                                    'a',
                                ]
                                
                                for name_sel in name_selectors:
                                    try:
                                        name_elem = await element.query_selector(name_sel)
                                        if name_elem:
                                            name = await name_elem.inner_text()
                                            if name and len(name) > 5:  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏—è
                                                break
                                    except:
                                        continue
                                
                                # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                                category = ""
                                category_selectors = [
                                    '[class*="category"]',
                                    '[class*="tag"]',
                                    'span',
                                ]
                                
                                for cat_sel in category_selectors:
                                    try:
                                        cat_elem = await element.query_selector(cat_sel)
                                        if cat_elem:
                                            text = await cat_elem.inner_text()
                                            if text and len(text) < 50:  # –ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±—ã—á–Ω–æ –∫–æ—Ä–æ—Ç–∫–∞—è
                                                category = text
                                                break
                                    except:
                                        continue
                                
                                if url and product_id:
                                    products.append({
                                        "name": name.strip() if name else "N/A",
                                        "category": category.strip() if category else "N/A",
                                        "url": url,
                                        "product_id": product_id  # –î–æ–±–∞–≤–ª—è–µ–º product_id –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
                                    })
                                    log.info(f"   üì¶ –¢–æ–≤–∞—Ä {len(products)}: {name[:50] if name else 'N/A'}... (ID: {product_id})")
                                
                        except Exception as e:
                            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —ç–ª–µ–º–µ–Ω—Ç–∞: {e}")
                            continue
                    
                    if len(products) >= count:
                        break
                        
                except Exception as e:
                    log.debug(f"–û—à–∏–±–∫–∞ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º {selector}: {e}")
                    continue
            
            if len(products) < count:
                log.warning(f"–ù–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ {count} –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã—Ö")
            
            log.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤")
            return products[:count]
            
        except Exception as e:
            log.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
            import traceback
            log.error(traceback.format_exc())
            return []
    
    async def get_product_details(self, product_url: str, sheets_writer=None) -> ProductData:
        """
        –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞ –∏ –≤–∏–¥–µ–æ
        
        Args:
            product_url: URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞
        
        Returns:
            ProductData —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞ –∏ –≤–∏–¥–µ–æ
        """
        log.info("=" * 80)
        log.info(f"üîÑ –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–ê")
        log.info(f"URL: {product_url}")
        log.info("=" * 80)
        
        product_data = ProductData()
        product_data.pipiads_link = product_url
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è page
        if not self.page:
            log.error("‚ùå –û–®–ò–ë–ö–ê: page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
            return product_data
        
        try:
            # –®–ê–ì 1: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞
            log.info("\nüìå –®–ê–ì 1: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞...")
            try:
                log.info(f"  ‚Üí –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {product_url}")
                if not self.page:
                    raise Exception("Page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
                await self.page.goto(product_url, wait_until="domcontentloaded", timeout=30000)
                log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            except Exception as e:
                log.error(f"  ‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {e}")
                log.error(f"  ‚Üí –¢–∏–ø –æ—à–∏–±–∫–∏: {type(e).__name__}")
                import traceback
                log.error(f"  ‚Üí –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:\n{traceback.format_exc()}")
                # –ü—Ä–æ–±—É–µ–º –ø–æ–¥–æ–∂–¥–∞—Ç—å –µ—â–µ –Ω–µ–º–Ω–æ–≥–æ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                try:
                    await self.human_delay(2, 3)
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Å–µ –µ—â–µ –¥–æ—Å—Ç—É–ø–Ω–∞
                    if self.page:
                        current_url = self.page.url
                        log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
                except Exception as e2:
                    log.error(f"  ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e2}")
                    return product_data
            
            try:
                await self.human_delay(0.5, 1)
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–¥–µ—Ä–∂–∫–µ: {e}")
            
            # –®–ê–ì 1.5: –ü–µ—Ä–µ–≤–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫
            log.info("\nüìå –®–ê–ì 1.5: –ü–µ—Ä–µ–≤–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫...")
            try:
                current_url = self.page.url
                log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
                
                # –ï—Å–ª–∏ URL —Å–æ–¥–µ—Ä–∂–∏—Ç /ru/, –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ /en/
                if "/ru/" in current_url:
                    english_url = current_url.replace("/ru/", "/en/")
                    log.info(f"  ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫—É—é –≤–µ—Ä—Å–∏—é: {english_url}")
                    await self.page.goto(english_url, wait_until="domcontentloaded", timeout=30000)
                    await self.human_delay(1, 2)
                    log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π")
                else:
                    # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞
                    log.info("  ‚Üí –ü–æ–∏—Å–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —è–∑—ã–∫–∞...")
                    lang_selectors = [
                        'a[href*="/en/"]',
                        'button:has-text("English")',
                        '[class*="language"]',
                        '[class*="lang"]',
                        'select[name*="lang"]',
                    ]
                    
                    lang_found = False
                    for selector in lang_selectors:
                        try:
                            lang_element = await self.page.query_selector(selector)
                            if lang_element:
                                is_visible = await lang_element.is_visible()
                                if is_visible:
                                    await lang_element.click()
                                    await self.human_delay(1, 2)
                                    log.info(f"  ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ –Ω–∞–π–¥–µ–Ω –∏ –Ω–∞–∂–∞—Ç: {selector}")
                                    lang_found = True
                                    break
                        except:
                            continue
                    
                    if not lang_found:
                        log.warning("  ‚ö†Ô∏è –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –Ω–∞ —Ç–µ–∫—É—â–µ–º —è–∑—ã–∫–µ")
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            # –®–ê–ì 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Product Name
            log.info("\nüìå –®–ê–ì 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Product Name...")
            try:
                # –°–∫—Ä–æ–ª–ª–∏–º –≤–≤–µ—Ä—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
                log.info("  ‚Üí –°–∫—Ä–æ–ª–ª–∏–º –≤–≤–µ—Ä—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞...")
                if not self.page:
                    raise Exception("Page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
                await self.page.evaluate("window.scrollTo(0, 0)")
                await self.human_delay(0.3, 0.5)
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ: {e}")
                # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É
            
            # –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ - –ø—Ä–æ–±—É–µ–º –±–æ–ª—å—à–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –∏ –º–µ—Ç–æ–¥–æ–≤
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã...")
            try:
                # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
                name_selectors = [
                    'h1:first-of-type',
                    'h1[class*="product"]',
                    'h1[class*="title"]',
                    '[class*="product-title"]',
                    '[class*="product-name"]',
                    '[class*="product_title"]',
                    '[class*="product_name"]',
                    'h1',
                    'h2:first-of-type',
                    '[data-testid*="title"]',
                    '[data-testid*="name"]',
                    '[data-testid*="product-title"]',
                ]
                
                for selector in name_selectors:
                    try:
                        elements = await self.page.query_selector_all(selector)
                        for element in elements:
                            name = await element.inner_text()
                            if name and len(name) > 3:
                                # –§–∏–ª—å—Ç—Ä—É–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã
                                name_lower = name.lower()
                                skip_words = ['–æ—Å—Ç–∞—Ç–æ–∫', 'remain', 'stock', '–º–µ—Å—è—Ü', 'month', '–∫–æ–º–∏—Å—Å–∏—è', 'commission', 
                                            'tiktok shop product detail', 'category', '–∫–∞—Ç–µ–≥–æ—Ä–∏—è']
                                if any(skip in name_lower for skip in skip_words):
                                    continue
                                # –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å "TikTok Shop Product Detail:" –µ—Å–ª–∏ –µ—Å—Ç—å
                                if "TikTok Shop Product Detail:" in name:
                                    name = name.split("TikTok Shop Product Detail:")[-1].strip()
                                # –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
                                if name.lower().startswith('tiktok shop product'):
                                    name = re.sub(r'^tiktok shop product\s*:?\s*', '', name, flags=re.IGNORECASE).strip()
                                if name.lower().endswith('tiktok shop product'):
                                    name = re.sub(r'\s*tiktok shop product\s*$', '', name, flags=re.IGNORECASE).strip()
                                # –£–±–∏—Ä–∞–µ–º, –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ "TikTok Shop Product"
                                if name.lower() == 'tiktok shop product' or name.lower() == 'tiktok shop product detail':
                                    continue
                                if ":" in name and len(name.split(":")[0]) < 20:
                                    name = name.split(":", 1)[-1].strip()
                                product_data.product_name = name.strip()
                                if len(product_data.product_name) > 5:
                                    log.info(f"  ‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞–π–¥–µ–Ω–æ: {product_data.product_name[:50]}...")
                                    break
                        if product_data.product_name and len(product_data.product_name) > 5:
                            break
                    except:
                        continue
                
                # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
                if not product_data.product_name or len(product_data.product_name) <= 5:
                    try:
                        product_name = await self.page.evaluate("""
                            () => {
                                // –ò—â–µ–º h1
                                const h1 = document.querySelector('h1');
                                if (h1) {
                                    const text = h1.innerText.trim();
                                    if (text && text.length > 5 && !text.toLowerCase().includes('tiktok shop product detail')) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º –≤ —ç–ª–µ–º–µ–Ω—Ç–∞—Ö —Å –∫–ª–∞—Å—Å–æ–º product
                                const productElements = document.querySelectorAll('[class*="product"][class*="title"], [class*="product"][class*="name"]');
                                for (const el of productElements) {
                                    const text = el.innerText.trim();
                                    if (text && text.length > 5) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º —Å–∞–º—ã–π –±–æ–ª—å—à–æ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–æ–±—ã—á–Ω–æ —ç—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞)
                                // –ù–û –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã —Ç–∏–ø–∞ "Ad Analysis"
                                const headings = document.querySelectorAll('h1, h2, h3');
                                let maxLength = 0;
                                let bestHeading = null;
                                for (const h of headings) {
                                    const text = h.innerText.trim();
                                    const skipWords = ['tiktok', 'shop', 'product', 'detail', 'category', 'commission', 
                                                      '–æ—Å—Ç–∞—Ç–æ–∫', 'remain', 'stock', 'ad analysis', 'analysis', 
                                                      'limited time', 'promotion', 'annual plan', 'tiktok shop product'];
                                    const textLower = text.toLowerCase();
                                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã (–º–µ–Ω—å—à–µ 20 —Å–∏–º–≤–æ–ª–æ–≤) - —ç—Ç–æ –æ–±—ã—á–Ω–æ –Ω–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
                                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º "TikTok Shop Product" –∏ –ø–æ—Ö–æ–∂–∏–µ —Ç–µ–∫—Å—Ç—ã
                                    if (!skipWords.some(word => textLower.includes(word)) && 
                                        text.length > maxLength && text.length > 20 &&
                                        !textLower.includes('tiktok shop product')) {
                                        maxLength = text.length;
                                        bestHeading = text;
                                    }
                                }
                                if (bestHeading) {
                                    return bestHeading;
                                }
                                
                                // –ò—â–µ–º –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–∞—Ö - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ–±—ã—á–Ω–æ –¥–ª–∏–Ω–Ω–æ–µ
                                // –ù–∞–ø—Ä–∏–º–µ—Ä: "[BUY 1 TAKE 11] SHEEureka Scrub Facial Cleanser..."
                                // –ù–û –∏—Å–∫–ª—é—á–∞–µ–º —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                           'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                           'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                           'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                           'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                const textBlocks = document.querySelectorAll('p, div, span');
                                for (const block of textBlocks) {
                                    const text = block.innerText.trim();
                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    const isFooterMenu = footerMenuKeywords.some(keyword => text.includes(keyword));
                                    if (isFooterMenu) continue;
                                    
                                    // –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ–±—ã—á–Ω–æ –¥–ª–∏–Ω–Ω–æ–µ (–±–æ–ª—å—à–µ 30 —Å–∏–º–≤–æ–ª–æ–≤) –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–æ–≤–∞ —Ç–∏–ø–∞ "Set", "Kit", "Mask" –∏ —Ç.–¥.
                                    // –ò–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å "[" (–Ω–∞–ø—Ä–∏–º–µ—Ä "[BUY 1 TAKE 11]")
                                    if (text.length > 30 && text.length < 500 && 
                                        !text.toLowerCase().includes('ad analysis') &&
                                        !text.toLowerCase().includes('limited time') &&
                                        !text.toLowerCase().includes('promotion') &&
                                        !text.toLowerCase().includes('annual plan') &&
                                        (text.startsWith('[') || text.includes('Set') || text.includes('Kit') || 
                                         text.includes('Mask') || text.includes('Cleanser') || text.includes('Gift') ||
                                         text.includes('Scrub') || text.includes('Facial') || text.includes('Repairing'))) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º –≤ –º–µ—Ç–∞-—Ç–µ–≥–∞—Ö
                                const ogTitle = document.querySelector('meta[property="og:title"]');
                                if (ogTitle && ogTitle.content) {
                                    let title = ogTitle.content;
                                    if (title.includes('TikTok Shop Product Detail:')) {
                                        title = title.split('TikTok Shop Product Detail:')[1].trim();
                                    }
                                    // –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞
                                    if (title.toLowerCase().startsWith('tiktok shop product')) {
                                        title = title.replace(/^tiktok shop product\s*:?\s*/i, '').trim();
                                    }
                                    if (title && title.length > 5 && !title.toLowerCase().includes('tiktok shop product')) {
                                        return title;
                                    }
                                }
                                
                                return null;
                            }
                        """)
                        if product_name and len(product_name) > 5:
                            product_name = product_name.strip()
                            # –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
                            if product_name.lower().startswith('tiktok shop product'):
                                product_name = re.sub(r'^tiktok shop product\s*:?\s*', '', product_name, flags=re.IGNORECASE).strip()
                            if product_name.lower().endswith('tiktok shop product'):
                                product_name = re.sub(r'\s*tiktok shop product\s*$', '', product_name, flags=re.IGNORECASE).strip()
                            # –£–±–∏—Ä–∞–µ–º, –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ "TikTok Shop Product"
                            if product_name.lower() == 'tiktok shop product' or product_name.lower() == 'tiktok shop product detail':
                                product_name = None
                            if product_name and len(product_name) > 5:
                                product_data.product_name = product_name
                                log.info(f"  ‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞–π–¥–µ–Ω–æ (—á–µ—Ä–µ–∑ JS): {product_data.product_name[:50]}...")
                    except Exception as e:
                        log.debug(f"  ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —á–µ—Ä–µ–∑ JS: {e}")
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞: {e}")
            
            if not product_data.product_name or len(product_data.product_name) <= 5:
                log.warning("  ‚ö†Ô∏è –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                product_data.product_name = "N/A"
            
            # –®–ê–ì 3: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Category
            log.info("\nüìå –®–ê–ì 3: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Category...")
            try:
                log.info("  ‚Üí –ü–æ–∏—Å–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–∞...")
                
                # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
                category_selectors = [
                    '[class*="category"]',
                    '[class*="tag"]',
                    'span:has-text("Category")',
                    'span:has-text("–ö–∞—Ç–µ–≥–æ—Ä–∏—è")',
                    'text=/Category/i',
                    'text=/–ö–∞—Ç–µ–≥–æ—Ä–∏—è/i',
                    'div:has-text("Category")',
                    'div:has-text("–ö–∞—Ç–µ–≥–æ—Ä–∏—è")',
                ]
                
                for selector in category_selectors:
                    try:
                        elements = await self.page.query_selector_all(selector)
                        for element in elements:
                            category = await element.inner_text()
                            if category:
                                # –û—á–∏—â–∞–µ–º –æ—Ç –ª–∏—à–Ω–µ–≥–æ —Ç–µ–∫—Å—Ç–∞
                                category = re.sub(r'Category\s*:', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'–ö–∞—Ç–µ–≥–æ—Ä–∏—è\s*:', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'Commission\s*Rate\s*:.*', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'–ö–æ–º–∏—Å—Å–∏—è\s*:.*', '', category, flags=re.IGNORECASE)
                                # –£–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä "15.00%")
                                category = re.sub(r'\s*\d+\.?\d*\s*%', '', category)
                                # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ —Å–∏–º–≤–æ–ª—ã > –∏ –ø—Ä–æ–±–µ–ª—ã
                                category = re.sub(r'\s*>\s*', ' > ', category)
                                category = category.strip()
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é —á–∞—Å—Ç—å –¥–æ "Commission" –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É
                                if "Commission" in category or "–ö–æ–º–∏—Å—Å–∏—è" in category:
                                    category = category.split("Commission")[0].split("–ö–æ–º–∏—Å—Å–∏—è")[0].strip()
                                if len(category) > 100:
                                    category = category[:100]
                                if category and len(category) > 3:
                                    product_data.category = category
                                    log.info(f"  ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–∞: {product_data.category}")
                                    break
                        if product_data.category:
                            break
                    except:
                        continue
                
                # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π)
                if not product_data.category:
                    try:
                        category = await self.page.evaluate("""
                            () => {
                                // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Category" –∏–ª–∏ "–ö–∞—Ç–µ–≥–æ—Ä–∏—è"
                                const allElements = document.querySelectorAll('*');
                                for (const el of allElements) {
                                    const text = el.innerText || '';
                                    if (text.includes('Category') || text.includes('–ö–∞—Ç–µ–≥–æ—Ä–∏—è')) {
                                        // –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ—Å–ª–µ "Category:" –∏–ª–∏ "–ö–∞—Ç–µ–≥–æ—Ä–∏—è:"
                                        let categoryText = text;
                                        if (categoryText.includes('Category:')) {
                                            categoryText = categoryText.split('Category:')[1];
                                        } else if (categoryText.includes('–ö–∞—Ç–µ–≥–æ—Ä–∏—è:')) {
                                            categoryText = categoryText.split('–ö–∞—Ç–µ–≥–æ—Ä–∏—è:')[1];
                                        }
                                        
                                        // –£–±–∏—Ä–∞–µ–º "Commission Rate" –∏ –≤—Å–µ –ø–æ—Å–ª–µ
                                        if (categoryText.includes('Commission Rate') || categoryText.includes('–ö–æ–º–∏—Å—Å–∏—è')) {
                                            categoryText = categoryText.split('Commission Rate')[0].split('–ö–æ–º–∏—Å—Å–∏—è')[0];
                                        }
                                        
                                        // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä "15.00%")
                                        categoryText = categoryText.replace(/\s*\d+\.?\d*\s*%/g, '');
                                        
                                        categoryText = categoryText.trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é (—Å–æ–¥–µ—Ä–∂–∏—Ç ">" –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–æ–≤)
                                        if (categoryText && categoryText.length > 3 && 
                                            (categoryText.includes('>') || categoryText.split(' ').length >= 2)) {
                                            return categoryText.substring(0, 100);
                                        }
                                    }
                                }
                                return null;
                            }
                        """)
                        if category and len(category) > 3:
                            product_data.category = category.strip()
                            log.info(f"  ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–∞ (—á–µ—Ä–µ–∑ JS): {product_data.category}")
                    except Exception as e:
                        log.debug(f"  ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ JS: {e}")
                
                if not product_data.category:
                    log.warning("  ‚ö†Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ 'N/A'")
                    product_data.category = "N/A"
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {e}")
                product_data.category = "N/A"
            
            # –®–ê–ì 3.5: –ó–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets (–µ—Å–ª–∏ sheets_writer –ø–µ—Ä–µ–¥–∞–Ω)
            # –í–ê–ñ–ù–û: –ï—Å–ª–∏ —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ
            if sheets_writer:
                log.info("\nüìå –®–ê–ì 3.5: –ó–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets...")
                try:
                    row_number = sheets_writer.write_basic_product_data(
                        product_data.product_name,
                        product_data.category,
                        product_data.pipiads_link
                    )
                    if row_number > 0:
                        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ
                        product_data._sheets_row = row_number
                        log.info(f"  ‚úÖ –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {row_number})")
                    else:
                        # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–≤–æ–∑–º–æ–∂–Ω–æ, —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã),
                        # –Ω–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö
                        log.warning("  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–≤–æ–∑–º–æ–∂–Ω–æ, —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã)")
                        log.info("  ‚Üí –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö...")
                        row_number = sheets_writer.find_next_empty_row()
                        product_data._sheets_row = row_number
                        log.info(f"  ‚úÖ –ë—É–¥–µ–º –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫—É {row_number}")
                except Exception as e:
                    log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö: {e}")
                    # –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ
                    try:
                        row_number = sheets_writer.find_next_empty_row()
                        product_data._sheets_row = row_number
                        log.info(f"  ‚Üí –ë—É–¥–µ–º –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫—É {row_number}")
                    except:
                        pass
            
            # –®–ê–ì 4: –ü–æ–∏—Å–∫ –±–ª–æ–∫–∞ "TikTok Ads"
            log.info("\nüìå –®–ê–ì 4: –ü–æ–∏—Å–∫ –±–ª–æ–∫–∞ 'TikTok Ads'...")
            log.info("  ‚Üí –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–Ω–∏–∑ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞...")
            
            # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–Ω–∏–∑, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç
            # –ë–ª–æ–∫ "TikTok Ads" –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            try:
                log.info("  ‚Üí –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–Ω–∏–∑ (–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ)...")
                # –ü–æ–ª—É—á–∞–µ–º –≤—ã—Å–æ—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                page_height = await self.page.evaluate("document.body.scrollHeight")
                viewport_height = await self.page.evaluate("window.innerHeight")
                log.info(f"  ‚Üí –í—ã—Å–æ—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {page_height}px, –≤—ã—Å–æ—Ç–∞ viewport: {viewport_height}px")
                
                # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ (–∫–∞–∫ —á–µ–ª–æ–≤–µ–∫)
                scroll_steps = max(3, page_height // viewport_height)
                scroll_step = page_height // scroll_steps
                
                for step in range(scroll_steps):
                    scroll_position = scroll_step * (step + 1)
                    await self.page.evaluate(f"window.scrollTo(0, {scroll_position})")
                    await self.human_delay(0.3, 0.5)
                    log.debug(f"  ‚Üí –ü—Ä–æ–∫—Ä—É—Ç–∫–∞: {scroll_position}/{page_height}px")
                
                # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ —Å–∞–º–æ–≥–æ –Ω–∏–∑–∞
                await self.page.evaluate("window.scrollTo(0, document.body.scrollHeight)")
                await self.human_delay(1, 2)  # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–∫—Ä—É—á–µ–Ω–∞ –≤–Ω–∏–∑")
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            log.info("  ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (–∫–∞–∫ Ctrl+F)...")
            tiktok_ads_found = False
            tiktok_ads_element = None
            
            # –°–Ω–∞—á–∞–ª–∞ –∂–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            await self.human_delay(0.5, 1)
            
            # –í–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
            tiktok_ads_texts = [
                "TikTok Ads",  # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π
                "–†–µ–∫–ª–∞–º–∞ –¢–∏–∫–¢–æ–∫",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 1
                "–†–µ–∫–ª–∞–º–∞ TikTok",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 2
                "TikTok –†–µ–∫–ª–∞–º–∞",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 3
            ]
            
            # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –±–ª–æ–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä —Å —Ç–µ–∫—Å—Ç–æ–º (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±)
            log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ Playwright locator...")
            for text_variant in tiktok_ads_texts:
                try:
                    # –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Ç–µ–∫—Å—Ç (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ)
                    locator = self.page.locator(f'text=/{text_variant}/i').first
                    if await locator.count() > 0:
                        tiktok_ads_element = await locator.element_handle()
                        if tiktok_ads_element:
                            # –°–∫—Ä–æ–ª–ª–∏–º –∫ —ç–ª–µ–º–µ–Ω—Ç—É
                            await tiktok_ads_element.scroll_into_view_if_needed()
                            await self.human_delay(0.3, 0.5)
                            tiktok_ads_found = True
                            log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ Playwright locator")
                            break
                except Exception as e:
                    log.debug(f"–ü–æ–∏—Å–∫ '{text_variant}' —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä –Ω–µ —É–¥–∞–ª—Å—è: {e}")
                    continue
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ JavaScript –ø–æ–∏—Å–∫ (–∫–∞–∫ Ctrl+F)
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript TreeWalker...")
                for text_variant in tiktok_ads_texts:
                    try:
                        # –ò—Å–ø–æ–ª—å–∑—É–µ–º JavaScript –¥–ª—è –ø–æ–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å —Ç–µ–∫—Å—Ç–æ–º
                        # –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è regex
                        escaped_text = text_variant.replace("\\", "\\\\").replace("/", "\\/")
                        tiktok_ads_element = await self.page.evaluate_handle(f"""
                            () => {{
                                const walker = document.createTreeWalker(
                                    document.body,
                                    NodeFilter.SHOW_TEXT,
                                    null,
                                    false
                                );
                                
                                let node;
                                while (node = walker.nextNode()) {{
                                    if (node.textContent && /{escaped_text}/i.test(node.textContent)) {{
                                        // –ù–∞—Ö–æ–¥–∏–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç
                                        let parent = node.parentElement;
                                        while (parent && parent !== document.body) {{
                                            if (parent.offsetHeight > 0 && parent.offsetWidth > 0) {{
                                                return parent;
                                            }}
                                            parent = parent.parentElement;
                                        }}
                                    }}
                                }}
                                return null;
                            }}
                        """)
                        
                        if tiktok_ads_element and await tiktok_ads_element.as_element():
                            element = await tiktok_ads_element.as_element()
                            await element.scroll_into_view_if_needed()
                            await self.human_delay(0.3, 0.5)
                            tiktok_ads_found = True
                            log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript TreeWalker")
                            break
                    except Exception as e:
                        log.debug(f"JavaScript –ø–æ–∏—Å–∫ '{text_variant}' –Ω–µ —É–¥–∞–ª—Å—è: {e}")
                        continue
            
            # –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ query_selector
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 3: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ query_selector —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ —Ç–µ–∫—Å—Ç–∞...")
                try:
                    # –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
                    text_variants = []
                    for text in tiktok_ads_texts:
                        text_variants.extend([
                            f'text="{text}"',
                            f'text={text}',
                            f'*:has-text("{text}")',
                        ])
                    
                    for variant in text_variants:
                        try:
                            element = await self.page.query_selector(variant)
                            if element:
                                is_visible = await element.is_visible()
                                if is_visible:
                                    await element.scroll_into_view_if_needed()
                                    await self.human_delay(0.3, 0.5)
                                    tiktok_ads_found = True
                                    tiktok_ads_element = element
                                    log.info(f"  ‚úÖ –ë–ª–æ–∫ –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ query_selector: {variant}")
                                    break
                        except:
                            continue
                except Exception as e:
                    log.debug(f"Query selector –ø–æ–∏—Å–∫ –Ω–µ —É–¥–∞–ª—Å—è: {e}")
            
            # –ü–æ–ø—ã—Ç–∫–∞ 4: –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –µ—â–µ —Ä–∞–∑ –∏ –ø–æ–∏—Å–∫–∞—Ç—å —Å–Ω–æ–≤–∞
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 4: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∏ –ø–æ–∏—Å–∫...")
                try:
                    # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –µ—â–µ —Ä–∞–∑ –º–µ–¥–ª–µ–Ω–Ω–æ
                    await self.page.evaluate("window.scrollTo(0, 0)")  # –í –Ω–∞—á–∞–ª–æ
                    await self.human_delay(0.5, 1)
                    
                    # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑ –º–µ–¥–ª–µ–Ω–Ω–æ, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è—Å—å –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
                    page_height = await self.page.evaluate("document.body.scrollHeight")
                    scroll_increment = 300  # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –ø–æ 300px
                    
                    for scroll_pos in range(0, page_height, scroll_increment):
                        await self.page.evaluate(f"window.scrollTo(0, {scroll_pos})")
                        await self.human_delay(0.2, 0.3)
                        
                        # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –Ω–∞ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ (–≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞)
                        for text_variant in tiktok_ads_texts:
                            try:
                                # –ó–∞–º–µ–Ω—è–µ–º –ø—Ä–æ–±–µ–ª—ã –Ω–∞ \s+ –¥–ª—è regex
                                regex_pattern = text_variant.replace(" ", "\\s+")
                                locator = self.page.locator(f'text=/{regex_pattern}/i').first
                                if await locator.count() > 0:
                                    tiktok_ads_element = await locator.element_handle()
                                    if tiktok_ads_element:
                                        await tiktok_ads_element.scroll_into_view_if_needed()
                                        await self.human_delay(0.3, 0.5)
                                        tiktok_ads_found = True
                                        log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ {scroll_pos}px")
                                        break
                            except:
                                continue
                        
                        if tiktok_ads_found:
                            break
                    
                    if not tiktok_ads_found:
                        # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ —Å–∞–º–æ–≥–æ –Ω–∏–∑–∞ –µ—â–µ —Ä–∞–∑
                        await self.page.evaluate("window.scrollTo(0, document.body.scrollHeight)")
                        await self.human_delay(1, 2)
                        
                        # –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–∏—Å–∫–∞ (–≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞)
                        for text_variant in tiktok_ads_texts:
                            try:
                                # –ó–∞–º–µ–Ω—è–µ–º –ø—Ä–æ–±–µ–ª—ã –Ω–∞ \s+ –¥–ª—è regex
                                regex_pattern = text_variant.replace(" ", "\\s+")
                                locator = self.page.locator(f'text=/{regex_pattern}/i').first
                                if await locator.count() > 0:
                                    tiktok_ads_element = await locator.element_handle()
                                    if tiktok_ads_element:
                                        await tiktok_ads_element.scroll_into_view_if_needed()
                                        await self.human_delay(0.3, 0.5)
                                        tiktok_ads_found = True
                                        log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω –≤ —Å–∞–º–æ–º –Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã")
                                        break
                            except:
                                continue
                except Exception as e:
                    log.debug(f"–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –Ω–µ –ø–æ–º–æ–≥–ª–∞: {e}")
            
            if not tiktok_ads_found:
                log.error("  ‚ùå –ë–ª–æ–∫ 'TikTok Ads' –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫")
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                try:
                    screenshot_path = config.SCREENSHOTS_DIR / f"tiktok_ads_not_found_{int(time.time())}.png"
                    await self.page.screenshot(path=str(screenshot_path), full_page=True)
                    log.info(f"  üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {screenshot_path}")
                except:
                    pass
                log.error("  ‚ùå –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: –±–ª–æ–∫ 'TikTok Ads' –Ω–µ –Ω–∞–π–¥–µ–Ω")
                return product_data
            
            log.info("  ‚úÖ –ë–ª–æ–∫ 'TikTok Ads' —É—Å–ø–µ—à–Ω–æ –Ω–∞–π–¥–µ–Ω")
            
            # –®–ê–ì 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ "First seen"
            log.info("\nüìå –®–ê–ì 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ 'First seen'...")
            sort_success = await self._set_sort_by_first_seen()
            if not sort_success:
                log.warning("  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            # –®–ê–ì 6: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–∏–¥–µ–æ
            log.info("\nüìå –®–ê–ì 6: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ 'TikTok Ads'...")
            videos = await self._get_videos_from_tiktok_ads_block()
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ {len(videos)} –≤–∏–¥–µ–æ –≤ –±–ª–æ–∫–µ")
            
            # –®–ê–ì 7: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ
            log.info(f"\nüìå –®–ê–ì 7: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ (impression >= {config.MIN_IMPRESSIONS}, –¥–∞—Ç–∞ <= {config.DAYS_BACK} –¥–Ω–µ–π)...")
            filtered_videos = await self._filter_videos(videos)
            log.info(f"  ‚Üí –ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: {len(filtered_videos)} –≤–∏–¥–µ–æ")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –í–°–ï –≤–∏–¥–µ–æ (–¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏) –≤ ProductData
            product_data._all_videos_raw = videos[:20]  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–≤—ã–µ 20 –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
            
            # –í–ê–ñ–ù–û: –ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ 0 –≤–∏–¥–µ–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä
            if len(filtered_videos) == 0:
                log.warning(f"  ‚ö†Ô∏è –ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ (>= {config.MIN_IMPRESSIONS} impressions, <= {config.DAYS_BACK} –¥–Ω–µ–π)")
                log.warning(f"  ‚ö†Ô∏è –¢–æ–≤–∞—Ä –±—É–¥–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω")
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ —Ç–æ–≤–∞—Ä–∞
                product_data._insufficient_videos = True
                product_data._videos_found = len(videos)
                return product_data
            
            # –í—ã–±–æ—Ä —Ç–æ–ø-3 –≤–∏–¥–µ–æ
            video_count = 3
            selected_videos = filtered_videos[:video_count]
            
            log.info(f"  ‚úÖ –í—ã–±—Ä–∞–Ω–æ {len(selected_videos)} –≤–∏–¥–µ–æ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            
            # –®–ê–ì 8: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
            log.info(f"\nüìå –®–ê–ì 8: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–ª—è {len(selected_videos)} –≤–∏–¥–µ–æ...")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
            product_page_url = self.page.url
            log.info(f"  ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞: {product_page_url}")
            
            for i, video in enumerate(selected_videos, 1):
                log.info(f"\n  üé¨ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ {i}/{len(selected_videos)}...")
                log.info(f"    ‚Üí Impression: {video.get('impression', 0)}, First seen: {video.get('first_seen', 'N/A')}")
                
                # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ (–ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ ad-search –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
                video_details = await self._get_video_details(video)
                
                if video_details:
                    product_data.videos.append(video_details)
                    log.info(f"    ‚úÖ –í–∏–¥–µ–æ {i} –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ")
                else:
                    log.warning(f"    ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –¥–ª—è –≤–∏–¥–µ–æ {i}")
                
                # –í–ê–ñ–ù–û: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
                log.info(f"    ‚Üí –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ {i}...")
                try:
                    await self.page.goto(product_page_url, wait_until="domcontentloaded", timeout=30000)
                    await self.human_delay(1, 2)
                    
                    # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –±–ª–æ–∫–∞ TikTok Ads (—á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ –≤–∏–¥–µ–æ)
                    try:
                        await self.page.wait_for_selector('a[href*="/ad-search/"]', timeout=10000, state="visible")
                        log.info(f"    ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ —É—Å–ø–µ—à–µ–Ω (–≤–∏–¥–µ–æ {i})")
                    except:
                        log.warning(f"    ‚ö†Ô∏è –ë–ª–æ–∫ TikTok Ads –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
                except Exception as e:
                    log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞: {e}")
                    # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–ª–µ–¥—É—é—â–∏—Ö –≤–∏–¥–µ–æ –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤–æ–∑–≤—Ä–∞—Ç–∞
                
                await self.human_delay(0.5, 1)
            
            # –ó–∞–ø–æ–ª–Ω—è–µ–º N/A –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤–∏–¥–µ–æ (–Ω—É–∂–Ω–æ 3 –≤–∏–¥–µ–æ)
            while len(product_data.videos) < video_count:
                product_data.videos.append({
                    "tiktok_link": "N/A",
                    "impression": 0,
                    "script": "N/A",
                    "hook": "N/A",
                    "audience_age": "N/A",
                    "country": "N/A",
                    "first_seen": "N/A",
                })
            
            log.info(f"\n‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {len(product_data.videos)} –≤–∏–¥–µ–æ –¥–ª—è —Ç–æ–≤–∞—Ä–∞")
            
            # –®–ê–ì 9: –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ –≤ Google Sheets (–µ—Å–ª–∏ sheets_writer –ø–µ—Ä–µ–¥–∞–Ω)
            if sheets_writer:
                if hasattr(product_data, '_sheets_row') and product_data._sheets_row > 0:
                    log.info(f"\nüìå –®–ê–ì 9: –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {product_data._sheets_row})...")
                    log.info(f"  ‚Üí –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ –¥–ª—è –∑–∞–ø–∏—Å–∏: {len(product_data.videos)}")
                    
                    # –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é
                    for i, video in enumerate(product_data.videos[:3], 1):
                        log.info(f"  ‚Üí –í–∏–¥–µ–æ {i}: tiktok={video.get('tiktok_link', 'N/A')[:50]}, "
                                f"impression={video.get('impression', 'N/A')}, "
                                f"script={len(str(video.get('script', 'N/A')))} —Å–∏–º–≤–æ–ª–æ–≤, "
                                f"hook={len(str(video.get('hook', 'N/A')))} —Å–∏–º–≤–æ–ª–æ–≤, "
                                f"audience={video.get('audience_age', 'N/A')}, "
                                f"country={video.get('country', 'N/A')}, "
                                f"first_seen={video.get('first_seen', 'N/A')}")
                    
                    try:
                        # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏
                        video_data_dict = {
                            "product_name": product_data.product_name,
                            "category": product_data.category,
                            "pipiads_link": product_data.pipiads_link,
                            "videos": product_data.videos
                        }
                        
                        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (update_basic=False - –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ F-Z)
                        success = sheets_writer.write_product_data(
                            product_data._sheets_row,
                            video_data_dict,
                            update_basic=False
                        )
                        
                        if success:
                            log.info(f"  ‚úÖ –î–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {product_data._sheets_row}, —Å—Ç–æ–ª–±—Ü—ã F-Z)")
                        else:
                            log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –≤ Google Sheets")
                    except Exception as e:
                        log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ: {e}")
                        import traceback
                        log.error(traceback.format_exc())
                else:
                    log.warning(f"  ‚ö†Ô∏è –ù–µ—Ç –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö (_sheets_row –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)")
            
            log.info("=" * 80)
            log.info("‚úÖ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û")
            log.info("=" * 80)
            return product_data
            
        except Exception as e:
            log.error("\n" + "=" * 80)
            log.error(f"‚ùå –û–®–ò–ë–ö–ê –ü–†–ò –û–ë–†–ê–ë–û–¢–ö–ï –¢–û–í–ê–†–ê: {e}")
            log.error("=" * 80)
            import traceback
            log.error(traceback.format_exc())
            return product_data
    
    async def return_to_main_page(self, main_page_url: str) -> bool:
        """
        –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–æ–≤–∞—Ä–æ–≤
        
        Args:
            main_page_url: URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ —Ç–æ–≤–∞—Ä)
        
        Returns:
            True –µ—Å–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç —É—Å–ø–µ—à–µ–Ω, False –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        """
        try:
            log.info("\nüîô –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–æ–≤–∞—Ä–æ–≤...")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π URL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            current_url = self.page.url
            log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
            log.info(f"  ‚Üí –¶–µ–ª–µ–≤–æ–π URL: {main_page_url}")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            if current_url == main_page_url:
                log.info("  ‚ÑπÔ∏è  –£–∂–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
                return True
            
            # –ú–ï–¢–û–î 1: –ü—Ä—è–º–æ–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π URL (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            await self.page.goto(main_page_url, wait_until="domcontentloaded", timeout=30000)  # –£–≤–µ–ª–∏—á–µ–Ω –¥–æ 30 —Å–µ–∫
            await self.human_delay(1, 2)
            
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ë–ï–ó networkidle - –æ–Ω –≤—ã–∑—ã–≤–∞–µ—Ç —Ç–∞–π–º–∞—É—Ç—ã!)
            await self.page.wait_for_load_state("domcontentloaded", timeout=5000)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞
            new_url = self.page.url
            log.info(f"  ‚Üí –ù–æ–≤—ã–π URL: {new_url}")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤
            try:
                await self.page.wait_for_selector('a[href*="/tiktok-shop-product/"]', timeout=10000)
                
                # –î–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ä–µ–º—è –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
                await self.human_delay(2, 3)
                
                log.info("  ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —É—Å–ø–µ—à–µ–Ω")
                return True
            except:
                log.warning("  ‚ö†Ô∏è –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞")
                return False
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É: {e}")
            import traceback
            log.error(traceback.format_exc())
            return False
    
    async def get_product_details_with_return(self, product_index: int, sheets_writer=None, banned_products=None):
        """
        –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        
        –ê–ª–≥–æ—Ä–∏—Ç–º:
        1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        2. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É
        3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ban-list (–µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω)
        4. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–≤–∞—Ä (get_product_details)
        5. –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        
        Args:
            product_index: –ò–Ω–¥–µ–∫—Å —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–Ω–∞—á–∏–Ω–∞—è —Å 0)
            sheets_writer: –û–±—ä–µ–∫—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ Google Sheets
            banned_products: –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö URL (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
        
        Returns:
            ProductData –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ
            Dict —Å–æ status="insufficient_videos" –µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ
            Dict —Å–æ status="duplicate" –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
            None –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        """
        log.info(f"\n{'='*80}")
        log.info(f"üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ü–û –ò–ù–î–ï–ö–°–£ {product_index}")
        log.info(f"{'='*80}")
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        main_page_url = self.page.url
        log.info(f"  ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {main_page_url}")
        
        def normalize_url(url: str) -> str:
            """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL (—É–±—Ä–∞—Ç—å —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É)"""
            if not url:
                return ""
            url = url.strip().rstrip('/')
            # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if '?' in url:
                url = url.split('?')[0]
            return url
        
        try:
            # –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É
            log.info(f"\nüìå –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É {product_index}...")
            
            try:
                # –ò—â–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
                product_links = await self.page.query_selector_all('a[href*="/tiktok-shop-product/"]')
                
                if not product_links:
                    log.error("  ‚ùå –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
                    return None
                
                if product_index >= len(product_links):
                    log.error(f"  ‚ùå –ò–Ω–¥–µ–∫—Å {product_index} –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã (–≤—Å–µ–≥–æ {len(product_links)} —Ç–æ–≤–∞—Ä–æ–≤)")
                    return None
                
                # –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Ç–æ–≤–∞—Ä–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É
                product_link = product_links[product_index]
                
                # –ü–æ–ª—É—á–∞–µ–º URL —Ç–æ–≤–∞—Ä–∞
                href = await product_link.get_attribute("href")
                if not href:
                    log.error(f"  ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å URL –¥–ª—è —Ç–æ–≤–∞—Ä–∞ {product_index}")
                    return None
                
                # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π URL
                if href.startswith("/"):
                    product_url = f"https://www.pipiads.com{href}"
                elif href.startswith("http"):
                    product_url = href
                else:
                    product_url = f"https://www.pipiads.com/{href}"
                
                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º URL (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
                product_url = normalize_url(product_url)
                
                if not product_url:
                    log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                    return None
                
                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
                if banned_products is not None and product_url in banned_products:
                    log.warning(f"  üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: {product_url}")
                    log.warning(f"     –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.")
                    return {"status": "duplicate", "product_url": product_url}
                
                log.info(f"  ‚úÖ –ü–æ–ª—É—á–µ–Ω URL —Ç–æ–≤–∞—Ä–∞: {product_url}")
                
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ URL —Ç–æ–≤–∞—Ä–∞: {e}")
                return None
            
            # –®–ê–ì 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ get_product_details
            log.info(f"\nüìå –®–ê–ì 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞...")
            product_data = await self.get_product_details(product_url, sheets_writer=sheets_writer)
            
            # –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–¥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é)
            log.info(f"\nüìå –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞...")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∏ –µ—Å—Ç—å –≤–∏–¥–µ–æ
            if not product_data:
                log.warning("  ‚ö†Ô∏è product_data –ø—É—Å—Ç")
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                await self.return_to_main_page(main_page_url)
                return None
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ —Ç–æ–≤–∞—Ä –ø—Ä–æ–ø—É—â–µ–Ω –∏–∑-–∑–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
            if hasattr(product_data, '_insufficient_videos') and product_data._insufficient_videos:
                videos_found = getattr(product_data, '_videos_found', 0)
                log.warning(f"  ‚ö†Ô∏è –¢–æ–≤–∞—Ä –ø—Ä–æ–ø—É—â–µ–Ω: –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ (–Ω–∞–π–¥–µ–Ω–æ –≤—Å–µ–≥–æ: {videos_found})")
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                await self.return_to_main_page(main_page_url)
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª–æ–≤–∞—Ä—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "insufficient_videos"
                return {
                    "status": "insufficient_videos",
                    "product_name": getattr(product_data, 'product_name', 'N/A'),
                    "videos_found": videos_found,
                    "videos_required": 3,
                    "reason": f"–ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (>= {config.MIN_IMPRESSIONS} impressions, <= {config.DAYS_BACK} –¥–Ω–µ–π) –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ"
                }
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ
            videos_count = len(product_data.videos) if hasattr(product_data, 'videos') else 0
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ –≤–∏–¥–µ–æ: {videos_count}")
            
            # –ï—Å–ª–∏ –≤–∏–¥–µ–æ –º–µ–Ω—å—à–µ 3 - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
            if videos_count < 3:
                log.warning(f"  ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ: {videos_count} < 3")
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                await self.return_to_main_page(main_page_url)
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª–æ–≤–∞—Ä—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "insufficient_videos"
                return {
                    "status": "insufficient_videos",
                    "product_name": getattr(product_data, 'product_name', 'N/A'),
                    "videos_found": videos_count,
                    "videos_required": 3,
                    "reason": f"–ù–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ {videos_count} –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏"
                }
            
            # –®–ê–ì 4: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            log.info(f"\nüìå –®–ê–ì 4: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É...")
            await self.return_to_main_page(main_page_url)
            
            # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä
            log.info(f"  ‚úÖ –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ ({videos_count} –≤–∏–¥–µ–æ)")
            return product_data
            
        except Exception as e:
            log.error(f"\n‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É {product_index}: {e}")
            import traceback
            log.error(traceback.format_exc())
            
            # –ü—ã—Ç–∞–µ–º—Å—è –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
            try:
                await self.return_to_main_page(main_page_url)
            except:
                log.error("  ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏")
            
            return None
    
    async def _set_sort_by_first_seen(self) -> bool:
        """
        –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É "First seen" –≤ dropdown
        
        Returns:
            True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
        """
        log.info("  ‚Üí –ü–æ–∏—Å–∫ dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏...")
        try:
            # –ò—â–µ–º dropdown "Sort by"
            sort_selectors = [
                'select:has-text("Sort by")',
                'select',
                '[class*="sort"]',
                'text="Sort by: First seen"',
                'text="Sort by"',
            ]
            
            dropdown = None
            for selector in sort_selectors:
                try:
                    dropdown = await self.page.query_selector(selector)
                    if dropdown:
                        is_visible = await dropdown.is_visible()
                        if is_visible:
                            log.debug(f"–ù–∞–π–¥–µ–Ω dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: {selector}")
                            break
                        else:
                            dropdown = None
                except:
                    continue
            
            if not dropdown:
                # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ —Ç–µ–∫—Å—Ç—É "Sort by: First seen"
                try:
                    sort_text = await self.page.query_selector('text="Sort by: First seen"')
                    if sort_text:
                        # –ö–ª–∏–∫–∞–µ–º –Ω–∞ —Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å dropdown
                        await sort_text.click()
                        await self.human_delay(0.5, 1)
                        
                        # –ò—â–µ–º –æ–ø—Ü–∏—é "First seen"
                        first_seen_option = await self.page.query_selector('text="First seen"')
                        if first_seen_option:
                            await first_seen_option.click()
                            await self.human_delay(1, 2)
                            log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (—á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç)")
                            return True
                except:
                    pass
                
                log.warning("Dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å")
                return False
            
            # –ï—Å–ª–∏ —ç—Ç–æ select —ç–ª–µ–º–µ–Ω—Ç
            tag_name = await dropdown.evaluate("el => el.tagName.toLowerCase()")
            if tag_name == "select":
                # –í—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é —á–µ—Ä–µ–∑ value –∏–ª–∏ —Ç–µ–∫—Å—Ç
                try:
                    log.info("  ‚Üí –ù–∞–π–¥–µ–Ω select —ç–ª–µ–º–µ–Ω—Ç, –≤—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é 'First seen'...")
                    await dropdown.select_option(label="First seen")
                    await self.human_delay(1, 2)
                    log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (select)")
                    return True
                except:
                    pass
            
            # –ï—Å–ª–∏ —ç—Ç–æ –∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown - –∫–ª–∏–∫–∞–µ–º –∏ –≤—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é
            log.info("  ‚Üí –ù–∞–π–¥–µ–Ω –∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown, –æ—Ç–∫—Ä—ã–≤–∞–µ–º...")
            await dropdown.click()
            await self.human_delay(0.5, 1)
            
            # –ò—â–µ–º –æ–ø—Ü–∏—é "First seen"
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –æ–ø—Ü–∏–∏ 'First seen'...")
            option_selectors = [
                'text="First seen"',
                'text="Sort by: First seen"',
                '[role="option"]:has-text("First seen")',
            ]
            
            for opt_sel in option_selectors:
                try:
                    option = await self.page.query_selector(opt_sel)
                    if option:
                        await option.click()
                        await self.human_delay(1, 2)
                        log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (–∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown)")
                        return True
                except:
                    continue
            
            log.warning("  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É 'First seen'")
            return False
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: {e}")
            return False
    
    async def _get_videos_from_tiktok_ads_block(self) -> List[Dict[str, Any]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ TikTok Ads
        
        Returns:
            –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        videos = []
        
        try:
            log.info("  ‚Üí –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ...")
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ
            await self.human_delay(0.5, 1)
            
            # –ò—â–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ - –ø—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã...")
            video_card_selectors = [
                '[class*="video"]',
                '[class*="card"]',
                '[class*="ad"]',
                'div[class*="item"]',
                'a[href*="/ad-search/"]',
            ]
            
            video_elements = []
            for selector in video_card_selectors:
                try:
                    elements = await self.page.query_selector_all(selector)
                    if elements:
                        log.debug(f"–ù–∞–π–¥–µ–Ω–æ {len(elements)} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º {selector}")
                        # –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ, —á—Ç–æ —Å–æ–¥–µ—Ä–∂–∞—Ç –≤–∏–¥–µ–æ (–∏–º–µ—é—Ç thumbnail –∏–ª–∏ play button)
                        for elem in elements:
                            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –∫–∞—Ä—Ç–æ—á–∫–∞ –≤–∏–¥–µ–æ
                            has_play_button = await elem.query_selector('[class*="play"], svg, [class*="thumbnail"]')
                            if has_play_button or '/ad-search/' in str(await elem.get_attribute("href") or ""):
                                video_elements.append(elem)
                        if video_elements:
                            break
                except:
                    continue
            
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ")
            
            # –û–ì–†–ê–ù–ò–ß–ï–ù–ò–ï: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 50 –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
            max_cards = 50
            if len(video_elements) > max_cards:
                log.info(f"  ‚Üí –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ {max_cards} –∏–∑ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫")
                video_elements = video_elements[:max_cards]
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
            log.info("  ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–µ–∫...")
            log.info(f"  ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∞ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫...")
            
            successful_extractions = 0
            for i, card in enumerate(video_elements, 1):
                try:
                    video_data = await self._extract_video_data_from_card(card, i)
                    if video_data:
                        videos.append(video_data)
                        impression = video_data.get('impression', 0)
                        first_seen = video_data.get('first_seen', 'N/A')
                        
                        # –õ–û–ì–ò–†–£–ï–ú –ö–ê–ñ–î–û–ï –í–ò–î–ï–û (–∫–∞–∫ –ø—Ä–æ—Å–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
                        log.info(f"  üìπ –í–∏–¥–µ–æ {i}: impression={impression}, first_seen={first_seen}")
                        
                        if impression > 0 or first_seen != 'N/A':
                            successful_extractions += 1
                except Exception as e:
                    log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ {i}: {e}")
                    continue
            
            log.info(f"  ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–æ {len(videos)} –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ (—É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–æ: {successful_extractions})")
            return videos
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤–∏–¥–µ–æ: {e}")
            return []
    
    async def _extract_video_data_from_card(self, card_element, card_index: int = 0) -> Optional[Dict[str, Any]]:
        """
        –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ
        
        Args:
            card_element: –≠–ª–µ–º–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ
            card_index: –ò–Ω–¥–µ–∫—Å –∫–∞—Ä—Ç–æ—á–∫–∏ (–¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ –∏–ª–∏ None
        """
        try:
            video_data = {
                "ad_search_url": None,
                "impression": 0,
                "first_seen": None,
                "card_element": card_element,  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –∫–ª–∏–∫–∞
            }
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï IMPRESSION ==========
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ HTML-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
            # –ò—â–µ–º div.data-count > div.item –≥–¥–µ caption = "Impression"
            try:
                # –ò—â–µ–º –≤—Å–µ –±–ª–æ–∫–∏ data-count
                data_count_items = await card_element.query_selector_all('div.data-count div.item')
                
                if card_index <= 3:
                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –Ω–∞–π–¥–µ–Ω–æ {len(data_count_items)} –±–ª–æ–∫–æ–≤ div.item")
                
                for idx, item in enumerate(data_count_items):
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å impression
                    caption_elem = await item.query_selector('p.caption')
                    if caption_elem:
                        caption_text = await caption_elem.inner_text()
                        
                        if card_index <= 3:
                            log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}, –±–ª–æ–∫ {idx}: caption = '{caption_text}'")
                        
                        if 'Impression' in caption_text or '–ü–æ–∫–∞–∑' in caption_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
                            value_elem = await item.query_selector('p.value')
                            if value_elem:
                                # –ü–æ–ø—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
                                impression_str_inner = (await value_elem.inner_text()).strip()
                                impression_str_html = (await value_elem.inner_html()).strip()
                                impression_str_content = (await value_elem.text_content()).strip()
                                
                                # –í–°–ï–ì–î–ê –ª–æ–≥–∏—Ä—É–µ–º RAW-–∑–Ω–∞—á–µ–Ω–∏–µ (–¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–∞—Ä—Ç–æ—á–µ–∫)
                                if card_index <= 3:
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (inner_text) = '{impression_str_inner}'")
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (inner_html) = '{impression_str_html}'")
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (text_content) = '{impression_str_content}'")
                                
                                # –ò—Å–ø–æ–ª—å–∑—É–µ–º inner_text –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫
                                impression_str = impression_str_inner
                                impression = validator.parse_impressions(impression_str)
                                if impression:
                                    video_data["impression"] = impression
                                    if card_index <= 3:
                                        log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression PARSED = {impression}")
                                    break
                                else:
                                    if card_index <= 3:
                                        log.warning(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: parse_impressions –≤–µ—Ä–Ω—É–ª None –¥–ª—è '{impression_str}'")
            except Exception as e:
                if card_index <= 3:
                    log.error(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ impression: {e}")
                    import traceback
                    log.error(traceback.format_exc())
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï FIRST SEEN ==========
            # –ò—â–µ–º div.create-time > span —Å –¥–∞—Ç–æ–π
            try:
                create_time_elem = await card_element.query_selector('div.create-time span')
                if create_time_elem:
                    date_text = (await create_time_elem.inner_text()).strip()
                    # –õ–æ–≥–∏—Ä—É–µ–º RAW-–∑–Ω–∞—á–µ–Ω–∏–µ
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: first_seen RAW='{date_text}'")
                    
                    # –§–æ—Ä–º–∞—Ç: "Nov 05 2025-Nov 11 2025" - –±–µ—Ä–µ–º –ü–ï–†–í–£–Æ –¥–∞—Ç—É (–¥–æ –¥–µ—Ñ–∏—Å–∞)
                    # –ò—Å–ø–æ–ª—å–∑—É–µ–º regex –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–µ—Ä–≤–æ–π –¥–∞—Ç—ã
                    match = re.match(r'([A-Z][a-z]{2}\s+\d{1,2}\s+\d{4})', date_text)
                    if match:
                        first_seen_str = match.group(1)
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –¥–∞—Ç—ã
                        parsed_date = validator.parse_video_date(first_seen_str)
                        if parsed_date:
                            video_data["first_seen"] = first_seen_str
                            log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: first_seen parsed='{first_seen_str}'")
            except Exception as e:
                if card_index <= 3:
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ first_seen —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä: {e}")
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï AD-SEARCH –°–°–´–õ–ö–ò ==========
            try:
                link_element = await card_element.query_selector('a.btn-detail[href*="/ad-search/"]')
                if link_element:
                    href = await link_element.get_attribute("href")
                    if href:
                        if href.startswith("/"):
                            video_data["ad_search_url"] = f"https://www.pipiads.com{href}"
                        elif href.startswith("http"):
                            video_data["ad_search_url"] = href
                        else:
                            video_data["ad_search_url"] = f"https://www.pipiads.com/{href}"
                        if card_index <= 3:
                            log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: ad_search_url = {video_data['ad_search_url']}")
            except Exception as e:
                if card_index <= 3:
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ ad_search_url: {e}")
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Å—Å—ã–ª–∫—É, –Ω–æ –µ—Å—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∞ - –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –Ω–µ—ë
            if not video_data["ad_search_url"]:
                video_data["card_element"] = card_element
            
            # –õ–æ–≥–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–∞—Ä—Ç–æ—á–µ–∫
            if card_index <= 3:
                log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –∏—Ç–æ–≥–æ - impression={video_data['impression']}, first_seen={video_data['first_seen']}, ad_search_url={bool(video_data['ad_search_url'])}")
            
            return video_data
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ {card_index}: {e}")
            import traceback
            log.debug(traceback.format_exc())
            return None
    
    async def _filter_videos(self, videos: List[Dict[str, Any]]) -> List[Dict[str, Any]]:
        """
        –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
        
        Args:
            videos: –°–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        
        Returns:
            –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ
        """
        filtered = []
        
        for video in videos:
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ impression (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π "170.6K" –∏–ª–∏ —á–∏—Å–ª–æ–º)
            impression = video.get("impression", 0)
            impression_num = 0
            if isinstance(impression, str):
                # –ü–∞—Ä—Å–∏–º —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                impression_num = validator.parse_impressions(impression) or 0
            elif isinstance(impression, (int, float)):
                impression_num = int(impression)
            
            if not validator.validate_impressions(impression_num, config.MIN_IMPRESSIONS):
                log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: impression {impression} ({impression_num}) < {config.MIN_IMPRESSIONS}")
                continue
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
            first_seen = video.get("first_seen")
            if first_seen and first_seen != "N/A" and first_seen is not None:
                parsed_date = validator.parse_video_date(first_seen)
                if parsed_date:
                    if not validator.is_date_within_days(parsed_date, config.DAYS_BACK):
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –¥–∞—Ç–∞ {first_seen} —Å—Ç–∞—Ä—à–µ {config.DAYS_BACK} –¥–Ω–µ–π")
                        continue
                else:
                    # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å, –Ω–æ –µ—Å—Ç—å impression >= 50k, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –¥–∞—Ç—ã
                    if impression >= config.MIN_IMPRESSIONS:
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–∏–Ω—è—Ç–æ: –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É {first_seen}, –Ω–æ impression {impression} >= {config.MIN_IMPRESSIONS}")
                    else:
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É {first_seen} –∏ impression {impression} < {config.MIN_IMPRESSIONS}")
                        continue
            # –ï—Å–ª–∏ –¥–∞—Ç—ã –Ω–µ—Ç, –Ω–æ impression >= 50k, –ø—Ä–∏–Ω–∏–º–∞–µ–º –≤–∏–¥–µ–æ
            elif impression >= config.MIN_IMPRESSIONS:
                log.debug(f"–í–∏–¥–µ–æ –ø—Ä–∏–Ω—è—Ç–æ: –Ω–µ—Ç –¥–∞—Ç—ã, –Ω–æ impression {impression} >= {config.MIN_IMPRESSIONS}")
            else:
                log.debug("–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –Ω–µ—Ç –¥–∞—Ç—ã first_seen –∏ impression < –º–∏–Ω–∏–º—É–º–∞")
                continue
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
            video["_impression_num"] = impression_num
            filtered.append(video)
        
        # –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: —Å–Ω–∞—á–∞–ª–∞ –ø–æ –¥–∞—Ç–µ (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ), –ø–æ—Ç–æ–º –ø–æ impressions (—Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ)
        # –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ ad_search_url (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π), –∑–∞—Ç–µ–º tiktok_link, –∑–∞—Ç–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—è
        seen_videos = set()
        unique_videos = []
        for video in filtered:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)
            # 1. ad_search_url (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ)
            # 2. tiktok_link (–µ—Å–ª–∏ ad_search_url –Ω–µ—Ç)
            # 3. –ö–æ–º–±–∏–Ω–∞—Ü–∏—è impression + first_seen (fallback)
            video_id = None
            
            # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º ad_search_url (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ)
            ad_search_url = video.get("ad_search_url", "")
            if ad_search_url and ad_search_url != "N/A":
                ad_search_url = ad_search_url.rstrip('/')
                video_id = f"ad_search:{ad_search_url}"
            elif video.get("tiktok_link") and video.get("tiktok_link") != "N/A":
                video_id = f"tiktok:{video.get('tiktok_link')}"
            else:
                # Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—é impression + first_seen
                impression = video.get("impression", 0)
                first_seen = video.get("first_seen", "N/A")
                video_id = f"fallback:{impression}:{first_seen}"
            
            if video_id and video_id not in seen_videos:
                seen_videos.add(video_id)
                unique_videos.append(video)
            else:
                log.info(f"‚è≠Ô∏è  –í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ –∫–∞–∫ –¥—É–±–ª–∏–∫–∞—Ç: {video_id}")
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º: —Å–Ω–∞—á–∞–ª–∞ –ø–æ –¥–∞—Ç–µ (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ), –ø–æ—Ç–æ–º –ø–æ impressions (—Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ)
        def sort_key(v):
            parsed_date = validator.parse_video_date(v.get("first_seen", ""))
            if parsed_date:
                date_timestamp = -parsed_date.timestamp()  # –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ —É–±—ã–≤–∞–Ω–∏—é (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ)
            else:
                date_timestamp = 0  # –í–∏–¥–µ–æ –±–µ–∑ –¥–∞—Ç—ã –≤ –∫–æ–Ω–µ—Ü
            return (date_timestamp, -v.get("_impression_num", 0))
        
        unique_videos.sort(key=sort_key)
        
        # –ë–µ—Ä–µ–º —Ç–æ–ø-3
        top_videos = unique_videos[:3]
        
        log.info(f"‚úÖ –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ {len(filtered)} –≤–∏–¥–µ–æ –∏–∑ {len(videos)}, —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö: {len(unique_videos)}, —Ç–æ–ø-3: {len(top_videos)}")
        return top_videos
    
    async def _get_video_details(self, video: Dict[str, Any]) -> Optional[Dict[str, Any]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –≤–∏–¥–µ–æ
        
        Args:
            video: –°–ª–æ–≤–∞—Ä—å —Å –±–∞–∑–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ (–∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        try:
            # –ï—Å–ª–∏ –µ—Å—Ç—å ad_search_url, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞–ø—Ä—è–º—É—é
            if video.get("ad_search_url"):
                log.info(f"    ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É ad-search: {video['ad_search_url']}")
                await self.page.goto(video["ad_search_url"], wait_until="domcontentloaded", timeout=30000)
                await self.human_delay(0.5, 1)
                log.info("    ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ad-search –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            else:
                # –ï—Å–ª–∏ –Ω–µ—Ç URL, –∫–ª–∏–∫–∞–µ–º –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É
                # –í–ê–ñ–ù–û: –≠–ª–µ–º–µ–Ω—Ç –º–æ–∂–µ—Ç –∏—Å—á–µ–∑–Ω—É—Ç—å –∏–∑ DOM, –ø–æ—ç—Ç–æ–º—É –∏—â–µ–º –µ–≥–æ –∑–∞–Ω–æ–≤–æ
                card_element = video.get("card_element")
                if not card_element:
                    log.error("    ‚ùå –ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ –ø–µ—Ä–µ–π—Ç–∏ –∫ –≤–∏–¥–µ–æ (–Ω–µ—Ç URL –∏ —ç–ª–µ–º–µ–Ω—Ç–∞)")
                    return None
                
                log.info("    ‚Üí –ö–ª–∏–∫ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –≤–∏–¥–µ–æ...")
                try:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –µ—â–µ –≤ DOM
                    is_attached = await card_element.evaluate("el => el.isConnected")
                    if not is_attached:
                        log.warning("    ‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç –∏—Å—á–µ–∑ –∏–∑ DOM, –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∑–∞–Ω–æ–≤–æ...")
                        # –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ –ø–æ ad_search_url –∏–ª–∏ –¥—Ä—É–≥–∏–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º
                        # –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None
                        log.error("    ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ")
                        return None
                    
                    await card_element.click()
                    await self.human_delay(0.5, 1)
                    log.info("    ‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ –≤–∏–¥–µ–æ –æ—Ç–∫—Ä—ã—Ç–∞")
                except Exception as e:
                    log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É: {e}")
                    log.warning("    ‚ö†Ô∏è –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ...")
                    # –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –∏—Å—á–µ–∑, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None
                    return None
                
                # –ñ–¥–µ–º –æ—Ç–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞/–º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                # –ò—â–µ–º –∫–Ω–æ–ø–∫—É "More detail"
                log.info("    ‚Üí –ü–æ–∏—Å–∫ –∫–Ω–æ–ø–∫–∏ 'More detail'...")
                more_detail_selectors = [
                    'text="More detail"',
                    'text="More Detail"',
                    'button:has-text("More detail")',
                    'a:has-text("More detail")',
                ]
                
                more_detail_button = None
                for selector in more_detail_selectors:
                    try:
                        more_detail_button = await self.page.wait_for_selector(selector, timeout=5000, state="visible")
                        if more_detail_button:
                            log.info(f"    ‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ 'More detail' (—Å–µ–ª–µ–∫—Ç–æ—Ä: {selector})")
                            break
                    except:
                        continue
                
                if not more_detail_button:
                    log.error("    ‚ùå –ö–Ω–æ–ø–∫–∞ 'More detail' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
                    return None
                
                # –ö–ª–∏–∫–∞–µ–º –Ω–∞ "More detail"
                log.info("    ‚Üí –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É 'More detail'...")
                await more_detail_button.click()
                await self.human_delay(0.5, 1)
                
                # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
                log.info("    ‚Üí –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search...")
                await self.page.wait_for_load_state("domcontentloaded", timeout=10000)
                await self.human_delay(0.3, 0.5)
                log.info("    ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ad-search –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
            # –ü–µ—Ä–µ–¥–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏) –¥–ª—è fallback
            log.info("    ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search...")
            
            # –í–ê–ñ–ù–û: –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º domcontentloaded (–±—ã—Å—Ç—Ä–µ–µ) + –∑–∞–¥–µ—Ä–∂–∫–∞ + –æ–∂–∏–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            await self.page.wait_for_load_state("domcontentloaded", timeout=10000)
            await self.human_delay(2, 3)  # –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (Script, Hook, Audience) —Å retry
            elements_found = False
            for attempt in range(3):  # 3 –ø–æ–ø—ã—Ç–∫–∏
                try:
                    # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                    await self.page.wait_for_selector('li#ai-script, li#ai-hook, div.addel-info-item', timeout=5000, state="visible")
                    log.info(f"    ‚úÖ –ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search (–ø–æ–ø—ã—Ç–∫–∞ {attempt + 1})")
                    elements_found = True
                    break
                except:
                    if attempt < 2:
                        log.debug(f"    ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∂–¥–µ–º –µ—â–µ...")
                        await self.human_delay(2, 3)
                    else:
                        log.warning("    ‚ö†Ô∏è –ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ 3 –ø–æ–ø—ã—Ç–æ–∫, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ...")
            
            return await self._extract_ad_search_data(video)
            
        except Exception as e:
            log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–µ—Ç–∞–ª–µ–π –≤–∏–¥–µ–æ: {e}")
            import traceback
            log.error(traceback.format_exc())
            return None
    
    async def _extract_ad_search_data(self, original_video: Optional[Dict[str, Any]] = None) -> Dict[str, Any]:
        """
        –ò–∑–≤–ª–µ—á—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
        
        Args:
            original_video: –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (–¥–ª—è fallback impressions)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        video_data = {
            "tiktok_link": "N/A",
            "impression": 0,
            "script": "N/A",
            "hook": "N/A",
            "audience_age": "N/A",
            "country": "N/A",
            "first_seen": "N/A",
        }
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è fallback
        if original_video:
            original_impression = original_video.get("impression")
            if original_impression:
                video_data["_original_impression"] = original_impression
        
        try:
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            await self.page.wait_for_load_state("domcontentloaded")
            await self.human_delay(0.3, 0.5)
            
            # –ü–æ–ª—É—á–∞–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ø–æ–∏—Å–∫–∞
            page_text = await self.page.content()
            
            # 1. TikTok —Å—Å—ã–ª–∫–∞ (–∏–∑ –ø–æ–ª—è "TikTok Post" (–∞–Ω–≥–ª.) –∏–ª–∏ "–ü–æ—Å—Ç TikTok" (—Ä—É—Å.))
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ TikTok —Å—Å—ã–ª–∫–∏...")
            
            # –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –ø–æ —Ç–µ–∫—Å—Ç—É "TikTok Post" –∏–ª–∏ "–ü–æ—Å—Ç TikTok"
            tiktok_post_selectors = [
                'text=/TikTok Post/i',  # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
                'text=/–ü–æ—Å—Ç TikTok/i',  # –†—É—Å—Å–∫–∏–π fallback
            ]
            
            for selector in tiktok_post_selectors:
                try:
                    locator = self.page.locator(selector).first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Å—Å—ã–ª–∫—É —Ä—è–¥–æ–º
                        try:
                            parent_locator = locator.locator("..")
                            # –ò—â–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å—Å—ã–ª–∫–∞–º —Å /v/)
                            link = await parent_locator.locator('a[href*="m.tiktok.com/v/"]').first.element_handle()
                            if not link:
                                link = await parent_locator.locator('a[href*="tiktok.com/v/"]').first.element_handle()
                            if not link:
                                link = await parent_locator.locator('a[href*="tiktok.com"]').first.element_handle()
                            if link:
                                href = await link.get_attribute("href")
                                if href:
                                    # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä—ã –≤ TikTok Shop
                                    if "shop.tiktok.com/view/product" in href or "/view/product" in href:
                                        log.debug(f"      ‚Üí –ü—Ä–æ–ø—É—â–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä: {href[:50]}...")
                                        continue
                                    # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ
                                    if "/v/" in href or "m.tiktok.com" in href:
                                        video_data["tiktok_link"] = href
                                        log.info(f"      ‚úÖ TikTok —Å—Å—ã–ª–∫–∞ –Ω–∞–π–¥–µ–Ω–∞: {href[:50]}...")
                                        break
                        except:
                            pass
                except:
                    continue
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç, –∏—â–µ–º –≤—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ TikTok
            # –í–ê–ñ–ù–û: –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ (m.tiktok.com/v/...), –ù–ï –Ω–∞ —Ç–æ–≤–∞—Ä—ã (shop.tiktok.com/view/product/...)
            if video_data["tiktok_link"] == "N/A":
                tiktok_link_selectors = [
                    'a[href*="m.tiktok.com/v/"]',  # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ
                    'a[href*="tiktok.com/v/"]',    # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                    'a[href*="tiktok.com"]',       # Fallback
                ]
                
                for selector in tiktok_link_selectors:
                    try:
                        links = await self.page.query_selector_all(selector)
                        for link in links:
                            href = await link.get_attribute("href")
                            if href and "tiktok.com" in href:
                                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä—ã –≤ TikTok Shop
                                if "shop.tiktok.com/view/product" in href or "/view/product" in href:
                                    log.debug(f"      ‚Üí –ü—Ä–æ–ø—É—â–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä: {href[:50]}...")
                                    continue
                                
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ (—Å–æ–¥–µ—Ä–∂–∞—Ç /v/ –≤ –ø—É—Ç–∏)
                                if "/v/" in href or "m.tiktok.com" in href:
                                    video_data["tiktok_link"] = href
                                    log.info(f"      ‚úÖ TikTok —Å—Å—ã–ª–∫–∞ –Ω–∞–π–¥–µ–Ω–∞: {href[:50]}...")
                                    break
                        if video_data["tiktok_link"] != "N/A":
                            break
                    except:
                        continue
            
            if video_data["tiktok_link"] == "N/A":
                log.warning("      ‚ö†Ô∏è TikTok —Å—Å—ã–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
            
            # 2. Impressions - –ö–†–ò–¢–ò–ß–ù–û: "Impressions" (–∞–Ω–≥–ª.) –∏–ª–∏ "–ü–æ–∫–∞–∑—ã" (—Ä—É—Å.), –Ω–µ "Likes" –∏–ª–∏ "–ù—Ä–∞–≤–∏—Ç—Å—è"!
            # –ò—â–µ–º –≤ —Ä–∞–∑–¥–µ–ª–µ "Data/–î–∞–Ω–Ω—ã–µ" –≤ –ø—É–Ω–∫—Ç–µ "Impression/–ü–æ–∫–∞–∑"
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ impressions...")
            impression_text = await self._extract_impressions()
            if impression_text:
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–µ—Å–ª–∏ –æ–Ω —É–∂–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "170.6K" –∏–ª–∏ "339.9M")
                if impression_text.upper().endswith(('K', 'M')):
                    video_data["impression"] = impression_text
                    log.info(f"      ‚úÖ Impressions (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç): {impression_text}")
                else:
                    # –ü–∞—Ä—Å–∏–º —á–∏—Å–ª–æ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞—Ç–Ω–æ
                    impression_num = validator.parse_impressions(impression_text) or 0
                    video_data["impression"] = validator.format_impressions(impression_num)
                    log.info(f"      ‚úÖ Impressions (—Å—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–æ): {video_data['impression']}")
            else:
                # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ–Ω–∏ –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                # (–∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞)
                original_impression = video_data.get("_original_impression")
                if original_impression:
                    if isinstance(original_impression, (int, float)) and original_impression > 0:
                        video_data["impression"] = validator.format_impressions(int(original_impression))
                        log.info(f"      ‚úÖ Impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏: {video_data['impression']}")
                    elif isinstance(original_impression, str) and original_impression != "N/A":
                        video_data["impression"] = original_impression
                        log.info(f"      ‚úÖ Impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (—Å—Ç—Ä–æ–∫–∞): {original_impression}")
                    else:
                        video_data["impression"] = "N/A"
                        log.warning("      ‚ö†Ô∏è Impressions –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –Ω–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ")
                else:
                    video_data["impression"] = "N/A"
                    log.warning("      ‚ö†Ô∏è Impressions –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
            
            # 3. Script (–∏–∑ "Transcript" –∏–ª–∏ "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞")
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è (script)...")
            log.info(f"      ‚Üí –¢–µ–∫—É—â–∏–π URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {self.page.url}")
            script = await self._extract_script()
            if script:
                video_data["script"] = script
                log.info(f"      ‚úÖ Script –Ω–∞–π–¥–µ–Ω ({len(script)} —Å–∏–º–≤–æ–ª–æ–≤): {script[:100]}...")
            else:
                video_data["script"] = "N/A"
                log.warning("      ‚ö†Ô∏è Script –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-script p.content-text –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 4. Hook (–∏–∑ —Å–µ–∫—Ü–∏–∏ Hook –∏–ª–∏ Hooks)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ hook...")
            hook = await self._extract_hook()
            if not hook:
                # –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω
                log.warning("      ‚ö†Ô∏è Hook –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫...")
                await self.human_delay(1, 2)  # –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É
                hook = await self._extract_hook()
            
            if hook:
                video_data["hook"] = hook
                log.info(f"      ‚úÖ Hook –Ω–∞–π–¥–µ–Ω ({len(hook)} —Å–∏–º–≤–æ–ª–æ–≤): {hook[:100]}...")
            else:
                video_data["hook"] = "N/A"
                log.warning("      ‚ö†Ô∏è Hook –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook p.content-text –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 5. Audience Age (–∏–∑ –ø–æ–ª—è Audience/–ê—É–¥–∏—Ç–æ—Ä–∏—è)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∞—É–¥–∏—Ç–æ—Ä–∏–∏...")
            audience_data = await self._extract_audience()
            if audience_data:
                age = audience_data.get("age", "N/A")
                platform = audience_data.get("platform", "N/A")
                # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ "35-45" –∏–ª–∏ "35-45 Android" (–µ—Å–ª–∏ –µ—Å—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞)
                # –í —Å—Ç—Ä–æ–∫–µ 6 —Ç–æ–ª—å–∫–æ –≤–æ–∑—Ä–∞—Å—Ç "25-35", –±–µ–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
                video_data["audience_age"] = age if age != "N/A" else "N/A"
                log.info(f"      ‚úÖ Audience: {video_data['audience_age']}")
            else:
                video_data["audience_age"] = "N/A"
                log.info("      ‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
            
            # 6. Country (–∏–∑ –ø–æ–ª—è "Country/Region" –∏–ª–∏ "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω" - –û–¢–î–ï–õ–¨–ù–û –æ—Ç Audience!)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã...")
            country = await self._extract_country()
            if country:
                video_data["country"] = country
                log.info(f"      ‚úÖ Country: {country}")
            else:
                video_data["country"] = "N/A"
                log.warning("      ‚ö†Ô∏è Country –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä div.addel-info-item —Å 'Country/Region' –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 7. First seen (—Ñ–æ—Ä–º–∞—Ç "Oct 27 2025" - –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ "Oct 28 2025 ~ Nov 10 2025")
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞—Ç—ã First seen...")
            first_seen = await self._extract_first_seen()
            if first_seen:
                video_data["first_seen"] = first_seen
                log.info(f"      ‚úÖ First seen: {first_seen}")
            else:
                video_data["first_seen"] = "N/A"
                log.info("      ‚ö†Ô∏è First seen –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
            
            log.info(f"    ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ—á–µ–Ω—ã: impression={video_data['impression']}, first_seen={video_data['first_seen']}")
            return video_data
            
        except Exception as e:
            log.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö ad-search: {e}")
            return video_data
    
    async def _extract_impressions(self) -> Optional[str]:
        """
        –ò–∑–≤–ª–µ—á—å impressions - –ö–†–ò–¢–ò–ß–ù–û: –≤ —Ä–∞–∑–¥–µ–ª–µ "Data/–î–∞–Ω–Ω—ã–µ" –≤ –ø—É–Ω–∫—Ç–µ "Impression/–ü–æ–∫–∞–∑"
        –í–ê–ñ–ù–û: –ù–ï –±—Ä–∞—Ç—å —à–∞–±–ª–æ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã!
        
        Returns:
            –°—Ç—Ä–æ–∫–∞ —Å impressions (–Ω–∞–ø—Ä–∏–º–µ—Ä "170.6K", "339.9M") –∏–ª–∏ None
        """
        try:
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM (–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ)
            try:
                impression_data = await self.page.evaluate("""
                    () => {
                        // –ò—â–µ–º —Ä–∞–∑–¥–µ–ª "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                        const dataKeywords = ['Data', '–î–∞–Ω–Ω—ã–µ'];
                        const impressionKeywords = ['Impression', '–ü–æ–∫–∞–∑', '–ü–æ–∫–∞–∑—ã'];
                        
                        // –ò—â–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —ç–ª–µ–º–µ–Ω—Ç "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                            for (const dataKeyword of dataKeywords) {
                                if (text.includes(dataKeyword)) {
                                    // –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –∏—â–µ–º "Impression" –∏–ª–∏ "–ü–æ–∫–∞–∑"
                                    for (const impKeyword of impressionKeywords) {
                                        if (text.includes(impKeyword)) {
                                            // –ò—â–µ–º —á–∏—Å–ª–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "170.6K", "403.2M" –∏ —Ç.–¥.
                                            const patterns = [
                                                new RegExp(impKeyword + '[\\s:]*([\\d.,]+[KM]?)', 'i'),
                                                new RegExp('([\\d.,]+[KM]?)\\s*' + impKeyword, 'i')
                                            ];
                                            
                                            for (const pattern of patterns) {
                                                const match = text.match(pattern);
                                                if (match && match[1]) {
                                                    const value = match[1];
                                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ —á–∏—Å–ª–æ (–Ω–µ —à–∞–±–ª–æ–Ω–Ω–æ–µ)
                                                    // –û–±—ã—á–Ω–æ —Ä–µ–∞–ª—å–Ω—ã–µ impressions –æ—Ç 50K –¥–æ 500M
                                                    const numValue = parseFloat(value.replace(/[KM]/i, ''));
                                                    if (numValue >= 0.05 && numValue <= 1000) {
                                                        return value;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        
                        // Fallback: –∏—â–µ–º –Ω–∞–ø—Ä—è–º—É—é "Impression" –∏–ª–∏ "–ü–æ–∫–∞–∑" (–ù–ï "Likes"!)
                        for (const impKeyword of impressionKeywords) {
                            const elements = Array.from(document.querySelectorAll('*')).filter(el => {
                                const text = el.innerText || '';
                                return text.includes(impKeyword) && !text.toLowerCase().includes('likes') && !text.toLowerCase().includes('–Ω—Ä–∞–≤–∏—Ç—Å—è');
                            });
                            
                            for (const el of elements) {
                                const text = el.innerText || '';
                                const patterns = [
                                    new RegExp(impKeyword + '[\\s:]*([\\d.,]+[KM]?)', 'i'),
                                    new RegExp('([\\d.,]+[KM]?)\\s*' + impKeyword, 'i')
                                ];
                                
                                for (const pattern of patterns) {
                                    const match = text.match(pattern);
                                    if (match && match[1]) {
                                        const value = match[1];
                                        const numValue = parseFloat(value.replace(/[KM]/i, ''));
                                        if (numValue >= 0.05 && numValue <= 1000) {
                                            return value;
                                        }
                                    }
                                }
                            }
                        }
                        
                        return null;
                    }
                """)
                
                if impression_data:
                    log.debug(f"–ù–∞–π–¥–µ–Ω–æ impressions —á–µ—Ä–µ–∑ JavaScript: {impression_data}")
                    return impression_data
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ impressions —á–µ—Ä–µ–∑ JS: {e}")
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (fallback)
            data_keywords = ["Data", "–î–∞–Ω–Ω—ã–µ"]
            
            for keyword in data_keywords:
                try:
                    data_locator = self.page.locator(f'text=/{keyword}/i').first
                    if await data_locator.count() > 0:
                        impression_keywords = ["Impression", "–ü–æ–∫–∞–∑", "–ü–æ–∫–∞–∑—ã"]
                        for imp_keyword in impression_keywords:
                            try:
                                parent_text = await data_locator.locator("..").inner_text()
                                if imp_keyword in parent_text and "Likes" not in parent_text and "–ù—Ä–∞–≤–∏—Ç—Å—è" not in parent_text:
                                    pattern = rf'{imp_keyword}[:\s]*([\d.,]+[KM]?)'
                                    match = re.search(pattern, parent_text, re.IGNORECASE)
                                    if match:
                                        impression_str = match.group(1)
                                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —à–∞–±–ª–æ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                                        num_value = validator.parse_impressions(impression_str)
                                        if num_value and 50000 <= num_value <= 1000000000:  # –û—Ç 50K –¥–æ 1B
                                            log.debug(f"–ù–∞–π–¥–µ–Ω–æ impressions –≤ —Ä–∞–∑–¥–µ–ª–µ Data: {impression_str}")
                                            return impression_str
                            except:
                                continue
                except:
                    continue
            
            log.warning("–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ 'Impression' –∏–ª–∏ '–ü–æ–∫–∞–∑' –≤ —Ä–∞–∑–¥–µ–ª–µ Data")
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ impressions: {e}")
            return None
    
    async def _extract_script(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å —Å—Ü–µ–Ω–∞—Ä–∏–π –∏–∑ —Å–µ–∫—Ü–∏–∏ 'Script' –∏–ª–∏ '–°—Ü–µ–Ω–∞—Ä–∏–π' (–∏–ª–∏ 'Transcript' –∏–ª–∏ '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞')
        
        –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
        <li id="ai-script">
            <div class="li-title">...</div>
            <div class="control-content li-content">
                <p class="content-text slot-wrap">...</p>
            </div>
        </li>
        """
        try:
            # –ú–ï–¢–û–î 0: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä—É –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            # –ü—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º (—ç–ª–µ–º–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
            for attempt in range(3):
                try:
                    # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
                    try:
                        await self.page.wait_for_selector('li#ai-script', timeout=5000, state="visible")
                    except:
                        if attempt < 2:
                            log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç li#ai-script –Ω–µ –ø–æ—è–≤–∏–ª—Å—è, –∂–¥–µ–º –µ—â–µ...")
                            await self.human_delay(1, 2)
                            continue
                        else:
                            log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-script –Ω–µ –ø–æ—è–≤–∏–ª—Å—è –∑–∞ 15 —Å–µ–∫—É–Ω–¥")
                    
                    script_element = await self.page.query_selector('li#ai-script p.content-text')
                    if script_element:
                        script = await script_element.inner_text()
                        if script and len(script.strip()) > 10:
                            log.info(f"      ‚úÖ Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-script p.content-text ({len(script)} —Å–∏–º–≤–æ–ª–æ–≤)")
                            return script.strip()
                    else:
                        if attempt < 2:
                            log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω, –∂–¥–µ–º –µ—â–µ...")
                            await self.human_delay(1, 2)
                            continue
                        else:
                            log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-script p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω")
                except Exception as e:
                    if attempt < 2:
                        log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: –æ—à–∏–±–∫–∞ {e}, –ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑...")
                        await self.human_delay(1, 2)
                        continue
                    else:
                        log.debug(f"      ‚Üí –°–µ–ª–µ–∫—Ç–æ—Ä li#ai-script –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: {e}")
            
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
            script_keywords = ["Script", "–°—Ü–µ–Ω–∞—Ä–∏–π", "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞", "–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç"]
            
            for keyword in script_keywords:
                try:
                    # –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å —Ç–µ–∫—Å—Ç–æ–º
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            parent_text = await locator.locator("..").inner_text()
                            if keyword in parent_text:
                                parts = parent_text.split(keyword, 1)
                                if len(parts) > 1:
                                    script = parts[1].strip()
                                    # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –º–µ—Ç–∫–∏
                                    stop_words = ["Hook", "–•—É–∫", "Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", 
                                                "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", "Impressions", "–ü–æ–∫–∞–∑—ã",
                                                "Limited Time Offer", "Annual Plan", "Promotion Period", "50% OFF",
                                                "Privacy", "Terms", "Copyright", "PIPIADS", "All Rights Reserved",
                                                "AI-agent", "cosmobeauty", "credits", "subscription", "invoice",
                                                "Monthly Credits", "Extra Credits", "data cost", "detail costs",
                                                "Team Setting", "Affiliate Dashboard", "Logout"]
                                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                           "cosmobeauty", "credits", "subscription", "invoice", 
                                                           "Monthly Credits", "Extra Credits", "@gmail.com"]
                                    is_footer_menu = any(keyword in script for keyword in footer_menu_keywords)
                                    
                                    for stop_word in stop_words:
                                        if stop_word in script:
                                            script = script.split(stop_word)[0].strip()
                                    # –§–∏–ª—å—Ç—Ä—É–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (Video Text Translator, Quality, Size –∏ —Ç.–¥.)
                                    metadata_keywords = ["Video Text Translator", "Translator", "Quality", "Size", "Resolution", 
                                                        "Width", "Height", "Duration", "Format", "Codec", "Frame Rate"]
                                    is_metadata = any(keyword in script for keyword in metadata_keywords)
                                    
                                    # –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                    lines = script.split('\n')
                                    cleaned_lines = []
                                    skip_words = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook']
                                    for line in lines:
                                        line = line.strip()
                                        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                        if line and not line.startswith('#') and not any(skip in line for skip in skip_words):
                                            cleaned_lines.append(line)
                                    script = '\n'.join(cleaned_lines).strip()
                                    
                                    if script and len(script) > 10 and not is_footer_menu and not is_metadata:
                                        log.debug(f"Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Ä–æ–¥–∏—Ç–µ–ª—å)")
                                        return script
                        except:
                            pass
                        
                        # –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            next_sibling = await locator.evaluate_handle("el => el.nextElementSibling")
                            if next_sibling:
                                script = await next_sibling.as_element().inner_text()
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                       "cosmobeauty", "credits", "subscription", "invoice", 
                                                       "Monthly Credits", "Extra Credits", "@gmail.com"]
                                is_footer_menu = any(keyword in script for keyword in footer_menu_keywords)
                                # –§–∏–ª—å—Ç—Ä—É–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                metadata_keywords = ["Video Text Translator", "Translator", "Quality", "Size", "Resolution"]
                                is_metadata = any(keyword in script for keyword in metadata_keywords)
                                
                                # –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                lines = script.split('\n')
                                cleaned_lines = []
                                skip_words = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook']
                                for line in lines:
                                    line = line.strip()
                                    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                    if line and not line.startswith('#') and not any(skip in line for skip in skip_words):
                                        cleaned_lines.append(line)
                                script = '\n'.join(cleaned_lines).strip()
                                
                                if script and len(script) > 10 and not is_footer_menu and not is_metadata:
                                    log.debug(f"Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç)")
                                    return script.strip()
                        except:
                            pass
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                script = await self.page.evaluate("""
                    () => {
                        const keywords = ['Script', '–°—Ü–µ–Ω–∞—Ä–∏–π', 'Transcript', '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞', '–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç'];
                        const stopWords = ['Hook', '–•—É–∫', 'Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 
                                          'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 'Impressions', '–ü–æ–∫–∞–∑—ã',
                                          'Analysis', 'Advertiser', 'Display Name', 'Ad Copy',
                                          'Limited Time Offer', 'Annual Plan', 'Promotion Period', '50% OFF'];
                        
                        // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    // –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ (–æ–±—ã—á–Ω–æ —ç—Ç–æ —Å–∞–º script)
                                    let scriptText = null;
                                    
                                    // –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ sibling —ç–ª–µ–º–µ–Ω—Ç–∞
                                    let nextSibling = el.nextElementSibling;
                                    if (nextSibling) {
                                        scriptText = nextSibling.innerText || '';
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    if (!scriptText || scriptText.length < 10) {
                                        const parentText = el.parentElement ? el.parentElement.innerText || '' : '';
                                        if (parentText.includes(keyword)) {
                                            const parts = parentText.split(keyword);
                                            if (parts.length > 1) {
                                                scriptText = parts[1].trim();
                                            }
                                        }
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 3: –ò—â–µ–º –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö (–æ–±—ã—á–Ω–æ script –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –±–ª–æ–∫–µ)
                                    if (!scriptText || scriptText.length < 10) {
                                        const children = el.querySelectorAll('p, div, span');
                                        for (const child of children) {
                                            const childText = child.innerText || '';
                                            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç—ã
                                            if (childText.length > 20 && 
                                                !childText.includes('Advertiser') && 
                                                !childText.includes('Display Name') &&
                                                !childText.includes('Analysis') &&
                                                !childText.includes('Generator') &&
                                                !childText.includes('Limited Time Offer') &&
                                                !childText.includes('Annual Plan') &&
                                                !childText.includes('Promotion Period') &&
                                                !childText.includes('50% OFF')) {
                                                scriptText = childText;
                                                break;
                                            }
                                        }
                                    }
                                    
                                    if (scriptText) {
                                        // –£–±–∏—Ä–∞–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                        for (const stopWord of stopWords) {
                                            if (scriptText.includes(stopWord)) {
                                                scriptText = scriptText.split(stopWord)[0];
                                            }
                                        }
                                        
                                        scriptText = scriptText.trim();
                                        
                                        // –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                        const skipWords = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook'];
                                        const lines = scriptText.split('\\n');
                                        const cleanedLines = [];
                                        for (const line of lines) {
                                            const trimmedLine = line.trim();
                                            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                            if (trimmedLine && !trimmedLine.startsWith('#') && 
                                                !skipWords.some(word => trimmedLine.includes(word))) {
                                                cleanedLines.push(trimmedLine);
                                            }
                                        }
                                        scriptText = cleanedLines.join('\\n').trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π script (–Ω–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –Ω–µ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç, –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é)
                                        const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                                   'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                                   'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                                   'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                                   'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                        const isFooterMenu = footerMenuKeywords.some(keyword => scriptText.includes(keyword));
                                        
                                        // –§–∏–ª—å—Ç—Ä—É–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                    const metadataKeywords = ['Video Text Translator', 'Translator', 'Quality', 'Size', 'Resolution', 
                                                             'Width', 'Height', 'Duration', 'Format', 'Codec', 'Frame Rate'];
                                    const isMetadata = metadataKeywords.some(keyword => scriptText.includes(keyword));
                                    
                                    if (scriptText && scriptText.length > 20 && 
                                            !scriptText.startsWith('Analysis') &&
                                            !scriptText.includes('shop.tiktok.com') &&
                                            !scriptText.includes('Generator Image') &&
                                            !scriptText.includes('Limited Time Offer') &&
                                            !scriptText.includes('Annual Plan') &&
                                            !scriptText.includes('Promotion Period') &&
                                            !scriptText.includes('50% OFF') &&
                                            !scriptText.toLowerCase().includes('q4') &&
                                            !scriptText.toLowerCase().includes('monthly plan') &&
                                            !isFooterMenu &&
                                            !isMetadata) {
                                            return scriptText;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if script and len(script) > 10:
                    log.debug("Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript")
                    return script.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ script —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è: {e}")
            return None
    
    async def _extract_hook(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å hook –∏–∑ —Å–µ–∫—Ü–∏–∏ Hook/Hooks (–∞–Ω–≥–ª.) –∏–ª–∏ –•—É–∫/–•—É–∫–∏ (—Ä—É—Å.)
        –í–ê–ñ–ù–û: Hook –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ Script –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ!
        
        –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
        <li id="ai-hook">
            <div class="li-title">...</div>
            <div class="control-content li-content">
                <p class="content-text slot-wrap">...</p>
            </div>
        </li>
        """
        try:
            # –ú–ï–¢–û–î 0: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä—É –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            # –ü—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º (—ç–ª–µ–º–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
            for attempt in range(3):
                try:
                    # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
                    try:
                        await self.page.wait_for_selector('li#ai-hook', timeout=5000, state="visible")
                    except:
                        if attempt < 2:
                            log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç li#ai-hook –Ω–µ –ø–æ—è–≤–∏–ª—Å—è, –∂–¥–µ–º –µ—â–µ...")
                            await self.human_delay(1, 2)
                            continue
                        else:
                            log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-hook –Ω–µ –ø–æ—è–≤–∏–ª—Å—è –∑–∞ 15 —Å–µ–∫—É–Ω–¥")
                    
                    hook_element = await self.page.query_selector('li#ai-hook p.content-text')
                    if hook_element:
                        hook = await hook_element.inner_text()
                        if hook and len(hook.strip()) > 5:
                        log.info(f"      ‚úÖ Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook p.content-text ({len(hook)} —Å–∏–º–≤–æ–ª–æ–≤)")
                        return hook.strip()
                else:
                    log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-hook p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω")
            except Exception as e:
                log.debug(f"      ‚Üí –°–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: {e}")
            
            # –ù–û–í–´–ô –ú–ï–¢–û–î: –ò—â–µ–º Script, –∑–∞—Ç–µ–º –∏—â–µ–º Hook –≤ —Å–ª–µ–¥—É—é—â–µ–º —ç–ª–µ–º–µ–Ω—Ç–µ/—Å–µ–∫—Ü–∏–∏
            try:
                # –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏–º Script
                script_keywords = ["Script", "–°—Ü–µ–Ω–∞—Ä–∏–π", "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞"]
                for script_keyword in script_keywords:
                    try:
                        script_locator = self.page.locator(f'text=/{script_keyword}/i').first
                        if await script_locator.count() > 0:
                            # –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ Script, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç "Hook" –∏–ª–∏ "Hooks"
                            # –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ –ø–æ—Å–ª–µ Script
                            try:
                                # –°–ø–æ—Å–æ–± 1: –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å "Hook" –∏–ª–∏ "Hooks" –ø–æ—Å–ª–µ Script
                                parent = script_locator.locator("..")
                                parent_text = await parent.inner_text()
                                
                                # –ò—â–µ–º "Hook" –∏–ª–∏ "Hooks" –≤ —Ç–æ–º –∂–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ
                                if "Hook" in parent_text or "Hooks" in parent_text or "–•—É–∫" in parent_text or "–•—É–∫–∏" in parent_text:
                                    # –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é Script –∏ Hook –≤ —Ç–µ–∫—Å—Ç–µ
                                    script_pos = parent_text.find(script_keyword)
                                    hook_pos = -1
                                    for hook_word in ["Hook", "Hooks", "–•—É–∫", "–•—É–∫–∏"]:
                                        pos = parent_text.find(hook_word, script_pos)
                                        if pos > script_pos:
                                            hook_pos = pos
                                            break
                                    
                                    if hook_pos > script_pos:
                                        # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ "Hook" –∏–ª–∏ "Hooks"
                                        hook_section = parent_text[hook_pos:]
                                        # –£–±–∏—Ä–∞–µ–º "Hook" –∏–ª–∏ "Hooks" –∏–∑ –Ω–∞—á–∞–ª–∞
                                        hook_section = re.sub(r'^Hooks?\s*:?\s*', '', hook_section, flags=re.IGNORECASE)
                                        hook_section = re.sub(r'^–•—É–∫–∏?\s*:?\s*', '', hook_section, flags=re.IGNORECASE)
                                        hook_text = hook_section.strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏ (Target Audience, First seen –∏ —Ç.–¥.)
                                        stop_words = ["Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", 
                                                    "Impressions", "–ü–æ–∫–∞–∑—ã", "Country", "–°—Ç—Ä–∞–Ω–∞", "Country/Region", "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω"]
                                        for stop_word in stop_words:
                                            if stop_word in hook_text:
                                                hook_text = hook_text.split(stop_word)[0].strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                        hook_text = re.sub(r'Quality\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'Size\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'Resolution\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'--', '', hook_text)
                                        hook_text = re.sub(r'\n{2,}', '\n', hook_text).strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞ –≤ –Ω–∞—á–∞–ª–µ
                                        hook_text = re.sub(r'^(Tags|Script|Hooks?)\s*:?\s*', '', hook_text, flags=re.IGNORECASE)
                                        
                                        if hook_text and len(hook_text) > 5 and len(hook_text) < 500:
                                            log.debug(f"Hook –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ Script —á–µ—Ä–µ–∑ '{script_keyword}'")
                                            return hook_text
                            except:
                                pass
                            
                            # –°–ø–æ—Å–æ–± 2: –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π sibling —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ Script
                            try:
                                script_element = await script_locator.element_handle()
                                if script_element:
                                    # –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å —Ç–µ–∫—Å—Ç–æ–º "Hook" –∏–ª–∏ "Hooks"
                                    next_elements = await self.page.evaluate("""
                                        (scriptEl) => {
                                            let current = scriptEl;
                                            // –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å "Hook" –∏–ª–∏ "Hooks"
                                            for (let i = 0; i < 10; i++) {
                                                current = current.nextElementSibling;
                                                if (!current) break;
                                                const text = current.innerText || '';
                                                if (text.includes('Hook') || text.includes('Hooks') || 
                                                    text.includes('–•—É–∫') || text.includes('–•—É–∫–∏')) {
                                                    // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ "Hook" –∏–ª–∏ "Hooks"
                                                    const parts = text.split(/Hooks?\\s*:?\\s*|–•—É–∫–∏?\\s*:?\\s*/i);
                                                    if (parts.length > 1) {
                                                        let hookText = parts[1].trim();
                                                        // –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏
                                                        const stopWords = ['Target Audience', 'First seen', 'Impressions', 'Country'];
                                                        for (const stop of stopWords) {
                                                            if (hookText.includes(stop)) {
                                                                hookText = hookText.split(stop)[0];
                                                            }
                                                        }
                                                        hookText = hookText.replace(/Quality\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/Size\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/Resolution\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/--/g, '');
                                                        hookText = hookText.replace(/\\n{2,}/g, '\\n').trim();
                                                        if (hookText && hookText.length > 5 && hookText.length < 500) {
                                                            return hookText;
                                                        }
                                                    }
                                                }
                                            }
                                            return null;
                                        }
                                    """, script_element)
                                    
                                    if next_elements:
                                        log.debug(f"Hook –Ω–∞–π–¥–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–º —ç–ª–µ–º–µ–Ω—Ç–µ –ø–æ—Å–ª–µ Script")
                                        return next_elements
                            except:
                                pass
                            
                            # –°–ø–æ—Å–æ–± 3: –ò—â–µ–º Hook –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –ø–æ—Å–ª–µ Script
                            try:
                                # –ü–æ–ª—É—á–∞–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –∏—â–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω "Script...Hook"
                                page_text = await self.page.content()
                                # –ò—â–µ–º —á–µ—Ä–µ–∑ JavaScript –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ
                                hook_text = await self.page.evaluate("""
                                    () => {
                                        // –ò—â–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Script"
                                        const allElements = Array.from(document.querySelectorAll('*'));
                                        for (const el of allElements) {
                                            const text = el.innerText || '';
                                            if (text.includes('Script') || text.includes('–°—Ü–µ–Ω–∞—Ä–∏–π')) {
                                                // –ò—â–µ–º –≤ —ç—Ç–æ–º –∂–µ —ç–ª–µ–º–µ–Ω—Ç–µ –∏–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º "Hook" –∏–ª–∏ "Hooks"
                                                let searchEl = el;
                                                for (let depth = 0; depth < 3; depth++) {
                                                    const searchText = searchEl.innerText || '';
                                                    if (searchText.includes('Hook') || searchText.includes('Hooks') || 
                                                        searchText.includes('–•—É–∫') || searchText.includes('–•—É–∫–∏')) {
                                                        // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –º–µ–∂–¥—É Script –∏ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Å–µ–∫—Ü–∏—è–º–∏
                                                        const scriptIndex = searchText.indexOf('Script');
                                                        const hookIndex = searchText.indexOf('Hook', scriptIndex);
                                                        if (hookIndex > scriptIndex) {
                                                            let hookText = searchText.substring(hookIndex);
                                                            // –£–±–∏—Ä–∞–µ–º "Hook" –∏–ª–∏ "Hooks" –∏–∑ –Ω–∞—á–∞–ª–∞
                                                            hookText = hookText.replace(/^Hooks?\\s*:?\\s*/i, '');
                                                            hookText = hookText.replace(/^–•—É–∫–∏?\\s*:?\\s*/i, '');
                                                            // –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏
                                                            const stopWords = ['Target Audience', 'First seen', 'Impressions', 'Country'];
                                                            for (const stop of stopWords) {
                                                                if (hookText.includes(stop)) {
                                                                    hookText = hookText.split(stop)[0];
                                                                }
                                                            }
                                                            hookText = hookText.replace(/Quality\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/Size\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/Resolution\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/--/g, '');
                                                            hookText = hookText.replace(/\\n{2,}/g, '\\n').trim();
                                                            if (hookText && hookText.length > 5 && hookText.length < 500) {
                                                                return hookText;
                                                            }
                                                        }
                                                    }
                                                    searchEl = searchEl.parentElement;
                                                    if (!searchEl) break;
                                                }
                                            }
                                        }
                                        return null;
                                    }
                                """)
                                
                                if hook_text:
                                    log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ—Å–ª–µ Script")
                                    return hook_text
                            except:
                                pass
                    except:
                        continue
            except:
                pass
            
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (—Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±, –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ fallback)
            hook_keywords = ["Hooks", "Hook", "–•—É–∫–∏", "–•—É–∫"]
            
            for keyword in hook_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            parent_text = await locator.locator("..").inner_text()
                            if keyword in parent_text:
                                parts = parent_text.split(keyword, 1)
                                if len(parts) > 1:
                                    hook = parts[1].strip()
                                    # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –º–µ—Ç–∫–∏
                                    stop_words = ["Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", 
                                                "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞", "Impressions", "–ü–æ–∫–∞–∑—ã",
                                                "Limited Time Offer", "Annual Plan", "Promotion Period", "50% OFF",
                                                "Privacy", "Terms", "Copyright", "PIPIADS", "All Rights Reserved",
                                                "AI-agent", "cosmobeauty", "credits", "subscription", "invoice",
                                                "Monthly Credits", "Extra Credits", "data cost", "detail costs",
                                                "Team Setting", "Affiliate Dashboard", "Logout"]
                                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                           "cosmobeauty", "credits", "subscription", "invoice", 
                                                           "Monthly Credits", "Extra Credits", "@gmail.com"]
                                    is_footer_menu = any(keyword in hook for keyword in footer_menu_keywords)
                                    
                                    for stop_word in stop_words:
                                        if stop_word in hook:
                                            hook = hook.split(stop_word)[0].strip()
                                    
                                    # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                    metadata_patterns = [
                                        r'Quality\s*:?\s*[^\n]*',
                                        r'Size\s*:?\s*[^\n]*',
                                        r'Resolution\s*:?\s*[^\n]*',
                                        r'Width\s*:?\s*[^\n]*',
                                        r'Height\s*:?\s*[^\n]*',
                                        r'Duration\s*:?\s*[^\n]*',
                                        r'Format\s*:?\s*[^\n]*',
                                        r'Codec\s*:?\s*[^\n]*',
                                        r'Frame Rate\s*:?\s*[^\n]*',
                                        r'--',  # –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                    ]
                                    for pattern in metadata_patterns:
                                        hook = re.sub(pattern, '', hook, flags=re.IGNORECASE)
                                    hook = re.sub(r'\n{2,}', '\n', hook).strip()  # –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                    
                                    if hook and len(hook) > 5 and not is_footer_menu:
                                        log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Ä–æ–¥–∏—Ç–µ–ª—å)")
                                        return hook
                        except:
                            pass
                        
                        # –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            next_sibling = await locator.evaluate_handle("el => el.nextElementSibling")
                            if next_sibling:
                                hook = await next_sibling.as_element().inner_text()
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                       "cosmobeauty", "credits", "subscription", "invoice", 
                                                       "Monthly Credits", "Extra Credits", "@gmail.com"]
                                is_footer_menu = any(keyword in hook for keyword in footer_menu_keywords)
                                
                                # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                metadata_patterns = [
                                    r'Quality\s*:?\s*[^\n]*',
                                    r'Size\s*:?\s*[^\n]*',
                                    r'Resolution\s*:?\s*[^\n]*',
                                    r'Width\s*:?\s*[^\n]*',
                                    r'Height\s*:?\s*[^\n]*',
                                    r'Duration\s*:?\s*[^\n]*',
                                    r'Format\s*:?\s*[^\n]*',
                                    r'Codec\s*:?\s*[^\n]*',
                                    r'Frame Rate\s*:?\s*[^\n]*',
                                    r'--',  # –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                ]
                                for pattern in metadata_patterns:
                                    hook = re.sub(pattern, '', hook, flags=re.IGNORECASE)
                                hook = re.sub(r'\n{2,}', '\n', hook).strip()  # –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                
                                if hook and len(hook) > 5 and not is_footer_menu:
                                    log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç)")
                                    return hook.strip()
                        except:
                            pass
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                hook = await self.page.evaluate("""
                    () => {
                        const keywords = ['Hooks', 'Hook', '–•—É–∫–∏', '–•—É–∫'];
                        const stopWords = ['Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 
                                         'Transcript', '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞', 'Impressions', '–ü–æ–∫–∞–∑—ã',
                                         'Script', '–°—Ü–µ–Ω–∞—Ä–∏–π', 'Analysis',
                                         'Limited Time Offer', 'Annual Plan', 'Promotion Period', '50% OFF'];
                        
                        // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    let hookText = null;
                                    
                                    // –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ sibling —ç–ª–µ–º–µ–Ω—Ç–∞
                                    let nextSibling = el.nextElementSibling;
                                    if (nextSibling) {
                                        hookText = nextSibling.innerText || '';
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    if (!hookText || hookText.length < 5) {
                                        const parentText = el.parentElement ? el.parentElement.innerText || '' : '';
                                        if (parentText.includes(keyword)) {
                                            const parts = parentText.split(keyword);
                                            if (parts.length > 1) {
                                                hookText = parts[1].trim();
                                            }
                                        }
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 3: –ò—â–µ–º –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö
                                    if (!hookText || hookText.length < 5) {
                                        const children = el.querySelectorAll('p, div, span');
                                        for (const child of children) {
                                            const childText = child.innerText || '';
                                            if (childText.length > 5 && childText.length < 200) {
                                                hookText = childText;
                                                break;
                                            }
                                        }
                                    }
                                    
                                    if (hookText) {
                                        // –£–±–∏—Ä–∞–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞
                                        for (const stopWord of stopWords) {
                                            if (hookText.includes(stopWord)) {
                                                hookText = hookText.split(stopWord)[0];
                                            }
                                        }
                                        
                                        hookText = hookText.trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π hook (–∫–æ—Ä–æ—Ç–∫–∞—è —Ñ—Ä–∞–∑–∞, –Ω–µ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç, –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é)
                                        const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                                   'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                                   'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                                   'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                                   'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                        const isFooterMenu = footerMenuKeywords.some(keyword => hookText.includes(keyword));
                                        
                                        // –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                        const metadataPatterns = [
                                            /Quality\s*:?\s*[^\n]*/gi,
                                            /Size\s*:?\s*[^\n]*/gi,
                                            /Resolution\s*:?\s*[^\n]*/gi,
                                            /Width\s*:?\s*[^\n]*/gi,
                                            /Height\s*:?\s*[^\n]*/gi,
                                            /Duration\s*:?\s*[^\n]*/gi,
                                            /Format\s*:?\s*[^\n]*/gi,
                                            /Codec\s*:?\s*[^\n]*/gi,
                                            /Frame Rate\s*:?\s*[^\n]*/gi,
                                            /--/g,  // –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                        ];
                                        let cleanedHook = hookText;
                                        for (const pattern of metadataPatterns) {
                                            cleanedHook = cleanedHook.replace(pattern, '');
                                        }
                                        cleanedHook = cleanedHook.replace(/\n{2,}/g, '\n').trim();  // –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                        
                                        if (cleanedHook && cleanedHook.length > 5 && cleanedHook.length < 300 &&
                                            !cleanedHook.includes('Limited Time Offer') &&
                                            !cleanedHook.includes('Annual Plan') &&
                                            !cleanedHook.includes('Promotion Period') &&
                                            !cleanedHook.includes('50% OFF') &&
                                            !cleanedHook.toLowerCase().includes('q4') &&
                                            !cleanedHook.toLowerCase().includes('monthly plan') &&
                                            !isFooterMenu) {
                                            return cleanedHook;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if hook and len(hook) > 5:
                    log.debug("Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript")
                    return hook.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ hook —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ hook: {e}")
            return None
    
    async def _extract_audience(self) -> Optional[Dict[str, str]]:
        """
        –ò–∑–≤–ª–µ—á—å –≤–æ–∑—Ä–∞—Å—Ç –∏–∑ –ø–æ–ª—è Audience
        
        –°—Ç—Ä—É–∫—Ç—É—Ä–∞ HTML:
        <div class="addel-info-item">
            <div class="name"> Audience </div>
            <div class="value">
                <div class="audience-info">
                    <div class="audience-info-info">45-55 ... Android...</div>
                </div>
            </div>
        </div>
        """
        try:
            audience_data = {"age": "N/A", "platform": "N/A"}
            
            # –ú–ï–¢–û–î 1: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                # –ò—â–µ–º –±–ª–æ–∫ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "Audience"
                audience_items = await self.page.query_selector_all('div.addel-info-item')
                
                for item in audience_items:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å Audience
                    name_elem = await item.query_selector('div.name')
                    if name_elem:
                        name_text = await name_elem.inner_text()
                        if 'Audience' in name_text or '–ê—É–¥–∏—Ç–æ—Ä–∏—è' in name_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ audience-info-info
                            audience_info = await item.query_selector('div.audience-info-info')
                            if audience_info:
                                text = await audience_info.inner_text()
                                # –ò–∑–≤–ª–µ–∫–∞–µ–º –≤–æ–∑—Ä–∞—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ "45-55" (–º–æ–∂–µ—Ç –±—ã—Ç—å 2 —Ü–∏—Ñ—Ä—ã)
                                age_match = re.search(r'(\d{1,2}-\d{1,2})', text)
                                if age_match:
                                    audience_data["age"] = age_match.group(1)
                                    log.debug(f"      ‚Üí Audience age –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä: {audience_data['age']}")
                                    return audience_data
            except Exception as e:
                log.debug(f"      ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–º –ø–æ–∏—Å–∫–µ audience: {e}")
            
            # –ú–ï–¢–û–î 2: Fallback —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (–µ—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª)
            audience_keywords = ["Audience", "–ê—É–¥–∏—Ç–æ—Ä–∏—è", "Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è"]
            
            for keyword in audience_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç –∞—É–¥–∏—Ç–æ—Ä–∏–∏ —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º –≤–æ–∑—Ä–∞—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ "25-35" –∏–ª–∏ "45-55"
                        age_patterns = [
                            r'–í–æ–∑—Ä–∞—Å—Ç[:\s]+(\d{1,2}-\d{1,2})',
                            r'Age[:\s]+(\d{1,2}-\d{1,2})',
                            r'(\d{1,2}-\d{1,2})',  # –ü—Ä–æ—Å—Ç–æ –≤–æ–∑—Ä–∞—Å—Ç
                        ]
                        
                        for pattern in age_patterns:
                            age_match = re.search(pattern, text, re.IGNORECASE)
                            if age_match:
                                audience_data["age"] = age_match.group(1)
                                log.debug(f"      ‚Üí Audience age –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä: {audience_data['age']}")
                                break
                        
                        if audience_data["age"] != "N/A":
                            return audience_data
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π)
            try:
                result = await self.page.evaluate("""
                    () => {
                        const keywords = ['Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 'Audience', '–ê—É–¥–∏—Ç–æ—Ä–∏—è'];
                        const agePattern = /(\\d{1,2}-\\d{1,2})/;
                        const platformKeywords = ['Android', 'iOS', 'iPhone', 'iPad'];
                        const countryKeywords = ['USA', 'US', 'United States', '–†–æ—Å—Å–∏—è', 'Russia', 'Philippines', 
                                                '–§–∏–ª–∏–ø–ø–∏–Ω—ã', 'China', '–ö–∏—Ç–∞–π', 'India', '–ò–Ω–¥–∏—è'];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    const result = {age: 'N/A', platform: 'N/A', country: 'N/A'};
                                    
                                    // –ò—â–µ–º –≤–æ–∑—Ä–∞—Å—Ç
                                    const ageMatch = text.match(agePattern);
                                    if (ageMatch) {
                                        result.age = ageMatch[1];
                                    }
                                    
                                    // –ò—â–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
                                    for (const platform of platformKeywords) {
                                        if (text.includes(platform)) {
                                            result.platform = (platform === 'iOS' || platform === 'iPhone' || platform === 'iPad') ? 'iOS' : 'Android';
                                            break;
                                        }
                                    }
                                    
                                    // –ò—â–µ–º —Å—Ç—Ä–∞–Ω—É
                                    for (const country of countryKeywords) {
                                        if (text.includes(country)) {
                                            result.country = country;
                                            break;
                                        }
                                    }
                                    
                                    if (result.age !== 'N/A' || result.platform !== 'N/A' || result.country !== 'N/A') {
                                        return result;
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if result:
                    audience_data.update(result)
                    return audience_data
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ audience —á–µ—Ä–µ–∑ JS: {e}")
            
            return audience_data
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–∏: {e}")
            return None
    
    async def _extract_country(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å —Å—Ç—Ä–∞–Ω—É –∏–∑ –ø–æ–ª—è 'Country/Region' –∏–ª–∏ '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω' (–û–¢–î–ï–õ–¨–ù–û –æ—Ç Audience!)"""
        try:
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            try:
                await self.page.wait_for_selector('div.addel-info-item', timeout=5000, state="visible")
            except:
                log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç—ã div.addel-info-item –Ω–µ –ø–æ—è–≤–∏–ª–∏—Å—å –∑–∞ 5 —Å–µ–∫—É–Ω–¥")
            
            country_keywords = ["Country/Region", "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω", "Country", "–°—Ç—Ä–∞–Ω–∞", "Region", "–†–µ–≥–∏–æ–Ω"]
            
            # –ú–ï–¢–û–î 0: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                country_items = await self.page.query_selector_all('div.addel-info-item')
                
                for item in country_items:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å Country/Region
                    name_elem = await item.query_selector('div.name')
                    if name_elem:
                        name_text = await name_elem.inner_text()
                        if 'Country/Region' in name_text or '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω' in name_text or 'Country' in name_text or '–°—Ç—Ä–∞–Ω–∞' in name_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º —Å—Ç—Ä–∞–Ω—É
                            value_elem = await item.query_selector('div.ellipsis, div.value')
                            if value_elem:
                                country_text = await value_elem.inner_text()
                                # –£–±–∏—Ä–∞–µ–º (1) –∏ —Ç.–¥.
                                country = re.sub(r'\([0-9]+\)', '', country_text).strip()
                                if country and len(country) > 0:
                                    log.info(f"      ‚úÖ Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä: {country}")
                                    return country
            except Exception as e:
                log.debug(f"      ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–º –ø–æ–∏—Å–∫–µ country: {e}")
            
            for keyword in country_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω—ã —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º —Å—Ç—Ä–∞–Ω—É (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫)
                        country_patterns = [
                            r'United States(?:\([0-9]+\))?',  # United States(1)
                            r'USA(?:\([0-9]+\))?',
                            r'US(?:\([0-9]+\))?',
                            r'Philippines(?:\([0-9]+\))?',
                            r'–§–∏–ª–∏–ø–ø–∏–Ω—ã(?:\([0-9]+\))?',
                            r'Russia(?:\([0-9]+\))?',
                            r'–†–æ—Å—Å–∏—è(?:\([0-9]+\))?',
                            r'China(?:\([0-9]+\))?',
                            r'–ö–∏—Ç–∞–π(?:\([0-9]+\))?',
                            r'India(?:\([0-9]+\))?',
                            r'–ò–Ω–¥–∏—è(?:\([0-9]+\))?',
                            r'Brazil(?:\([0-9]+\))?',
                            r'–ë—Ä–∞–∑–∏–ª–∏—è(?:\([0-9]+\))?',
                            r'Germany(?:\([0-9]+\))?',
                            r'–ì–µ—Ä–º–∞–Ω–∏—è(?:\([0-9]+\))?',
                            r'France(?:\([0-9]+\))?',
                            r'–§—Ä–∞–Ω—Ü–∏—è(?:\([0-9]+\))?',
                            r'UK(?:\([0-9]+\))?',
                            r'United Kingdom(?:\([0-9]+\))?',
                        ]
                        
                        for pattern in country_patterns:
                            match = re.search(pattern, text, re.IGNORECASE)
                            if match:
                                country = match.group(0)
                                # –£–±–∏—Ä–∞–µ–º (1) –∏ —Ç.–¥.
                                country = re.sub(r'\([0-9]+\)', '', country).strip()
                                log.debug(f"Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}': {country}")
                                return country
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript
            try:
                country = await self.page.evaluate("""
                    () => {
                        const keywords = ['Country/Region', '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω', 'Country', '–°—Ç—Ä–∞–Ω–∞'];
                        const countryPatterns = [
                            /United States(?:\\([0-9]+\\))?/i,
                            /USA(?:\\([0-9]+\\))?/i,
                            /Philippines(?:\\([0-9]+\\))?/i,
                            /Russia(?:\\([0-9]+\\))?/i,
                            /China(?:\\([0-9]+\\))?/i,
                            /India(?:\\([0-9]+\\))?/i
                        ];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    for (const pattern of countryPatterns) {
                                        const match = text.match(pattern);
                                        if (match) {
                                            return match[0].replace(/\\([0-9]+\\)/g, '').trim();
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if country:
                    log.debug(f"Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript: {country}")
                    return country.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ country —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ country: {e}")
            return None
    
    async def _extract_first_seen(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å First seen –≤ —Ñ–æ—Ä–º–∞—Ç–µ 'Oct 27 2025' - —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ 'Oct 28 2025 ~ Nov 10 2025'"""
        try:
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã
            first_seen_keywords = ["First seen - Last seen", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", "First Seen"]
            
            for keyword in first_seen_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç –¥–∞—Ç—ã —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ "Oct 27 2025" –∏–ª–∏ "Oct 27, 2025"
                        # –ò—â–µ–º –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ "Oct 28 2025 ~ Nov 10 2025"
                        date_patterns = [
                            r'([A-Z][a-z]{2}\s+\d{1,2}\s+\d{4})',  # Oct 27 2025
                            r'([A-Z][a-z]{2}\s+\d{1,2},\s+\d{4})',  # Oct 27, 2025
                            r'(\d{1,2}\s+[A-Z][a-z]{2}\s+\d{4})',  # 27 Oct 2025
                        ]
                        
                        for pattern in date_patterns:
                            # –ò—â–µ–º –ø–µ—Ä–≤—É—é –¥–∞—Ç—É (–¥–æ ~ –∏–ª–∏ –∫–æ–Ω—Ü–∞ —Å—Ç—Ä–æ–∫–∏)
                            date_match = re.search(pattern, text)
                            if date_match:
                                date_str = date_match.group(1)
                                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ñ–æ—Ä–º–∞—Ç (—É–±–∏—Ä–∞–µ–º –∑–∞–ø—è—Ç—É—é –µ—Å–ª–∏ –µ—Å—Ç—å)
                                date_str = date_str.replace(',', '').strip()
                                log.debug(f"First seen –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}': {date_str}")
                                return date_str
                        
                        # –¢–∞–∫–∂–µ –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –¥–∞—Ç—É –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
                        if keyword in text:
                            parts = text.split(keyword, 1)
                            if len(parts) > 1:
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–æ ~ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω)
                                after_keyword = parts[1].split('~')[0].strip()
                                for pattern in date_patterns:
                                    date_match = re.search(pattern, after_keyword)
                                    if date_match:
                                        date_str = date_match.group(1).replace(',', '').strip()
                                        log.debug(f"First seen –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ '{keyword}': {date_str}")
                                        return date_str
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                first_seen = await self.page.evaluate("""
                    () => {
                        const keywords = ['First seen - Last seen', 'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 'First Seen'];
                        const datePatterns = [
                            /([A-Z][a-z]{2}\\s+\\d{1,2}\\s+\\d{4})/,  // Oct 27 2025
                            /([A-Z][a-z]{2}\\s+\\d{1,2},\\s+\\d{4})/,  // Oct 27, 2025
                            /(\\d{1,2}\\s+[A-Z][a-z]{2}\\s+\\d{4})/   // 27 Oct 2025
                        ];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    // –ò—â–µ–º –¥–∞—Ç—É –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    const index = text.indexOf(keyword);
                                    let afterKeyword = text.substring(index + keyword.length);
                                    
                                    // –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–æ ~ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω)
                                    if (afterKeyword.includes('~')) {
                                        afterKeyword = afterKeyword.split('~')[0];
                                    }
                                    
                                    for (const pattern of datePatterns) {
                                        const match = afterKeyword.match(pattern);
                                        if (match) {
                                            const dateStr = match[1].replace(',', '').trim();
                                            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤—É—é –Ω–∞–π–¥–µ–Ω–Ω—É—é –¥–∞—Ç—É (–±–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫ - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç –≤ _filter_videos)
                                            return dateStr;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if first_seen:
                    log.debug(f"First seen –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript: {first_seen}")
                    return first_seen.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ first_seen —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ first_seen: {e}")
            return None


```

–ò—Å–ø—Ä–∞–≤–ª—è—é –æ—à–∏–±–∫—É –æ—Ç—Å—Ç—É–ø–∞:


```python
"""
Parser Engine - –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö —Å Pipiads
"""

import asyncio
import re
import time
from typing import List, Dict, Optional, Any
from datetime import datetime

from playwright.async_api import Page, TimeoutError as PlaywrightTimeoutError

from . import config
from . import logger
from . import validator

log = logger.get_logger("ParserEngine")


class ProductData:
    """–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞"""
    def __init__(self):
        self.product_name: str = ""
        self.category: str = ""
        self.pipiads_link: str = ""
        self.videos: List[Dict[str, Any]] = []


class ParserEngine:
    """–ü–∞—Ä—Å–µ—Ä –¥–∞–Ω–Ω—ã—Ö —Å Pipiads"""
    
    def __init__(self, page: Page):
        self.page = page
        self.browser_manager = None  # –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ human_delay
    
    def set_browser_manager(self, browser_manager):
        """–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ browser_manager –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è human_delay"""
        self.browser_manager = browser_manager
    
    async def human_delay(self, min_seconds: float = 1, max_seconds: float = 3):
        """–ò–º–∏—Ç–∞—Ü–∏—è —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏"""
        if self.browser_manager:
            await self.browser_manager.human_delay(min_seconds, max_seconds)
        else:
            delay = asyncio.sleep(1)  # Fallback
            await delay
    
    async def scroll_to_element(self, selector: str, timeout: int = 10000):
        """
        –°–∫—Ä–æ–ª–ª–∏—Ç—å –¥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
        
        Args:
            selector: –°–µ–ª–µ–∫—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞
            timeout: –¢–∞–π–º–∞—É—Ç –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
        """
        try:
            element = await self.page.wait_for_selector(selector, timeout=timeout, state="visible")
            if element:
                await element.scroll_into_view_if_needed()
                await self.human_delay(0.5, 1)
                return True
        except:
            pass
        return False
    
    async def get_products_from_search_page(self, count: int = 3) -> List[Dict[str, str]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞
        
        Args:
            count: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ (–¥–ª—è MVP-0: 1, –ø–æ—Ç–æ–º —Ä–∞—Å—à–∏—Ä–∏–º –¥–æ 3)
        
        Returns:
            –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–æ–≤: [{"name": "...", "category": "...", "url": "..."}]
        """
        log.info(f"–ü–æ–ª—É—á–µ–Ω–∏–µ {count} —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞...")
        
        try:
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (domcontentloaded –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º networkidle)
            await self.page.wait_for_load_state("domcontentloaded")
            await self.human_delay(2, 3)
            
            # –°–∫—Ä–æ–ª–ª–∏–º –≤–Ω–∏–∑, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
            log.info("–°–∫—Ä–æ–ª–ª–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤...")
            for i in range(3):  # –°–∫—Ä–æ–ª–ª–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
                await self.page.evaluate("window.scrollBy(0, 500)")
                await self.human_delay(1, 2)
            
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤
            await self.human_delay(2, 3)
            
            # –ò—â–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ - –ø—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
            product_selectors = [
                'a[href*="/tiktok-shop-product/"]',
                '[class*="product"]',
                '[class*="card"]',
                'div[class*="item"]',
            ]
            
            products = []
            product_ids = set()  # –î–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ product_id
            
            def extract_product_id(url: str) -> str:
                """–ò–∑–≤–ª–µ—á—å product_id –∏–∑ URL"""
                # https://www.pipiads.com/tiktok-shop-product/1729732622305364547/
                # ‚Üí 1729732622305364547
                url_normalized = url.rstrip('/')
                parts = url_normalized.split('/')
                return parts[-1] if parts else ""
            
            for selector in product_selectors:
                try:
                    elements = await self.page.query_selector_all(selector)
                    log.info(f"üîç –ù–∞–π–¥–µ–Ω–æ {len(elements)} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º '{selector}'")
                    
                    for element in elements:
                        if len(products) >= count:
                            break
                        
                        try:
                            # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É
                            href = await element.get_attribute("href")
                            if not href:
                                # –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ —Å—Å—ã–ª–∫–∞, –∏—â–µ–º —Å—Å—ã–ª–∫—É –≤–Ω—É—Ç—Ä–∏
                                link_element = await element.query_selector('a[href*="/tiktok-shop-product/"]')
                                if link_element:
                                    href = await link_element.get_attribute("href")
                            
                            if href and "/tiktok-shop-product/" in href:
                                # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π URL
                                if href.startswith("/"):
                                    url = f"https://www.pipiads.com{href}"
                                elif href.startswith("http"):
                                    url = href
                                else:
                                    url = f"https://www.pipiads.com/{href}"
                                
                                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º URL (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ)
                                url = url.rstrip('/')
                                
                                # –ò–∑–≤–ª–µ–∫–∞–µ–º product_id –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
                                product_id = extract_product_id(url)
                                
                                if not product_id:
                                    log.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å product_id –∏–∑ URL: {url}")
                                    continue
                                
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä (–ø–æ product_id)
                                if product_id in product_ids:
                                    log.info(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id={product_id}): {url}")
                                    continue
                                
                                product_ids.add(product_id)
                                log.info(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #{len(products) + 1}: product_id={product_id}, url={url}")
                                
                                # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
                                name = ""
                                name_selectors = [
                                    'h1', 'h2', 'h3',
                                    '[class*="title"]',
                                    '[class*="name"]',
                                    'a',
                                ]
                                
                                for name_sel in name_selectors:
                                    try:
                                        name_elem = await element.query_selector(name_sel)
                                        if name_elem:
                                            name = await name_elem.inner_text()
                                            if name and len(name) > 5:  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏—è
                                                break
                                    except:
                                        continue
                                
                                # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                                category = ""
                                category_selectors = [
                                    '[class*="category"]',
                                    '[class*="tag"]',
                                    'span',
                                ]
                                
                                for cat_sel in category_selectors:
                                    try:
                                        cat_elem = await element.query_selector(cat_sel)
                                        if cat_elem:
                                            text = await cat_elem.inner_text()
                                            if text and len(text) < 50:  # –ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±—ã—á–Ω–æ –∫–æ—Ä–æ—Ç–∫–∞—è
                                                category = text
                                                break
                                    except:
                                        continue
                                
                                if url and product_id:
                                    products.append({
                                        "name": name.strip() if name else "N/A",
                                        "category": category.strip() if category else "N/A",
                                        "url": url,
                                        "product_id": product_id  # –î–æ–±–∞–≤–ª—è–µ–º product_id –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
                                    })
                                    log.info(f"   üì¶ –¢–æ–≤–∞—Ä {len(products)}: {name[:50] if name else 'N/A'}... (ID: {product_id})")
                                
                        except Exception as e:
                            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —ç–ª–µ–º–µ–Ω—Ç–∞: {e}")
                            continue
                    
                    if len(products) >= count:
                        break
                        
                except Exception as e:
                    log.debug(f"–û—à–∏–±–∫–∞ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º {selector}: {e}")
                    continue
            
            if len(products) < count:
                log.warning(f"–ù–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ {count} –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã—Ö")
            
            log.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤")
            return products[:count]
            
        except Exception as e:
            log.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
            import traceback
            log.error(traceback.format_exc())
            return []
    
    async def get_product_details(self, product_url: str, sheets_writer=None) -> ProductData:
        """
        –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞ –∏ –≤–∏–¥–µ–æ
        
        Args:
            product_url: URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞
        
        Returns:
            ProductData —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞ –∏ –≤–∏–¥–µ–æ
        """
        log.info("=" * 80)
        log.info(f"üîÑ –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–ê")
        log.info(f"URL: {product_url}")
        log.info("=" * 80)
        
        product_data = ProductData()
        product_data.pipiads_link = product_url
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è page
        if not self.page:
            log.error("‚ùå –û–®–ò–ë–ö–ê: page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
            return product_data
        
        try:
            # –®–ê–ì 1: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞
            log.info("\nüìå –®–ê–ì 1: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞...")
            try:
                log.info(f"  ‚Üí –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {product_url}")
                if not self.page:
                    raise Exception("Page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
                await self.page.goto(product_url, wait_until="domcontentloaded", timeout=30000)
                log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            except Exception as e:
                log.error(f"  ‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {e}")
                log.error(f"  ‚Üí –¢–∏–ø –æ—à–∏–±–∫–∏: {type(e).__name__}")
                import traceback
                log.error(f"  ‚Üí –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:\n{traceback.format_exc()}")
                # –ü—Ä–æ–±—É–µ–º –ø–æ–¥–æ–∂–¥–∞—Ç—å –µ—â–µ –Ω–µ–º–Ω–æ–≥–æ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                try:
                    await self.human_delay(2, 3)
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Å–µ –µ—â–µ –¥–æ—Å—Ç—É–ø–Ω–∞
                    if self.page:
                        current_url = self.page.url
                        log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
                except Exception as e2:
                    log.error(f"  ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e2}")
                    return product_data
            
            try:
                await self.human_delay(0.5, 1)
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–¥–µ—Ä–∂–∫–µ: {e}")
            
            # –®–ê–ì 1.5: –ü–µ—Ä–µ–≤–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫
            log.info("\nüìå –®–ê–ì 1.5: –ü–µ—Ä–µ–≤–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫...")
            try:
                current_url = self.page.url
                log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
                
                # –ï—Å–ª–∏ URL —Å–æ–¥–µ—Ä–∂–∏—Ç /ru/, –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ /en/
                if "/ru/" in current_url:
                    english_url = current_url.replace("/ru/", "/en/")
                    log.info(f"  ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫—É—é –≤–µ—Ä—Å–∏—é: {english_url}")
                    await self.page.goto(english_url, wait_until="domcontentloaded", timeout=30000)
                    await self.human_delay(1, 2)
                    log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π")
                else:
                    # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞
                    log.info("  ‚Üí –ü–æ–∏—Å–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —è–∑—ã–∫–∞...")
                    lang_selectors = [
                        'a[href*="/en/"]',
                        'button:has-text("English")',
                        '[class*="language"]',
                        '[class*="lang"]',
                        'select[name*="lang"]',
                    ]
                    
                    lang_found = False
                    for selector in lang_selectors:
                        try:
                            lang_element = await self.page.query_selector(selector)
                            if lang_element:
                                is_visible = await lang_element.is_visible()
                                if is_visible:
                                    await lang_element.click()
                                    await self.human_delay(1, 2)
                                    log.info(f"  ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ –Ω–∞–π–¥–µ–Ω –∏ –Ω–∞–∂–∞—Ç: {selector}")
                                    lang_found = True
                                    break
                        except:
                            continue
                    
                    if not lang_found:
                        log.warning("  ‚ö†Ô∏è –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –Ω–∞ —Ç–µ–∫—É—â–µ–º —è–∑—ã–∫–µ")
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            # –®–ê–ì 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Product Name
            log.info("\nüìå –®–ê–ì 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Product Name...")
            try:
                # –°–∫—Ä–æ–ª–ª–∏–º –≤–≤–µ—Ä—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
                log.info("  ‚Üí –°–∫—Ä–æ–ª–ª–∏–º –≤–≤–µ—Ä—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞...")
                if not self.page:
                    raise Exception("Page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
                await self.page.evaluate("window.scrollTo(0, 0)")
                await self.human_delay(0.3, 0.5)
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ: {e}")
                # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É
            
            # –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ - –ø—Ä–æ–±—É–µ–º –±–æ–ª—å—à–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –∏ –º–µ—Ç–æ–¥–æ–≤
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã...")
            try:
                # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
                name_selectors = [
                    'h1:first-of-type',
                    'h1[class*="product"]',
                    'h1[class*="title"]',
                    '[class*="product-title"]',
                    '[class*="product-name"]',
                    '[class*="product_title"]',
                    '[class*="product_name"]',
                    'h1',
                    'h2:first-of-type',
                    '[data-testid*="title"]',
                    '[data-testid*="name"]',
                    '[data-testid*="product-title"]',
                ]
                
                for selector in name_selectors:
                    try:
                        elements = await self.page.query_selector_all(selector)
                        for element in elements:
                            name = await element.inner_text()
                            if name and len(name) > 3:
                                # –§–∏–ª—å—Ç—Ä—É–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã
                                name_lower = name.lower()
                                skip_words = ['–æ—Å—Ç–∞—Ç–æ–∫', 'remain', 'stock', '–º–µ—Å—è—Ü', 'month', '–∫–æ–º–∏—Å—Å–∏—è', 'commission', 
                                            'tiktok shop product detail', 'category', '–∫–∞—Ç–µ–≥–æ—Ä–∏—è']
                                if any(skip in name_lower for skip in skip_words):
                                    continue
                                # –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å "TikTok Shop Product Detail:" –µ—Å–ª–∏ –µ—Å—Ç—å
                                if "TikTok Shop Product Detail:" in name:
                                    name = name.split("TikTok Shop Product Detail:")[-1].strip()
                                # –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
                                if name.lower().startswith('tiktok shop product'):
                                    name = re.sub(r'^tiktok shop product\s*:?\s*', '', name, flags=re.IGNORECASE).strip()
                                if name.lower().endswith('tiktok shop product'):
                                    name = re.sub(r'\s*tiktok shop product\s*$', '', name, flags=re.IGNORECASE).strip()
                                # –£–±–∏—Ä–∞–µ–º, –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ "TikTok Shop Product"
                                if name.lower() == 'tiktok shop product' or name.lower() == 'tiktok shop product detail':
                                    continue
                                if ":" in name and len(name.split(":")[0]) < 20:
                                    name = name.split(":", 1)[-1].strip()
                                product_data.product_name = name.strip()
                                if len(product_data.product_name) > 5:
                                    log.info(f"  ‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞–π–¥–µ–Ω–æ: {product_data.product_name[:50]}...")
                                    break
                        if product_data.product_name and len(product_data.product_name) > 5:
                            break
                    except:
                        continue
                
                # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
                if not product_data.product_name or len(product_data.product_name) <= 5:
                    try:
                        product_name = await self.page.evaluate("""
                            () => {
                                // –ò—â–µ–º h1
                                const h1 = document.querySelector('h1');
                                if (h1) {
                                    const text = h1.innerText.trim();
                                    if (text && text.length > 5 && !text.toLowerCase().includes('tiktok shop product detail')) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º –≤ —ç–ª–µ–º–µ–Ω—Ç–∞—Ö —Å –∫–ª–∞—Å—Å–æ–º product
                                const productElements = document.querySelectorAll('[class*="product"][class*="title"], [class*="product"][class*="name"]');
                                for (const el of productElements) {
                                    const text = el.innerText.trim();
                                    if (text && text.length > 5) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º —Å–∞–º—ã–π –±–æ–ª—å—à–æ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–æ–±—ã—á–Ω–æ —ç—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞)
                                // –ù–û –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã —Ç–∏–ø–∞ "Ad Analysis"
                                const headings = document.querySelectorAll('h1, h2, h3');
                                let maxLength = 0;
                                let bestHeading = null;
                                for (const h of headings) {
                                    const text = h.innerText.trim();
                                    const skipWords = ['tiktok', 'shop', 'product', 'detail', 'category', 'commission', 
                                                      '–æ—Å—Ç–∞—Ç–æ–∫', 'remain', 'stock', 'ad analysis', 'analysis', 
                                                      'limited time', 'promotion', 'annual plan', 'tiktok shop product'];
                                    const textLower = text.toLowerCase();
                                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã (–º–µ–Ω—å—à–µ 20 —Å–∏–º–≤–æ–ª–æ–≤) - —ç—Ç–æ –æ–±—ã—á–Ω–æ –Ω–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
                                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º "TikTok Shop Product" –∏ –ø–æ—Ö–æ–∂–∏–µ —Ç–µ–∫—Å—Ç—ã
                                    if (!skipWords.some(word => textLower.includes(word)) && 
                                        text.length > maxLength && text.length > 20 &&
                                        !textLower.includes('tiktok shop product')) {
                                        maxLength = text.length;
                                        bestHeading = text;
                                    }
                                }
                                if (bestHeading) {
                                    return bestHeading;
                                }
                                
                                // –ò—â–µ–º –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–∞—Ö - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ–±—ã—á–Ω–æ –¥–ª–∏–Ω–Ω–æ–µ
                                // –ù–∞–ø—Ä–∏–º–µ—Ä: "[BUY 1 TAKE 11] SHEEureka Scrub Facial Cleanser..."
                                // –ù–û –∏—Å–∫–ª—é—á–∞–µ–º —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                           'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                           'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                           'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                           'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                const textBlocks = document.querySelectorAll('p, div, span');
                                for (const block of textBlocks) {
                                    const text = block.innerText.trim();
                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    const isFooterMenu = footerMenuKeywords.some(keyword => text.includes(keyword));
                                    if (isFooterMenu) continue;
                                    
                                    // –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ–±—ã—á–Ω–æ –¥–ª–∏–Ω–Ω–æ–µ (–±–æ–ª—å—à–µ 30 —Å–∏–º–≤–æ–ª–æ–≤) –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–æ–≤–∞ —Ç–∏–ø–∞ "Set", "Kit", "Mask" –∏ —Ç.–¥.
                                    // –ò–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å "[" (–Ω–∞–ø—Ä–∏–º–µ—Ä "[BUY 1 TAKE 11]")
                                    if (text.length > 30 && text.length < 500 && 
                                        !text.toLowerCase().includes('ad analysis') &&
                                        !text.toLowerCase().includes('limited time') &&
                                        !text.toLowerCase().includes('promotion') &&
                                        !text.toLowerCase().includes('annual plan') &&
                                        (text.startsWith('[') || text.includes('Set') || text.includes('Kit') || 
                                         text.includes('Mask') || text.includes('Cleanser') || text.includes('Gift') ||
                                         text.includes('Scrub') || text.includes('Facial') || text.includes('Repairing'))) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º –≤ –º–µ—Ç–∞-—Ç–µ–≥–∞—Ö
                                const ogTitle = document.querySelector('meta[property="og:title"]');
                                if (ogTitle && ogTitle.content) {
                                    let title = ogTitle.content;
                                    if (title.includes('TikTok Shop Product Detail:')) {
                                        title = title.split('TikTok Shop Product Detail:')[1].trim();
                                    }
                                    // –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞
                                    if (title.toLowerCase().startsWith('tiktok shop product')) {
                                        title = title.replace(/^tiktok shop product\s*:?\s*/i, '').trim();
                                    }
                                    if (title && title.length > 5 && !title.toLowerCase().includes('tiktok shop product')) {
                                        return title;
                                    }
                                }
                                
                                return null;
                            }
                        """)
                        if product_name and len(product_name) > 5:
                            product_name = product_name.strip()
                            # –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
                            if product_name.lower().startswith('tiktok shop product'):
                                product_name = re.sub(r'^tiktok shop product\s*:?\s*', '', product_name, flags=re.IGNORECASE).strip()
                            if product_name.lower().endswith('tiktok shop product'):
                                product_name = re.sub(r'\s*tiktok shop product\s*$', '', product_name, flags=re.IGNORECASE).strip()
                            # –£–±–∏—Ä–∞–µ–º, –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ "TikTok Shop Product"
                            if product_name.lower() == 'tiktok shop product' or product_name.lower() == 'tiktok shop product detail':
                                product_name = None
                            if product_name and len(product_name) > 5:
                                product_data.product_name = product_name
                                log.info(f"  ‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞–π–¥–µ–Ω–æ (—á–µ—Ä–µ–∑ JS): {product_data.product_name[:50]}...")
                    except Exception as e:
                        log.debug(f"  ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —á–µ—Ä–µ–∑ JS: {e}")
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞: {e}")
            
            if not product_data.product_name or len(product_data.product_name) <= 5:
                log.warning("  ‚ö†Ô∏è –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                product_data.product_name = "N/A"
            
            # –®–ê–ì 3: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Category
            log.info("\nüìå –®–ê–ì 3: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Category...")
            try:
                log.info("  ‚Üí –ü–æ–∏—Å–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–∞...")
                
                # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
                category_selectors = [
                    '[class*="category"]',
                    '[class*="tag"]',
                    'span:has-text("Category")',
                    'span:has-text("–ö–∞—Ç–µ–≥–æ—Ä–∏—è")',
                    'text=/Category/i',
                    'text=/–ö–∞—Ç–µ–≥–æ—Ä–∏—è/i',
                    'div:has-text("Category")',
                    'div:has-text("–ö–∞—Ç–µ–≥–æ—Ä–∏—è")',
                ]
                
                for selector in category_selectors:
                    try:
                        elements = await self.page.query_selector_all(selector)
                        for element in elements:
                            category = await element.inner_text()
                            if category:
                                # –û—á–∏—â–∞–µ–º –æ—Ç –ª–∏—à–Ω–µ–≥–æ —Ç–µ–∫—Å—Ç–∞
                                category = re.sub(r'Category\s*:', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'–ö–∞—Ç–µ–≥–æ—Ä–∏—è\s*:', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'Commission\s*Rate\s*:.*', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'–ö–æ–º–∏—Å—Å–∏—è\s*:.*', '', category, flags=re.IGNORECASE)
                                # –£–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä "15.00%")
                                category = re.sub(r'\s*\d+\.?\d*\s*%', '', category)
                                # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ —Å–∏–º–≤–æ–ª—ã > –∏ –ø—Ä–æ–±–µ–ª—ã
                                category = re.sub(r'\s*>\s*', ' > ', category)
                                category = category.strip()
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é —á–∞—Å—Ç—å –¥–æ "Commission" –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É
                                if "Commission" in category or "–ö–æ–º–∏—Å—Å–∏—è" in category:
                                    category = category.split("Commission")[0].split("–ö–æ–º–∏—Å—Å–∏—è")[0].strip()
                                if len(category) > 100:
                                    category = category[:100]
                                if category and len(category) > 3:
                                    product_data.category = category
                                    log.info(f"  ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–∞: {product_data.category}")
                                    break
                        if product_data.category:
                            break
                    except:
                        continue
                
                # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π)
                if not product_data.category:
                    try:
                        category = await self.page.evaluate("""
                            () => {
                                // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Category" –∏–ª–∏ "–ö–∞—Ç–µ–≥–æ—Ä–∏—è"
                                const allElements = document.querySelectorAll('*');
                                for (const el of allElements) {
                                    const text = el.innerText || '';
                                    if (text.includes('Category') || text.includes('–ö–∞—Ç–µ–≥–æ—Ä–∏—è')) {
                                        // –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ—Å–ª–µ "Category:" –∏–ª–∏ "–ö–∞—Ç–µ–≥–æ—Ä–∏—è:"
                                        let categoryText = text;
                                        if (categoryText.includes('Category:')) {
                                            categoryText = categoryText.split('Category:')[1];
                                        } else if (categoryText.includes('–ö–∞—Ç–µ–≥–æ—Ä–∏—è:')) {
                                            categoryText = categoryText.split('–ö–∞—Ç–µ–≥–æ—Ä–∏—è:')[1];
                                        }
                                        
                                        // –£–±–∏—Ä–∞–µ–º "Commission Rate" –∏ –≤—Å–µ –ø–æ—Å–ª–µ
                                        if (categoryText.includes('Commission Rate') || categoryText.includes('–ö–æ–º–∏—Å—Å–∏—è')) {
                                            categoryText = categoryText.split('Commission Rate')[0].split('–ö–æ–º–∏—Å—Å–∏—è')[0];
                                        }
                                        
                                        // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä "15.00%")
                                        categoryText = categoryText.replace(/\s*\d+\.?\d*\s*%/g, '');
                                        
                                        categoryText = categoryText.trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é (—Å–æ–¥–µ—Ä–∂–∏—Ç ">" –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–æ–≤)
                                        if (categoryText && categoryText.length > 3 && 
                                            (categoryText.includes('>') || categoryText.split(' ').length >= 2)) {
                                            return categoryText.substring(0, 100);
                                        }
                                    }
                                }
                                return null;
                            }
                        """)
                        if category and len(category) > 3:
                            product_data.category = category.strip()
                            log.info(f"  ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–∞ (—á–µ—Ä–µ–∑ JS): {product_data.category}")
                    except Exception as e:
                        log.debug(f"  ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ JS: {e}")
                
                if not product_data.category:
                    log.warning("  ‚ö†Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ 'N/A'")
                    product_data.category = "N/A"
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {e}")
                product_data.category = "N/A"
            
            # –®–ê–ì 3.5: –ó–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets (–µ—Å–ª–∏ sheets_writer –ø–µ—Ä–µ–¥–∞–Ω)
            # –í–ê–ñ–ù–û: –ï—Å–ª–∏ —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ
            if sheets_writer:
                log.info("\nüìå –®–ê–ì 3.5: –ó–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets...")
                try:
                    row_number = sheets_writer.write_basic_product_data(
                        product_data.product_name,
                        product_data.category,
                        product_data.pipiads_link
                    )
                    if row_number > 0:
                        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ
                        product_data._sheets_row = row_number
                        log.info(f"  ‚úÖ –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {row_number})")
                    else:
                        # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–≤–æ–∑–º–æ–∂–Ω–æ, —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã),
                        # –Ω–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö
                        log.warning("  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–≤–æ–∑–º–æ–∂–Ω–æ, —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã)")
                        log.info("  ‚Üí –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö...")
                        row_number = sheets_writer.find_next_empty_row()
                        product_data._sheets_row = row_number
                        log.info(f"  ‚úÖ –ë—É–¥–µ–º –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫—É {row_number}")
                except Exception as e:
                    log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö: {e}")
                    # –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ
                    try:
                        row_number = sheets_writer.find_next_empty_row()
                        product_data._sheets_row = row_number
                        log.info(f"  ‚Üí –ë—É–¥–µ–º –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫—É {row_number}")
                    except:
                        pass
            
            # –®–ê–ì 4: –ü–æ–∏—Å–∫ –±–ª–æ–∫–∞ "TikTok Ads"
            log.info("\nüìå –®–ê–ì 4: –ü–æ–∏—Å–∫ –±–ª–æ–∫–∞ 'TikTok Ads'...")
            log.info("  ‚Üí –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–Ω–∏–∑ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞...")
            
            # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–Ω–∏–∑, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç
            # –ë–ª–æ–∫ "TikTok Ads" –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            try:
                log.info("  ‚Üí –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–Ω–∏–∑ (–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ)...")
                # –ü–æ–ª—É—á–∞–µ–º –≤—ã—Å–æ—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                page_height = await self.page.evaluate("document.body.scrollHeight")
                viewport_height = await self.page.evaluate("window.innerHeight")
                log.info(f"  ‚Üí –í—ã—Å–æ—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {page_height}px, –≤—ã—Å–æ—Ç–∞ viewport: {viewport_height}px")
                
                # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ (–∫–∞–∫ —á–µ–ª–æ–≤–µ–∫)
                scroll_steps = max(3, page_height // viewport_height)
                scroll_step = page_height // scroll_steps
                
                for step in range(scroll_steps):
                    scroll_position = scroll_step * (step + 1)
                    await self.page.evaluate(f"window.scrollTo(0, {scroll_position})")
                    await self.human_delay(0.3, 0.5)
                    log.debug(f"  ‚Üí –ü—Ä–æ–∫—Ä—É—Ç–∫–∞: {scroll_position}/{page_height}px")
                
                # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ —Å–∞–º–æ–≥–æ –Ω–∏–∑–∞
                await self.page.evaluate("window.scrollTo(0, document.body.scrollHeight)")
                await self.human_delay(1, 2)  # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–∫—Ä—É—á–µ–Ω–∞ –≤–Ω–∏–∑")
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            log.info("  ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (–∫–∞–∫ Ctrl+F)...")
            tiktok_ads_found = False
            tiktok_ads_element = None
            
            # –°–Ω–∞—á–∞–ª–∞ –∂–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            await self.human_delay(0.5, 1)
            
            # –í–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
            tiktok_ads_texts = [
                "TikTok Ads",  # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π
                "–†–µ–∫–ª–∞–º–∞ –¢–∏–∫–¢–æ–∫",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 1
                "–†–µ–∫–ª–∞–º–∞ TikTok",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 2
                "TikTok –†–µ–∫–ª–∞–º–∞",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 3
            ]
            
            # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –±–ª–æ–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä —Å —Ç–µ–∫—Å—Ç–æ–º (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±)
            log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ Playwright locator...")
            for text_variant in tiktok_ads_texts:
                try:
                    # –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Ç–µ–∫—Å—Ç (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ)
                    locator = self.page.locator(f'text=/{text_variant}/i').first
                    if await locator.count() > 0:
                        tiktok_ads_element = await locator.element_handle()
                        if tiktok_ads_element:
                            # –°–∫—Ä–æ–ª–ª–∏–º –∫ —ç–ª–µ–º–µ–Ω—Ç—É
                            await tiktok_ads_element.scroll_into_view_if_needed()
                            await self.human_delay(0.3, 0.5)
                            tiktok_ads_found = True
                            log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ Playwright locator")
                            break
                except Exception as e:
                    log.debug(f"–ü–æ–∏—Å–∫ '{text_variant}' —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä –Ω–µ —É–¥–∞–ª—Å—è: {e}")
                    continue
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ JavaScript –ø–æ–∏—Å–∫ (–∫–∞–∫ Ctrl+F)
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript TreeWalker...")
                for text_variant in tiktok_ads_texts:
                    try:
                        # –ò—Å–ø–æ–ª—å–∑—É–µ–º JavaScript –¥–ª—è –ø–æ–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å —Ç–µ–∫—Å—Ç–æ–º
                        # –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è regex
                        escaped_text = text_variant.replace("\\", "\\\\").replace("/", "\\/")
                        tiktok_ads_element = await self.page.evaluate_handle(f"""
                            () => {{
                                const walker = document.createTreeWalker(
                                    document.body,
                                    NodeFilter.SHOW_TEXT,
                                    null,
                                    false
                                );
                                
                                let node;
                                while (node = walker.nextNode()) {{
                                    if (node.textContent && /{escaped_text}/i.test(node.textContent)) {{
                                        // –ù–∞—Ö–æ–¥–∏–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç
                                        let parent = node.parentElement;
                                        while (parent && parent !== document.body) {{
                                            if (parent.offsetHeight > 0 && parent.offsetWidth > 0) {{
                                                return parent;
                                            }}
                                            parent = parent.parentElement;
                                        }}
                                    }}
                                }}
                                return null;
                            }}
                        """)
                        
                        if tiktok_ads_element and await tiktok_ads_element.as_element():
                            element = await tiktok_ads_element.as_element()
                            await element.scroll_into_view_if_needed()
                            await self.human_delay(0.3, 0.5)
                            tiktok_ads_found = True
                            log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript TreeWalker")
                            break
                    except Exception as e:
                        log.debug(f"JavaScript –ø–æ–∏—Å–∫ '{text_variant}' –Ω–µ —É–¥–∞–ª—Å—è: {e}")
                        continue
            
            # –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ query_selector
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 3: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ query_selector —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ —Ç–µ–∫—Å—Ç–∞...")
                try:
                    # –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
                    text_variants = []
                    for text in tiktok_ads_texts:
                        text_variants.extend([
                            f'text="{text}"',
                            f'text={text}',
                            f'*:has-text("{text}")',
                        ])
                    
                    for variant in text_variants:
                        try:
                            element = await self.page.query_selector(variant)
                            if element:
                                is_visible = await element.is_visible()
                                if is_visible:
                                    await element.scroll_into_view_if_needed()
                                    await self.human_delay(0.3, 0.5)
                                    tiktok_ads_found = True
                                    tiktok_ads_element = element
                                    log.info(f"  ‚úÖ –ë–ª–æ–∫ –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ query_selector: {variant}")
                                    break
                        except:
                            continue
                except Exception as e:
                    log.debug(f"Query selector –ø–æ–∏—Å–∫ –Ω–µ —É–¥–∞–ª—Å—è: {e}")
            
            # –ü–æ–ø—ã—Ç–∫–∞ 4: –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –µ—â–µ —Ä–∞–∑ –∏ –ø–æ–∏—Å–∫–∞—Ç—å —Å–Ω–æ–≤–∞
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 4: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∏ –ø–æ–∏—Å–∫...")
                try:
                    # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –µ—â–µ —Ä–∞–∑ –º–µ–¥–ª–µ–Ω–Ω–æ
                    await self.page.evaluate("window.scrollTo(0, 0)")  # –í –Ω–∞—á–∞–ª–æ
                    await self.human_delay(0.5, 1)
                    
                    # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑ –º–µ–¥–ª–µ–Ω–Ω–æ, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è—Å—å –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
                    page_height = await self.page.evaluate("document.body.scrollHeight")
                    scroll_increment = 300  # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –ø–æ 300px
                    
                    for scroll_pos in range(0, page_height, scroll_increment):
                        await self.page.evaluate(f"window.scrollTo(0, {scroll_pos})")
                        await self.human_delay(0.2, 0.3)
                        
                        # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –Ω–∞ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ (–≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞)
                        for text_variant in tiktok_ads_texts:
                            try:
                                # –ó–∞–º–µ–Ω—è–µ–º –ø—Ä–æ–±–µ–ª—ã –Ω–∞ \s+ –¥–ª—è regex
                                regex_pattern = text_variant.replace(" ", "\\s+")
                                locator = self.page.locator(f'text=/{regex_pattern}/i').first
                                if await locator.count() > 0:
                                    tiktok_ads_element = await locator.element_handle()
                                    if tiktok_ads_element:
                                        await tiktok_ads_element.scroll_into_view_if_needed()
                                        await self.human_delay(0.3, 0.5)
                                        tiktok_ads_found = True
                                        log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ {scroll_pos}px")
                                        break
                            except:
                                continue
                        
                        if tiktok_ads_found:
                            break
                    
                    if not tiktok_ads_found:
                        # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ —Å–∞–º–æ–≥–æ –Ω–∏–∑–∞ –µ—â–µ —Ä–∞–∑
                        await self.page.evaluate("window.scrollTo(0, document.body.scrollHeight)")
                        await self.human_delay(1, 2)
                        
                        # –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–∏—Å–∫–∞ (–≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞)
                        for text_variant in tiktok_ads_texts:
                            try:
                                # –ó–∞–º–µ–Ω—è–µ–º –ø—Ä–æ–±–µ–ª—ã –Ω–∞ \s+ –¥–ª—è regex
                                regex_pattern = text_variant.replace(" ", "\\s+")
                                locator = self.page.locator(f'text=/{regex_pattern}/i').first
                                if await locator.count() > 0:
                                    tiktok_ads_element = await locator.element_handle()
                                    if tiktok_ads_element:
                                        await tiktok_ads_element.scroll_into_view_if_needed()
                                        await self.human_delay(0.3, 0.5)
                                        tiktok_ads_found = True
                                        log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω –≤ —Å–∞–º–æ–º –Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã")
                                        break
                            except:
                                continue
                except Exception as e:
                    log.debug(f"–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –Ω–µ –ø–æ–º–æ–≥–ª–∞: {e}")
            
            if not tiktok_ads_found:
                log.error("  ‚ùå –ë–ª–æ–∫ 'TikTok Ads' –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫")
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                try:
                    screenshot_path = config.SCREENSHOTS_DIR / f"tiktok_ads_not_found_{int(time.time())}.png"
                    await self.page.screenshot(path=str(screenshot_path), full_page=True)
                    log.info(f"  üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {screenshot_path}")
                except:
                    pass
                log.error("  ‚ùå –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: –±–ª–æ–∫ 'TikTok Ads' –Ω–µ –Ω–∞–π–¥–µ–Ω")
                return product_data
            
            log.info("  ‚úÖ –ë–ª–æ–∫ 'TikTok Ads' —É—Å–ø–µ—à–Ω–æ –Ω–∞–π–¥–µ–Ω")
            
            # –®–ê–ì 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ "First seen"
            log.info("\nüìå –®–ê–ì 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ 'First seen'...")
            sort_success = await self._set_sort_by_first_seen()
            if not sort_success:
                log.warning("  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            # –®–ê–ì 6: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–∏–¥–µ–æ
            log.info("\nüìå –®–ê–ì 6: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ 'TikTok Ads'...")
            videos = await self._get_videos_from_tiktok_ads_block()
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ {len(videos)} –≤–∏–¥–µ–æ –≤ –±–ª–æ–∫–µ")
            
            # –®–ê–ì 7: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ
            log.info(f"\nüìå –®–ê–ì 7: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ (impression >= {config.MIN_IMPRESSIONS}, –¥–∞—Ç–∞ <= {config.DAYS_BACK} –¥–Ω–µ–π)...")
            filtered_videos = await self._filter_videos(videos)
            log.info(f"  ‚Üí –ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: {len(filtered_videos)} –≤–∏–¥–µ–æ")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –í–°–ï –≤–∏–¥–µ–æ (–¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏) –≤ ProductData
            product_data._all_videos_raw = videos[:20]  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–≤—ã–µ 20 –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
            
            # –í–ê–ñ–ù–û: –ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ 0 –≤–∏–¥–µ–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä
            if len(filtered_videos) == 0:
                log.warning(f"  ‚ö†Ô∏è –ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ (>= {config.MIN_IMPRESSIONS} impressions, <= {config.DAYS_BACK} –¥–Ω–µ–π)")
                log.warning(f"  ‚ö†Ô∏è –¢–æ–≤–∞—Ä –±—É–¥–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω")
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ —Ç–æ–≤–∞—Ä–∞
                product_data._insufficient_videos = True
                product_data._videos_found = len(videos)
                return product_data
            
            # –í—ã–±–æ—Ä —Ç–æ–ø-3 –≤–∏–¥–µ–æ
            video_count = 3
            selected_videos = filtered_videos[:video_count]
            
            log.info(f"  ‚úÖ –í—ã–±—Ä–∞–Ω–æ {len(selected_videos)} –≤–∏–¥–µ–æ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            
            # –®–ê–ì 8: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
            log.info(f"\nüìå –®–ê–ì 8: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–ª—è {len(selected_videos)} –≤–∏–¥–µ–æ...")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
            product_page_url = self.page.url
            log.info(f"  ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞: {product_page_url}")
            
            for i, video in enumerate(selected_videos, 1):
                log.info(f"\n  üé¨ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ {i}/{len(selected_videos)}...")
                log.info(f"    ‚Üí Impression: {video.get('impression', 0)}, First seen: {video.get('first_seen', 'N/A')}")
                
                # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ (–ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ ad-search –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
                video_details = await self._get_video_details(video)
                
                if video_details:
                    product_data.videos.append(video_details)
                    log.info(f"    ‚úÖ –í–∏–¥–µ–æ {i} –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ")
                else:
                    log.warning(f"    ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –¥–ª—è –≤–∏–¥–µ–æ {i}")
                
                # –í–ê–ñ–ù–û: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
                log.info(f"    ‚Üí –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ {i}...")
                try:
                    await self.page.goto(product_page_url, wait_until="domcontentloaded", timeout=30000)
                    await self.human_delay(1, 2)
                    
                    # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –±–ª–æ–∫–∞ TikTok Ads (—á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ –≤–∏–¥–µ–æ)
                    try:
                        await self.page.wait_for_selector('a[href*="/ad-search/"]', timeout=10000, state="visible")
                        log.info(f"    ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ —É—Å–ø–µ—à–µ–Ω (–≤–∏–¥–µ–æ {i})")
                    except:
                        log.warning(f"    ‚ö†Ô∏è –ë–ª–æ–∫ TikTok Ads –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
                except Exception as e:
                    log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞: {e}")
                    # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–ª–µ–¥—É—é—â–∏—Ö –≤–∏–¥–µ–æ –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤–æ–∑–≤—Ä–∞—Ç–∞
                
                await self.human_delay(0.5, 1)
            
            # –ó–∞–ø–æ–ª–Ω—è–µ–º N/A –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤–∏–¥–µ–æ (–Ω—É–∂–Ω–æ 3 –≤–∏–¥–µ–æ)
            while len(product_data.videos) < video_count:
                product_data.videos.append({
                    "tiktok_link": "N/A",
                    "impression": 0,
                    "script": "N/A",
                    "hook": "N/A",
                    "audience_age": "N/A",
                    "country": "N/A",
                    "first_seen": "N/A",
                })
            
            log.info(f"\n‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {len(product_data.videos)} –≤–∏–¥–µ–æ –¥–ª—è —Ç–æ–≤–∞—Ä–∞")
            
            # –®–ê–ì 9: –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ –≤ Google Sheets (–µ—Å–ª–∏ sheets_writer –ø–µ—Ä–µ–¥–∞–Ω)
            if sheets_writer:
                if hasattr(product_data, '_sheets_row') and product_data._sheets_row > 0:
                    log.info(f"\nüìå –®–ê–ì 9: –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {product_data._sheets_row})...")
                    log.info(f"  ‚Üí –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ –¥–ª—è –∑–∞–ø–∏—Å–∏: {len(product_data.videos)}")
                    
                    # –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é
                    for i, video in enumerate(product_data.videos[:3], 1):
                        log.info(f"  ‚Üí –í–∏–¥–µ–æ {i}: tiktok={video.get('tiktok_link', 'N/A')[:50]}, "
                                f"impression={video.get('impression', 'N/A')}, "
                                f"script={len(str(video.get('script', 'N/A')))} —Å–∏–º–≤–æ–ª–æ–≤, "
                                f"hook={len(str(video.get('hook', 'N/A')))} —Å–∏–º–≤–æ–ª–æ–≤, "
                                f"audience={video.get('audience_age', 'N/A')}, "
                                f"country={video.get('country', 'N/A')}, "
                                f"first_seen={video.get('first_seen', 'N/A')}")
                    
                    try:
                        # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏
                        video_data_dict = {
                            "product_name": product_data.product_name,
                            "category": product_data.category,
                            "pipiads_link": product_data.pipiads_link,
                            "videos": product_data.videos
                        }
                        
                        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (update_basic=False - –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ F-Z)
                        success = sheets_writer.write_product_data(
                            product_data._sheets_row,
                            video_data_dict,
                            update_basic=False
                        )
                        
                        if success:
                            log.info(f"  ‚úÖ –î–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {product_data._sheets_row}, —Å—Ç–æ–ª–±—Ü—ã F-Z)")
                        else:
                            log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –≤ Google Sheets")
                    except Exception as e:
                        log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ: {e}")
                        import traceback
                        log.error(traceback.format_exc())
                else:
                    log.warning(f"  ‚ö†Ô∏è –ù–µ—Ç –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö (_sheets_row –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)")
            
            log.info("=" * 80)
            log.info("‚úÖ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û")
            log.info("=" * 80)
            return product_data
            
        except Exception as e:
            log.error("\n" + "=" * 80)
            log.error(f"‚ùå –û–®–ò–ë–ö–ê –ü–†–ò –û–ë–†–ê–ë–û–¢–ö–ï –¢–û–í–ê–†–ê: {e}")
            log.error("=" * 80)
            import traceback
            log.error(traceback.format_exc())
            return product_data
    
    async def return_to_main_page(self, main_page_url: str) -> bool:
        """
        –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–æ–≤–∞—Ä–æ–≤
        
        Args:
            main_page_url: URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ —Ç–æ–≤–∞—Ä)
        
        Returns:
            True –µ—Å–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç —É—Å–ø–µ—à–µ–Ω, False –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        """
        try:
            log.info("\nüîô –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–æ–≤–∞—Ä–æ–≤...")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π URL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            current_url = self.page.url
            log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
            log.info(f"  ‚Üí –¶–µ–ª–µ–≤–æ–π URL: {main_page_url}")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            if current_url == main_page_url:
                log.info("  ‚ÑπÔ∏è  –£–∂–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
                return True
            
            # –ú–ï–¢–û–î 1: –ü—Ä—è–º–æ–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π URL (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            await self.page.goto(main_page_url, wait_until="domcontentloaded", timeout=30000)  # –£–≤–µ–ª–∏—á–µ–Ω –¥–æ 30 —Å–µ–∫
            await self.human_delay(1, 2)
            
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ë–ï–ó networkidle - –æ–Ω –≤—ã–∑—ã–≤–∞–µ—Ç —Ç–∞–π–º–∞—É—Ç—ã!)
            await self.page.wait_for_load_state("domcontentloaded", timeout=5000)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞
            new_url = self.page.url
            log.info(f"  ‚Üí –ù–æ–≤—ã–π URL: {new_url}")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤
            try:
                await self.page.wait_for_selector('a[href*="/tiktok-shop-product/"]', timeout=10000)
                
                # –î–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ä–µ–º—è –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
                await self.human_delay(2, 3)
                
                log.info("  ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —É—Å–ø–µ—à–µ–Ω")
                return True
            except:
                log.warning("  ‚ö†Ô∏è –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞")
                return False
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É: {e}")
            import traceback
            log.error(traceback.format_exc())
            return False
    
    async def get_product_details_with_return(self, product_index: int, sheets_writer=None, banned_products=None):
        """
        –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        
        –ê–ª–≥–æ—Ä–∏—Ç–º:
        1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        2. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É
        3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ban-list (–µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω)
        4. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–≤–∞—Ä (get_product_details)
        5. –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        
        Args:
            product_index: –ò–Ω–¥–µ–∫—Å —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–Ω–∞—á–∏–Ω–∞—è —Å 0)
            sheets_writer: –û–±—ä–µ–∫—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ Google Sheets
            banned_products: –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö URL (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
        
        Returns:
            ProductData –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ
            Dict —Å–æ status="insufficient_videos" –µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ
            Dict —Å–æ status="duplicate" –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
            None –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        """
        log.info(f"\n{'='*80}")
        log.info(f"üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ü–û –ò–ù–î–ï–ö–°–£ {product_index}")
        log.info(f"{'='*80}")
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        main_page_url = self.page.url
        log.info(f"  ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {main_page_url}")
        
        def normalize_url(url: str) -> str:
            """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL (—É–±—Ä–∞—Ç—å —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É)"""
            if not url:
                return ""
            url = url.strip().rstrip('/')
            # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if '?' in url:
                url = url.split('?')[0]
            return url
        
        try:
            # –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É
            log.info(f"\nüìå –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É {product_index}...")
            
            try:
                # –ò—â–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
                product_links = await self.page.query_selector_all('a[href*="/tiktok-shop-product/"]')
                
                if not product_links:
                    log.error("  ‚ùå –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
                    return None
                
                if product_index >= len(product_links):
                    log.error(f"  ‚ùå –ò–Ω–¥–µ–∫—Å {product_index} –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã (–≤—Å–µ–≥–æ {len(product_links)} —Ç–æ–≤–∞—Ä–æ–≤)")
                    return None
                
                # –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Ç–æ–≤–∞—Ä–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É
                product_link = product_links[product_index]
                
                # –ü–æ–ª—É—á–∞–µ–º URL —Ç–æ–≤–∞—Ä–∞
                href = await product_link.get_attribute("href")
                if not href:
                    log.error(f"  ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å URL –¥–ª—è —Ç–æ–≤–∞—Ä–∞ {product_index}")
                    return None
                
                # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π URL
                if href.startswith("/"):
                    product_url = f"https://www.pipiads.com{href}"
                elif href.startswith("http"):
                    product_url = href
                else:
                    product_url = f"https://www.pipiads.com/{href}"
                
                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º URL (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
                product_url = normalize_url(product_url)
                
                if not product_url:
                    log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                    return None
                
                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
                if banned_products is not None and product_url in banned_products:
                    log.warning(f"  üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: {product_url}")
                    log.warning(f"     –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.")
                    return {"status": "duplicate", "product_url": product_url}
                
                log.info(f"  ‚úÖ –ü–æ–ª—É—á–µ–Ω URL —Ç–æ–≤–∞—Ä–∞: {product_url}")
                
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ URL —Ç–æ–≤–∞—Ä–∞: {e}")
                return None
            
            # –®–ê–ì 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ get_product_details
            log.info(f"\nüìå –®–ê–ì 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞...")
            product_data = await self.get_product_details(product_url, sheets_writer=sheets_writer)
            
            # –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–¥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é)
            log.info(f"\nüìå –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞...")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∏ –µ—Å—Ç—å –≤–∏–¥–µ–æ
            if not product_data:
                log.warning("  ‚ö†Ô∏è product_data –ø—É—Å—Ç")
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                await self.return_to_main_page(main_page_url)
                return None
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ —Ç–æ–≤–∞—Ä –ø—Ä–æ–ø—É—â–µ–Ω –∏–∑-–∑–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
            if hasattr(product_data, '_insufficient_videos') and product_data._insufficient_videos:
                videos_found = getattr(product_data, '_videos_found', 0)
                log.warning(f"  ‚ö†Ô∏è –¢–æ–≤–∞—Ä –ø—Ä–æ–ø—É—â–µ–Ω: –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ (–Ω–∞–π–¥–µ–Ω–æ –≤—Å–µ–≥–æ: {videos_found})")
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                await self.return_to_main_page(main_page_url)
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª–æ–≤–∞—Ä—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "insufficient_videos"
                return {
                    "status": "insufficient_videos",
                    "product_name": getattr(product_data, 'product_name', 'N/A'),
                    "videos_found": videos_found,
                    "videos_required": 3,
                    "reason": f"–ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (>= {config.MIN_IMPRESSIONS} impressions, <= {config.DAYS_BACK} –¥–Ω–µ–π) –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ"
                }
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ
            videos_count = len(product_data.videos) if hasattr(product_data, 'videos') else 0
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ –≤–∏–¥–µ–æ: {videos_count}")
            
            # –ï—Å–ª–∏ –≤–∏–¥–µ–æ –º–µ–Ω—å—à–µ 3 - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
            if videos_count < 3:
                log.warning(f"  ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ: {videos_count} < 3")
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                await self.return_to_main_page(main_page_url)
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª–æ–≤–∞—Ä—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "insufficient_videos"
                return {
                    "status": "insufficient_videos",
                    "product_name": getattr(product_data, 'product_name', 'N/A'),
                    "videos_found": videos_count,
                    "videos_required": 3,
                    "reason": f"–ù–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ {videos_count} –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏"
                }
            
            # –®–ê–ì 4: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            log.info(f"\nüìå –®–ê–ì 4: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É...")
            await self.return_to_main_page(main_page_url)
            
            # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä
            log.info(f"  ‚úÖ –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ ({videos_count} –≤–∏–¥–µ–æ)")
            return product_data
            
        except Exception as e:
            log.error(f"\n‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É {product_index}: {e}")
            import traceback
            log.error(traceback.format_exc())
            
            # –ü—ã—Ç–∞–µ–º—Å—è –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
            try:
                await self.return_to_main_page(main_page_url)
            except:
                log.error("  ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏")
            
            return None
    
    async def _set_sort_by_first_seen(self) -> bool:
        """
        –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É "First seen" –≤ dropdown
        
        Returns:
            True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
        """
        log.info("  ‚Üí –ü–æ–∏—Å–∫ dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏...")
        try:
            # –ò—â–µ–º dropdown "Sort by"
            sort_selectors = [
                'select:has-text("Sort by")',
                'select',
                '[class*="sort"]',
                'text="Sort by: First seen"',
                'text="Sort by"',
            ]
            
            dropdown = None
            for selector in sort_selectors:
                try:
                    dropdown = await self.page.query_selector(selector)
                    if dropdown:
                        is_visible = await dropdown.is_visible()
                        if is_visible:
                            log.debug(f"–ù–∞–π–¥–µ–Ω dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: {selector}")
                            break
                        else:
                            dropdown = None
                except:
                    continue
            
            if not dropdown:
                # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ —Ç–µ–∫—Å—Ç—É "Sort by: First seen"
                try:
                    sort_text = await self.page.query_selector('text="Sort by: First seen"')
                    if sort_text:
                        # –ö–ª–∏–∫–∞–µ–º –Ω–∞ —Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å dropdown
                        await sort_text.click()
                        await self.human_delay(0.5, 1)
                        
                        # –ò—â–µ–º –æ–ø—Ü–∏—é "First seen"
                        first_seen_option = await self.page.query_selector('text="First seen"')
                        if first_seen_option:
                            await first_seen_option.click()
                            await self.human_delay(1, 2)
                            log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (—á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç)")
                            return True
                except:
                    pass
                
                log.warning("Dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å")
                return False
            
            # –ï—Å–ª–∏ —ç—Ç–æ select —ç–ª–µ–º–µ–Ω—Ç
            tag_name = await dropdown.evaluate("el => el.tagName.toLowerCase()")
            if tag_name == "select":
                # –í—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é —á–µ—Ä–µ–∑ value –∏–ª–∏ —Ç–µ–∫—Å—Ç
                try:
                    log.info("  ‚Üí –ù–∞–π–¥–µ–Ω select —ç–ª–µ–º–µ–Ω—Ç, –≤—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é 'First seen'...")
                    await dropdown.select_option(label="First seen")
                    await self.human_delay(1, 2)
                    log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (select)")
                    return True
                except:
                    pass
            
            # –ï—Å–ª–∏ —ç—Ç–æ –∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown - –∫–ª–∏–∫–∞–µ–º –∏ –≤—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é
            log.info("  ‚Üí –ù–∞–π–¥–µ–Ω –∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown, –æ—Ç–∫—Ä—ã–≤–∞–µ–º...")
            await dropdown.click()
            await self.human_delay(0.5, 1)
            
            # –ò—â–µ–º –æ–ø—Ü–∏—é "First seen"
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –æ–ø—Ü–∏–∏ 'First seen'...")
            option_selectors = [
                'text="First seen"',
                'text="Sort by: First seen"',
                '[role="option"]:has-text("First seen")',
            ]
            
            for opt_sel in option_selectors:
                try:
                    option = await self.page.query_selector(opt_sel)
                    if option:
                        await option.click()
                        await self.human_delay(1, 2)
                        log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (–∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown)")
                        return True
                except:
                    continue
            
            log.warning("  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É 'First seen'")
            return False
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: {e}")
            return False
    
    async def _get_videos_from_tiktok_ads_block(self) -> List[Dict[str, Any]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ TikTok Ads
        
        Returns:
            –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        videos = []
        
        try:
            log.info("  ‚Üí –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ...")
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ
            await self.human_delay(0.5, 1)
            
            # –ò—â–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ - –ø—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã...")
            video_card_selectors = [
                '[class*="video"]',
                '[class*="card"]',
                '[class*="ad"]',
                'div[class*="item"]',
                'a[href*="/ad-search/"]',
            ]
            
            video_elements = []
            for selector in video_card_selectors:
                try:
                    elements = await self.page.query_selector_all(selector)
                    if elements:
                        log.debug(f"–ù–∞–π–¥–µ–Ω–æ {len(elements)} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º {selector}")
                        # –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ, —á—Ç–æ —Å–æ–¥–µ—Ä–∂–∞—Ç –≤–∏–¥–µ–æ (–∏–º–µ—é—Ç thumbnail –∏–ª–∏ play button)
                        for elem in elements:
                            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –∫–∞—Ä—Ç–æ—á–∫–∞ –≤–∏–¥–µ–æ
                            has_play_button = await elem.query_selector('[class*="play"], svg, [class*="thumbnail"]')
                            if has_play_button or '/ad-search/' in str(await elem.get_attribute("href") or ""):
                                video_elements.append(elem)
                        if video_elements:
                            break
                except:
                    continue
            
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ")
            
            # –û–ì–†–ê–ù–ò–ß–ï–ù–ò–ï: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 50 –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
            max_cards = 50
            if len(video_elements) > max_cards:
                log.info(f"  ‚Üí –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ {max_cards} –∏–∑ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫")
                video_elements = video_elements[:max_cards]
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
            log.info("  ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–µ–∫...")
            log.info(f"  ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∞ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫...")
            
            successful_extractions = 0
            for i, card in enumerate(video_elements, 1):
                try:
                    video_data = await self._extract_video_data_from_card(card, i)
                    if video_data:
                        videos.append(video_data)
                        impression = video_data.get('impression', 0)
                        first_seen = video_data.get('first_seen', 'N/A')
                        
                        # –õ–û–ì–ò–†–£–ï–ú –ö–ê–ñ–î–û–ï –í–ò–î–ï–û (–∫–∞–∫ –ø—Ä–æ—Å–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
                        log.info(f"  üìπ –í–∏–¥–µ–æ {i}: impression={impression}, first_seen={first_seen}")
                        
                        if impression > 0 or first_seen != 'N/A':
                            successful_extractions += 1
                except Exception as e:
                    log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ {i}: {e}")
                    continue
            
            log.info(f"  ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–æ {len(videos)} –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ (—É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–æ: {successful_extractions})")
            return videos
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤–∏–¥–µ–æ: {e}")
            return []
    
    async def _extract_video_data_from_card(self, card_element, card_index: int = 0) -> Optional[Dict[str, Any]]:
        """
        –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ
        
        Args:
            card_element: –≠–ª–µ–º–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ
            card_index: –ò–Ω–¥–µ–∫—Å –∫–∞—Ä—Ç–æ—á–∫–∏ (–¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ –∏–ª–∏ None
        """
        try:
            video_data = {
                "ad_search_url": None,
                "impression": 0,
                "first_seen": None,
                "card_element": card_element,  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –∫–ª–∏–∫–∞
            }
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï IMPRESSION ==========
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ HTML-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
            # –ò—â–µ–º div.data-count > div.item –≥–¥–µ caption = "Impression"
            try:
                # –ò—â–µ–º –≤—Å–µ –±–ª–æ–∫–∏ data-count
                data_count_items = await card_element.query_selector_all('div.data-count div.item')
                
                if card_index <= 3:
                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –Ω–∞–π–¥–µ–Ω–æ {len(data_count_items)} –±–ª–æ–∫–æ–≤ div.item")
                
                for idx, item in enumerate(data_count_items):
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å impression
                    caption_elem = await item.query_selector('p.caption')
                    if caption_elem:
                        caption_text = await caption_elem.inner_text()
                        
                        if card_index <= 3:
                            log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}, –±–ª–æ–∫ {idx}: caption = '{caption_text}'")
                        
                        if 'Impression' in caption_text or '–ü–æ–∫–∞–∑' in caption_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
                            value_elem = await item.query_selector('p.value')
                            if value_elem:
                                # –ü–æ–ø—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
                                impression_str_inner = (await value_elem.inner_text()).strip()
                                impression_str_html = (await value_elem.inner_html()).strip()
                                impression_str_content = (await value_elem.text_content()).strip()
                                
                                # –í–°–ï–ì–î–ê –ª–æ–≥–∏—Ä—É–µ–º RAW-–∑–Ω–∞—á–µ–Ω–∏–µ (–¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–∞—Ä—Ç–æ—á–µ–∫)
                                if card_index <= 3:
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (inner_text) = '{impression_str_inner}'")
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (inner_html) = '{impression_str_html}'")
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (text_content) = '{impression_str_content}'")
                                
                                # –ò—Å–ø–æ–ª—å–∑—É–µ–º inner_text –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫
                                impression_str = impression_str_inner
                                impression = validator.parse_impressions(impression_str)
                                if impression:
                                    video_data["impression"] = impression
                                    if card_index <= 3:
                                        log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression PARSED = {impression}")
                                    break
                                else:
                                    if card_index <= 3:
                                        log.warning(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: parse_impressions –≤–µ—Ä–Ω—É–ª None –¥–ª—è '{impression_str}'")
            except Exception as e:
                if card_index <= 3:
                    log.error(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ impression: {e}")
                    import traceback
                    log.error(traceback.format_exc())
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï FIRST SEEN ==========
            # –ò—â–µ–º div.create-time > span —Å –¥–∞—Ç–æ–π
            try:
                create_time_elem = await card_element.query_selector('div.create-time span')
                if create_time_elem:
                    date_text = (await create_time_elem.inner_text()).strip()
                    # –õ–æ–≥–∏—Ä—É–µ–º RAW-–∑–Ω–∞—á–µ–Ω–∏–µ
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: first_seen RAW='{date_text}'")
                    
                    # –§–æ—Ä–º–∞—Ç: "Nov 05 2025-Nov 11 2025" - –±–µ—Ä–µ–º –ü–ï–†–í–£–Æ –¥–∞—Ç—É (–¥–æ –¥–µ—Ñ–∏—Å–∞)
                    # –ò—Å–ø–æ–ª—å–∑—É–µ–º regex –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–µ—Ä–≤–æ–π –¥–∞—Ç—ã
                    match = re.match(r'([A-Z][a-z]{2}\s+\d{1,2}\s+\d{4})', date_text)
                    if match:
                        first_seen_str = match.group(1)
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –¥–∞—Ç—ã
                        parsed_date = validator.parse_video_date(first_seen_str)
                        if parsed_date:
                            video_data["first_seen"] = first_seen_str
                            log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: first_seen parsed='{first_seen_str}'")
            except Exception as e:
                if card_index <= 3:
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ first_seen —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä: {e}")
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï AD-SEARCH –°–°–´–õ–ö–ò ==========
            try:
                link_element = await card_element.query_selector('a.btn-detail[href*="/ad-search/"]')
                if link_element:
                    href = await link_element.get_attribute("href")
                    if href:
                        if href.startswith("/"):
                            video_data["ad_search_url"] = f"https://www.pipiads.com{href}"
                        elif href.startswith("http"):
                            video_data["ad_search_url"] = href
                        else:
                            video_data["ad_search_url"] = f"https://www.pipiads.com/{href}"
                        if card_index <= 3:
                            log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: ad_search_url = {video_data['ad_search_url']}")
            except Exception as e:
                if card_index <= 3:
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ ad_search_url: {e}")
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Å—Å—ã–ª–∫—É, –Ω–æ –µ—Å—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∞ - –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –Ω–µ—ë
            if not video_data["ad_search_url"]:
                video_data["card_element"] = card_element
            
            # –õ–æ–≥–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–∞—Ä—Ç–æ—á–µ–∫
            if card_index <= 3:
                log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –∏—Ç–æ–≥–æ - impression={video_data['impression']}, first_seen={video_data['first_seen']}, ad_search_url={bool(video_data['ad_search_url'])}")
            
            return video_data
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ {card_index}: {e}")
            import traceback
            log.debug(traceback.format_exc())
            return None
    
    async def _filter_videos(self, videos: List[Dict[str, Any]]) -> List[Dict[str, Any]]:
        """
        –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
        
        Args:
            videos: –°–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        
        Returns:
            –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ
        """
        filtered = []
        
        for video in videos:
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ impression (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π "170.6K" –∏–ª–∏ —á–∏—Å–ª–æ–º)
            impression = video.get("impression", 0)
            impression_num = 0
            if isinstance(impression, str):
                # –ü–∞—Ä—Å–∏–º —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                impression_num = validator.parse_impressions(impression) or 0
            elif isinstance(impression, (int, float)):
                impression_num = int(impression)
            
            if not validator.validate_impressions(impression_num, config.MIN_IMPRESSIONS):
                log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: impression {impression} ({impression_num}) < {config.MIN_IMPRESSIONS}")
                continue
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
            first_seen = video.get("first_seen")
            if first_seen and first_seen != "N/A" and first_seen is not None:
                parsed_date = validator.parse_video_date(first_seen)
                if parsed_date:
                    if not validator.is_date_within_days(parsed_date, config.DAYS_BACK):
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –¥–∞—Ç–∞ {first_seen} —Å—Ç–∞—Ä—à–µ {config.DAYS_BACK} –¥–Ω–µ–π")
                        continue
                else:
                    # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å, –Ω–æ –µ—Å—Ç—å impression >= 50k, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –¥–∞—Ç—ã
                    if impression >= config.MIN_IMPRESSIONS:
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–∏–Ω—è—Ç–æ: –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É {first_seen}, –Ω–æ impression {impression} >= {config.MIN_IMPRESSIONS}")
                    else:
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É {first_seen} –∏ impression {impression} < {config.MIN_IMPRESSIONS}")
                        continue
            # –ï—Å–ª–∏ –¥–∞—Ç—ã –Ω–µ—Ç, –Ω–æ impression >= 50k, –ø—Ä–∏–Ω–∏–º–∞–µ–º –≤–∏–¥–µ–æ
            elif impression >= config.MIN_IMPRESSIONS:
                log.debug(f"–í–∏–¥–µ–æ –ø—Ä–∏–Ω—è—Ç–æ: –Ω–µ—Ç –¥–∞—Ç—ã, –Ω–æ impression {impression} >= {config.MIN_IMPRESSIONS}")
            else:
                log.debug("–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –Ω–µ—Ç –¥–∞—Ç—ã first_seen –∏ impression < –º–∏–Ω–∏–º—É–º–∞")
                continue
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
            video["_impression_num"] = impression_num
            filtered.append(video)
        
        # –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: —Å–Ω–∞—á–∞–ª–∞ –ø–æ –¥–∞—Ç–µ (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ), –ø–æ—Ç–æ–º –ø–æ impressions (—Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ)
        # –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ ad_search_url (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π), –∑–∞—Ç–µ–º tiktok_link, –∑–∞—Ç–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—è
        seen_videos = set()
        unique_videos = []
        for video in filtered:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)
            # 1. ad_search_url (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ)
            # 2. tiktok_link (–µ—Å–ª–∏ ad_search_url –Ω–µ—Ç)
            # 3. –ö–æ–º–±–∏–Ω–∞—Ü–∏—è impression + first_seen (fallback)
            video_id = None
            
            # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º ad_search_url (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ)
            ad_search_url = video.get("ad_search_url", "")
            if ad_search_url and ad_search_url != "N/A":
                ad_search_url = ad_search_url.rstrip('/')
                video_id = f"ad_search:{ad_search_url}"
            elif video.get("tiktok_link") and video.get("tiktok_link") != "N/A":
                video_id = f"tiktok:{video.get('tiktok_link')}"
            else:
                # Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—é impression + first_seen
                impression = video.get("impression", 0)
                first_seen = video.get("first_seen", "N/A")
                video_id = f"fallback:{impression}:{first_seen}"
            
            if video_id and video_id not in seen_videos:
                seen_videos.add(video_id)
                unique_videos.append(video)
            else:
                log.info(f"‚è≠Ô∏è  –í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ –∫–∞–∫ –¥—É–±–ª–∏–∫–∞—Ç: {video_id}")
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º: —Å–Ω–∞—á–∞–ª–∞ –ø–æ –¥–∞—Ç–µ (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ), –ø–æ—Ç–æ–º –ø–æ impressions (—Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ)
        def sort_key(v):
            parsed_date = validator.parse_video_date(v.get("first_seen", ""))
            if parsed_date:
                date_timestamp = -parsed_date.timestamp()  # –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ —É–±—ã–≤–∞–Ω–∏—é (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ)
            else:
                date_timestamp = 0  # –í–∏–¥–µ–æ –±–µ–∑ –¥–∞—Ç—ã –≤ –∫–æ–Ω–µ—Ü
            return (date_timestamp, -v.get("_impression_num", 0))
        
        unique_videos.sort(key=sort_key)
        
        # –ë–µ—Ä–µ–º —Ç–æ–ø-3
        top_videos = unique_videos[:3]
        
        log.info(f"‚úÖ –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ {len(filtered)} –≤–∏–¥–µ–æ –∏–∑ {len(videos)}, —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö: {len(unique_videos)}, —Ç–æ–ø-3: {len(top_videos)}")
        return top_videos
    
    async def _get_video_details(self, video: Dict[str, Any]) -> Optional[Dict[str, Any]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –≤–∏–¥–µ–æ
        
        Args:
            video: –°–ª–æ–≤–∞—Ä—å —Å –±–∞–∑–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ (–∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        try:
            # –ï—Å–ª–∏ –µ—Å—Ç—å ad_search_url, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞–ø—Ä—è–º—É—é
            if video.get("ad_search_url"):
                log.info(f"    ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É ad-search: {video['ad_search_url']}")
                await self.page.goto(video["ad_search_url"], wait_until="domcontentloaded", timeout=30000)
                await self.human_delay(0.5, 1)
                log.info("    ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ad-search –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            else:
                # –ï—Å–ª–∏ –Ω–µ—Ç URL, –∫–ª–∏–∫–∞–µ–º –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É
                # –í–ê–ñ–ù–û: –≠–ª–µ–º–µ–Ω—Ç –º–æ–∂–µ—Ç –∏—Å—á–µ–∑–Ω—É—Ç—å –∏–∑ DOM, –ø–æ—ç—Ç–æ–º—É –∏—â–µ–º –µ–≥–æ –∑–∞–Ω–æ–≤–æ
                card_element = video.get("card_element")
                if not card_element:
                    log.error("    ‚ùå –ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ –ø–µ—Ä–µ–π—Ç–∏ –∫ –≤–∏–¥–µ–æ (–Ω–µ—Ç URL –∏ —ç–ª–µ–º–µ–Ω—Ç–∞)")
                    return None
                
                log.info("    ‚Üí –ö–ª–∏–∫ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –≤–∏–¥–µ–æ...")
                try:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –µ—â–µ –≤ DOM
                    is_attached = await card_element.evaluate("el => el.isConnected")
                    if not is_attached:
                        log.warning("    ‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç –∏—Å—á–µ–∑ –∏–∑ DOM, –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∑–∞–Ω–æ–≤–æ...")
                        # –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ –ø–æ ad_search_url –∏–ª–∏ –¥—Ä—É–≥–∏–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º
                        # –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None
                        log.error("    ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ")
                        return None
                    
                    await card_element.click()
                    await self.human_delay(0.5, 1)
                    log.info("    ‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ –≤–∏–¥–µ–æ –æ—Ç–∫—Ä—ã—Ç–∞")
                except Exception as e:
                    log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É: {e}")
                    log.warning("    ‚ö†Ô∏è –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ...")
                    # –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –∏—Å—á–µ–∑, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None
                    return None
                
                # –ñ–¥–µ–º –æ—Ç–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞/–º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                # –ò—â–µ–º –∫–Ω–æ–ø–∫—É "More detail"
                log.info("    ‚Üí –ü–æ–∏—Å–∫ –∫–Ω–æ–ø–∫–∏ 'More detail'...")
                more_detail_selectors = [
                    'text="More detail"',
                    'text="More Detail"',
                    'button:has-text("More detail")',
                    'a:has-text("More detail")',
                ]
                
                more_detail_button = None
                for selector in more_detail_selectors:
                    try:
                        more_detail_button = await self.page.wait_for_selector(selector, timeout=5000, state="visible")
                        if more_detail_button:
                            log.info(f"    ‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ 'More detail' (—Å–µ–ª–µ–∫—Ç–æ—Ä: {selector})")
                            break
                    except:
                        continue
                
                if not more_detail_button:
                    log.error("    ‚ùå –ö–Ω–æ–ø–∫–∞ 'More detail' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
                    return None
                
                # –ö–ª–∏–∫–∞–µ–º –Ω–∞ "More detail"
                log.info("    ‚Üí –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É 'More detail'...")
                await more_detail_button.click()
                await self.human_delay(0.5, 1)
                
                # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
                log.info("    ‚Üí –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search...")
                await self.page.wait_for_load_state("domcontentloaded", timeout=10000)
                await self.human_delay(0.3, 0.5)
                log.info("    ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ad-search –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
            # –ü–µ—Ä–µ–¥–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏) –¥–ª—è fallback
            log.info("    ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search...")
            
            # –í–ê–ñ–ù–û: –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º domcontentloaded (–±—ã—Å—Ç—Ä–µ–µ) + –∑–∞–¥–µ—Ä–∂–∫–∞ + –æ–∂–∏–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            await self.page.wait_for_load_state("domcontentloaded", timeout=10000)
            await self.human_delay(2, 3)  # –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (Script, Hook, Audience) —Å retry
            elements_found = False
            for attempt in range(3):  # 3 –ø–æ–ø—ã—Ç–∫–∏
                try:
                    # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                    await self.page.wait_for_selector('li#ai-script, li#ai-hook, div.addel-info-item', timeout=5000, state="visible")
                    log.info(f"    ‚úÖ –ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search (–ø–æ–ø—ã—Ç–∫–∞ {attempt + 1})")
                    elements_found = True
                    break
                except:
                    if attempt < 2:
                        log.debug(f"    ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∂–¥–µ–º –µ—â–µ...")
                        await self.human_delay(2, 3)
                    else:
                        log.warning("    ‚ö†Ô∏è –ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ 3 –ø–æ–ø—ã—Ç–æ–∫, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ...")
            
            return await self._extract_ad_search_data(video)
            
        except Exception as e:
            log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–µ—Ç–∞–ª–µ–π –≤–∏–¥–µ–æ: {e}")
            import traceback
            log.error(traceback.format_exc())
            return None
    
    async def _extract_ad_search_data(self, original_video: Optional[Dict[str, Any]] = None) -> Dict[str, Any]:
        """
        –ò–∑–≤–ª–µ—á—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
        
        Args:
            original_video: –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (–¥–ª—è fallback impressions)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        video_data = {
            "tiktok_link": "N/A",
            "impression": 0,
            "script": "N/A",
            "hook": "N/A",
            "audience_age": "N/A",
            "country": "N/A",
            "first_seen": "N/A",
        }
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è fallback
        if original_video:
            original_impression = original_video.get("impression")
            if original_impression:
                video_data["_original_impression"] = original_impression
        
        try:
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            await self.page.wait_for_load_state("domcontentloaded")
            await self.human_delay(0.3, 0.5)
            
            # –ü–æ–ª—É—á–∞–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ø–æ–∏—Å–∫–∞
            page_text = await self.page.content()
            
            # 1. TikTok —Å—Å—ã–ª–∫–∞ (–∏–∑ –ø–æ–ª—è "TikTok Post" (–∞–Ω–≥–ª.) –∏–ª–∏ "–ü–æ—Å—Ç TikTok" (—Ä—É—Å.))
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ TikTok —Å—Å—ã–ª–∫–∏...")
            
            # –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –ø–æ —Ç–µ–∫—Å—Ç—É "TikTok Post" –∏–ª–∏ "–ü–æ—Å—Ç TikTok"
            tiktok_post_selectors = [
                'text=/TikTok Post/i',  # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
                'text=/–ü–æ—Å—Ç TikTok/i',  # –†—É—Å—Å–∫–∏–π fallback
            ]
            
            for selector in tiktok_post_selectors:
                try:
                    locator = self.page.locator(selector).first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Å—Å—ã–ª–∫—É —Ä—è–¥–æ–º
                        try:
                            parent_locator = locator.locator("..")
                            # –ò—â–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å—Å—ã–ª–∫–∞–º —Å /v/)
                            link = await parent_locator.locator('a[href*="m.tiktok.com/v/"]').first.element_handle()
                            if not link:
                                link = await parent_locator.locator('a[href*="tiktok.com/v/"]').first.element_handle()
                            if not link:
                                link = await parent_locator.locator('a[href*="tiktok.com"]').first.element_handle()
                            if link:
                                href = await link.get_attribute("href")
                                if href:
                                    # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä—ã –≤ TikTok Shop
                                    if "shop.tiktok.com/view/product" in href or "/view/product" in href:
                                        log.debug(f"      ‚Üí –ü—Ä–æ–ø—É—â–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä: {href[:50]}...")
                                        continue
                                    # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ
                                    if "/v/" in href or "m.tiktok.com" in href:
                                        video_data["tiktok_link"] = href
                                        log.info(f"      ‚úÖ TikTok —Å—Å—ã–ª–∫–∞ –Ω–∞–π–¥–µ–Ω–∞: {href[:50]}...")
                                        break
                        except:
                            pass
                except:
                    continue
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç, –∏—â–µ–º –≤—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ TikTok
            # –í–ê–ñ–ù–û: –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ (m.tiktok.com/v/...), –ù–ï –Ω–∞ —Ç–æ–≤–∞—Ä—ã (shop.tiktok.com/view/product/...)
            if video_data["tiktok_link"] == "N/A":
                tiktok_link_selectors = [
                    'a[href*="m.tiktok.com/v/"]',  # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ
                    'a[href*="tiktok.com/v/"]',    # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                    'a[href*="tiktok.com"]',       # Fallback
                ]
                
                for selector in tiktok_link_selectors:
                    try:
                        links = await self.page.query_selector_all(selector)
                        for link in links:
                            href = await link.get_attribute("href")
                            if href and "tiktok.com" in href:
                                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä—ã –≤ TikTok Shop
                                if "shop.tiktok.com/view/product" in href or "/view/product" in href:
                                    log.debug(f"      ‚Üí –ü—Ä–æ–ø—É—â–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä: {href[:50]}...")
                                    continue
                                
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ (—Å–æ–¥–µ—Ä–∂–∞—Ç /v/ –≤ –ø—É—Ç–∏)
                                if "/v/" in href or "m.tiktok.com" in href:
                                    video_data["tiktok_link"] = href
                                    log.info(f"      ‚úÖ TikTok —Å—Å—ã–ª–∫–∞ –Ω–∞–π–¥–µ–Ω–∞: {href[:50]}...")
                                    break
                        if video_data["tiktok_link"] != "N/A":
                            break
                    except:
                        continue
            
            if video_data["tiktok_link"] == "N/A":
                log.warning("      ‚ö†Ô∏è TikTok —Å—Å—ã–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
            
            # 2. Impressions - –ö–†–ò–¢–ò–ß–ù–û: "Impressions" (–∞–Ω–≥–ª.) –∏–ª–∏ "–ü–æ–∫–∞–∑—ã" (—Ä—É—Å.), –Ω–µ "Likes" –∏–ª–∏ "–ù—Ä–∞–≤–∏—Ç—Å—è"!
            # –ò—â–µ–º –≤ —Ä–∞–∑–¥–µ–ª–µ "Data/–î–∞–Ω–Ω—ã–µ" –≤ –ø—É–Ω–∫—Ç–µ "Impression/–ü–æ–∫–∞–∑"
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ impressions...")
            impression_text = await self._extract_impressions()
            if impression_text:
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–µ—Å–ª–∏ –æ–Ω —É–∂–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "170.6K" –∏–ª–∏ "339.9M")
                if impression_text.upper().endswith(('K', 'M')):
                    video_data["impression"] = impression_text
                    log.info(f"      ‚úÖ Impressions (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç): {impression_text}")
                else:
                    # –ü–∞—Ä—Å–∏–º —á–∏—Å–ª–æ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞—Ç–Ω–æ
                    impression_num = validator.parse_impressions(impression_text) or 0
                    video_data["impression"] = validator.format_impressions(impression_num)
                    log.info(f"      ‚úÖ Impressions (—Å—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–æ): {video_data['impression']}")
            else:
                # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ–Ω–∏ –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                # (–∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞)
                original_impression = video_data.get("_original_impression")
                if original_impression:
                    if isinstance(original_impression, (int, float)) and original_impression > 0:
                        video_data["impression"] = validator.format_impressions(int(original_impression))
                        log.info(f"      ‚úÖ Impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏: {video_data['impression']}")
                    elif isinstance(original_impression, str) and original_impression != "N/A":
                        video_data["impression"] = original_impression
                        log.info(f"      ‚úÖ Impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (—Å—Ç—Ä–æ–∫–∞): {original_impression}")
                    else:
                        video_data["impression"] = "N/A"
                        log.warning("      ‚ö†Ô∏è Impressions –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –Ω–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ")
                else:
                    video_data["impression"] = "N/A"
                    log.warning("      ‚ö†Ô∏è Impressions –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
            
            # 3. Script (–∏–∑ "Transcript" –∏–ª–∏ "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞")
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è (script)...")
            log.info(f"      ‚Üí –¢–µ–∫—É—â–∏–π URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {self.page.url}")
            script = await self._extract_script()
            if script:
                video_data["script"] = script
                log.info(f"      ‚úÖ Script –Ω–∞–π–¥–µ–Ω ({len(script)} —Å–∏–º–≤–æ–ª–æ–≤): {script[:100]}...")
            else:
                video_data["script"] = "N/A"
                log.warning("      ‚ö†Ô∏è Script –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-script p.content-text –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 4. Hook (–∏–∑ —Å–µ–∫—Ü–∏–∏ Hook –∏–ª–∏ Hooks)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ hook...")
            hook = await self._extract_hook()
            if not hook:
                # –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω
                log.warning("      ‚ö†Ô∏è Hook –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫...")
                await self.human_delay(1, 2)  # –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É
                hook = await self._extract_hook()
            
            if hook:
                video_data["hook"] = hook
                log.info(f"      ‚úÖ Hook –Ω–∞–π–¥–µ–Ω ({len(hook)} —Å–∏–º–≤–æ–ª–æ–≤): {hook[:100]}...")
            else:
                video_data["hook"] = "N/A"
                log.warning("      ‚ö†Ô∏è Hook –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook p.content-text –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 5. Audience Age (–∏–∑ –ø–æ–ª—è Audience/–ê—É–¥–∏—Ç–æ—Ä–∏—è)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∞—É–¥–∏—Ç–æ—Ä–∏–∏...")
            audience_data = await self._extract_audience()
            if audience_data:
                age = audience_data.get("age", "N/A")
                platform = audience_data.get("platform", "N/A")
                # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ "35-45" –∏–ª–∏ "35-45 Android" (–µ—Å–ª–∏ –µ—Å—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞)
                # –í —Å—Ç—Ä–æ–∫–µ 6 —Ç–æ–ª—å–∫–æ –≤–æ–∑—Ä–∞—Å—Ç "25-35", –±–µ–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
                video_data["audience_age"] = age if age != "N/A" else "N/A"
                log.info(f"      ‚úÖ Audience: {video_data['audience_age']}")
            else:
                video_data["audience_age"] = "N/A"
                log.info("      ‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
            
            # 6. Country (–∏–∑ –ø–æ–ª—è "Country/Region" –∏–ª–∏ "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω" - –û–¢–î–ï–õ–¨–ù–û –æ—Ç Audience!)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã...")
            country = await self._extract_country()
            if country:
                video_data["country"] = country
                log.info(f"      ‚úÖ Country: {country}")
            else:
                video_data["country"] = "N/A"
                log.warning("      ‚ö†Ô∏è Country –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä div.addel-info-item —Å 'Country/Region' –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 7. First seen (—Ñ–æ—Ä–º–∞—Ç "Oct 27 2025" - –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ "Oct 28 2025 ~ Nov 10 2025")
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞—Ç—ã First seen...")
            first_seen = await self._extract_first_seen()
            if first_seen:
                video_data["first_seen"] = first_seen
                log.info(f"      ‚úÖ First seen: {first_seen}")
            else:
                video_data["first_seen"] = "N/A"
                log.info("      ‚ö†Ô∏è First seen –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
            
            log.info(f"    ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ—á–µ–Ω—ã: impression={video_data['impression']}, first_seen={video_data['first_seen']}")
            return video_data
            
        except Exception as e:
            log.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö ad-search: {e}")
            return video_data
    
    async def _extract_impressions(self) -> Optional[str]:
        """
        –ò–∑–≤–ª–µ—á—å impressions - –ö–†–ò–¢–ò–ß–ù–û: –≤ —Ä–∞–∑–¥–µ–ª–µ "Data/–î–∞–Ω–Ω—ã–µ" –≤ –ø—É–Ω–∫—Ç–µ "Impression/–ü–æ–∫–∞–∑"
        –í–ê–ñ–ù–û: –ù–ï –±—Ä–∞—Ç—å —à–∞–±–ª–æ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã!
        
        Returns:
            –°—Ç—Ä–æ–∫–∞ —Å impressions (–Ω–∞–ø—Ä–∏–º–µ—Ä "170.6K", "339.9M") –∏–ª–∏ None
        """
        try:
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM (–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ)
            try:
                impression_data = await self.page.evaluate("""
                    () => {
                        // –ò—â–µ–º —Ä–∞–∑–¥–µ–ª "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                        const dataKeywords = ['Data', '–î–∞–Ω–Ω—ã–µ'];
                        const impressionKeywords = ['Impression', '–ü–æ–∫–∞–∑', '–ü–æ–∫–∞–∑—ã'];
                        
                        // –ò—â–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —ç–ª–µ–º–µ–Ω—Ç "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                            for (const dataKeyword of dataKeywords) {
                                if (text.includes(dataKeyword)) {
                                    // –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –∏—â–µ–º "Impression" –∏–ª–∏ "–ü–æ–∫–∞–∑"
                                    for (const impKeyword of impressionKeywords) {
                                        if (text.includes(impKeyword)) {
                                            // –ò—â–µ–º —á–∏—Å–ª–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "170.6K", "403.2M" –∏ —Ç.–¥.
                                            const patterns = [
                                                new RegExp(impKeyword + '[\\s:]*([\\d.,]+[KM]?)', 'i'),
                                                new RegExp('([\\d.,]+[KM]?)\\s*' + impKeyword, 'i')
                                            ];
                                            
                                            for (const pattern of patterns) {
                                                const match = text.match(pattern);
                                                if (match && match[1]) {
                                                    const value = match[1];
                                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ —á–∏—Å–ª–æ (–Ω–µ —à–∞–±–ª–æ–Ω–Ω–æ–µ)
                                                    // –û–±—ã—á–Ω–æ —Ä–µ–∞–ª—å–Ω—ã–µ impressions –æ—Ç 50K –¥–æ 500M
                                                    const numValue = parseFloat(value.replace(/[KM]/i, ''));
                                                    if (numValue >= 0.05 && numValue <= 1000) {
                                                        return value;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        
                        // Fallback: –∏—â–µ–º –Ω–∞–ø—Ä—è–º—É—é "Impression" –∏–ª–∏ "–ü–æ–∫–∞–∑" (–ù–ï "Likes"!)
                        for (const impKeyword of impressionKeywords) {
                            const elements = Array.from(document.querySelectorAll('*')).filter(el => {
                                const text = el.innerText || '';
                                return text.includes(impKeyword) && !text.toLowerCase().includes('likes') && !text.toLowerCase().includes('–Ω—Ä–∞–≤–∏—Ç—Å—è');
                            });
                            
                            for (const el of elements) {
                                const text = el.innerText || '';
                                const patterns = [
                                    new RegExp(impKeyword + '[\\s:]*([\\d.,]+[KM]?)', 'i'),
                                    new RegExp('([\\d.,]+[KM]?)\\s*' + impKeyword, 'i')
                                ];
                                
                                for (const pattern of patterns) {
                                    const match = text.match(pattern);
                                    if (match && match[1]) {
                                        const value = match[1];
                                        const numValue = parseFloat(value.replace(/[KM]/i, ''));
                                        if (numValue >= 0.05 && numValue <= 1000) {
                                            return value;
                                        }
                                    }
                                }
                            }
                        }
                        
                        return null;
                    }
                """)
                
                if impression_data:
                    log.debug(f"–ù–∞–π–¥–µ–Ω–æ impressions —á–µ—Ä–µ–∑ JavaScript: {impression_data}")
                    return impression_data
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ impressions —á–µ—Ä–µ–∑ JS: {e}")
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (fallback)
            data_keywords = ["Data", "–î–∞–Ω–Ω—ã–µ"]
            
            for keyword in data_keywords:
                try:
                    data_locator = self.page.locator(f'text=/{keyword}/i').first
                    if await data_locator.count() > 0:
                        impression_keywords = ["Impression", "–ü–æ–∫–∞–∑", "–ü–æ–∫–∞–∑—ã"]
                        for imp_keyword in impression_keywords:
                            try:
                                parent_text = await data_locator.locator("..").inner_text()
                                if imp_keyword in parent_text and "Likes" not in parent_text and "–ù—Ä–∞–≤–∏—Ç—Å—è" not in parent_text:
                                    pattern = rf'{imp_keyword}[:\s]*([\d.,]+[KM]?)'
                                    match = re.search(pattern, parent_text, re.IGNORECASE)
                                    if match:
                                        impression_str = match.group(1)
                                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —à–∞–±–ª–æ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                                        num_value = validator.parse_impressions(impression_str)
                                        if num_value and 50000 <= num_value <= 1000000000:  # –û—Ç 50K –¥–æ 1B
                                            log.debug(f"–ù–∞–π–¥–µ–Ω–æ impressions –≤ —Ä–∞–∑–¥–µ–ª–µ Data: {impression_str}")
                                            return impression_str
                            except:
                                continue
                except:
                    continue
            
            log.warning("–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ 'Impression' –∏–ª–∏ '–ü–æ–∫–∞–∑' –≤ —Ä–∞–∑–¥–µ–ª–µ Data")
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ impressions: {e}")
            return None
    
    async def _extract_script(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å —Å—Ü–µ–Ω–∞—Ä–∏–π –∏–∑ —Å–µ–∫—Ü–∏–∏ 'Script' –∏–ª–∏ '–°—Ü–µ–Ω–∞—Ä–∏–π' (–∏–ª–∏ 'Transcript' –∏–ª–∏ '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞')
        
        –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
        <li id="ai-script">
            <div class="li-title">...</div>
            <div class="control-content li-content">
                <p class="content-text slot-wrap">...</p>
            </div>
        </li>
        """
        try:
            # –ú–ï–¢–û–î 0: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä—É –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            # –ü—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º (—ç–ª–µ–º–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
            for attempt in range(3):
                try:
                    # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
                    try:
                        await self.page.wait_for_selector('li#ai-script', timeout=5000, state="visible")
                    except:
                        if attempt < 2:
                            log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç li#ai-script –Ω–µ –ø–æ—è–≤–∏–ª—Å—è, –∂–¥–µ–º –µ—â–µ...")
                            await self.human_delay(1, 2)
                            continue
                        else:
                            log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-script –Ω–µ –ø–æ—è–≤–∏–ª—Å—è –∑–∞ 15 —Å–µ–∫—É–Ω–¥")
                    
                    script_element = await self.page.query_selector('li#ai-script p.content-text')
                    if script_element:
                        script = await script_element.inner_text()
                        if script and len(script.strip()) > 10:
                            log.info(f"      ‚úÖ Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-script p.content-text ({len(script)} —Å–∏–º–≤–æ–ª–æ–≤)")
                            return script.strip()
                    else:
                        if attempt < 2:
                            log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω, –∂–¥–µ–º –µ—â–µ...")
                            await self.human_delay(1, 2)
                            continue
                        else:
                            log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-script p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω")
                except Exception as e:
                    if attempt < 2:
                        log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: –æ—à–∏–±–∫–∞ {e}, –ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑...")
                        await self.human_delay(1, 2)
                        continue
                    else:
                        log.debug(f"      ‚Üí –°–µ–ª–µ–∫—Ç–æ—Ä li#ai-script –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: {e}")
            
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
            script_keywords = ["Script", "–°—Ü–µ–Ω–∞—Ä–∏–π", "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞", "–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç"]
            
            for keyword in script_keywords:
                try:
                    # –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å —Ç–µ–∫—Å—Ç–æ–º
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            parent_text = await locator.locator("..").inner_text()
                            if keyword in parent_text:
                                parts = parent_text.split(keyword, 1)
                                if len(parts) > 1:
                                    script = parts[1].strip()
                                    # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –º–µ—Ç–∫–∏
                                    stop_words = ["Hook", "–•—É–∫", "Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", 
                                                "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", "Impressions", "–ü–æ–∫–∞–∑—ã",
                                                "Limited Time Offer", "Annual Plan", "Promotion Period", "50% OFF",
                                                "Privacy", "Terms", "Copyright", "PIPIADS", "All Rights Reserved",
                                                "AI-agent", "cosmobeauty", "credits", "subscription", "invoice",
                                                "Monthly Credits", "Extra Credits", "data cost", "detail costs",
                                                "Team Setting", "Affiliate Dashboard", "Logout"]
                                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                           "cosmobeauty", "credits", "subscription", "invoice", 
                                                           "Monthly Credits", "Extra Credits", "@gmail.com"]
                                    is_footer_menu = any(keyword in script for keyword in footer_menu_keywords)
                                    
                                    for stop_word in stop_words:
                                        if stop_word in script:
                                            script = script.split(stop_word)[0].strip()
                                    # –§–∏–ª—å—Ç—Ä—É–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (Video Text Translator, Quality, Size –∏ —Ç.–¥.)
                                    metadata_keywords = ["Video Text Translator", "Translator", "Quality", "Size", "Resolution", 
                                                        "Width", "Height", "Duration", "Format", "Codec", "Frame Rate"]
                                    is_metadata = any(keyword in script for keyword in metadata_keywords)
                                    
                                    # –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                    lines = script.split('\n')
                                    cleaned_lines = []
                                    skip_words = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook']
                                    for line in lines:
                                        line = line.strip()
                                        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                        if line and not line.startswith('#') and not any(skip in line for skip in skip_words):
                                            cleaned_lines.append(line)
                                    script = '\n'.join(cleaned_lines).strip()
                                    
                                    if script and len(script) > 10 and not is_footer_menu and not is_metadata:
                                        log.debug(f"Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Ä–æ–¥–∏—Ç–µ–ª—å)")
                                        return script
                        except:
                            pass
                        
                        # –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            next_sibling = await locator.evaluate_handle("el => el.nextElementSibling")
                            if next_sibling:
                                script = await next_sibling.as_element().inner_text()
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                       "cosmobeauty", "credits", "subscription", "invoice", 
                                                       "Monthly Credits", "Extra Credits", "@gmail.com"]
                                is_footer_menu = any(keyword in script for keyword in footer_menu_keywords)
                                # –§–∏–ª—å—Ç—Ä—É–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                metadata_keywords = ["Video Text Translator", "Translator", "Quality", "Size", "Resolution"]
                                is_metadata = any(keyword in script for keyword in metadata_keywords)
                                
                                # –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                lines = script.split('\n')
                                cleaned_lines = []
                                skip_words = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook']
                                for line in lines:
                                    line = line.strip()
                                    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                    if line and not line.startswith('#') and not any(skip in line for skip in skip_words):
                                        cleaned_lines.append(line)
                                script = '\n'.join(cleaned_lines).strip()
                                
                                if script and len(script) > 10 and not is_footer_menu and not is_metadata:
                                    log.debug(f"Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç)")
                                    return script.strip()
                        except:
                            pass
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                script = await self.page.evaluate("""
                    () => {
                        const keywords = ['Script', '–°—Ü–µ–Ω–∞—Ä–∏–π', 'Transcript', '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞', '–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç'];
                        const stopWords = ['Hook', '–•—É–∫', 'Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 
                                          'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 'Impressions', '–ü–æ–∫–∞–∑—ã',
                                          'Analysis', 'Advertiser', 'Display Name', 'Ad Copy',
                                          'Limited Time Offer', 'Annual Plan', 'Promotion Period', '50% OFF'];
                        
                        // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    // –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ (–æ–±—ã—á–Ω–æ —ç—Ç–æ —Å–∞–º script)
                                    let scriptText = null;
                                    
                                    // –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ sibling —ç–ª–µ–º–µ–Ω—Ç–∞
                                    let nextSibling = el.nextElementSibling;
                                    if (nextSibling) {
                                        scriptText = nextSibling.innerText || '';
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    if (!scriptText || scriptText.length < 10) {
                                        const parentText = el.parentElement ? el.parentElement.innerText || '' : '';
                                        if (parentText.includes(keyword)) {
                                            const parts = parentText.split(keyword);
                                            if (parts.length > 1) {
                                                scriptText = parts[1].trim();
                                            }
                                        }
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 3: –ò—â–µ–º –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö (–æ–±—ã—á–Ω–æ script –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –±–ª–æ–∫–µ)
                                    if (!scriptText || scriptText.length < 10) {
                                        const children = el.querySelectorAll('p, div, span');
                                        for (const child of children) {
                                            const childText = child.innerText || '';
                                            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç—ã
                                            if (childText.length > 20 && 
                                                !childText.includes('Advertiser') && 
                                                !childText.includes('Display Name') &&
                                                !childText.includes('Analysis') &&
                                                !childText.includes('Generator') &&
                                                !childText.includes('Limited Time Offer') &&
                                                !childText.includes('Annual Plan') &&
                                                !childText.includes('Promotion Period') &&
                                                !childText.includes('50% OFF')) {
                                                scriptText = childText;
                                                break;
                                            }
                                        }
                                    }
                                    
                                    if (scriptText) {
                                        // –£–±–∏—Ä–∞–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                        for (const stopWord of stopWords) {
                                            if (scriptText.includes(stopWord)) {
                                                scriptText = scriptText.split(stopWord)[0];
                                            }
                                        }
                                        
                                        scriptText = scriptText.trim();
                                        
                                        // –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                        const skipWords = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook'];
                                        const lines = scriptText.split('\\n');
                                        const cleanedLines = [];
                                        for (const line of lines) {
                                            const trimmedLine = line.trim();
                                            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                            if (trimmedLine && !trimmedLine.startsWith('#') && 
                                                !skipWords.some(word => trimmedLine.includes(word))) {
                                                cleanedLines.push(trimmedLine);
                                            }
                                        }
                                        scriptText = cleanedLines.join('\\n').trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π script (–Ω–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –Ω–µ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç, –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é)
                                        const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                                   'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                                   'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                                   'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                                   'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                        const isFooterMenu = footerMenuKeywords.some(keyword => scriptText.includes(keyword));
                                        
                                        // –§–∏–ª—å—Ç—Ä—É–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                    const metadataKeywords = ['Video Text Translator', 'Translator', 'Quality', 'Size', 'Resolution', 
                                                             'Width', 'Height', 'Duration', 'Format', 'Codec', 'Frame Rate'];
                                    const isMetadata = metadataKeywords.some(keyword => scriptText.includes(keyword));
                                    
                                    if (scriptText && scriptText.length > 20 && 
                                            !scriptText.startsWith('Analysis') &&
                                            !scriptText.includes('shop.tiktok.com') &&
                                            !scriptText.includes('Generator Image') &&
                                            !scriptText.includes('Limited Time Offer') &&
                                            !scriptText.includes('Annual Plan') &&
                                            !scriptText.includes('Promotion Period') &&
                                            !scriptText.includes('50% OFF') &&
                                            !scriptText.toLowerCase().includes('q4') &&
                                            !scriptText.toLowerCase().includes('monthly plan') &&
                                            !isFooterMenu &&
                                            !isMetadata) {
                                            return scriptText;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if script and len(script) > 10:
                    log.debug("Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript")
                    return script.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ script —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è: {e}")
            return None
    
    async def _extract_hook(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å hook –∏–∑ —Å–µ–∫—Ü–∏–∏ Hook/Hooks (–∞–Ω–≥–ª.) –∏–ª–∏ –•—É–∫/–•—É–∫–∏ (—Ä—É—Å.)
        –í–ê–ñ–ù–û: Hook –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ Script –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ!
        
        –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
        <li id="ai-hook">
            <div class="li-title">...</div>
            <div class="control-content li-content">
                <p class="content-text slot-wrap">...</p>
            </div>
        </li>
        """
        try:
            # –ú–ï–¢–û–î 0: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä—É –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            # –ü—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º (—ç–ª–µ–º–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
            for attempt in range(3):
                try:
                    # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
                    try:
                        await self.page.wait_for_selector('li#ai-hook', timeout=5000, state="visible")
                    except:
                        if attempt < 2:
                            log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç li#ai-hook –Ω–µ –ø–æ—è–≤–∏–ª—Å—è, –∂–¥–µ–º –µ—â–µ...")
                            await self.human_delay(1, 2)
                            continue
                        else:
                            log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-hook –Ω–µ –ø–æ—è–≤–∏–ª—Å—è –∑–∞ 15 —Å–µ–∫—É–Ω–¥")
                    
                    hook_element = await self.page.query_selector('li#ai-hook p.content-text')
                    if hook_element:
                        hook = await hook_element.inner_text()
                        if hook and len(hook.strip()) > 5:
                            log.info(f"      ‚úÖ Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook p.content-text ({len(hook)} —Å–∏–º–≤–æ–ª–æ–≤)")
                            return hook.strip()
                    else:
                        if attempt < 2:
                            log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω, –∂–¥–µ–º –µ—â–µ...")
                            await self.human_delay(1, 2)
                            continue
                        else:
                            log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-hook p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω")
                except Exception as e:
                    if attempt < 2:
                        log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: –æ—à–∏–±–∫–∞ {e}, –ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑...")
                        await self.human_delay(1, 2)
                        continue
                    else:
                        log.debug(f"      ‚Üí –°–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: {e}")
            
            # –ù–û–í–´–ô –ú–ï–¢–û–î: –ò—â–µ–º Script, –∑–∞—Ç–µ–º –∏—â–µ–º Hook –≤ —Å–ª–µ–¥—É—é—â–µ–º —ç–ª–µ–º–µ–Ω—Ç–µ/—Å–µ–∫—Ü–∏–∏
            try:
                # –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏–º Script
                script_keywords = ["Script", "–°—Ü–µ–Ω–∞—Ä–∏–π", "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞"]
                for script_keyword in script_keywords:
                    try:
                        script_locator = self.page.locator(f'text=/{script_keyword}/i').first
                        if await script_locator.count() > 0:
                            # –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ Script, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç "Hook" –∏–ª–∏ "Hooks"
                            # –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ –ø–æ—Å–ª–µ Script
                            try:
                                # –°–ø–æ—Å–æ–± 1: –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å "Hook" –∏–ª–∏ "Hooks" –ø–æ—Å–ª–µ Script
                                parent = script_locator.locator("..")
                                parent_text = await parent.inner_text()
                                
                                # –ò—â–µ–º "Hook" –∏–ª–∏ "Hooks" –≤ —Ç–æ–º –∂–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ
                                if "Hook" in parent_text or "Hooks" in parent_text or "–•—É–∫" in parent_text or "–•—É–∫–∏" in parent_text:
                                    # –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é Script –∏ Hook –≤ —Ç–µ–∫—Å—Ç–µ
                                    script_pos = parent_text.find(script_keyword)
                                    hook_pos = -1
                                    for hook_word in ["Hook", "Hooks", "–•—É–∫", "–•—É–∫–∏"]:
                                        pos = parent_text.find(hook_word, script_pos)
                                        if pos > script_pos:
                                            hook_pos = pos
                                            break
                                    
                                    if hook_pos > script_pos:
                                        # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ "Hook" –∏–ª–∏ "Hooks"
                                        hook_section = parent_text[hook_pos:]
                                        # –£–±–∏—Ä–∞–µ–º "Hook" –∏–ª–∏ "Hooks" –∏–∑ –Ω–∞—á–∞–ª–∞
                                        hook_section = re.sub(r'^Hooks?\s*:?\s*', '', hook_section, flags=re.IGNORECASE)
                                        hook_section = re.sub(r'^–•—É–∫–∏?\s*:?\s*', '', hook_section, flags=re.IGNORECASE)
                                        hook_text = hook_section.strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏ (Target Audience, First seen –∏ —Ç.–¥.)
                                        stop_words = ["Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", 
                                                    "Impressions", "–ü–æ–∫–∞–∑—ã", "Country", "–°—Ç—Ä–∞–Ω–∞", "Country/Region", "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω"]
                                        for stop_word in stop_words:
                                            if stop_word in hook_text:
                                                hook_text = hook_text.split(stop_word)[0].strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                        hook_text = re.sub(r'Quality\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'Size\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'Resolution\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'--', '', hook_text)
                                        hook_text = re.sub(r'\n{2,}', '\n', hook_text).strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞ –≤ –Ω–∞—á–∞–ª–µ
                                        hook_text = re.sub(r'^(Tags|Script|Hooks?)\s*:?\s*', '', hook_text, flags=re.IGNORECASE)
                                        
                                        if hook_text and len(hook_text) > 5 and len(hook_text) < 500:
                                            log.debug(f"Hook –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ Script —á–µ—Ä–µ–∑ '{script_keyword}'")
                                            return hook_text
                            except:
                                pass
                            
                            # –°–ø–æ—Å–æ–± 2: –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π sibling —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ Script
                            try:
                                script_element = await script_locator.element_handle()
                                if script_element:
                                    # –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å —Ç–µ–∫—Å—Ç–æ–º "Hook" –∏–ª–∏ "Hooks"
                                    next_elements = await self.page.evaluate("""
                                        (scriptEl) => {
                                            let current = scriptEl;
                                            // –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å "Hook" –∏–ª–∏ "Hooks"
                                            for (let i = 0; i < 10; i++) {
                                                current = current.nextElementSibling;
                                                if (!current) break;
                                                const text = current.innerText || '';
                                                if (text.includes('Hook') || text.includes('Hooks') || 
                                                    text.includes('–•—É–∫') || text.includes('–•—É–∫–∏')) {
                                                    // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ "Hook" –∏–ª–∏ "Hooks"
                                                    const parts = text.split(/Hooks?\\s*:?\\s*|–•—É–∫–∏?\\s*:?\\s*/i);
                                                    if (parts.length > 1) {
                                                        let hookText = parts[1].trim();
                                                        // –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏
                                                        const stopWords = ['Target Audience', 'First seen', 'Impressions', 'Country'];
                                                        for (const stop of stopWords) {
                                                            if (hookText.includes(stop)) {
                                                                hookText = hookText.split(stop)[0];
                                                            }
                                                        }
                                                        hookText = hookText.replace(/Quality\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/Size\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/Resolution\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/--/g, '');
                                                        hookText = hookText.replace(/\\n{2,}/g, '\\n').trim();
                                                        if (hookText && hookText.length > 5 && hookText.length < 500) {
                                                            return hookText;
                                                        }
                                                    }
                                                }
                                            }
                                            return null;
                                        }
                                    """, script_element)
                                    
                                    if next_elements:
                                        log.debug(f"Hook –Ω–∞–π–¥–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–º —ç–ª–µ–º–µ–Ω—Ç–µ –ø–æ—Å–ª–µ Script")
                                        return next_elements
                            except:
                                pass
                            
                            # –°–ø–æ—Å–æ–± 3: –ò—â–µ–º Hook –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –ø–æ—Å–ª–µ Script
                            try:
                                # –ü–æ–ª—É—á–∞–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –∏—â–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω "Script...Hook"
                                page_text = await self.page.content()
                                # –ò—â–µ–º —á–µ—Ä–µ–∑ JavaScript –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ
                                hook_text = await self.page.evaluate("""
                                    () => {
                                        // –ò—â–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Script"
                                        const allElements = Array.from(document.querySelectorAll('*'));
                                        for (const el of allElements) {
                                            const text = el.innerText || '';
                                            if (text.includes('Script') || text.includes('–°—Ü–µ–Ω–∞—Ä–∏–π')) {
                                                // –ò—â–µ–º –≤ —ç—Ç–æ–º –∂–µ —ç–ª–µ–º–µ–Ω—Ç–µ –∏–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º "Hook" –∏–ª–∏ "Hooks"
                                                let searchEl = el;
                                                for (let depth = 0; depth < 3; depth++) {
                                                    const searchText = searchEl.innerText || '';
                                                    if (searchText.includes('Hook') || searchText.includes('Hooks') || 
                                                        searchText.includes('–•—É–∫') || searchText.includes('–•—É–∫–∏')) {
                                                        // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –º–µ–∂–¥—É Script –∏ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Å–µ–∫—Ü–∏—è–º–∏
                                                        const scriptIndex = searchText.indexOf('Script');
                                                        const hookIndex = searchText.indexOf('Hook', scriptIndex);
                                                        if (hookIndex > scriptIndex) {
                                                            let hookText = searchText.substring(hookIndex);
                                                            // –£–±–∏—Ä–∞–µ–º "Hook" –∏–ª–∏ "Hooks" –∏–∑ –Ω–∞—á–∞–ª–∞
                                                            hookText = hookText.replace(/^Hooks?\\s*:?\\s*/i, '');
                                                            hookText = hookText.replace(/^–•—É–∫–∏?\\s*:?\\s*/i, '');
                                                            // –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏
                                                            const stopWords = ['Target Audience', 'First seen', 'Impressions', 'Country'];
                                                            for (const stop of stopWords) {
                                                                if (hookText.includes(stop)) {
                                                                    hookText = hookText.split(stop)[0];
                                                                }
                                                            }
                                                            hookText = hookText.replace(/Quality\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/Size\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/Resolution\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/--/g, '');
                                                            hookText = hookText.replace(/\\n{2,}/g, '\\n').trim();
                                                            if (hookText && hookText.length > 5 && hookText.length < 500) {
                                                                return hookText;
                                                            }
                                                        }
                                                    }
                                                    searchEl = searchEl.parentElement;
                                                    if (!searchEl) break;
                                                }
                                            }
                                        }
                                        return null;
                                    }
                                """)
                                
                                if hook_text:
                                    log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ—Å–ª–µ Script")
                                    return hook_text
                            except:
                                pass
                    except:
                        continue
            except:
                pass
            
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (—Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±, –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ fallback)
            hook_keywords = ["Hooks", "Hook", "–•—É–∫–∏", "–•—É–∫"]
            
            for keyword in hook_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            parent_text = await locator.locator("..").inner_text()
                            if keyword in parent_text:
                                parts = parent_text.split(keyword, 1)
                                if len(parts) > 1:
                                    hook = parts[1].strip()
                                    # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –º–µ—Ç–∫–∏
                                    stop_words = ["Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", 
                                                "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞", "Impressions", "–ü–æ–∫–∞–∑—ã",
                                                "Limited Time Offer", "Annual Plan", "Promotion Period", "50% OFF",
                                                "Privacy", "Terms", "Copyright", "PIPIADS", "All Rights Reserved",
                                                "AI-agent", "cosmobeauty", "credits", "subscription", "invoice",
                                                "Monthly Credits", "Extra Credits", "data cost", "detail costs",
                                                "Team Setting", "Affiliate Dashboard", "Logout"]
                                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                           "cosmobeauty", "credits", "subscription", "invoice", 
                                                           "Monthly Credits", "Extra Credits", "@gmail.com"]
                                    is_footer_menu = any(keyword in hook for keyword in footer_menu_keywords)
                                    
                                    for stop_word in stop_words:
                                        if stop_word in hook:
                                            hook = hook.split(stop_word)[0].strip()
                                    
                                    # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                    metadata_patterns = [
                                        r'Quality\s*:?\s*[^\n]*',
                                        r'Size\s*:?\s*[^\n]*',
                                        r'Resolution\s*:?\s*[^\n]*',
                                        r'Width\s*:?\s*[^\n]*',
                                        r'Height\s*:?\s*[^\n]*',
                                        r'Duration\s*:?\s*[^\n]*',
                                        r'Format\s*:?\s*[^\n]*',
                                        r'Codec\s*:?\s*[^\n]*',
                                        r'Frame Rate\s*:?\s*[^\n]*',
                                        r'--',  # –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                    ]
                                    for pattern in metadata_patterns:
                                        hook = re.sub(pattern, '', hook, flags=re.IGNORECASE)
                                    hook = re.sub(r'\n{2,}', '\n', hook).strip()  # –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                    
                                    if hook and len(hook) > 5 and not is_footer_menu:
                                        log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Ä–æ–¥–∏—Ç–µ–ª—å)")
                                        return hook
                        except:
                            pass
                        
                        # –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            next_sibling = await locator.evaluate_handle("el => el.nextElementSibling")
                            if next_sibling:
                                hook = await next_sibling.as_element().inner_text()
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                       "cosmobeauty", "credits", "subscription", "invoice", 
                                                       "Monthly Credits", "Extra Credits", "@gmail.com"]
                                is_footer_menu = any(keyword in hook for keyword in footer_menu_keywords)
                                
                                # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                metadata_patterns = [
                                    r'Quality\s*:?\s*[^\n]*',
                                    r'Size\s*:?\s*[^\n]*',
                                    r'Resolution\s*:?\s*[^\n]*',
                                    r'Width\s*:?\s*[^\n]*',
                                    r'Height\s*:?\s*[^\n]*',
                                    r'Duration\s*:?\s*[^\n]*',
                                    r'Format\s*:?\s*[^\n]*',
                                    r'Codec\s*:?\s*[^\n]*',
                                    r'Frame Rate\s*:?\s*[^\n]*',
                                    r'--',  # –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                ]
                                for pattern in metadata_patterns:
                                    hook = re.sub(pattern, '', hook, flags=re.IGNORECASE)
                                hook = re.sub(r'\n{2,}', '\n', hook).strip()  # –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                
                                if hook and len(hook) > 5 and not is_footer_menu:
                                    log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç)")
                                    return hook.strip()
                        except:
                            pass
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                hook = await self.page.evaluate("""
                    () => {
                        const keywords = ['Hooks', 'Hook', '–•—É–∫–∏', '–•—É–∫'];
                        const stopWords = ['Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 
                                         'Transcript', '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞', 'Impressions', '–ü–æ–∫–∞–∑—ã',
                                         'Script', '–°—Ü–µ–Ω–∞—Ä–∏–π', 'Analysis',
                                         'Limited Time Offer', 'Annual Plan', 'Promotion Period', '50% OFF'];
                        
                        // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    let hookText = null;
                                    
                                    // –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ sibling —ç–ª–µ–º–µ–Ω—Ç–∞
                                    let nextSibling = el.nextElementSibling;
                                    if (nextSibling) {
                                        hookText = nextSibling.innerText || '';
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    if (!hookText || hookText.length < 5) {
                                        const parentText = el.parentElement ? el.parentElement.innerText || '' : '';
                                        if (parentText.includes(keyword)) {
                                            const parts = parentText.split(keyword);
                                            if (parts.length > 1) {
                                                hookText = parts[1].trim();
                                            }
                                        }
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 3: –ò—â–µ–º –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö
                                    if (!hookText || hookText.length < 5) {
                                        const children = el.querySelectorAll('p, div, span');
                                        for (const child of children) {
                                            const childText = child.innerText || '';
                                            if (childText.length > 5 && childText.length < 200) {
                                                hookText = childText;
                                                break;
                                            }
                                        }
                                    }
                                    
                                    if (hookText) {
                                        // –£–±–∏—Ä–∞–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞
                                        for (const stopWord of stopWords) {
                                            if (hookText.includes(stopWord)) {
                                                hookText = hookText.split(stopWord)[0];
                                            }
                                        }
                                        
                                        hookText = hookText.trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π hook (–∫–æ—Ä–æ—Ç–∫–∞—è —Ñ—Ä–∞–∑–∞, –Ω–µ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç, –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é)
                                        const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                                   'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                                   'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                                   'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                                   'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                        const isFooterMenu = footerMenuKeywords.some(keyword => hookText.includes(keyword));
                                        
                                        // –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                        const metadataPatterns = [
                                            /Quality\s*:?\s*[^\n]*/gi,
                                            /Size\s*:?\s*[^\n]*/gi,
                                            /Resolution\s*:?\s*[^\n]*/gi,
                                            /Width\s*:?\s*[^\n]*/gi,
                                            /Height\s*:?\s*[^\n]*/gi,
                                            /Duration\s*:?\s*[^\n]*/gi,
                                            /Format\s*:?\s*[^\n]*/gi,
                                            /Codec\s*:?\s*[^\n]*/gi,
                                            /Frame Rate\s*:?\s*[^\n]*/gi,
                                            /--/g,  // –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                        ];
                                        let cleanedHook = hookText;
                                        for (const pattern of metadataPatterns) {
                                            cleanedHook = cleanedHook.replace(pattern, '');
                                        }
                                        cleanedHook = cleanedHook.replace(/\n{2,}/g, '\n').trim();  // –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                        
                                        if (cleanedHook && cleanedHook.length > 5 && cleanedHook.length < 300 &&
                                            !cleanedHook.includes('Limited Time Offer') &&
                                            !cleanedHook.includes('Annual Plan') &&
                                            !cleanedHook.includes('Promotion Period') &&
                                            !cleanedHook.includes('50% OFF') &&
                                            !cleanedHook.toLowerCase().includes('q4') &&
                                            !cleanedHook.toLowerCase().includes('monthly plan') &&
                                            !isFooterMenu) {
                                            return cleanedHook;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if hook and len(hook) > 5:
                    log.debug("Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript")
                    return hook.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ hook —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ hook: {e}")
            return None
    
    async def _extract_audience(self) -> Optional[Dict[str, str]]:
        """
        –ò–∑–≤–ª–µ—á—å –≤–æ–∑—Ä–∞—Å—Ç –∏–∑ –ø–æ–ª—è Audience
        
        –°—Ç—Ä—É–∫—Ç—É—Ä–∞ HTML:
        <div class="addel-info-item">
            <div class="name"> Audience </div>
            <div class="value">
                <div class="audience-info">
                    <div class="audience-info-info">45-55 ... Android...</div>
                </div>
            </div>
        </div>
        """
        try:
            audience_data = {"age": "N/A", "platform": "N/A"}
            
            # –ú–ï–¢–û–î 1: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                # –ò—â–µ–º –±–ª–æ–∫ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "Audience"
                audience_items = await self.page.query_selector_all('div.addel-info-item')
                
                for item in audience_items:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å Audience
                    name_elem = await item.query_selector('div.name')
                    if name_elem:
                        name_text = await name_elem.inner_text()
                        if 'Audience' in name_text or '–ê—É–¥–∏—Ç–æ—Ä–∏—è' in name_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ audience-info-info
                            audience_info = await item.query_selector('div.audience-info-info')
                            if audience_info:
                                text = await audience_info.inner_text()
                                # –ò–∑–≤–ª–µ–∫–∞–µ–º –≤–æ–∑—Ä–∞—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ "45-55" (–º–æ–∂–µ—Ç –±—ã—Ç—å 2 —Ü–∏—Ñ—Ä—ã)
                                age_match = re.search(r'(\d{1,2}-\d{1,2})', text)
                                if age_match:
                                    audience_data["age"] = age_match.group(1)
                                    log.debug(f"      ‚Üí Audience age –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä: {audience_data['age']}")
                                    return audience_data
            except Exception as e:
                log.debug(f"      ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–º –ø–æ–∏—Å–∫–µ audience: {e}")
            
            # –ú–ï–¢–û–î 2: Fallback —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (–µ—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª)
            audience_keywords = ["Audience", "–ê—É–¥–∏—Ç–æ—Ä–∏—è", "Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è"]
            
            for keyword in audience_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç –∞—É–¥–∏—Ç–æ—Ä–∏–∏ —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º –≤–æ–∑—Ä–∞—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ "25-35" –∏–ª–∏ "45-55"
                        age_patterns = [
                            r'–í–æ–∑—Ä–∞—Å—Ç[:\s]+(\d{1,2}-\d{1,2})',
                            r'Age[:\s]+(\d{1,2}-\d{1,2})',
                            r'(\d{1,2}-\d{1,2})',  # –ü—Ä–æ—Å—Ç–æ –≤–æ–∑—Ä–∞—Å—Ç
                        ]
                        
                        for pattern in age_patterns:
                            age_match = re.search(pattern, text, re.IGNORECASE)
                            if age_match:
                                audience_data["age"] = age_match.group(1)
                                log.debug(f"      ‚Üí Audience age –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä: {audience_data['age']}")
                                break
                        
                        if audience_data["age"] != "N/A":
                            return audience_data
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π)
            try:
                result = await self.page.evaluate("""
                    () => {
                        const keywords = ['Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 'Audience', '–ê—É–¥–∏—Ç–æ—Ä–∏—è'];
                        const agePattern = /(\\d{1,2}-\\d{1,2})/;
                        const platformKeywords = ['Android', 'iOS', 'iPhone', 'iPad'];
                        const countryKeywords = ['USA', 'US', 'United States', '–†–æ—Å—Å–∏—è', 'Russia', 'Philippines', 
                                                '–§–∏–ª–∏–ø–ø–∏–Ω—ã', 'China', '–ö–∏—Ç–∞–π', 'India', '–ò–Ω–¥–∏—è'];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    const result = {age: 'N/A', platform: 'N/A', country: 'N/A'};
                                    
                                    // –ò—â–µ–º –≤–æ–∑—Ä–∞—Å—Ç
                                    const ageMatch = text.match(agePattern);
                                    if (ageMatch) {
                                        result.age = ageMatch[1];
                                    }
                                    
                                    // –ò—â–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
                                    for (const platform of platformKeywords) {
                                        if (text.includes(platform)) {
                                            result.platform = (platform === 'iOS' || platform === 'iPhone' || platform === 'iPad') ? 'iOS' : 'Android';
                                            break;
                                        }
                                    }
                                    
                                    // –ò—â–µ–º —Å—Ç—Ä–∞–Ω—É
                                    for (const country of countryKeywords) {
                                        if (text.includes(country)) {
                                            result.country = country;
                                            break;
                                        }
                                    }
                                    
                                    if (result.age !== 'N/A' || result.platform !== 'N/A' || result.country !== 'N/A') {
                                        return result;
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if result:
                    audience_data.update(result)
                    return audience_data
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ audience —á–µ—Ä–µ–∑ JS: {e}")
            
            return audience_data
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–∏: {e}")
            return None
    
    async def _extract_country(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å —Å—Ç—Ä–∞–Ω—É –∏–∑ –ø–æ–ª—è 'Country/Region' –∏–ª–∏ '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω' (–û–¢–î–ï–õ–¨–ù–û –æ—Ç Audience!)"""
        try:
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            try:
                await self.page.wait_for_selector('div.addel-info-item', timeout=5000, state="visible")
            except:
                log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç—ã div.addel-info-item –Ω–µ –ø–æ—è–≤–∏–ª–∏—Å—å –∑–∞ 5 —Å–µ–∫—É–Ω–¥")
            
            country_keywords = ["Country/Region", "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω", "Country", "–°—Ç—Ä–∞–Ω–∞", "Region", "–†–µ–≥–∏–æ–Ω"]
            
            # –ú–ï–¢–û–î 0: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                country_items = await self.page.query_selector_all('div.addel-info-item')
                
                for item in country_items:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å Country/Region
                    name_elem = await item.query_selector('div.name')
                    if name_elem:
                        name_text = await name_elem.inner_text()
                        if 'Country/Region' in name_text or '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω' in name_text or 'Country' in name_text or '–°—Ç—Ä–∞–Ω–∞' in name_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º —Å—Ç—Ä–∞–Ω—É
                            value_elem = await item.query_selector('div.ellipsis, div.value')
                            if value_elem:
                                country_text = await value_elem.inner_text()
                                # –£–±–∏—Ä–∞–µ–º (1) –∏ —Ç.–¥.
                                country = re.sub(r'\([0-9]+\)', '', country_text).strip()
                                if country and len(country) > 0:
                                    log.info(f"      ‚úÖ Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä: {country}")
                                    return country
            except Exception as e:
                log.debug(f"      ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–º –ø–æ–∏—Å–∫–µ country: {e}")
            
            for keyword in country_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω—ã —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º —Å—Ç—Ä–∞–Ω—É (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫)
                        country_patterns = [
                            r'United States(?:\([0-9]+\))?',  # United States(1)
                            r'USA(?:\([0-9]+\))?',
                            r'US(?:\([0-9]+\))?',
                            r'Philippines(?:\([0-9]+\))?',
                            r'–§–∏–ª–∏–ø–ø–∏–Ω—ã(?:\([0-9]+\))?',
                            r'Russia(?:\([0-9]+\))?',
                            r'–†–æ—Å—Å–∏—è(?:\([0-9]+\))?',
                            r'China(?:\([0-9]+\))?',
                            r'–ö–∏—Ç–∞–π(?:\([0-9]+\))?',
                            r'India(?:\([0-9]+\))?',
                            r'–ò–Ω–¥–∏—è(?:\([0-9]+\))?',
                            r'Brazil(?:\([0-9]+\))?',
                            r'–ë—Ä–∞–∑–∏–ª–∏—è(?:\([0-9]+\))?',
                            r'Germany(?:\([0-9]+\))?',
                            r'–ì–µ—Ä–º–∞–Ω–∏—è(?:\([0-9]+\))?',
                            r'France(?:\([0-9]+\))?',
                            r'–§—Ä–∞–Ω—Ü–∏—è(?:\([0-9]+\))?',
                            r'UK(?:\([0-9]+\))?',
                            r'United Kingdom(?:\([0-9]+\))?',
                        ]
                        
                        for pattern in country_patterns:
                            match = re.search(pattern, text, re.IGNORECASE)
                            if match:
                                country = match.group(0)
                                # –£–±–∏—Ä–∞–µ–º (1) –∏ —Ç.–¥.
                                country = re.sub(r'\([0-9]+\)', '', country).strip()
                                log.debug(f"Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}': {country}")
                                return country
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript
            try:
                country = await self.page.evaluate("""
                    () => {
                        const keywords = ['Country/Region', '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω', 'Country', '–°—Ç—Ä–∞–Ω–∞'];
                        const countryPatterns = [
                            /United States(?:\\([0-9]+\\))?/i,
                            /USA(?:\\([0-9]+\\))?/i,
                            /Philippines(?:\\([0-9]+\\))?/i,
                            /Russia(?:\\([0-9]+\\))?/i,
                            /China(?:\\([0-9]+\\))?/i,
                            /India(?:\\([0-9]+\\))?/i
                        ];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    for (const pattern of countryPatterns) {
                                        const match = text.match(pattern);
                                        if (match) {
                                            return match[0].replace(/\\([0-9]+\\)/g, '').trim();
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if country:
                    log.debug(f"Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript: {country}")
                    return country.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ country —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ country: {e}")
            return None
    
    async def _extract_first_seen(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å First seen –≤ —Ñ–æ—Ä–º–∞—Ç–µ 'Oct 27 2025' - —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ 'Oct 28 2025 ~ Nov 10 2025'"""
        try:
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã
            first_seen_keywords = ["First seen - Last seen", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", "First Seen"]
            
            for keyword in first_seen_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç –¥–∞—Ç—ã —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ "Oct 27 2025" –∏–ª–∏ "Oct 27, 2025"
                        # –ò—â–µ–º –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ "Oct 28 2025 ~ Nov 10 2025"
                        date_patterns = [
                            r'([A-Z][a-z]{2}\s+\d{1,2}\s+\d{4})',  # Oct 27 2025
                            r'([A-Z][a-z]{2}\s+\d{1,2},\s+\d{4})',  # Oct 27, 2025
                            r'(\d{1,2}\s+[A-Z][a-z]{2}\s+\d{4})',  # 27 Oct 2025
                        ]
                        
                        for pattern in date_patterns:
                            # –ò—â–µ–º –ø–µ—Ä–≤—É—é –¥–∞—Ç—É (–¥–æ ~ –∏–ª–∏ –∫–æ–Ω—Ü–∞ —Å—Ç—Ä–æ–∫–∏)
                            date_match = re.search(pattern, text)
                            if date_match:
                                date_str = date_match.group(1)
                                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ñ–æ—Ä–º–∞—Ç (—É–±–∏—Ä–∞–µ–º –∑–∞–ø—è—Ç—É—é –µ—Å–ª–∏ –µ—Å—Ç—å)
                                date_str = date_str.replace(',', '').strip()
                                log.debug(f"First seen –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}': {date_str}")
                                return date_str
                        
                        # –¢–∞–∫–∂–µ –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –¥–∞—Ç—É –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
                        if keyword in text:
                            parts = text.split(keyword, 1)
                            if len(parts) > 1:
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–æ ~ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω)
                                after_keyword = parts[1].split('~')[0].strip()
                                for pattern in date_patterns:
                                    date_match = re.search(pattern, after_keyword)
                                    if date_match:
                                        date_str = date_match.group(1).replace(',', '').strip()
                                        log.debug(f"First seen –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ '{keyword}': {date_str}")
                                        return date_str
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                first_seen = await self.page.evaluate("""
                    () => {
                        const keywords = ['First seen - Last seen', 'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 'First Seen'];
                        const datePatterns = [
                            /([A-Z][a-z]{2}\\s+\\d{1,2}\\s+\\d{4})/,  // Oct 27 2025
                            /([A-Z][a-z]{2}\\s+\\d{1,2},\\s+\\d{4})/,  // Oct 27, 2025
                            /(\\d{1,2}\\s+[A-Z][a-z]{2}\\s+\\d{4})/   // 27 Oct 2025
                        ];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    // –ò—â–µ–º –¥–∞—Ç—É –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    const index = text.indexOf(keyword);
                                    let afterKeyword = text.substring(index + keyword.length);
                                    
                                    // –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–æ ~ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω)
                                    if (afterKeyword.includes('~')) {
                                        afterKeyword = afterKeyword.split('~')[0];
                                    }
                                    
                                    for (const pattern of datePatterns) {
                                        const match = afterKeyword.match(pattern);
                                        if (match) {
                                            const dateStr = match[1].replace(',', '').trim();
                                            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤—É—é –Ω–∞–π–¥–µ–Ω–Ω—É—é –¥–∞—Ç—É (–±–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫ - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç –≤ _filter_videos)
                                            return dateStr;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if first_seen:
                    log.debug(f"First seen –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript: {first_seen}")
                    return first_seen.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ first_seen —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ first_seen: {e}")
            return None


```

## –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π URL –≤–º–µ—Å—Ç–æ `product_id`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `normalize_url()` –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–π –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ ban-list –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π

### 2. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –≤–∏–¥–µ–æ
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: `ad_search_url` (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π) ‚Üí `tiktok_link` ‚Üí fallback
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è `ad_search_url` (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ)
- –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

### 3. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Script/Hook/Country
- –î–æ–±–∞–≤–ª–µ–Ω retry (3 –ø–æ–ø—ã—Ç–∫–∏) –¥–ª—è `_extract_script()` –∏ `_extract_hook()`
- –£–ª—É—á—à–µ–Ω–æ –æ–∂–∏–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–¥–æ 15 —Å–µ–∫—É–Ω–¥ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏)
- –£–±—Ä–∞–Ω–æ `networkidle`, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `domcontentloaded` + –∑–∞–¥–µ—Ä–∂–∫–∞

## –û—Å—Ç–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

–ü–æ—á–µ–º—É —Ç–æ–≤–∞—Ä `1730994090387212243` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è 3 —Ä–∞–∑–∞:
- –í–æ–∑–º–æ–∂–Ω–æ, –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏ —Ç–æ—Ç –∂–µ —Ç–æ–≤–∞—Ä –ø–æ–ø–∞–¥–∞–µ—Ç —Å–Ω–æ–≤–∞
- –ò–ª–∏ URL –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö

–ù—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è, –¥–æ–±–∞–≤–ª—é –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É.

## –ß—Ç–æ –¥–∞–ª—å—à–µ

1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ ‚Äî —É–±—Ä–∞—Ç—å –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
2. –û—Å—Ç–∞–≤–∏—Ç—å –Ω–∏–∑–∫–∏–µ –ø–æ—Ä–æ–≥–∏ –¥–ª—è MVP

–ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–ª–∏ —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è?

---

**User**

—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —è –∑–∞–ø—É—Å—Ç–∏–ª —Ç–æ–ª—å–∫–æ —á—Ç–æ:



PS C:\Users\Acer\Downloads\ProductRadar-main\ProductRadar-main> python test_parser_engine.py

2025-11-14 21:16:22 - BrowserManager - INFO - ============================================================

2025-11-14 21:16:22 - BrowserManager - INFO - –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï PARSER ENGINE

2025-11-14 21:16:22 - BrowserManager - INFO - ============================================================

2025-11-14 21:16:22 - BrowserManager - INFO -

1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞...

2025-11-14 21:16:22 - BrowserManager - INFO - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Playwright...

2025-11-14 21:16:24 - BrowserManager - INFO - ‚úÖ –ë—Ä–∞—É–∑–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω

2025-11-14 21:16:24 - BrowserManager - INFO - 

2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies...

2025-11-14 21:16:24 - BrowserManager - INFO - ‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ 19 cookies

2025-11-14 21:16:24 - BrowserManager - INFO -

3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads...

2025-11-14 21:16:24 - BrowserManager - INFO - –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc (–ø–æ–ø—ã—Ç–∫–∞ 1/3)

2025-11-14 21:16:32 - BrowserManager - INFO - ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ

2025-11-14 21:16:34 - BrowserManager - INFO - 

4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...

2025-11-14 21:16:34 - BrowserManager - INFO - –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...

2025-11-14 21:16:34 - BrowserManager - INFO - –ù–∞—á–∞–ª–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ Pipiads...

2025-11-14 21:16:34 - BrowserManager - INFO - –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc (–ø–æ–ø—ã—Ç–∫–∞ 1/3)

2025-11-14 21:16:41 - BrowserManager - INFO - ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ

2025-11-14 21:16:44 - BrowserManager - INFO - –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞, —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

2025-11-14 21:16:44 - BrowserManager - INFO - –ü–æ–∏—Å–∫ –ø–æ–ª–µ–π –¥–ª—è –≤—Ö–æ–¥–∞...

2025-11-14 21:16:52 - BrowserManager - INFO - ‚úÖ –ü–æ–ª—è –¥–ª—è –≤—Ö–æ–¥–∞ –Ω–∞–π–¥–µ–Ω—ã

2025-11-14 21:16:52 - BrowserManager - INFO - –í–≤–æ–¥ email...

2025-11-14 21:16:55 - BrowserManager - INFO - –í–≤–æ–¥ –ø–∞—Ä–æ–ª—è...

2025-11-14 21:16:59 - BrowserManager - INFO - –ü–æ–∏—Å–∫ –∫–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞...

2025-11-14 21:16:59 - BrowserManager - INFO - –ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞...

2025-11-14 21:17:00 - BrowserManager - INFO - –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...

2025-11-14 21:17:06 - BrowserManager - INFO - ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞

2025-11-14 21:17:06 - BrowserManager - INFO - ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ 21 cookies

2025-11-14 21:17:06 - BrowserManager - INFO - ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ 21 cookies

2025-11-14 21:17:06 - BrowserManager - INFO -

5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine...

2025-11-14 21:17:06 - BrowserManager - INFO -

6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets...

2025-11-14 21:17:06 - BrowserManager - INFO - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets...

2025-11-14 21:17:06 - BrowserManager - INFO - ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞

2025-11-14 21:17:09 - BrowserManager - INFO - ‚úÖ –¢–∞–±–ª–∏—Ü–∞ –æ—Ç–∫—Ä—ã—Ç–∞: Airtop –≤—ã–≥—Ä—É–∑–∫–∏

2025-11-14 21:17:10 - BrowserManager - INFO - ‚úÖ –õ–∏—Å—Ç '–ß–µ—Ä–Ω–æ–≤–∏–∫' –æ—Ç–∫—Ä—ã—Ç

2025-11-14 21:17:11 - BrowserManager - INFO - ‚úÖ –õ–∏—Å—Ç '–£—Å–ø–µ—à–Ω—ã–µ' –æ—Ç–∫—Ä—ã—Ç

2025-11-14 21:17:11 - BrowserManager - INFO - ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets —É—Å–ø–µ—à–Ω–æ

2025-11-14 21:17:11 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:11 - BrowserManager - INFO - 7. –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–û–í

2025-11-14 21:17:11 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:11 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:11 - BrowserManager - INFO - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã...

2025-11-14 21:17:11 - BrowserManager - INFO - –ü—Ä–æ–≥—Ä–µ—Å—Å: 0/3 —Ç–æ–≤–∞—Ä–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ, 0/15 –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ

2025-11-14 21:17:11 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:11 - BrowserManager - INFO - –ü–æ–ª—É—á–µ–Ω–∏–µ 20 —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞...

2025-11-14 21:17:14 - BrowserManager - INFO - –°–∫—Ä–æ–ª–ª–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤...

2025-11-14 21:17:21 - BrowserManager - INFO - üîç –ù–∞–π–¥–µ–Ω–æ 60 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º 'a[href*="/tiktok-shop-product/"]'

2025-11-14 21:17:21 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #1: product_id=1729732622305364547, url=https://www.pipiads.com/tiktok-shop-product/1729732622305364547

2025-11-14 21:17:21 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 1: N/A... (ID: 1729732622305364547)

2025-11-14 21:17:21 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729732622305364547): https://www.pipiads.com/tiktok-shop-produuct/1729732622305364547

2025-11-14 21:17:21 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729732622305364547): https://www.pipiads.com/tiktok-shop-produuct/1729732622305364547

2025-11-14 21:17:21 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #2: product_id=1729992925351939069, url=https://www.pipiads.com/tiktok-shop-product/1729992925351939069

2025-11-14 21:17:21 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 2: N/A... (ID: 1729992925351939069)

2025-11-14 21:17:21 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729992925351939069): https://www.pipiads.com/tiktok-shop-produuct/1729992925351939069

2025-11-14 21:17:21 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729992925351939069): https://www.pipiads.com/tiktok-shop-produuct/1729992925351939069

2025-11-14 21:17:21 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #3: product_id=1730994090387212243, url=https://www.pipiads.com/tiktok-shop-product/1730994090387212243

2025-11-14 21:17:21 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 3: N/A... (ID: 1730994090387212243)

2025-11-14 21:17:21 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1730994090387212243): https://www.pipiads.com/tiktok-shop-produuct/1730994090387212243

2025-11-14 21:17:21 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1730994090387212243): https://www.pipiads.com/tiktok-shop-produuct/1730994090387212243

2025-11-14 21:17:21 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #4: product_id=1729882321617586962, url=https://www.pipiads.com/tiktok-shop-product/1729882321617586962

2025-11-14 21:17:21 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 4: N/A... (ID: 1729882321617586962)

2025-11-14 21:17:21 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729882321617586962): https://www.pipiads.com/tiktok-shop-produuct/1729882321617586962

2025-11-14 21:17:21 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729882321617586962): https://www.pipiads.com/tiktok-shop-produuct/1729882321617586962

2025-11-14 21:17:21 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #5: product_id=1731837917544875595, url=https://www.pipiads.com/tiktok-shop-product/1731837917544875595

2025-11-14 21:17:22 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 5: N/A... (ID: 1731837917544875595)

2025-11-14 21:17:22 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731837917544875595): https://www.pipiads.com/tiktok-shop-produuct/1731837917544875595

2025-11-14 21:17:22 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731837917544875595): https://www.pipiads.com/tiktok-shop-produuct/1731837917544875595

2025-11-14 21:17:22 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #6: product_id=1729603031836231024, url=https://www.pipiads.com/tiktok-shop-product/1729603031836231024

2025-11-14 21:17:22 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 6: N/A... (ID: 1729603031836231024)

2025-11-14 21:17:22 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729603031836231024): https://www.pipiads.com/tiktok-shop-produuct/1729603031836231024

2025-11-14 21:17:22 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729603031836231024): https://www.pipiads.com/tiktok-shop-produuct/1729603031836231024

2025-11-14 21:17:22 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #7: product_id=1730886966965209424, url=https://www.pipiads.com/tiktok-shop-product/1730886966965209424

2025-11-14 21:17:22 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 7: N/A... (ID: 1730886966965209424)

2025-11-14 21:17:22 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1730886966965209424): https://www.pipiads.com/tiktok-shop-produuct/1730886966965209424

2025-11-14 21:17:22 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1730886966965209424): https://www.pipiads.com/tiktok-shop-produuct/1730886966965209424

2025-11-14 21:17:22 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #8: product_id=1732177304007247394, url=https://www.pipiads.com/tiktok-shop-product/1732177304007247394

2025-11-14 21:17:22 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 8: N/A... (ID: 1732177304007247394)

2025-11-14 21:17:22 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1732177304007247394): https://www.pipiads.com/tiktok-shop-produuct/1732177304007247394

2025-11-14 21:17:22 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1732177304007247394): https://www.pipiads.com/tiktok-shop-produuct/1732177304007247394

2025-11-14 21:17:22 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #9: product_id=1730336399083801362, url=https://www.pipiads.com/tiktok-shop-product/1730336399083801362

2025-11-14 21:17:22 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 9: N/A... (ID: 1730336399083801362)

2025-11-14 21:17:22 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1730336399083801362): https://www.pipiads.com/tiktok-shop-produuct/1730336399083801362

2025-11-14 21:17:22 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1730336399083801362): https://www.pipiads.com/tiktok-shop-produuct/1730336399083801362

2025-11-14 21:17:22 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #10: product_id=1732278462162634274, url=https://www.pipiads.com/tiktok-shop-product/1732278462162634274

2025-11-14 21:17:23 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 10: N/A... (ID: 1732278462162634274)

2025-11-14 21:17:23 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1732278462162634274): https://www.pipiads.com/tiktok-shop-produuct/1732278462162634274

2025-11-14 21:17:23 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1732278462162634274): https://www.pipiads.com/tiktok-shop-produuct/1732278462162634274

2025-11-14 21:17:23 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #11: product_id=1732312451214640391, url=https://www.pipiads.com/tiktok-shop-product/1732312451214640391

2025-11-14 21:17:23 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 11: N/A... (ID: 1732312451214640391)

2025-11-14 21:17:23 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1732312451214640391): https://www.pipiads.com/tiktok-shop-produuct/1732312451214640391

2025-11-14 21:17:23 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1732312451214640391): https://www.pipiads.com/tiktok-shop-produuct/1732312451214640391

2025-11-14 21:17:23 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #12: product_id=1729870157239192011, url=https://www.pipiads.com/tiktok-shop-product/1729870157239192011

2025-11-14 21:17:23 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 12: N/A... (ID: 1729870157239192011)

2025-11-14 21:17:23 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729870157239192011): https://www.pipiads.com/tiktok-shop-produuct/1729870157239192011

2025-11-14 21:17:23 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729870157239192011): https://www.pipiads.com/tiktok-shop-produuct/1729870157239192011

2025-11-14 21:17:23 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #13: product_id=1731705908683179674, url=https://www.pipiads.com/tiktok-shop-product/1731705908683179674

2025-11-14 21:17:23 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 13: N/A... (ID: 1731705908683179674)

2025-11-14 21:17:23 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731705908683179674): https://www.pipiads.com/tiktok-shop-produuct/1731705908683179674

2025-11-14 21:17:23 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731705908683179674): https://www.pipiads.com/tiktok-shop-produuct/1731705908683179674

2025-11-14 21:17:23 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #14: product_id=1731158139588413926, url=https://www.pipiads.com/tiktok-shop-product/1731158139588413926

2025-11-14 21:17:23 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 14: N/A... (ID: 1731158139588413926)

2025-11-14 21:17:23 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731158139588413926): https://www.pipiads.com/tiktok-shop-produuct/1731158139588413926

2025-11-14 21:17:23 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731158139588413926): https://www.pipiads.com/tiktok-shop-produuct/1731158139588413926

2025-11-14 21:17:24 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #15: product_id=1731536666924188931, url=https://www.pipiads.com/tiktok-shop-product/1731536666924188931

2025-11-14 21:17:24 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 15: N/A... (ID: 1731536666924188931)

2025-11-14 21:17:24 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731536666924188931): https://www.pipiads.com/tiktok-shop-produuct/1731536666924188931

2025-11-14 21:17:24 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731536666924188931): https://www.pipiads.com/tiktok-shop-produuct/1731536666924188931

2025-11-14 21:17:24 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #16: product_id=1730186392032938533, url=https://www.pipiads.com/tiktok-shop-product/1730186392032938533

2025-11-14 21:17:24 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 16: N/A... (ID: 1730186392032938533)

2025-11-14 21:17:24 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1730186392032938533): https://www.pipiads.com/tiktok-shop-produuct/1730186392032938533

2025-11-14 21:17:24 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1730186392032938533): https://www.pipiads.com/tiktok-shop-produuct/1730186392032938533

2025-11-14 21:17:24 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #17: product_id=1731101132193432912, url=https://www.pipiads.com/tiktok-shop-product/1731101132193432912

2025-11-14 21:17:24 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 17: N/A... (ID: 1731101132193432912)

2025-11-14 21:17:24 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731101132193432912): https://www.pipiads.com/tiktok-shop-produuct/1731101132193432912

2025-11-14 21:17:24 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731101132193432912): https://www.pipiads.com/tiktok-shop-produuct/1731101132193432912

2025-11-14 21:17:24 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #18: product_id=1729606769780232427, url=https://www.pipiads.com/tiktok-shop-product/1729606769780232427

2025-11-14 21:17:24 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 18: N/A... (ID: 1729606769780232427)

2025-11-14 21:17:24 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729606769780232427): https://www.pipiads.com/tiktok-shop-produuct/1729606769780232427

2025-11-14 21:17:24 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729606769780232427): https://www.pipiads.com/tiktok-shop-produuct/1729606769780232427

2025-11-14 21:17:24 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #19: product_id=1731287359289985573, url=https://www.pipiads.com/tiktok-shop-product/1731287359289985573

2025-11-14 21:17:24 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 19: N/A... (ID: 1731287359289985573)

2025-11-14 21:17:24 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731287359289985573): https://www.pipiads.com/tiktok-shop-produuct/1731287359289985573

2025-11-14 21:17:24 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731287359289985573): https://www.pipiads.com/tiktok-shop-produuct/1731287359289985573

2025-11-14 21:17:24 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #20: product_id=1732278517077542434, url=https://www.pipiads.com/tiktok-shop-product/1732278517077542434

2025-11-14 21:17:25 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 20: N/A... (ID: 1732278517077542434)

2025-11-14 21:17:25 - BrowserManager - INFO - ‚úÖ –ü–æ–ª—É—á–µ–Ω–æ 20 —Ç–æ–≤–∞—Ä–æ–≤

2025-11-14 21:17:25 - BrowserManager - INFO - ‚úÖ –ü–æ–ª—É—á–µ–Ω–æ 20 —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ

2025-11-14 21:17:25 - BrowserManager - INFO - ‚úÖ –ü–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏: 20 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

2025-11-14 21:17:25 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1729732622305364547

2025-11-14 21:17:25 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 1/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:17:25 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:17:25 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:17:25 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1729732622305364547

2025-11-14 21:17:25 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ü–û –ò–ù–î–ï–ö–°–£ 0

2025-11-14 21:17:25 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:17:25 - BrowserManager - INFO -

üìå –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É 0...

2025-11-14 21:17:25 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1729732622305364547

2025-11-14 21:17:25 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:17:25 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1729732622305364547

2025-11-14 21:17:25 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1729992925351939069

2025-11-14 21:17:25 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 2/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:17:25 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:17:25 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:17:25 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1729992925351939069

2025-11-14 21:17:25 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ü–û –ò–ù–î–ï–ö–°–£ 1

2025-11-14 21:17:25 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:17:25 - BrowserManager - INFO -

üìå –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É 1...

2025-11-14 21:17:25 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1729732622305364547

2025-11-14 21:17:25 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:17:25 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1729732622305364547

2025-11-14 21:17:25 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1730994090387212243

2025-11-14 21:17:25 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 3/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:17:25 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:17:25 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:17:25 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1730994090387212243

2025-11-14 21:17:25 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ü–û –ò–ù–î–ï–ö–°–£ 2

2025-11-14 21:17:25 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:17:25 - BrowserManager - INFO -

üìå –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É 2...

2025-11-14 21:17:25 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1729732622305364547

2025-11-14 21:17:25 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:17:25 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1729732622305364547

2025-11-14 21:17:25 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1729882321617586962

2025-11-14 21:17:25 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 4/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:17:25 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:17:25 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:17:25 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1729882321617586962

2025-11-14 21:17:25 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ü–û –ò–ù–î–ï–ö–°–£ 3

2025-11-14 21:17:25 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:17:25 - BrowserManager - INFO -

üìå –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É 3...

2025-11-14 21:17:25 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1729992925351939069

2025-11-14 21:17:25 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:17:25 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1729992925351939069

2025-11-14 21:17:25 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1731837917544875595

2025-11-14 21:17:25 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 5/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:17:25 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:17:25 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:17:25 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1731837917544875595

2025-11-14 21:17:25 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ü–û –ò–ù–î–ï–ö–°–£ 4

2025-11-14 21:17:25 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:17:25 - BrowserManager - INFO - 

üìå –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É 4...

2025-11-14 21:17:25 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1729992925351939069

2025-11-14 21:17:25 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:17:25 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1729992925351939069

2025-11-14 21:17:25 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1729603031836231024

2025-11-14 21:17:25 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 6/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:17:25 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:17:25 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:17:25 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1729603031836231024

2025-11-14 21:17:25 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ü–û –ò–ù–î–ï–ö–°–£ 5

2025-11-14 21:17:25 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:17:25 - BrowserManager - INFO -

üìå –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É 5...

2025-11-14 21:17:25 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1729992925351939069

2025-11-14 21:17:25 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:17:25 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1729992925351939069

2025-11-14 21:17:25 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1730886966965209424

2025-11-14 21:17:25 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 7/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:17:25 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:17:25 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:17:25 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1730886966965209424

2025-11-14 21:17:25 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ü–û –ò–ù–î–ï–ö–°–£ 6

2025-11-14 21:17:25 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:17:25 - BrowserManager - INFO -

üìå –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É 6...

2025-11-14 21:17:25 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1730994090387212243

2025-11-14 21:17:25 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:17:25 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1730994090387212243

2025-11-14 21:17:25 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1732177304007247394

2025-11-14 21:17:25 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 8/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:17:25 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:17:25 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:17:25 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1732177304007247394

2025-11-14 21:17:25 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ü–û –ò–ù–î–ï–ö–°–£ 7

2025-11-14 21:17:25 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:17:25 - BrowserManager - INFO -

üìå –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É 7...

2025-11-14 21:17:25 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1730994090387212243

2025-11-14 21:17:25 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:17:25 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1730994090387212243

2025-11-14 21:17:25 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1730336399083801362

2025-11-14 21:17:25 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 9/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:17:25 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:17:25 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:17:25 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1730336399083801362

2025-11-14 21:17:25 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ü–û –ò–ù–î–ï–ö–°–£ 8

2025-11-14 21:17:25 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:25 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:17:25 - BrowserManager - INFO -

üìå –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É 8...

2025-11-14 21:17:25 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1730994090387212243

2025-11-14 21:17:25 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:17:25 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1730994090387212243

2025-11-14 21:17:25 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1732278462162634274

2025-11-14 21:17:25 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 10/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:17:26 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:17:26 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:17:26 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1732278462162634274

2025-11-14 21:17:26 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ü–û –ò–ù–î–ï–ö–°–£ 9

2025-11-14 21:17:26 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:17:26 - BrowserManager - INFO -

üìå –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É 9...

2025-11-14 21:17:26 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1729882321617586962

2025-11-14 21:17:26 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:17:26 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1729882321617586962

2025-11-14 21:17:26 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1732312451214640391

2025-11-14 21:17:26 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 11/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:17:26 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:17:26 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:17:26 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1732312451214640391

2025-11-14 21:17:26 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ü–û –ò–ù–î–ï–ö–°–£ 10

2025-11-14 21:17:26 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:17:26 - BrowserManager - INFO -

üìå –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É 10...

2025-11-14 21:17:26 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1729882321617586962

2025-11-14 21:17:26 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:17:26 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1729882321617586962

2025-11-14 21:17:26 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1729870157239192011

2025-11-14 21:17:26 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 12/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:17:26 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:17:26 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:17:26 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1729870157239192011

2025-11-14 21:17:26 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ü–û –ò–ù–î–ï–ö–°–£ 11

2025-11-14 21:17:26 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:17:26 - BrowserManager - INFO -

üìå –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É 11...

2025-11-14 21:17:26 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1729882321617586962

2025-11-14 21:17:26 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:17:26 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1729882321617586962

2025-11-14 21:17:26 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1731705908683179674

2025-11-14 21:17:26 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 13/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:17:26 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:17:26 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:17:26 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1731705908683179674

2025-11-14 21:17:26 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ü–û –ò–ù–î–ï–ö–°–£ 12

2025-11-14 21:17:26 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:17:26 - BrowserManager - INFO -

üìå –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É 12...

2025-11-14 21:17:26 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1731837917544875595

2025-11-14 21:17:26 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:17:26 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1731837917544875595

2025-11-14 21:17:26 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1731158139588413926

2025-11-14 21:17:26 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 14/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:17:26 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:17:26 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:17:26 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1731158139588413926

2025-11-14 21:17:26 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ü–û –ò–ù–î–ï–ö–°–£ 13

2025-11-14 21:17:26 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:17:26 - BrowserManager - INFO -

üìå –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É 13...

2025-11-14 21:17:26 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1731837917544875595

2025-11-14 21:17:26 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:17:26 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1731837917544875595

2025-11-14 21:17:26 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1731536666924188931

2025-11-14 21:17:26 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 15/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:17:26 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:17:26 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:17:26 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1731536666924188931

2025-11-14 21:17:26 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ü–û –ò–ù–î–ï–ö–°–£ 14

2025-11-14 21:17:26 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:17:26 - BrowserManager - INFO -

üìå –®–ê–ì 1: –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä –ø–æ –∏–Ω–¥–µ–∫—Å—É 14...

2025-11-14 21:17:26 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1731837917544875595

2025-11-14 21:17:26 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:17:26 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1731837917544875595

2025-11-14 21:17:26 - BrowserManager - WARNING -

‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ (15 —Ç–æ–≤–∞—Ä–æ–≤)

2025-11-14 21:17:26 - BrowserManager - INFO -

================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO - üìä –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢

2025-11-14 21:17:26 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO - ‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: 0

2025-11-14 21:17:26 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: 0

2025-11-14 21:17:26 - BrowserManager - INFO - üîç –í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: 15

2025-11-14 21:17:26 - BrowserManager - INFO - üö´ –¢–æ–≤–∞—Ä–æ–≤ –≤ ban-list: 15

2025-11-14 21:17:26 - BrowserManager - INFO - ================================================================================

2025-11-14 21:17:26 - BrowserManager - INFO -

üö´ BAN-LIST (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã):

2025-11-14 21:17:26 - BrowserManager - INFO -    1. https://www.pipiads.com/tiktok-shop-product/1729603031836231024

2025-11-14 21:17:26 - BrowserManager - INFO -    2. https://www.pipiads.com/tiktok-shop-product/1729732622305364547

2025-11-14 21:17:26 - BrowserManager - INFO -    3. https://www.pipiads.com/tiktok-shop-product/1729870157239192011

2025-11-14 21:17:26 - BrowserManager - INFO -    4. https://www.pipiads.com/tiktok-shop-product/1729882321617586962

2025-11-14 21:17:26 - BrowserManager - INFO -    5. https://www.pipiads.com/tiktok-shop-product/1729992925351939069

2025-11-14 21:17:26 - BrowserManager - INFO -    6. https://www.pipiads.com/tiktok-shop-product/1730336399083801362

2025-11-14 21:17:26 - BrowserManager - INFO -    7. https://www.pipiads.com/tiktok-shop-product/1730886966965209424

2025-11-14 21:17:26 - BrowserManager - INFO -    8. https://www.pipiads.com/tiktok-shop-product/1730994090387212243

2025-11-14 21:17:26 - BrowserManager - INFO -    9. https://www.pipiads.com/tiktok-shop-product/1731158139588413926

2025-11-14 21:17:26 - BrowserManager - INFO -    10. https://www.pipiads.com/tiktok-shop-product/1731536666924188931

2025-11-14 21:17:26 - BrowserManager - INFO -    11. https://www.pipiads.com/tiktok-shop-product/1731705908683179674

2025-11-14 21:17:26 - BrowserManager - INFO -    12. https://www.pipiads.com/tiktok-shop-product/1731837917544875595

2025-11-14 21:17:26 - BrowserManager - INFO -    13. https://www.pipiads.com/tiktok-shop-product/1732177304007247394

2025-11-14 21:17:26 - BrowserManager - INFO -    14. https://www.pipiads.com/tiktok-shop-product/1732278462162634274

2025-11-14 21:17:26 - BrowserManager - INFO -    15. https://www.pipiads.com/tiktok-shop-product/1732312451214640391

2025-11-14 21:17:26 - BrowserManager - WARNING -

‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ (15 —Ç–æ–≤–∞—Ä–æ–≤)

2025-11-14 21:17:26 - BrowserManager - WARNING -    –°–æ–±—Ä–∞–Ω–æ —Ç–æ–ª—å–∫–æ 0 —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ 3

2025-11-14 21:17:26 - BrowserManager - INFO -

============================================================

2025-11-14 21:17:26 - BrowserManager - INFO - üìù –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –≤–∏–¥–µ–æ...

2025-11-14 21:17:26 - BrowserManager - INFO - ============================================================

2025-11-14 21:17:26 - BrowserManager - INFO - ‚úÖ Summary —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω: logs/summaries/iteration_2025-11-14_21-17-26.md

2025-11-14 21:17:26 - BrowserManager - INFO - 

============================================================

2025-11-14 21:17:26 - BrowserManager - INFO - ‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û

2025-11-14 21:17:26 - BrowserManager - INFO - ============================================================

2025-11-14 21:17:26 - BrowserManager - INFO -

‚è∏Ô∏è –û–∂–∏–¥–∞–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –±—Ä–∞—É–∑–µ—Ä–∞ (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)...

2025-11-14 21:17:26 - BrowserManager - INFO -    –ù–∞–∂–º–∏—Ç–µ Ctrl+C, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å —Ä–∞–Ω—å—à–µ

2025-11-14 21:17:37 - BrowserManager - INFO - –ë—Ä–∞—É–∑–µ—Ä –∑–∞–∫—Ä—ã—Ç

PS C:\Users\Acer\Downloads\ProductRadar-main\ProductRadar-main> 

---

**Cursor**

–ü—Ä–æ–±–ª–µ–º–∞: –≤ `get_product_details_with_return` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ, –Ω–æ –ø–æ—Ä—è–¥–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –º–æ–∂–µ—Ç –Ω–µ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å–æ —Å–ø–∏—Å–∫–æ–º `products`. –ò–∑-–∑–∞ —ç—Ç–æ–≥–æ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –Ω–µ —Ç–æ—Ç —Ç–æ–≤–∞—Ä.

–ò—Å–ø—Ä–∞–≤–ª—è—é: –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å URL —Ç–æ–≤–∞—Ä–∞ –Ω–∞–ø—Ä—è–º—É—é –≤–º–µ—Å—Ç–æ –∏–Ω–¥–µ–∫—Å–∞.


–ò—Å–ø—Ä–∞–≤–ª—è—é: –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å URL —Ç–æ–≤–∞—Ä–∞ –Ω–∞–ø—Ä—è–º—É—é –≤–º–µ—Å—Ç–æ –∏–Ω–¥–µ–∫—Å–∞, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø–æ—Ä—è–¥–∫–∞.


```python
"""
Parser Engine - –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö —Å Pipiads
"""

import asyncio
import re
import time
from typing import List, Dict, Optional, Any
from datetime import datetime

from playwright.async_api import Page, TimeoutError as PlaywrightTimeoutError

from . import config
from . import logger
from . import validator

log = logger.get_logger("ParserEngine")


class ProductData:
    """–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞"""
    def __init__(self):
        self.product_name: str = ""
        self.category: str = ""
        self.pipiads_link: str = ""
        self.videos: List[Dict[str, Any]] = []


class ParserEngine:
    """–ü–∞—Ä—Å–µ—Ä –¥–∞–Ω–Ω—ã—Ö —Å Pipiads"""
    
    def __init__(self, page: Page):
        self.page = page
        self.browser_manager = None  # –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ human_delay
    
    def set_browser_manager(self, browser_manager):
        """–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ browser_manager –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è human_delay"""
        self.browser_manager = browser_manager
    
    async def human_delay(self, min_seconds: float = 1, max_seconds: float = 3):
        """–ò–º–∏—Ç–∞—Ü–∏—è —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏"""
        if self.browser_manager:
            await self.browser_manager.human_delay(min_seconds, max_seconds)
        else:
            delay = asyncio.sleep(1)  # Fallback
            await delay
    
    async def scroll_to_element(self, selector: str, timeout: int = 10000):
        """
        –°–∫—Ä–æ–ª–ª–∏—Ç—å –¥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
        
        Args:
            selector: –°–µ–ª–µ–∫—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞
            timeout: –¢–∞–π–º–∞—É—Ç –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
        """
        try:
            element = await self.page.wait_for_selector(selector, timeout=timeout, state="visible")
            if element:
                await element.scroll_into_view_if_needed()
                await self.human_delay(0.5, 1)
                return True
        except:
            pass
        return False
    
    async def get_products_from_search_page(self, count: int = 3) -> List[Dict[str, str]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞
        
        Args:
            count: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ (–¥–ª—è MVP-0: 1, –ø–æ—Ç–æ–º —Ä–∞—Å—à–∏—Ä–∏–º –¥–æ 3)
        
        Returns:
            –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–æ–≤: [{"name": "...", "category": "...", "url": "..."}]
        """
        log.info(f"–ü–æ–ª—É—á–µ–Ω–∏–µ {count} —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞...")
        
        try:
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (domcontentloaded –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º networkidle)
            await self.page.wait_for_load_state("domcontentloaded")
            await self.human_delay(2, 3)
            
            # –°–∫—Ä–æ–ª–ª–∏–º –≤–Ω–∏–∑, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
            log.info("–°–∫—Ä–æ–ª–ª–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤...")
            for i in range(3):  # –°–∫—Ä–æ–ª–ª–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
                await self.page.evaluate("window.scrollBy(0, 500)")
                await self.human_delay(1, 2)
            
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤
            await self.human_delay(2, 3)
            
            # –ò—â–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ - –ø—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
            product_selectors = [
                'a[href*="/tiktok-shop-product/"]',
                '[class*="product"]',
                '[class*="card"]',
                'div[class*="item"]',
            ]
            
            products = []
            product_ids = set()  # –î–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ product_id
            
            def extract_product_id(url: str) -> str:
                """–ò–∑–≤–ª–µ—á—å product_id –∏–∑ URL"""
                # https://www.pipiads.com/tiktok-shop-product/1729732622305364547/
                # ‚Üí 1729732622305364547
                url_normalized = url.rstrip('/')
                parts = url_normalized.split('/')
                return parts[-1] if parts else ""
            
            for selector in product_selectors:
                try:
                    elements = await self.page.query_selector_all(selector)
                    log.info(f"üîç –ù–∞–π–¥–µ–Ω–æ {len(elements)} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º '{selector}'")
                    
                    for element in elements:
                        if len(products) >= count:
                            break
                        
                        try:
                            # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É
                            href = await element.get_attribute("href")
                            if not href:
                                # –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ —Å—Å—ã–ª–∫–∞, –∏—â–µ–º —Å—Å—ã–ª–∫—É –≤–Ω—É—Ç—Ä–∏
                                link_element = await element.query_selector('a[href*="/tiktok-shop-product/"]')
                                if link_element:
                                    href = await link_element.get_attribute("href")
                            
                            if href and "/tiktok-shop-product/" in href:
                                # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π URL
                                if href.startswith("/"):
                                    url = f"https://www.pipiads.com{href}"
                                elif href.startswith("http"):
                                    url = href
                                else:
                                    url = f"https://www.pipiads.com/{href}"
                                
                                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º URL (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ)
                                url = url.rstrip('/')
                                
                                # –ò–∑–≤–ª–µ–∫–∞–µ–º product_id –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
                                product_id = extract_product_id(url)
                                
                                if not product_id:
                                    log.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å product_id –∏–∑ URL: {url}")
                                    continue
                                
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä (–ø–æ product_id)
                                if product_id in product_ids:
                                    log.info(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id={product_id}): {url}")
                                    continue
                                
                                product_ids.add(product_id)
                                log.info(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #{len(products) + 1}: product_id={product_id}, url={url}")
                                
                                # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
                                name = ""
                                name_selectors = [
                                    'h1', 'h2', 'h3',
                                    '[class*="title"]',
                                    '[class*="name"]',
                                    'a',
                                ]
                                
                                for name_sel in name_selectors:
                                    try:
                                        name_elem = await element.query_selector(name_sel)
                                        if name_elem:
                                            name = await name_elem.inner_text()
                                            if name and len(name) > 5:  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏—è
                                                break
                                    except:
                                        continue
                                
                                # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                                category = ""
                                category_selectors = [
                                    '[class*="category"]',
                                    '[class*="tag"]',
                                    'span',
                                ]
                                
                                for cat_sel in category_selectors:
                                    try:
                                        cat_elem = await element.query_selector(cat_sel)
                                        if cat_elem:
                                            text = await cat_elem.inner_text()
                                            if text and len(text) < 50:  # –ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±—ã—á–Ω–æ –∫–æ—Ä–æ—Ç–∫–∞—è
                                                category = text
                                                break
                                    except:
                                        continue
                                
                                if url and product_id:
                                    products.append({
                                        "name": name.strip() if name else "N/A",
                                        "category": category.strip() if category else "N/A",
                                        "url": url,
                                        "product_id": product_id  # –î–æ–±–∞–≤–ª—è–µ–º product_id –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
                                    })
                                    log.info(f"   üì¶ –¢–æ–≤–∞—Ä {len(products)}: {name[:50] if name else 'N/A'}... (ID: {product_id})")
                                
                        except Exception as e:
                            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —ç–ª–µ–º–µ–Ω—Ç–∞: {e}")
                            continue
                    
                    if len(products) >= count:
                        break
                        
                except Exception as e:
                    log.debug(f"–û—à–∏–±–∫–∞ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º {selector}: {e}")
                    continue
            
            if len(products) < count:
                log.warning(f"–ù–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ {count} –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã—Ö")
            
            log.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤")
            return products[:count]
            
        except Exception as e:
            log.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
            import traceback
            log.error(traceback.format_exc())
            return []
    
    async def get_product_details(self, product_url: str, sheets_writer=None) -> ProductData:
        """
        –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞ –∏ –≤–∏–¥–µ–æ
        
        Args:
            product_url: URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞
        
        Returns:
            ProductData —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞ –∏ –≤–∏–¥–µ–æ
        """
        log.info("=" * 80)
        log.info(f"üîÑ –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–ê")
        log.info(f"URL: {product_url}")
        log.info("=" * 80)
        
        product_data = ProductData()
        product_data.pipiads_link = product_url
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è page
        if not self.page:
            log.error("‚ùå –û–®–ò–ë–ö–ê: page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
            return product_data
        
        try:
            # –®–ê–ì 1: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞
            log.info("\nüìå –®–ê–ì 1: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞...")
            try:
                log.info(f"  ‚Üí –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {product_url}")
                if not self.page:
                    raise Exception("Page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
                await self.page.goto(product_url, wait_until="domcontentloaded", timeout=30000)
                log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            except Exception as e:
                log.error(f"  ‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {e}")
                log.error(f"  ‚Üí –¢–∏–ø –æ—à–∏–±–∫–∏: {type(e).__name__}")
                import traceback
                log.error(f"  ‚Üí –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:\n{traceback.format_exc()}")
                # –ü—Ä–æ–±—É–µ–º –ø–æ–¥–æ–∂–¥–∞—Ç—å –µ—â–µ –Ω–µ–º–Ω–æ–≥–æ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                try:
                    await self.human_delay(2, 3)
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Å–µ –µ—â–µ –¥–æ—Å—Ç—É–ø–Ω–∞
                    if self.page:
                        current_url = self.page.url
                        log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
                except Exception as e2:
                    log.error(f"  ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e2}")
                    return product_data
            
            try:
                await self.human_delay(0.5, 1)
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–¥–µ—Ä–∂–∫–µ: {e}")
            
            # –®–ê–ì 1.5: –ü–µ—Ä–µ–≤–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫
            log.info("\nüìå –®–ê–ì 1.5: –ü–µ—Ä–µ–≤–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫...")
            try:
                current_url = self.page.url
                log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
                
                # –ï—Å–ª–∏ URL —Å–æ–¥–µ—Ä–∂–∏—Ç /ru/, –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ /en/
                if "/ru/" in current_url:
                    english_url = current_url.replace("/ru/", "/en/")
                    log.info(f"  ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫—É—é –≤–µ—Ä—Å–∏—é: {english_url}")
                    await self.page.goto(english_url, wait_until="domcontentloaded", timeout=30000)
                    await self.human_delay(1, 2)
                    log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π")
                else:
                    # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞
                    log.info("  ‚Üí –ü–æ–∏—Å–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —è–∑—ã–∫–∞...")
                    lang_selectors = [
                        'a[href*="/en/"]',
                        'button:has-text("English")',
                        '[class*="language"]',
                        '[class*="lang"]',
                        'select[name*="lang"]',
                    ]
                    
                    lang_found = False
                    for selector in lang_selectors:
                        try:
                            lang_element = await self.page.query_selector(selector)
                            if lang_element:
                                is_visible = await lang_element.is_visible()
                                if is_visible:
                                    await lang_element.click()
                                    await self.human_delay(1, 2)
                                    log.info(f"  ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ –Ω–∞–π–¥–µ–Ω –∏ –Ω–∞–∂–∞—Ç: {selector}")
                                    lang_found = True
                                    break
                        except:
                            continue
                    
                    if not lang_found:
                        log.warning("  ‚ö†Ô∏è –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –Ω–∞ —Ç–µ–∫—É—â–µ–º —è–∑—ã–∫–µ")
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            # –®–ê–ì 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Product Name
            log.info("\nüìå –®–ê–ì 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Product Name...")
            try:
                # –°–∫—Ä–æ–ª–ª–∏–º –≤–≤–µ—Ä—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
                log.info("  ‚Üí –°–∫—Ä–æ–ª–ª–∏–º –≤–≤–µ—Ä—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞...")
                if not self.page:
                    raise Exception("Page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
                await self.page.evaluate("window.scrollTo(0, 0)")
                await self.human_delay(0.3, 0.5)
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ: {e}")
                # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É
            
            # –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ - –ø—Ä–æ–±—É–µ–º –±–æ–ª—å—à–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –∏ –º–µ—Ç–æ–¥–æ–≤
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã...")
            try:
                # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
                name_selectors = [
                    'h1:first-of-type',
                    'h1[class*="product"]',
                    'h1[class*="title"]',
                    '[class*="product-title"]',
                    '[class*="product-name"]',
                    '[class*="product_title"]',
                    '[class*="product_name"]',
                    'h1',
                    'h2:first-of-type',
                    '[data-testid*="title"]',
                    '[data-testid*="name"]',
                    '[data-testid*="product-title"]',
                ]
                
                for selector in name_selectors:
                    try:
                        elements = await self.page.query_selector_all(selector)
                        for element in elements:
                            name = await element.inner_text()
                            if name and len(name) > 3:
                                # –§–∏–ª—å—Ç—Ä—É–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã
                                name_lower = name.lower()
                                skip_words = ['–æ—Å—Ç–∞—Ç–æ–∫', 'remain', 'stock', '–º–µ—Å—è—Ü', 'month', '–∫–æ–º–∏—Å—Å–∏—è', 'commission', 
                                            'tiktok shop product detail', 'category', '–∫–∞—Ç–µ–≥–æ—Ä–∏—è']
                                if any(skip in name_lower for skip in skip_words):
                                    continue
                                # –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å "TikTok Shop Product Detail:" –µ—Å–ª–∏ –µ—Å—Ç—å
                                if "TikTok Shop Product Detail:" in name:
                                    name = name.split("TikTok Shop Product Detail:")[-1].strip()
                                # –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
                                if name.lower().startswith('tiktok shop product'):
                                    name = re.sub(r'^tiktok shop product\s*:?\s*', '', name, flags=re.IGNORECASE).strip()
                                if name.lower().endswith('tiktok shop product'):
                                    name = re.sub(r'\s*tiktok shop product\s*$', '', name, flags=re.IGNORECASE).strip()
                                # –£–±–∏—Ä–∞–µ–º, –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ "TikTok Shop Product"
                                if name.lower() == 'tiktok shop product' or name.lower() == 'tiktok shop product detail':
                                    continue
                                if ":" in name and len(name.split(":")[0]) < 20:
                                    name = name.split(":", 1)[-1].strip()
                                product_data.product_name = name.strip()
                                if len(product_data.product_name) > 5:
                                    log.info(f"  ‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞–π–¥–µ–Ω–æ: {product_data.product_name[:50]}...")
                                    break
                        if product_data.product_name and len(product_data.product_name) > 5:
                            break
                    except:
                        continue
                
                # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
                if not product_data.product_name or len(product_data.product_name) <= 5:
                    try:
                        product_name = await self.page.evaluate("""
                            () => {
                                // –ò—â–µ–º h1
                                const h1 = document.querySelector('h1');
                                if (h1) {
                                    const text = h1.innerText.trim();
                                    if (text && text.length > 5 && !text.toLowerCase().includes('tiktok shop product detail')) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º –≤ —ç–ª–µ–º–µ–Ω—Ç–∞—Ö —Å –∫–ª–∞—Å—Å–æ–º product
                                const productElements = document.querySelectorAll('[class*="product"][class*="title"], [class*="product"][class*="name"]');
                                for (const el of productElements) {
                                    const text = el.innerText.trim();
                                    if (text && text.length > 5) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º —Å–∞–º—ã–π –±–æ–ª—å—à–æ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–æ–±—ã—á–Ω–æ —ç—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞)
                                // –ù–û –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã —Ç–∏–ø–∞ "Ad Analysis"
                                const headings = document.querySelectorAll('h1, h2, h3');
                                let maxLength = 0;
                                let bestHeading = null;
                                for (const h of headings) {
                                    const text = h.innerText.trim();
                                    const skipWords = ['tiktok', 'shop', 'product', 'detail', 'category', 'commission', 
                                                      '–æ—Å—Ç–∞—Ç–æ–∫', 'remain', 'stock', 'ad analysis', 'analysis', 
                                                      'limited time', 'promotion', 'annual plan', 'tiktok shop product'];
                                    const textLower = text.toLowerCase();
                                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã (–º–µ–Ω—å—à–µ 20 —Å–∏–º–≤–æ–ª–æ–≤) - —ç—Ç–æ –æ–±—ã—á–Ω–æ –Ω–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
                                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º "TikTok Shop Product" –∏ –ø–æ—Ö–æ–∂–∏–µ —Ç–µ–∫—Å—Ç—ã
                                    if (!skipWords.some(word => textLower.includes(word)) && 
                                        text.length > maxLength && text.length > 20 &&
                                        !textLower.includes('tiktok shop product')) {
                                        maxLength = text.length;
                                        bestHeading = text;
                                    }
                                }
                                if (bestHeading) {
                                    return bestHeading;
                                }
                                
                                // –ò—â–µ–º –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–∞—Ö - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ–±—ã—á–Ω–æ –¥–ª–∏–Ω–Ω–æ–µ
                                // –ù–∞–ø—Ä–∏–º–µ—Ä: "[BUY 1 TAKE 11] SHEEureka Scrub Facial Cleanser..."
                                // –ù–û –∏—Å–∫–ª—é—á–∞–µ–º —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                           'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                           'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                           'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                           'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                const textBlocks = document.querySelectorAll('p, div, span');
                                for (const block of textBlocks) {
                                    const text = block.innerText.trim();
                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    const isFooterMenu = footerMenuKeywords.some(keyword => text.includes(keyword));
                                    if (isFooterMenu) continue;
                                    
                                    // –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ–±—ã—á–Ω–æ –¥–ª–∏–Ω–Ω–æ–µ (–±–æ–ª—å—à–µ 30 —Å–∏–º–≤–æ–ª–æ–≤) –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–æ–≤–∞ —Ç–∏–ø–∞ "Set", "Kit", "Mask" –∏ —Ç.–¥.
                                    // –ò–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å "[" (–Ω–∞–ø—Ä–∏–º–µ—Ä "[BUY 1 TAKE 11]")
                                    if (text.length > 30 && text.length < 500 && 
                                        !text.toLowerCase().includes('ad analysis') &&
                                        !text.toLowerCase().includes('limited time') &&
                                        !text.toLowerCase().includes('promotion') &&
                                        !text.toLowerCase().includes('annual plan') &&
                                        (text.startsWith('[') || text.includes('Set') || text.includes('Kit') || 
                                         text.includes('Mask') || text.includes('Cleanser') || text.includes('Gift') ||
                                         text.includes('Scrub') || text.includes('Facial') || text.includes('Repairing'))) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º –≤ –º–µ—Ç–∞-—Ç–µ–≥–∞—Ö
                                const ogTitle = document.querySelector('meta[property="og:title"]');
                                if (ogTitle && ogTitle.content) {
                                    let title = ogTitle.content;
                                    if (title.includes('TikTok Shop Product Detail:')) {
                                        title = title.split('TikTok Shop Product Detail:')[1].trim();
                                    }
                                    // –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞
                                    if (title.toLowerCase().startsWith('tiktok shop product')) {
                                        title = title.replace(/^tiktok shop product\s*:?\s*/i, '').trim();
                                    }
                                    if (title && title.length > 5 && !title.toLowerCase().includes('tiktok shop product')) {
                                        return title;
                                    }
                                }
                                
                                return null;
                            }
                        """)
                        if product_name and len(product_name) > 5:
                            product_name = product_name.strip()
                            # –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
                            if product_name.lower().startswith('tiktok shop product'):
                                product_name = re.sub(r'^tiktok shop product\s*:?\s*', '', product_name, flags=re.IGNORECASE).strip()
                            if product_name.lower().endswith('tiktok shop product'):
                                product_name = re.sub(r'\s*tiktok shop product\s*$', '', product_name, flags=re.IGNORECASE).strip()
                            # –£–±–∏—Ä–∞–µ–º, –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ "TikTok Shop Product"
                            if product_name.lower() == 'tiktok shop product' or product_name.lower() == 'tiktok shop product detail':
                                product_name = None
                            if product_name and len(product_name) > 5:
                                product_data.product_name = product_name
                                log.info(f"  ‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞–π–¥–µ–Ω–æ (—á–µ—Ä–µ–∑ JS): {product_data.product_name[:50]}...")
                    except Exception as e:
                        log.debug(f"  ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —á–µ—Ä–µ–∑ JS: {e}")
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞: {e}")
            
            if not product_data.product_name or len(product_data.product_name) <= 5:
                log.warning("  ‚ö†Ô∏è –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                product_data.product_name = "N/A"
            
            # –®–ê–ì 3: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Category
            log.info("\nüìå –®–ê–ì 3: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Category...")
            try:
                log.info("  ‚Üí –ü–æ–∏—Å–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–∞...")
                
                # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
                category_selectors = [
                    '[class*="category"]',
                    '[class*="tag"]',
                    'span:has-text("Category")',
                    'span:has-text("–ö–∞—Ç–µ–≥–æ—Ä–∏—è")',
                    'text=/Category/i',
                    'text=/–ö–∞—Ç–µ–≥–æ—Ä–∏—è/i',
                    'div:has-text("Category")',
                    'div:has-text("–ö–∞—Ç–µ–≥–æ—Ä–∏—è")',
                ]
                
                for selector in category_selectors:
                    try:
                        elements = await self.page.query_selector_all(selector)
                        for element in elements:
                            category = await element.inner_text()
                            if category:
                                # –û—á–∏—â–∞–µ–º –æ—Ç –ª–∏—à–Ω–µ–≥–æ —Ç–µ–∫—Å—Ç–∞
                                category = re.sub(r'Category\s*:', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'–ö–∞—Ç–µ–≥–æ—Ä–∏—è\s*:', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'Commission\s*Rate\s*:.*', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'–ö–æ–º–∏—Å—Å–∏—è\s*:.*', '', category, flags=re.IGNORECASE)
                                # –£–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä "15.00%")
                                category = re.sub(r'\s*\d+\.?\d*\s*%', '', category)
                                # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ —Å–∏–º–≤–æ–ª—ã > –∏ –ø—Ä–æ–±–µ–ª—ã
                                category = re.sub(r'\s*>\s*', ' > ', category)
                                category = category.strip()
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é —á–∞—Å—Ç—å –¥–æ "Commission" –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É
                                if "Commission" in category or "–ö–æ–º–∏—Å—Å–∏—è" in category:
                                    category = category.split("Commission")[0].split("–ö–æ–º–∏—Å—Å–∏—è")[0].strip()
                                if len(category) > 100:
                                    category = category[:100]
                                if category and len(category) > 3:
                                    product_data.category = category
                                    log.info(f"  ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–∞: {product_data.category}")
                                    break
                        if product_data.category:
                            break
                    except:
                        continue
                
                # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π)
                if not product_data.category:
                    try:
                        category = await self.page.evaluate("""
                            () => {
                                // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Category" –∏–ª–∏ "–ö–∞—Ç–µ–≥–æ—Ä–∏—è"
                                const allElements = document.querySelectorAll('*');
                                for (const el of allElements) {
                                    const text = el.innerText || '';
                                    if (text.includes('Category') || text.includes('–ö–∞—Ç–µ–≥–æ—Ä–∏—è')) {
                                        // –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ—Å–ª–µ "Category:" –∏–ª–∏ "–ö–∞—Ç–µ–≥–æ—Ä–∏—è:"
                                        let categoryText = text;
                                        if (categoryText.includes('Category:')) {
                                            categoryText = categoryText.split('Category:')[1];
                                        } else if (categoryText.includes('–ö–∞—Ç–µ–≥–æ—Ä–∏—è:')) {
                                            categoryText = categoryText.split('–ö–∞—Ç–µ–≥–æ—Ä–∏—è:')[1];
                                        }
                                        
                                        // –£–±–∏—Ä–∞–µ–º "Commission Rate" –∏ –≤—Å–µ –ø–æ—Å–ª–µ
                                        if (categoryText.includes('Commission Rate') || categoryText.includes('–ö–æ–º–∏—Å—Å–∏—è')) {
                                            categoryText = categoryText.split('Commission Rate')[0].split('–ö–æ–º–∏—Å—Å–∏—è')[0];
                                        }
                                        
                                        // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä "15.00%")
                                        categoryText = categoryText.replace(/\s*\d+\.?\d*\s*%/g, '');
                                        
                                        categoryText = categoryText.trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é (—Å–æ–¥–µ—Ä–∂–∏—Ç ">" –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–æ–≤)
                                        if (categoryText && categoryText.length > 3 && 
                                            (categoryText.includes('>') || categoryText.split(' ').length >= 2)) {
                                            return categoryText.substring(0, 100);
                                        }
                                    }
                                }
                                return null;
                            }
                        """)
                        if category and len(category) > 3:
                            product_data.category = category.strip()
                            log.info(f"  ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–∞ (—á–µ—Ä–µ–∑ JS): {product_data.category}")
                    except Exception as e:
                        log.debug(f"  ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ JS: {e}")
                
                if not product_data.category:
                    log.warning("  ‚ö†Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ 'N/A'")
                    product_data.category = "N/A"
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {e}")
                product_data.category = "N/A"
            
            # –®–ê–ì 3.5: –ó–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets (–µ—Å–ª–∏ sheets_writer –ø–µ—Ä–µ–¥–∞–Ω)
            # –í–ê–ñ–ù–û: –ï—Å–ª–∏ —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ
            if sheets_writer:
                log.info("\nüìå –®–ê–ì 3.5: –ó–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets...")
                try:
                    row_number = sheets_writer.write_basic_product_data(
                        product_data.product_name,
                        product_data.category,
                        product_data.pipiads_link
                    )
                    if row_number > 0:
                        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ
                        product_data._sheets_row = row_number
                        log.info(f"  ‚úÖ –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {row_number})")
                    else:
                        # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–≤–æ–∑–º–æ–∂–Ω–æ, —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã),
                        # –Ω–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö
                        log.warning("  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–≤–æ–∑–º–æ–∂–Ω–æ, —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã)")
                        log.info("  ‚Üí –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö...")
                        row_number = sheets_writer.find_next_empty_row()
                        product_data._sheets_row = row_number
                        log.info(f"  ‚úÖ –ë—É–¥–µ–º –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫—É {row_number}")
                except Exception as e:
                    log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö: {e}")
                    # –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ
                    try:
                        row_number = sheets_writer.find_next_empty_row()
                        product_data._sheets_row = row_number
                        log.info(f"  ‚Üí –ë—É–¥–µ–º –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫—É {row_number}")
                    except:
                        pass
            
            # –®–ê–ì 4: –ü–æ–∏—Å–∫ –±–ª–æ–∫–∞ "TikTok Ads"
            log.info("\nüìå –®–ê–ì 4: –ü–æ–∏—Å–∫ –±–ª–æ–∫–∞ 'TikTok Ads'...")
            log.info("  ‚Üí –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–Ω–∏–∑ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞...")
            
            # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–Ω–∏–∑, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç
            # –ë–ª–æ–∫ "TikTok Ads" –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            try:
                log.info("  ‚Üí –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–Ω–∏–∑ (–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ)...")
                # –ü–æ–ª—É—á–∞–µ–º –≤—ã—Å–æ—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                page_height = await self.page.evaluate("document.body.scrollHeight")
                viewport_height = await self.page.evaluate("window.innerHeight")
                log.info(f"  ‚Üí –í—ã—Å–æ—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {page_height}px, –≤—ã—Å–æ—Ç–∞ viewport: {viewport_height}px")
                
                # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ (–∫–∞–∫ —á–µ–ª–æ–≤–µ–∫)
                scroll_steps = max(3, page_height // viewport_height)
                scroll_step = page_height // scroll_steps
                
                for step in range(scroll_steps):
                    scroll_position = scroll_step * (step + 1)
                    await self.page.evaluate(f"window.scrollTo(0, {scroll_position})")
                    await self.human_delay(0.3, 0.5)
                    log.debug(f"  ‚Üí –ü—Ä–æ–∫—Ä—É—Ç–∫–∞: {scroll_position}/{page_height}px")
                
                # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ —Å–∞–º–æ–≥–æ –Ω–∏–∑–∞
                await self.page.evaluate("window.scrollTo(0, document.body.scrollHeight)")
                await self.human_delay(1, 2)  # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–∫—Ä—É—á–µ–Ω–∞ –≤–Ω–∏–∑")
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            log.info("  ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (–∫–∞–∫ Ctrl+F)...")
            tiktok_ads_found = False
            tiktok_ads_element = None
            
            # –°–Ω–∞—á–∞–ª–∞ –∂–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            await self.human_delay(0.5, 1)
            
            # –í–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
            tiktok_ads_texts = [
                "TikTok Ads",  # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π
                "–†–µ–∫–ª–∞–º–∞ –¢–∏–∫–¢–æ–∫",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 1
                "–†–µ–∫–ª–∞–º–∞ TikTok",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 2
                "TikTok –†–µ–∫–ª–∞–º–∞",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 3
            ]
            
            # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –±–ª–æ–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä —Å —Ç–µ–∫—Å—Ç–æ–º (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±)
            log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ Playwright locator...")
            for text_variant in tiktok_ads_texts:
                try:
                    # –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Ç–µ–∫—Å—Ç (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ)
                    locator = self.page.locator(f'text=/{text_variant}/i').first
                    if await locator.count() > 0:
                        tiktok_ads_element = await locator.element_handle()
                        if tiktok_ads_element:
                            # –°–∫—Ä–æ–ª–ª–∏–º –∫ —ç–ª–µ–º–µ–Ω—Ç—É
                            await tiktok_ads_element.scroll_into_view_if_needed()
                            await self.human_delay(0.3, 0.5)
                            tiktok_ads_found = True
                            log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ Playwright locator")
                            break
                except Exception as e:
                    log.debug(f"–ü–æ–∏—Å–∫ '{text_variant}' —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä –Ω–µ —É–¥–∞–ª—Å—è: {e}")
                    continue
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ JavaScript –ø–æ–∏—Å–∫ (–∫–∞–∫ Ctrl+F)
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript TreeWalker...")
                for text_variant in tiktok_ads_texts:
                    try:
                        # –ò—Å–ø–æ–ª—å–∑—É–µ–º JavaScript –¥–ª—è –ø–æ–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å —Ç–µ–∫—Å—Ç–æ–º
                        # –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è regex
                        escaped_text = text_variant.replace("\\", "\\\\").replace("/", "\\/")
                        tiktok_ads_element = await self.page.evaluate_handle(f"""
                            () => {{
                                const walker = document.createTreeWalker(
                                    document.body,
                                    NodeFilter.SHOW_TEXT,
                                    null,
                                    false
                                );
                                
                                let node;
                                while (node = walker.nextNode()) {{
                                    if (node.textContent && /{escaped_text}/i.test(node.textContent)) {{
                                        // –ù–∞—Ö–æ–¥–∏–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç
                                        let parent = node.parentElement;
                                        while (parent && parent !== document.body) {{
                                            if (parent.offsetHeight > 0 && parent.offsetWidth > 0) {{
                                                return parent;
                                            }}
                                            parent = parent.parentElement;
                                        }}
                                    }}
                                }}
                                return null;
                            }}
                        """)
                        
                        if tiktok_ads_element and await tiktok_ads_element.as_element():
                            element = await tiktok_ads_element.as_element()
                            await element.scroll_into_view_if_needed()
                            await self.human_delay(0.3, 0.5)
                            tiktok_ads_found = True
                            log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript TreeWalker")
                            break
                    except Exception as e:
                        log.debug(f"JavaScript –ø–æ–∏—Å–∫ '{text_variant}' –Ω–µ —É–¥–∞–ª—Å—è: {e}")
                        continue
            
            # –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ query_selector
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 3: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ query_selector —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ —Ç–µ–∫—Å—Ç–∞...")
                try:
                    # –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
                    text_variants = []
                    for text in tiktok_ads_texts:
                        text_variants.extend([
                            f'text="{text}"',
                            f'text={text}',
                            f'*:has-text("{text}")',
                        ])
                    
                    for variant in text_variants:
                        try:
                            element = await self.page.query_selector(variant)
                            if element:
                                is_visible = await element.is_visible()
                                if is_visible:
                                    await element.scroll_into_view_if_needed()
                                    await self.human_delay(0.3, 0.5)
                                    tiktok_ads_found = True
                                    tiktok_ads_element = element
                                    log.info(f"  ‚úÖ –ë–ª–æ–∫ –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ query_selector: {variant}")
                                    break
                        except:
                            continue
                except Exception as e:
                    log.debug(f"Query selector –ø–æ–∏—Å–∫ –Ω–µ —É–¥–∞–ª—Å—è: {e}")
            
            # –ü–æ–ø—ã—Ç–∫–∞ 4: –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –µ—â–µ —Ä–∞–∑ –∏ –ø–æ–∏—Å–∫–∞—Ç—å —Å–Ω–æ–≤–∞
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 4: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∏ –ø–æ–∏—Å–∫...")
                try:
                    # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –µ—â–µ —Ä–∞–∑ –º–µ–¥–ª–µ–Ω–Ω–æ
                    await self.page.evaluate("window.scrollTo(0, 0)")  # –í –Ω–∞—á–∞–ª–æ
                    await self.human_delay(0.5, 1)
                    
                    # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑ –º–µ–¥–ª–µ–Ω–Ω–æ, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è—Å—å –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
                    page_height = await self.page.evaluate("document.body.scrollHeight")
                    scroll_increment = 300  # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –ø–æ 300px
                    
                    for scroll_pos in range(0, page_height, scroll_increment):
                        await self.page.evaluate(f"window.scrollTo(0, {scroll_pos})")
                        await self.human_delay(0.2, 0.3)
                        
                        # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –Ω–∞ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ (–≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞)
                        for text_variant in tiktok_ads_texts:
                            try:
                                # –ó–∞–º–µ–Ω—è–µ–º –ø—Ä–æ–±–µ–ª—ã –Ω–∞ \s+ –¥–ª—è regex
                                regex_pattern = text_variant.replace(" ", "\\s+")
                                locator = self.page.locator(f'text=/{regex_pattern}/i').first
                                if await locator.count() > 0:
                                    tiktok_ads_element = await locator.element_handle()
                                    if tiktok_ads_element:
                                        await tiktok_ads_element.scroll_into_view_if_needed()
                                        await self.human_delay(0.3, 0.5)
                                        tiktok_ads_found = True
                                        log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ {scroll_pos}px")
                                        break
                            except:
                                continue
                        
                        if tiktok_ads_found:
                            break
                    
                    if not tiktok_ads_found:
                        # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ —Å–∞–º–æ–≥–æ –Ω–∏–∑–∞ –µ—â–µ —Ä–∞–∑
                        await self.page.evaluate("window.scrollTo(0, document.body.scrollHeight)")
                        await self.human_delay(1, 2)
                        
                        # –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–∏—Å–∫–∞ (–≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞)
                        for text_variant in tiktok_ads_texts:
                            try:
                                # –ó–∞–º–µ–Ω—è–µ–º –ø—Ä–æ–±–µ–ª—ã –Ω–∞ \s+ –¥–ª—è regex
                                regex_pattern = text_variant.replace(" ", "\\s+")
                                locator = self.page.locator(f'text=/{regex_pattern}/i').first
                                if await locator.count() > 0:
                                    tiktok_ads_element = await locator.element_handle()
                                    if tiktok_ads_element:
                                        await tiktok_ads_element.scroll_into_view_if_needed()
                                        await self.human_delay(0.3, 0.5)
                                        tiktok_ads_found = True
                                        log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω –≤ —Å–∞–º–æ–º –Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã")
                                        break
                            except:
                                continue
                except Exception as e:
                    log.debug(f"–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –Ω–µ –ø–æ–º–æ–≥–ª–∞: {e}")
            
            if not tiktok_ads_found:
                log.error("  ‚ùå –ë–ª–æ–∫ 'TikTok Ads' –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫")
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                try:
                    screenshot_path = config.SCREENSHOTS_DIR / f"tiktok_ads_not_found_{int(time.time())}.png"
                    await self.page.screenshot(path=str(screenshot_path), full_page=True)
                    log.info(f"  üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {screenshot_path}")
                except:
                    pass
                log.error("  ‚ùå –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: –±–ª–æ–∫ 'TikTok Ads' –Ω–µ –Ω–∞–π–¥–µ–Ω")
                return product_data
            
            log.info("  ‚úÖ –ë–ª–æ–∫ 'TikTok Ads' —É—Å–ø–µ—à–Ω–æ –Ω–∞–π–¥–µ–Ω")
            
            # –®–ê–ì 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ "First seen"
            log.info("\nüìå –®–ê–ì 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ 'First seen'...")
            sort_success = await self._set_sort_by_first_seen()
            if not sort_success:
                log.warning("  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            # –®–ê–ì 6: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–∏–¥–µ–æ
            log.info("\nüìå –®–ê–ì 6: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ 'TikTok Ads'...")
            videos = await self._get_videos_from_tiktok_ads_block()
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ {len(videos)} –≤–∏–¥–µ–æ –≤ –±–ª–æ–∫–µ")
            
            # –®–ê–ì 7: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ
            log.info(f"\nüìå –®–ê–ì 7: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ (impression >= {config.MIN_IMPRESSIONS}, –¥–∞—Ç–∞ <= {config.DAYS_BACK} –¥–Ω–µ–π)...")
            filtered_videos = await self._filter_videos(videos)
            log.info(f"  ‚Üí –ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: {len(filtered_videos)} –≤–∏–¥–µ–æ")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –í–°–ï –≤–∏–¥–µ–æ (–¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏) –≤ ProductData
            product_data._all_videos_raw = videos[:20]  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–≤—ã–µ 20 –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
            
            # –í–ê–ñ–ù–û: –ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ 0 –≤–∏–¥–µ–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä
            if len(filtered_videos) == 0:
                log.warning(f"  ‚ö†Ô∏è –ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ (>= {config.MIN_IMPRESSIONS} impressions, <= {config.DAYS_BACK} –¥–Ω–µ–π)")
                log.warning(f"  ‚ö†Ô∏è –¢–æ–≤–∞—Ä –±—É–¥–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω")
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ —Ç–æ–≤–∞—Ä–∞
                product_data._insufficient_videos = True
                product_data._videos_found = len(videos)
                return product_data
            
            # –í—ã–±–æ—Ä —Ç–æ–ø-3 –≤–∏–¥–µ–æ
            video_count = 3
            selected_videos = filtered_videos[:video_count]
            
            log.info(f"  ‚úÖ –í—ã–±—Ä–∞–Ω–æ {len(selected_videos)} –≤–∏–¥–µ–æ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            
            # –®–ê–ì 8: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
            log.info(f"\nüìå –®–ê–ì 8: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–ª—è {len(selected_videos)} –≤–∏–¥–µ–æ...")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
            product_page_url = self.page.url
            log.info(f"  ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞: {product_page_url}")
            
            for i, video in enumerate(selected_videos, 1):
                log.info(f"\n  üé¨ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ {i}/{len(selected_videos)}...")
                log.info(f"    ‚Üí Impression: {video.get('impression', 0)}, First seen: {video.get('first_seen', 'N/A')}")
                
                # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ (–ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ ad-search –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
                video_details = await self._get_video_details(video)
                
                if video_details:
                    product_data.videos.append(video_details)
                    log.info(f"    ‚úÖ –í–∏–¥–µ–æ {i} –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ")
                else:
                    log.warning(f"    ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –¥–ª—è –≤–∏–¥–µ–æ {i}")
                
                # –í–ê–ñ–ù–û: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
                log.info(f"    ‚Üí –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ {i}...")
                try:
                    await self.page.goto(product_page_url, wait_until="domcontentloaded", timeout=30000)
                    await self.human_delay(1, 2)
                    
                    # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –±–ª–æ–∫–∞ TikTok Ads (—á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ –≤–∏–¥–µ–æ)
                    try:
                        await self.page.wait_for_selector('a[href*="/ad-search/"]', timeout=10000, state="visible")
                        log.info(f"    ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ —É—Å–ø–µ—à–µ–Ω (–≤–∏–¥–µ–æ {i})")
                    except:
                        log.warning(f"    ‚ö†Ô∏è –ë–ª–æ–∫ TikTok Ads –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
                except Exception as e:
                    log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞: {e}")
                    # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–ª–µ–¥—É—é—â–∏—Ö –≤–∏–¥–µ–æ –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤–æ–∑–≤—Ä–∞—Ç–∞
                
                await self.human_delay(0.5, 1)
            
            # –ó–∞–ø–æ–ª–Ω—è–µ–º N/A –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤–∏–¥–µ–æ (–Ω—É–∂–Ω–æ 3 –≤–∏–¥–µ–æ)
            while len(product_data.videos) < video_count:
                product_data.videos.append({
                    "tiktok_link": "N/A",
                    "impression": 0,
                    "script": "N/A",
                    "hook": "N/A",
                    "audience_age": "N/A",
                    "country": "N/A",
                    "first_seen": "N/A",
                })
            
            log.info(f"\n‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {len(product_data.videos)} –≤–∏–¥–µ–æ –¥–ª—è —Ç–æ–≤–∞—Ä–∞")
            
            # –®–ê–ì 9: –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ –≤ Google Sheets (–µ—Å–ª–∏ sheets_writer –ø–µ—Ä–µ–¥–∞–Ω)
            if sheets_writer:
                if hasattr(product_data, '_sheets_row') and product_data._sheets_row > 0:
                    log.info(f"\nüìå –®–ê–ì 9: –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {product_data._sheets_row})...")
                    log.info(f"  ‚Üí –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ –¥–ª—è –∑–∞–ø–∏—Å–∏: {len(product_data.videos)}")
                    
                    # –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é
                    for i, video in enumerate(product_data.videos[:3], 1):
                        log.info(f"  ‚Üí –í–∏–¥–µ–æ {i}: tiktok={video.get('tiktok_link', 'N/A')[:50]}, "
                                f"impression={video.get('impression', 'N/A')}, "
                                f"script={len(str(video.get('script', 'N/A')))} —Å–∏–º–≤–æ–ª–æ–≤, "
                                f"hook={len(str(video.get('hook', 'N/A')))} —Å–∏–º–≤–æ–ª–æ–≤, "
                                f"audience={video.get('audience_age', 'N/A')}, "
                                f"country={video.get('country', 'N/A')}, "
                                f"first_seen={video.get('first_seen', 'N/A')}")
                    
                    try:
                        # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏
                        video_data_dict = {
                            "product_name": product_data.product_name,
                            "category": product_data.category,
                            "pipiads_link": product_data.pipiads_link,
                            "videos": product_data.videos
                        }
                        
                        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (update_basic=False - –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ F-Z)
                        success = sheets_writer.write_product_data(
                            product_data._sheets_row,
                            video_data_dict,
                            update_basic=False
                        )
                        
                        if success:
                            log.info(f"  ‚úÖ –î–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {product_data._sheets_row}, —Å—Ç–æ–ª–±—Ü—ã F-Z)")
                        else:
                            log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –≤ Google Sheets")
                    except Exception as e:
                        log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ: {e}")
                        import traceback
                        log.error(traceback.format_exc())
                else:
                    log.warning(f"  ‚ö†Ô∏è –ù–µ—Ç –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö (_sheets_row –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)")
            
            log.info("=" * 80)
            log.info("‚úÖ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û")
            log.info("=" * 80)
            return product_data
            
        except Exception as e:
            log.error("\n" + "=" * 80)
            log.error(f"‚ùå –û–®–ò–ë–ö–ê –ü–†–ò –û–ë–†–ê–ë–û–¢–ö–ï –¢–û–í–ê–†–ê: {e}")
            log.error("=" * 80)
            import traceback
            log.error(traceback.format_exc())
            return product_data
    
    async def return_to_main_page(self, main_page_url: str) -> bool:
        """
        –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–æ–≤–∞—Ä–æ–≤
        
        Args:
            main_page_url: URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ —Ç–æ–≤–∞—Ä)
        
        Returns:
            True –µ—Å–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç —É—Å–ø–µ—à–µ–Ω, False –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        """
        try:
            log.info("\nüîô –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–æ–≤–∞—Ä–æ–≤...")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π URL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            current_url = self.page.url
            log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
            log.info(f"  ‚Üí –¶–µ–ª–µ–≤–æ–π URL: {main_page_url}")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            if current_url == main_page_url:
                log.info("  ‚ÑπÔ∏è  –£–∂–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
                return True
            
            # –ú–ï–¢–û–î 1: –ü—Ä—è–º–æ–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π URL (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            await self.page.goto(main_page_url, wait_until="domcontentloaded", timeout=30000)  # –£–≤–µ–ª–∏—á–µ–Ω –¥–æ 30 —Å–µ–∫
            await self.human_delay(1, 2)
            
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ë–ï–ó networkidle - –æ–Ω –≤—ã–∑—ã–≤–∞–µ—Ç —Ç–∞–π–º–∞—É—Ç—ã!)
            await self.page.wait_for_load_state("domcontentloaded", timeout=5000)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞
            new_url = self.page.url
            log.info(f"  ‚Üí –ù–æ–≤—ã–π URL: {new_url}")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤
            try:
                await self.page.wait_for_selector('a[href*="/tiktok-shop-product/"]', timeout=10000)
                
                # –î–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ä–µ–º—è –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
                await self.human_delay(2, 3)
                
                log.info("  ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —É—Å–ø–µ—à–µ–Ω")
                return True
            except:
                log.warning("  ‚ö†Ô∏è –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞")
                return False
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É: {e}")
            import traceback
            log.error(traceback.format_exc())
            return False
    
    async def get_product_details_with_return(self, product_url: str, sheets_writer=None, banned_products=None):
        """
        –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–≤–∞—Ä –ø–æ URL –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        
        –ê–ª–≥–æ—Ä–∏—Ç–º:
        1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        2. –ù–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ URL –∏ –∫–ª–∏–∫–Ω—É—Ç—å
        3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ban-list (–µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω)
        4. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–≤–∞—Ä (get_product_details)
        5. –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        
        Args:
            product_url: URL —Ç–æ–≤–∞—Ä–∞ (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π)
            sheets_writer: –û–±—ä–µ–∫—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ Google Sheets
            banned_products: –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö URL (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
        
        Returns:
            ProductData –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ
            Dict —Å–æ status="insufficient_videos" –µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ
            Dict —Å–æ status="duplicate" –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
            None –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        """
        log.info(f"\n{'='*80}")
        log.info(f"üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê: {product_url}")
        log.info(f"{'='*80}")
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        main_page_url = self.page.url
        log.info(f"  ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {main_page_url}")
        
        def normalize_url(url: str) -> str:
            """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL (—É–±—Ä–∞—Ç—å —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É)"""
            if not url:
                return ""
            url = url.strip().rstrip('/')
            # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if '?' in url:
                url = url.split('?')[0]
            return url
        
        try:
            # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º URL —Ç–æ–≤–∞—Ä–∞
            product_url = normalize_url(product_url)
            
            if not product_url:
                log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                return None
            
            # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
            if banned_products is not None and product_url in banned_products:
                log.warning(f"  üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: {product_url}")
                log.warning(f"     –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.")
                return {"status": "duplicate", "product_url": product_url}
            
            # –®–ê–ì 1: –ù–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ URL –∏ –∫–ª–∏–∫–Ω—É—Ç—å
            log.info(f"\nüìå –®–ê–ì 1: –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ URL...")
            
            try:
                # –ò—â–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
                product_links = await self.page.query_selector_all('a[href*="/tiktok-shop-product/"]')
                
                if not product_links:
                    log.error("  ‚ùå –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
                    return None
                
                # –ò—â–µ–º —Ç–æ–≤–∞—Ä –ø–æ URL (–ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ URL)
                product_link = None
                for link in product_links:
                    href = await link.get_attribute("href")
                    if not href:
                        continue
                    
                    # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π URL
                    if href.startswith("/"):
                        link_url = f"https://www.pipiads.com{href}"
                    elif href.startswith("http"):
                        link_url = href
                    else:
                        link_url = f"https://www.pipiads.com/{href}"
                    
                    # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º URL —Å—Å—ã–ª–∫–∏
                    link_url = normalize_url(link_url)
                    
                    if link_url == product_url:
                        product_link = link
                        break
                
                if not product_link:
                    log.error(f"  ‚ùå –¢–æ–≤–∞—Ä —Å URL {product_url} –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
                    return None
                
                log.info(f"  ‚úÖ –¢–æ–≤–∞—Ä –Ω–∞–π–¥–µ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {product_url}")
                
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ URL —Ç–æ–≤–∞—Ä–∞: {e}")
                return None
            
            # –®–ê–ì 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ get_product_details
            log.info(f"\nüìå –®–ê–ì 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞...")
            product_data = await self.get_product_details(product_url, sheets_writer=sheets_writer)
            
            # –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–¥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é)
            log.info(f"\nüìå –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞...")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∏ –µ—Å—Ç—å –≤–∏–¥–µ–æ
            if not product_data:
                log.warning("  ‚ö†Ô∏è product_data –ø—É—Å—Ç")
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                await self.return_to_main_page(main_page_url)
                return None
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ —Ç–æ–≤–∞—Ä –ø—Ä–æ–ø—É—â–µ–Ω –∏–∑-–∑–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
            if hasattr(product_data, '_insufficient_videos') and product_data._insufficient_videos:
                videos_found = getattr(product_data, '_videos_found', 0)
                log.warning(f"  ‚ö†Ô∏è –¢–æ–≤–∞—Ä –ø—Ä–æ–ø—É—â–µ–Ω: –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ (–Ω–∞–π–¥–µ–Ω–æ –≤—Å–µ–≥–æ: {videos_found})")
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                await self.return_to_main_page(main_page_url)
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª–æ–≤–∞—Ä—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "insufficient_videos"
                return {
                    "status": "insufficient_videos",
                    "product_name": getattr(product_data, 'product_name', 'N/A'),
                    "videos_found": videos_found,
                    "videos_required": 3,
                    "reason": f"–ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (>= {config.MIN_IMPRESSIONS} impressions, <= {config.DAYS_BACK} –¥–Ω–µ–π) –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ"
                }
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ
            videos_count = len(product_data.videos) if hasattr(product_data, 'videos') else 0
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ –≤–∏–¥–µ–æ: {videos_count}")
            
            # –ï—Å–ª–∏ –≤–∏–¥–µ–æ –º–µ–Ω—å—à–µ 3 - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
            if videos_count < 3:
                log.warning(f"  ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ: {videos_count} < 3")
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                await self.return_to_main_page(main_page_url)
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª–æ–≤–∞—Ä—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "insufficient_videos"
                return {
                    "status": "insufficient_videos",
                    "product_name": getattr(product_data, 'product_name', 'N/A'),
                    "videos_found": videos_count,
                    "videos_required": 3,
                    "reason": f"–ù–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ {videos_count} –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏"
                }
            
            # –®–ê–ì 4: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            log.info(f"\nüìå –®–ê–ì 4: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É...")
            await self.return_to_main_page(main_page_url)
            
            # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä
            log.info(f"  ‚úÖ –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ ({videos_count} –≤–∏–¥–µ–æ)")
            return product_data
            
        except Exception as e:
            log.error(f"\n‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É {product_index}: {e}")
            import traceback
            log.error(traceback.format_exc())
            
            # –ü—ã—Ç–∞–µ–º—Å—è –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
            try:
                await self.return_to_main_page(main_page_url)
            except:
                log.error("  ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏")
            
            return None
    
    async def _set_sort_by_first_seen(self) -> bool:
        """
        –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É "First seen" –≤ dropdown
        
        Returns:
            True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
        """
        log.info("  ‚Üí –ü–æ–∏—Å–∫ dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏...")
        try:
            # –ò—â–µ–º dropdown "Sort by"
            sort_selectors = [
                'select:has-text("Sort by")',
                'select',
                '[class*="sort"]',
                'text="Sort by: First seen"',
                'text="Sort by"',
            ]
            
            dropdown = None
            for selector in sort_selectors:
                try:
                    dropdown = await self.page.query_selector(selector)
                    if dropdown:
                        is_visible = await dropdown.is_visible()
                        if is_visible:
                            log.debug(f"–ù–∞–π–¥–µ–Ω dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: {selector}")
                            break
                        else:
                            dropdown = None
                except:
                    continue
            
            if not dropdown:
                # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ —Ç–µ–∫—Å—Ç—É "Sort by: First seen"
                try:
                    sort_text = await self.page.query_selector('text="Sort by: First seen"')
                    if sort_text:
                        # –ö–ª–∏–∫–∞–µ–º –Ω–∞ —Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å dropdown
                        await sort_text.click()
                        await self.human_delay(0.5, 1)
                        
                        # –ò—â–µ–º –æ–ø—Ü–∏—é "First seen"
                        first_seen_option = await self.page.query_selector('text="First seen"')
                        if first_seen_option:
                            await first_seen_option.click()
                            await self.human_delay(1, 2)
                            log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (—á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç)")
                            return True
                except:
                    pass
                
                log.warning("Dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å")
                return False
            
            # –ï—Å–ª–∏ —ç—Ç–æ select —ç–ª–µ–º–µ–Ω—Ç
            tag_name = await dropdown.evaluate("el => el.tagName.toLowerCase()")
            if tag_name == "select":
                # –í—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é —á–µ—Ä–µ–∑ value –∏–ª–∏ —Ç–µ–∫—Å—Ç
                try:
                    log.info("  ‚Üí –ù–∞–π–¥–µ–Ω select —ç–ª–µ–º–µ–Ω—Ç, –≤—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é 'First seen'...")
                    await dropdown.select_option(label="First seen")
                    await self.human_delay(1, 2)
                    log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (select)")
                    return True
                except:
                    pass
            
            # –ï—Å–ª–∏ —ç—Ç–æ –∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown - –∫–ª–∏–∫–∞–µ–º –∏ –≤—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é
            log.info("  ‚Üí –ù–∞–π–¥–µ–Ω –∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown, –æ—Ç–∫—Ä—ã–≤–∞–µ–º...")
            await dropdown.click()
            await self.human_delay(0.5, 1)
            
            # –ò—â–µ–º –æ–ø—Ü–∏—é "First seen"
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –æ–ø—Ü–∏–∏ 'First seen'...")
            option_selectors = [
                'text="First seen"',
                'text="Sort by: First seen"',
                '[role="option"]:has-text("First seen")',
            ]
            
            for opt_sel in option_selectors:
                try:
                    option = await self.page.query_selector(opt_sel)
                    if option:
                        await option.click()
                        await self.human_delay(1, 2)
                        log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (–∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown)")
                        return True
                except:
                    continue
            
            log.warning("  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É 'First seen'")
            return False
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: {e}")
            return False
    
    async def _get_videos_from_tiktok_ads_block(self) -> List[Dict[str, Any]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ TikTok Ads
        
        Returns:
            –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        videos = []
        
        try:
            log.info("  ‚Üí –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ...")
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ
            await self.human_delay(0.5, 1)
            
            # –ò—â–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ - –ø—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã...")
            video_card_selectors = [
                '[class*="video"]',
                '[class*="card"]',
                '[class*="ad"]',
                'div[class*="item"]',
                'a[href*="/ad-search/"]',
            ]
            
            video_elements = []
            for selector in video_card_selectors:
                try:
                    elements = await self.page.query_selector_all(selector)
                    if elements:
                        log.debug(f"–ù–∞–π–¥–µ–Ω–æ {len(elements)} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º {selector}")
                        # –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ, —á—Ç–æ —Å–æ–¥–µ—Ä–∂–∞—Ç –≤–∏–¥–µ–æ (–∏–º–µ—é—Ç thumbnail –∏–ª–∏ play button)
                        for elem in elements:
                            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –∫–∞—Ä—Ç–æ—á–∫–∞ –≤–∏–¥–µ–æ
                            has_play_button = await elem.query_selector('[class*="play"], svg, [class*="thumbnail"]')
                            if has_play_button or '/ad-search/' in str(await elem.get_attribute("href") or ""):
                                video_elements.append(elem)
                        if video_elements:
                            break
                except:
                    continue
            
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ")
            
            # –û–ì–†–ê–ù–ò–ß–ï–ù–ò–ï: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 50 –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
            max_cards = 50
            if len(video_elements) > max_cards:
                log.info(f"  ‚Üí –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ {max_cards} –∏–∑ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫")
                video_elements = video_elements[:max_cards]
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
            log.info("  ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–µ–∫...")
            log.info(f"  ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∞ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫...")
            
            successful_extractions = 0
            for i, card in enumerate(video_elements, 1):
                try:
                    video_data = await self._extract_video_data_from_card(card, i)
                    if video_data:
                        videos.append(video_data)
                        impression = video_data.get('impression', 0)
                        first_seen = video_data.get('first_seen', 'N/A')
                        
                        # –õ–û–ì–ò–†–£–ï–ú –ö–ê–ñ–î–û–ï –í–ò–î–ï–û (–∫–∞–∫ –ø—Ä–æ—Å–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
                        log.info(f"  üìπ –í–∏–¥–µ–æ {i}: impression={impression}, first_seen={first_seen}")
                        
                        if impression > 0 or first_seen != 'N/A':
                            successful_extractions += 1
                except Exception as e:
                    log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ {i}: {e}")
                    continue
            
            log.info(f"  ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–æ {len(videos)} –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ (—É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–æ: {successful_extractions})")
            return videos
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤–∏–¥–µ–æ: {e}")
            return []
    
    async def _extract_video_data_from_card(self, card_element, card_index: int = 0) -> Optional[Dict[str, Any]]:
        """
        –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ
        
        Args:
            card_element: –≠–ª–µ–º–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ
            card_index: –ò–Ω–¥–µ–∫—Å –∫–∞—Ä—Ç–æ—á–∫–∏ (–¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ –∏–ª–∏ None
        """
        try:
            video_data = {
                "ad_search_url": None,
                "impression": 0,
                "first_seen": None,
                "card_element": card_element,  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –∫–ª–∏–∫–∞
            }
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï IMPRESSION ==========
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ HTML-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
            # –ò—â–µ–º div.data-count > div.item –≥–¥–µ caption = "Impression"
            try:
                # –ò—â–µ–º –≤—Å–µ –±–ª–æ–∫–∏ data-count
                data_count_items = await card_element.query_selector_all('div.data-count div.item')
                
                if card_index <= 3:
                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –Ω–∞–π–¥–µ–Ω–æ {len(data_count_items)} –±–ª–æ–∫–æ–≤ div.item")
                
                for idx, item in enumerate(data_count_items):
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å impression
                    caption_elem = await item.query_selector('p.caption')
                    if caption_elem:
                        caption_text = await caption_elem.inner_text()
                        
                        if card_index <= 3:
                            log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}, –±–ª–æ–∫ {idx}: caption = '{caption_text}'")
                        
                        if 'Impression' in caption_text or '–ü–æ–∫–∞–∑' in caption_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
                            value_elem = await item.query_selector('p.value')
                            if value_elem:
                                # –ü–æ–ø—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
                                impression_str_inner = (await value_elem.inner_text()).strip()
                                impression_str_html = (await value_elem.inner_html()).strip()
                                impression_str_content = (await value_elem.text_content()).strip()
                                
                                # –í–°–ï–ì–î–ê –ª–æ–≥–∏—Ä—É–µ–º RAW-–∑–Ω–∞—á–µ–Ω–∏–µ (–¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–∞—Ä—Ç–æ—á–µ–∫)
                                if card_index <= 3:
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (inner_text) = '{impression_str_inner}'")
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (inner_html) = '{impression_str_html}'")
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (text_content) = '{impression_str_content}'")
                                
                                # –ò—Å–ø–æ–ª—å–∑—É–µ–º inner_text –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫
                                impression_str = impression_str_inner
                                impression = validator.parse_impressions(impression_str)
                                if impression:
                                    video_data["impression"] = impression
                                    if card_index <= 3:
                                        log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression PARSED = {impression}")
                                    break
                                else:
                                    if card_index <= 3:
                                        log.warning(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: parse_impressions –≤–µ—Ä–Ω—É–ª None –¥–ª—è '{impression_str}'")
            except Exception as e:
                if card_index <= 3:
                    log.error(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ impression: {e}")
                    import traceback
                    log.error(traceback.format_exc())
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï FIRST SEEN ==========
            # –ò—â–µ–º div.create-time > span —Å –¥–∞—Ç–æ–π
            try:
                create_time_elem = await card_element.query_selector('div.create-time span')
                if create_time_elem:
                    date_text = (await create_time_elem.inner_text()).strip()
                    # –õ–æ–≥–∏—Ä—É–µ–º RAW-–∑–Ω–∞—á–µ–Ω–∏–µ
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: first_seen RAW='{date_text}'")
                    
                    # –§–æ—Ä–º–∞—Ç: "Nov 05 2025-Nov 11 2025" - –±–µ—Ä–µ–º –ü–ï–†–í–£–Æ –¥–∞—Ç—É (–¥–æ –¥–µ—Ñ–∏—Å–∞)
                    # –ò—Å–ø–æ–ª—å–∑—É–µ–º regex –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–µ—Ä–≤–æ–π –¥–∞—Ç—ã
                    match = re.match(r'([A-Z][a-z]{2}\s+\d{1,2}\s+\d{4})', date_text)
                    if match:
                        first_seen_str = match.group(1)
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –¥–∞—Ç—ã
                        parsed_date = validator.parse_video_date(first_seen_str)
                        if parsed_date:
                            video_data["first_seen"] = first_seen_str
                            log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: first_seen parsed='{first_seen_str}'")
            except Exception as e:
                if card_index <= 3:
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ first_seen —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä: {e}")
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï AD-SEARCH –°–°–´–õ–ö–ò ==========
            try:
                link_element = await card_element.query_selector('a.btn-detail[href*="/ad-search/"]')
                if link_element:
                    href = await link_element.get_attribute("href")
                    if href:
                        if href.startswith("/"):
                            video_data["ad_search_url"] = f"https://www.pipiads.com{href}"
                        elif href.startswith("http"):
                            video_data["ad_search_url"] = href
                        else:
                            video_data["ad_search_url"] = f"https://www.pipiads.com/{href}"
                        if card_index <= 3:
                            log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: ad_search_url = {video_data['ad_search_url']}")
            except Exception as e:
                if card_index <= 3:
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ ad_search_url: {e}")
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Å—Å—ã–ª–∫—É, –Ω–æ –µ—Å—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∞ - –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –Ω–µ—ë
            if not video_data["ad_search_url"]:
                video_data["card_element"] = card_element
            
            # –õ–æ–≥–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–∞—Ä—Ç–æ—á–µ–∫
            if card_index <= 3:
                log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –∏—Ç–æ–≥–æ - impression={video_data['impression']}, first_seen={video_data['first_seen']}, ad_search_url={bool(video_data['ad_search_url'])}")
            
            return video_data
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ {card_index}: {e}")
            import traceback
            log.debug(traceback.format_exc())
            return None
    
    async def _filter_videos(self, videos: List[Dict[str, Any]]) -> List[Dict[str, Any]]:
        """
        –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
        
        Args:
            videos: –°–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        
        Returns:
            –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ
        """
        filtered = []
        
        for video in videos:
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ impression (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π "170.6K" –∏–ª–∏ —á–∏—Å–ª–æ–º)
            impression = video.get("impression", 0)
            impression_num = 0
            if isinstance(impression, str):
                # –ü–∞—Ä—Å–∏–º —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                impression_num = validator.parse_impressions(impression) or 0
            elif isinstance(impression, (int, float)):
                impression_num = int(impression)
            
            if not validator.validate_impressions(impression_num, config.MIN_IMPRESSIONS):
                log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: impression {impression} ({impression_num}) < {config.MIN_IMPRESSIONS}")
                continue
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
            first_seen = video.get("first_seen")
            if first_seen and first_seen != "N/A" and first_seen is not None:
                parsed_date = validator.parse_video_date(first_seen)
                if parsed_date:
                    if not validator.is_date_within_days(parsed_date, config.DAYS_BACK):
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –¥–∞—Ç–∞ {first_seen} —Å—Ç–∞—Ä—à–µ {config.DAYS_BACK} –¥–Ω–µ–π")
                        continue
                else:
                    # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å, –Ω–æ –µ—Å—Ç—å impression >= 50k, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –¥–∞—Ç—ã
                    if impression >= config.MIN_IMPRESSIONS:
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–∏–Ω—è—Ç–æ: –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É {first_seen}, –Ω–æ impression {impression} >= {config.MIN_IMPRESSIONS}")
                    else:
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É {first_seen} –∏ impression {impression} < {config.MIN_IMPRESSIONS}")
                        continue
            # –ï—Å–ª–∏ –¥–∞—Ç—ã –Ω–µ—Ç, –Ω–æ impression >= 50k, –ø—Ä–∏–Ω–∏–º–∞–µ–º –≤–∏–¥–µ–æ
            elif impression >= config.MIN_IMPRESSIONS:
                log.debug(f"–í–∏–¥–µ–æ –ø—Ä–∏–Ω—è—Ç–æ: –Ω–µ—Ç –¥–∞—Ç—ã, –Ω–æ impression {impression} >= {config.MIN_IMPRESSIONS}")
            else:
                log.debug("–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –Ω–µ—Ç –¥–∞—Ç—ã first_seen –∏ impression < –º–∏–Ω–∏–º—É–º–∞")
                continue
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
            video["_impression_num"] = impression_num
            filtered.append(video)
        
        # –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: —Å–Ω–∞—á–∞–ª–∞ –ø–æ –¥–∞—Ç–µ (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ), –ø–æ—Ç–æ–º –ø–æ impressions (—Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ)
        # –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ ad_search_url (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π), –∑–∞—Ç–µ–º tiktok_link, –∑–∞—Ç–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—è
        seen_videos = set()
        unique_videos = []
        for video in filtered:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)
            # 1. ad_search_url (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ)
            # 2. tiktok_link (–µ—Å–ª–∏ ad_search_url –Ω–µ—Ç)
            # 3. –ö–æ–º–±–∏–Ω–∞—Ü–∏—è impression + first_seen (fallback)
            video_id = None
            
            # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º ad_search_url (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ)
            ad_search_url = video.get("ad_search_url", "")
            if ad_search_url and ad_search_url != "N/A":
                ad_search_url = ad_search_url.rstrip('/')
                video_id = f"ad_search:{ad_search_url}"
            elif video.get("tiktok_link") and video.get("tiktok_link") != "N/A":
                video_id = f"tiktok:{video.get('tiktok_link')}"
            else:
                # Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—é impression + first_seen
                impression = video.get("impression", 0)
                first_seen = video.get("first_seen", "N/A")
                video_id = f"fallback:{impression}:{first_seen}"
            
            if video_id and video_id not in seen_videos:
                seen_videos.add(video_id)
                unique_videos.append(video)
            else:
                log.info(f"‚è≠Ô∏è  –í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ –∫–∞–∫ –¥—É–±–ª–∏–∫–∞—Ç: {video_id}")
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º: —Å–Ω–∞—á–∞–ª–∞ –ø–æ –¥–∞—Ç–µ (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ), –ø–æ—Ç–æ–º –ø–æ impressions (—Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ)
        def sort_key(v):
            parsed_date = validator.parse_video_date(v.get("first_seen", ""))
            if parsed_date:
                date_timestamp = -parsed_date.timestamp()  # –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ —É–±—ã–≤–∞–Ω–∏—é (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ)
            else:
                date_timestamp = 0  # –í–∏–¥–µ–æ –±–µ–∑ –¥–∞—Ç—ã –≤ –∫–æ–Ω–µ—Ü
            return (date_timestamp, -v.get("_impression_num", 0))
        
        unique_videos.sort(key=sort_key)
        
        # –ë–µ—Ä–µ–º —Ç–æ–ø-3
        top_videos = unique_videos[:3]
        
        log.info(f"‚úÖ –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ {len(filtered)} –≤–∏–¥–µ–æ –∏–∑ {len(videos)}, —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö: {len(unique_videos)}, —Ç–æ–ø-3: {len(top_videos)}")
        return top_videos
    
    async def _get_video_details(self, video: Dict[str, Any]) -> Optional[Dict[str, Any]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –≤–∏–¥–µ–æ
        
        Args:
            video: –°–ª–æ–≤–∞—Ä—å —Å –±–∞–∑–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ (–∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        try:
            # –ï—Å–ª–∏ –µ—Å—Ç—å ad_search_url, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞–ø—Ä—è–º—É—é
            if video.get("ad_search_url"):
                log.info(f"    ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É ad-search: {video['ad_search_url']}")
                await self.page.goto(video["ad_search_url"], wait_until="domcontentloaded", timeout=30000)
                await self.human_delay(0.5, 1)
                log.info("    ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ad-search –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            else:
                # –ï—Å–ª–∏ –Ω–µ—Ç URL, –∫–ª–∏–∫–∞–µ–º –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É
                # –í–ê–ñ–ù–û: –≠–ª–µ–º–µ–Ω—Ç –º–æ–∂–µ—Ç –∏—Å—á–µ–∑–Ω—É—Ç—å –∏–∑ DOM, –ø–æ—ç—Ç–æ–º—É –∏—â–µ–º –µ–≥–æ –∑–∞–Ω–æ–≤–æ
                card_element = video.get("card_element")
                if not card_element:
                    log.error("    ‚ùå –ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ –ø–µ—Ä–µ–π—Ç–∏ –∫ –≤–∏–¥–µ–æ (–Ω–µ—Ç URL –∏ —ç–ª–µ–º–µ–Ω—Ç–∞)")
                    return None
                
                log.info("    ‚Üí –ö–ª–∏–∫ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –≤–∏–¥–µ–æ...")
                try:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –µ—â–µ –≤ DOM
                    is_attached = await card_element.evaluate("el => el.isConnected")
                    if not is_attached:
                        log.warning("    ‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç –∏—Å—á–µ–∑ –∏–∑ DOM, –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∑–∞–Ω–æ–≤–æ...")
                        # –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ –ø–æ ad_search_url –∏–ª–∏ –¥—Ä—É–≥–∏–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º
                        # –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None
                        log.error("    ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ")
                        return None
                    
                    await card_element.click()
                    await self.human_delay(0.5, 1)
                    log.info("    ‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ –≤–∏–¥–µ–æ –æ—Ç–∫—Ä—ã—Ç–∞")
                except Exception as e:
                    log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É: {e}")
                    log.warning("    ‚ö†Ô∏è –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ...")
                    # –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –∏—Å—á–µ–∑, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None
                    return None
                
                # –ñ–¥–µ–º –æ—Ç–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞/–º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                # –ò—â–µ–º –∫–Ω–æ–ø–∫—É "More detail"
                log.info("    ‚Üí –ü–æ–∏—Å–∫ –∫–Ω–æ–ø–∫–∏ 'More detail'...")
                more_detail_selectors = [
                    'text="More detail"',
                    'text="More Detail"',
                    'button:has-text("More detail")',
                    'a:has-text("More detail")',
                ]
                
                more_detail_button = None
                for selector in more_detail_selectors:
                    try:
                        more_detail_button = await self.page.wait_for_selector(selector, timeout=5000, state="visible")
                        if more_detail_button:
                            log.info(f"    ‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ 'More detail' (—Å–µ–ª–µ–∫—Ç–æ—Ä: {selector})")
                            break
                    except:
                        continue
                
                if not more_detail_button:
                    log.error("    ‚ùå –ö–Ω–æ–ø–∫–∞ 'More detail' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
                    return None
                
                # –ö–ª–∏–∫–∞–µ–º –Ω–∞ "More detail"
                log.info("    ‚Üí –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É 'More detail'...")
                await more_detail_button.click()
                await self.human_delay(0.5, 1)
                
                # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
                log.info("    ‚Üí –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search...")
                await self.page.wait_for_load_state("domcontentloaded", timeout=10000)
                await self.human_delay(0.3, 0.5)
                log.info("    ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ad-search –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
            # –ü–µ—Ä–µ–¥–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏) –¥–ª—è fallback
            log.info("    ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search...")
            
            # –í–ê–ñ–ù–û: –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º domcontentloaded (–±—ã—Å—Ç—Ä–µ–µ) + –∑–∞–¥–µ—Ä–∂–∫–∞ + –æ–∂–∏–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            await self.page.wait_for_load_state("domcontentloaded", timeout=10000)
            await self.human_delay(2, 3)  # –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (Script, Hook, Audience) —Å retry
            elements_found = False
            for attempt in range(3):  # 3 –ø–æ–ø—ã—Ç–∫–∏
                try:
                    # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                    await self.page.wait_for_selector('li#ai-script, li#ai-hook, div.addel-info-item', timeout=5000, state="visible")
                    log.info(f"    ‚úÖ –ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search (–ø–æ–ø—ã—Ç–∫–∞ {attempt + 1})")
                    elements_found = True
                    break
                except:
                    if attempt < 2:
                        log.debug(f"    ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∂–¥–µ–º –µ—â–µ...")
                        await self.human_delay(2, 3)
                    else:
                        log.warning("    ‚ö†Ô∏è –ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ 3 –ø–æ–ø—ã—Ç–æ–∫, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ...")
            
            return await self._extract_ad_search_data(video)
            
        except Exception as e:
            log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–µ—Ç–∞–ª–µ–π –≤–∏–¥–µ–æ: {e}")
            import traceback
            log.error(traceback.format_exc())
            return None
    
    async def _extract_ad_search_data(self, original_video: Optional[Dict[str, Any]] = None) -> Dict[str, Any]:
        """
        –ò–∑–≤–ª–µ—á—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
        
        Args:
            original_video: –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (–¥–ª—è fallback impressions)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        video_data = {
            "tiktok_link": "N/A",
            "impression": 0,
            "script": "N/A",
            "hook": "N/A",
            "audience_age": "N/A",
            "country": "N/A",
            "first_seen": "N/A",
        }
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è fallback
        if original_video:
            original_impression = original_video.get("impression")
            if original_impression:
                video_data["_original_impression"] = original_impression
        
        try:
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            await self.page.wait_for_load_state("domcontentloaded")
            await self.human_delay(0.3, 0.5)
            
            # –ü–æ–ª—É—á–∞–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ø–æ–∏—Å–∫–∞
            page_text = await self.page.content()
            
            # 1. TikTok —Å—Å—ã–ª–∫–∞ (–∏–∑ –ø–æ–ª—è "TikTok Post" (–∞–Ω–≥–ª.) –∏–ª–∏ "–ü–æ—Å—Ç TikTok" (—Ä—É—Å.))
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ TikTok —Å—Å—ã–ª–∫–∏...")
            
            # –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –ø–æ —Ç–µ–∫—Å—Ç—É "TikTok Post" –∏–ª–∏ "–ü–æ—Å—Ç TikTok"
            tiktok_post_selectors = [
                'text=/TikTok Post/i',  # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
                'text=/–ü–æ—Å—Ç TikTok/i',  # –†—É—Å—Å–∫–∏–π fallback
            ]
            
            for selector in tiktok_post_selectors:
                try:
                    locator = self.page.locator(selector).first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Å—Å—ã–ª–∫—É —Ä—è–¥–æ–º
                        try:
                            parent_locator = locator.locator("..")
                            # –ò—â–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å—Å—ã–ª–∫–∞–º —Å /v/)
                            link = await parent_locator.locator('a[href*="m.tiktok.com/v/"]').first.element_handle()
                            if not link:
                                link = await parent_locator.locator('a[href*="tiktok.com/v/"]').first.element_handle()
                            if not link:
                                link = await parent_locator.locator('a[href*="tiktok.com"]').first.element_handle()
                            if link:
                                href = await link.get_attribute("href")
                                if href:
                                    # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä—ã –≤ TikTok Shop
                                    if "shop.tiktok.com/view/product" in href or "/view/product" in href:
                                        log.debug(f"      ‚Üí –ü—Ä–æ–ø—É—â–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä: {href[:50]}...")
                                        continue
                                    # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ
                                    if "/v/" in href or "m.tiktok.com" in href:
                                        video_data["tiktok_link"] = href
                                        log.info(f"      ‚úÖ TikTok —Å—Å—ã–ª–∫–∞ –Ω–∞–π–¥–µ–Ω–∞: {href[:50]}...")
                                        break
                        except:
                            pass
                except:
                    continue
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç, –∏—â–µ–º –≤—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ TikTok
            # –í–ê–ñ–ù–û: –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ (m.tiktok.com/v/...), –ù–ï –Ω–∞ —Ç–æ–≤–∞—Ä—ã (shop.tiktok.com/view/product/...)
            if video_data["tiktok_link"] == "N/A":
                tiktok_link_selectors = [
                    'a[href*="m.tiktok.com/v/"]',  # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ
                    'a[href*="tiktok.com/v/"]',    # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                    'a[href*="tiktok.com"]',       # Fallback
                ]
                
                for selector in tiktok_link_selectors:
                    try:
                        links = await self.page.query_selector_all(selector)
                        for link in links:
                            href = await link.get_attribute("href")
                            if href and "tiktok.com" in href:
                                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä—ã –≤ TikTok Shop
                                if "shop.tiktok.com/view/product" in href or "/view/product" in href:
                                    log.debug(f"      ‚Üí –ü—Ä–æ–ø—É—â–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä: {href[:50]}...")
                                    continue
                                
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ (—Å–æ–¥–µ—Ä–∂–∞—Ç /v/ –≤ –ø—É—Ç–∏)
                                if "/v/" in href or "m.tiktok.com" in href:
                                    video_data["tiktok_link"] = href
                                    log.info(f"      ‚úÖ TikTok —Å—Å—ã–ª–∫–∞ –Ω–∞–π–¥–µ–Ω–∞: {href[:50]}...")
                                    break
                        if video_data["tiktok_link"] != "N/A":
                            break
                    except:
                        continue
            
            if video_data["tiktok_link"] == "N/A":
                log.warning("      ‚ö†Ô∏è TikTok —Å—Å—ã–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
            
            # 2. Impressions - –ö–†–ò–¢–ò–ß–ù–û: "Impressions" (–∞–Ω–≥–ª.) –∏–ª–∏ "–ü–æ–∫–∞–∑—ã" (—Ä—É—Å.), –Ω–µ "Likes" –∏–ª–∏ "–ù—Ä–∞–≤–∏—Ç—Å—è"!
            # –ò—â–µ–º –≤ —Ä–∞–∑–¥–µ–ª–µ "Data/–î–∞–Ω–Ω—ã–µ" –≤ –ø—É–Ω–∫—Ç–µ "Impression/–ü–æ–∫–∞–∑"
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ impressions...")
            impression_text = await self._extract_impressions()
            if impression_text:
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–µ—Å–ª–∏ –æ–Ω —É–∂–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "170.6K" –∏–ª–∏ "339.9M")
                if impression_text.upper().endswith(('K', 'M')):
                    video_data["impression"] = impression_text
                    log.info(f"      ‚úÖ Impressions (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç): {impression_text}")
                else:
                    # –ü–∞—Ä—Å–∏–º —á–∏—Å–ª–æ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞—Ç–Ω–æ
                    impression_num = validator.parse_impressions(impression_text) or 0
                    video_data["impression"] = validator.format_impressions(impression_num)
                    log.info(f"      ‚úÖ Impressions (—Å—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–æ): {video_data['impression']}")
            else:
                # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ–Ω–∏ –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                # (–∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞)
                original_impression = video_data.get("_original_impression")
                if original_impression:
                    if isinstance(original_impression, (int, float)) and original_impression > 0:
                        video_data["impression"] = validator.format_impressions(int(original_impression))
                        log.info(f"      ‚úÖ Impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏: {video_data['impression']}")
                    elif isinstance(original_impression, str) and original_impression != "N/A":
                        video_data["impression"] = original_impression
                        log.info(f"      ‚úÖ Impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (—Å—Ç—Ä–æ–∫–∞): {original_impression}")
                    else:
                        video_data["impression"] = "N/A"
                        log.warning("      ‚ö†Ô∏è Impressions –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –Ω–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ")
                else:
                    video_data["impression"] = "N/A"
                    log.warning("      ‚ö†Ô∏è Impressions –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
            
            # 3. Script (–∏–∑ "Transcript" –∏–ª–∏ "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞")
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è (script)...")
            log.info(f"      ‚Üí –¢–µ–∫—É—â–∏–π URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {self.page.url}")
            script = await self._extract_script()
            if script:
                video_data["script"] = script
                log.info(f"      ‚úÖ Script –Ω–∞–π–¥–µ–Ω ({len(script)} —Å–∏–º–≤–æ–ª–æ–≤): {script[:100]}...")
            else:
                video_data["script"] = "N/A"
                log.warning("      ‚ö†Ô∏è Script –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-script p.content-text –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 4. Hook (–∏–∑ —Å–µ–∫—Ü–∏–∏ Hook –∏–ª–∏ Hooks)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ hook...")
            hook = await self._extract_hook()
            if not hook:
                # –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω
                log.warning("      ‚ö†Ô∏è Hook –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫...")
                await self.human_delay(1, 2)  # –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É
                hook = await self._extract_hook()
            
            if hook:
                video_data["hook"] = hook
                log.info(f"      ‚úÖ Hook –Ω–∞–π–¥–µ–Ω ({len(hook)} —Å–∏–º–≤–æ–ª–æ–≤): {hook[:100]}...")
            else:
                video_data["hook"] = "N/A"
                log.warning("      ‚ö†Ô∏è Hook –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook p.content-text –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 5. Audience Age (–∏–∑ –ø–æ–ª—è Audience/–ê—É–¥–∏—Ç–æ—Ä–∏—è)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∞—É–¥–∏—Ç–æ—Ä–∏–∏...")
            audience_data = await self._extract_audience()
            if audience_data:
                age = audience_data.get("age", "N/A")
                platform = audience_data.get("platform", "N/A")
                # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ "35-45" –∏–ª–∏ "35-45 Android" (–µ—Å–ª–∏ –µ—Å—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞)
                # –í —Å—Ç—Ä–æ–∫–µ 6 —Ç–æ–ª—å–∫–æ –≤–æ–∑—Ä–∞—Å—Ç "25-35", –±–µ–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
                video_data["audience_age"] = age if age != "N/A" else "N/A"
                log.info(f"      ‚úÖ Audience: {video_data['audience_age']}")
            else:
                video_data["audience_age"] = "N/A"
                log.info("      ‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
            
            # 6. Country (–∏–∑ –ø–æ–ª—è "Country/Region" –∏–ª–∏ "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω" - –û–¢–î–ï–õ–¨–ù–û –æ—Ç Audience!)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã...")
            country = await self._extract_country()
            if country:
                video_data["country"] = country
                log.info(f"      ‚úÖ Country: {country}")
            else:
                video_data["country"] = "N/A"
                log.warning("      ‚ö†Ô∏è Country –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä div.addel-info-item —Å 'Country/Region' –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 7. First seen (—Ñ–æ—Ä–º–∞—Ç "Oct 27 2025" - –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ "Oct 28 2025 ~ Nov 10 2025")
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞—Ç—ã First seen...")
            first_seen = await self._extract_first_seen()
            if first_seen:
                video_data["first_seen"] = first_seen
                log.info(f"      ‚úÖ First seen: {first_seen}")
            else:
                video_data["first_seen"] = "N/A"
                log.info("      ‚ö†Ô∏è First seen –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
            
            log.info(f"    ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ—á–µ–Ω—ã: impression={video_data['impression']}, first_seen={video_data['first_seen']}")
            return video_data
            
        except Exception as e:
            log.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö ad-search: {e}")
            return video_data
    
    async def _extract_impressions(self) -> Optional[str]:
        """
        –ò–∑–≤–ª–µ—á—å impressions - –ö–†–ò–¢–ò–ß–ù–û: –≤ —Ä–∞–∑–¥–µ–ª–µ "Data/–î–∞–Ω–Ω—ã–µ" –≤ –ø—É–Ω–∫—Ç–µ "Impression/–ü–æ–∫–∞–∑"
        –í–ê–ñ–ù–û: –ù–ï –±—Ä–∞—Ç—å —à–∞–±–ª–æ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã!
        
        Returns:
            –°—Ç—Ä–æ–∫–∞ —Å impressions (–Ω–∞–ø—Ä–∏–º–µ—Ä "170.6K", "339.9M") –∏–ª–∏ None
        """
        try:
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM (–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ)
            try:
                impression_data = await self.page.evaluate("""
                    () => {
                        // –ò—â–µ–º —Ä–∞–∑–¥–µ–ª "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                        const dataKeywords = ['Data', '–î–∞–Ω–Ω—ã–µ'];
                        const impressionKeywords = ['Impression', '–ü–æ–∫–∞–∑', '–ü–æ–∫–∞–∑—ã'];
                        
                        // –ò—â–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —ç–ª–µ–º–µ–Ω—Ç "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                            for (const dataKeyword of dataKeywords) {
                                if (text.includes(dataKeyword)) {
                                    // –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –∏—â–µ–º "Impression" –∏–ª–∏ "–ü–æ–∫–∞–∑"
                                    for (const impKeyword of impressionKeywords) {
                                        if (text.includes(impKeyword)) {
                                            // –ò—â–µ–º —á–∏—Å–ª–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "170.6K", "403.2M" –∏ —Ç.–¥.
                                            const patterns = [
                                                new RegExp(impKeyword + '[\\s:]*([\\d.,]+[KM]?)', 'i'),
                                                new RegExp('([\\d.,]+[KM]?)\\s*' + impKeyword, 'i')
                                            ];
                                            
                                            for (const pattern of patterns) {
                                                const match = text.match(pattern);
                                                if (match && match[1]) {
                                                    const value = match[1];
                                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ —á–∏—Å–ª–æ (–Ω–µ —à–∞–±–ª–æ–Ω–Ω–æ–µ)
                                                    // –û–±—ã—á–Ω–æ —Ä–µ–∞–ª—å–Ω—ã–µ impressions –æ—Ç 50K –¥–æ 500M
                                                    const numValue = parseFloat(value.replace(/[KM]/i, ''));
                                                    if (numValue >= 0.05 && numValue <= 1000) {
                                                        return value;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        
                        // Fallback: –∏—â–µ–º –Ω–∞–ø—Ä—è–º—É—é "Impression" –∏–ª–∏ "–ü–æ–∫–∞–∑" (–ù–ï "Likes"!)
                        for (const impKeyword of impressionKeywords) {
                            const elements = Array.from(document.querySelectorAll('*')).filter(el => {
                                const text = el.innerText || '';
                                return text.includes(impKeyword) && !text.toLowerCase().includes('likes') && !text.toLowerCase().includes('–Ω—Ä–∞–≤–∏—Ç—Å—è');
                            });
                            
                            for (const el of elements) {
                                const text = el.innerText || '';
                                const patterns = [
                                    new RegExp(impKeyword + '[\\s:]*([\\d.,]+[KM]?)', 'i'),
                                    new RegExp('([\\d.,]+[KM]?)\\s*' + impKeyword, 'i')
                                ];
                                
                                for (const pattern of patterns) {
                                    const match = text.match(pattern);
                                    if (match && match[1]) {
                                        const value = match[1];
                                        const numValue = parseFloat(value.replace(/[KM]/i, ''));
                                        if (numValue >= 0.05 && numValue <= 1000) {
                                            return value;
                                        }
                                    }
                                }
                            }
                        }
                        
                        return null;
                    }
                """)
                
                if impression_data:
                    log.debug(f"–ù–∞–π–¥–µ–Ω–æ impressions —á–µ—Ä–µ–∑ JavaScript: {impression_data}")
                    return impression_data
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ impressions —á–µ—Ä–µ–∑ JS: {e}")
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (fallback)
            data_keywords = ["Data", "–î–∞–Ω–Ω—ã–µ"]
            
            for keyword in data_keywords:
                try:
                    data_locator = self.page.locator(f'text=/{keyword}/i').first
                    if await data_locator.count() > 0:
                        impression_keywords = ["Impression", "–ü–æ–∫–∞–∑", "–ü–æ–∫–∞–∑—ã"]
                        for imp_keyword in impression_keywords:
                            try:
                                parent_text = await data_locator.locator("..").inner_text()
                                if imp_keyword in parent_text and "Likes" not in parent_text and "–ù—Ä–∞–≤–∏—Ç—Å—è" not in parent_text:
                                    pattern = rf'{imp_keyword}[:\s]*([\d.,]+[KM]?)'
                                    match = re.search(pattern, parent_text, re.IGNORECASE)
                                    if match:
                                        impression_str = match.group(1)
                                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —à–∞–±–ª–æ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                                        num_value = validator.parse_impressions(impression_str)
                                        if num_value and 50000 <= num_value <= 1000000000:  # –û—Ç 50K –¥–æ 1B
                                            log.debug(f"–ù–∞–π–¥–µ–Ω–æ impressions –≤ —Ä–∞–∑–¥–µ–ª–µ Data: {impression_str}")
                                            return impression_str
                            except:
                                continue
                except:
                    continue
            
            log.warning("–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ 'Impression' –∏–ª–∏ '–ü–æ–∫–∞–∑' –≤ —Ä–∞–∑–¥–µ–ª–µ Data")
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ impressions: {e}")
            return None
    
    async def _extract_script(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å —Å—Ü–µ–Ω–∞—Ä–∏–π –∏–∑ —Å–µ–∫—Ü–∏–∏ 'Script' –∏–ª–∏ '–°—Ü–µ–Ω–∞—Ä–∏–π' (–∏–ª–∏ 'Transcript' –∏–ª–∏ '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞')
        
        –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
        <li id="ai-script">
            <div class="li-title">...</div>
            <div class="control-content li-content">
                <p class="content-text slot-wrap">...</p>
            </div>
        </li>
        """
        try:
            # –ú–ï–¢–û–î 0: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä—É –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            # –ü—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º (—ç–ª–µ–º–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
            for attempt in range(3):
                try:
                    # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
                    try:
                        await self.page.wait_for_selector('li#ai-script', timeout=5000, state="visible")
                    except:
                        if attempt < 2:
                            log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç li#ai-script –Ω–µ –ø–æ—è–≤–∏–ª—Å—è, –∂–¥–µ–º –µ—â–µ...")
                            await self.human_delay(1, 2)
                            continue
                        else:
                            log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-script –Ω–µ –ø–æ—è–≤–∏–ª—Å—è –∑–∞ 15 —Å–µ–∫—É–Ω–¥")
                    
                    script_element = await self.page.query_selector('li#ai-script p.content-text')
                    if script_element:
                        script = await script_element.inner_text()
                        if script and len(script.strip()) > 10:
                            log.info(f"      ‚úÖ Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-script p.content-text ({len(script)} —Å–∏–º–≤–æ–ª–æ–≤)")
                            return script.strip()
                    else:
                        if attempt < 2:
                            log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω, –∂–¥–µ–º –µ—â–µ...")
                            await self.human_delay(1, 2)
                            continue
                        else:
                            log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-script p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω")
                except Exception as e:
                    if attempt < 2:
                        log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: –æ—à–∏–±–∫–∞ {e}, –ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑...")
                        await self.human_delay(1, 2)
                        continue
                    else:
                        log.debug(f"      ‚Üí –°–µ–ª–µ–∫—Ç–æ—Ä li#ai-script –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: {e}")
            
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
            script_keywords = ["Script", "–°—Ü–µ–Ω–∞—Ä–∏–π", "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞", "–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç"]
            
            for keyword in script_keywords:
                try:
                    # –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å —Ç–µ–∫—Å—Ç–æ–º
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            parent_text = await locator.locator("..").inner_text()
                            if keyword in parent_text:
                                parts = parent_text.split(keyword, 1)
                                if len(parts) > 1:
                                    script = parts[1].strip()
                                    # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –º–µ—Ç–∫–∏
                                    stop_words = ["Hook", "–•—É–∫", "Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", 
                                                "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", "Impressions", "–ü–æ–∫–∞–∑—ã",
                                                "Limited Time Offer", "Annual Plan", "Promotion Period", "50% OFF",
                                                "Privacy", "Terms", "Copyright", "PIPIADS", "All Rights Reserved",
                                                "AI-agent", "cosmobeauty", "credits", "subscription", "invoice",
                                                "Monthly Credits", "Extra Credits", "data cost", "detail costs",
                                                "Team Setting", "Affiliate Dashboard", "Logout"]
                                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                           "cosmobeauty", "credits", "subscription", "invoice", 
                                                           "Monthly Credits", "Extra Credits", "@gmail.com"]
                                    is_footer_menu = any(keyword in script for keyword in footer_menu_keywords)
                                    
                                    for stop_word in stop_words:
                                        if stop_word in script:
                                            script = script.split(stop_word)[0].strip()
                                    # –§–∏–ª—å—Ç—Ä—É–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (Video Text Translator, Quality, Size –∏ —Ç.–¥.)
                                    metadata_keywords = ["Video Text Translator", "Translator", "Quality", "Size", "Resolution", 
                                                        "Width", "Height", "Duration", "Format", "Codec", "Frame Rate"]
                                    is_metadata = any(keyword in script for keyword in metadata_keywords)
                                    
                                    # –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                    lines = script.split('\n')
                                    cleaned_lines = []
                                    skip_words = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook']
                                    for line in lines:
                                        line = line.strip()
                                        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                        if line and not line.startswith('#') and not any(skip in line for skip in skip_words):
                                            cleaned_lines.append(line)
                                    script = '\n'.join(cleaned_lines).strip()
                                    
                                    if script and len(script) > 10 and not is_footer_menu and not is_metadata:
                                        log.debug(f"Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Ä–æ–¥–∏—Ç–µ–ª—å)")
                                        return script
                        except:
                            pass
                        
                        # –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            next_sibling = await locator.evaluate_handle("el => el.nextElementSibling")
                            if next_sibling:
                                script = await next_sibling.as_element().inner_text()
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                       "cosmobeauty", "credits", "subscription", "invoice", 
                                                       "Monthly Credits", "Extra Credits", "@gmail.com"]
                                is_footer_menu = any(keyword in script for keyword in footer_menu_keywords)
                                # –§–∏–ª—å—Ç—Ä—É–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                metadata_keywords = ["Video Text Translator", "Translator", "Quality", "Size", "Resolution"]
                                is_metadata = any(keyword in script for keyword in metadata_keywords)
                                
                                # –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                lines = script.split('\n')
                                cleaned_lines = []
                                skip_words = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook']
                                for line in lines:
                                    line = line.strip()
                                    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                    if line and not line.startswith('#') and not any(skip in line for skip in skip_words):
                                        cleaned_lines.append(line)
                                script = '\n'.join(cleaned_lines).strip()
                                
                                if script and len(script) > 10 and not is_footer_menu and not is_metadata:
                                    log.debug(f"Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç)")
                                    return script.strip()
                        except:
                            pass
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                script = await self.page.evaluate("""
                    () => {
                        const keywords = ['Script', '–°—Ü–µ–Ω–∞—Ä–∏–π', 'Transcript', '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞', '–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç'];
                        const stopWords = ['Hook', '–•—É–∫', 'Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 
                                          'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 'Impressions', '–ü–æ–∫–∞–∑—ã',
                                          'Analysis', 'Advertiser', 'Display Name', 'Ad Copy',
                                          'Limited Time Offer', 'Annual Plan', 'Promotion Period', '50% OFF'];
                        
                        // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    // –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ (–æ–±—ã—á–Ω–æ —ç—Ç–æ —Å–∞–º script)
                                    let scriptText = null;
                                    
                                    // –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ sibling —ç–ª–µ–º–µ–Ω—Ç–∞
                                    let nextSibling = el.nextElementSibling;
                                    if (nextSibling) {
                                        scriptText = nextSibling.innerText || '';
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    if (!scriptText || scriptText.length < 10) {
                                        const parentText = el.parentElement ? el.parentElement.innerText || '' : '';
                                        if (parentText.includes(keyword)) {
                                            const parts = parentText.split(keyword);
                                            if (parts.length > 1) {
                                                scriptText = parts[1].trim();
                                            }
                                        }
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 3: –ò—â–µ–º –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö (–æ–±—ã—á–Ω–æ script –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –±–ª–æ–∫–µ)
                                    if (!scriptText || scriptText.length < 10) {
                                        const children = el.querySelectorAll('p, div, span');
                                        for (const child of children) {
                                            const childText = child.innerText || '';
                                            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç—ã
                                            if (childText.length > 20 && 
                                                !childText.includes('Advertiser') && 
                                                !childText.includes('Display Name') &&
                                                !childText.includes('Analysis') &&
                                                !childText.includes('Generator') &&
                                                !childText.includes('Limited Time Offer') &&
                                                !childText.includes('Annual Plan') &&
                                                !childText.includes('Promotion Period') &&
                                                !childText.includes('50% OFF')) {
                                                scriptText = childText;
                                                break;
                                            }
                                        }
                                    }
                                    
                                    if (scriptText) {
                                        // –£–±–∏—Ä–∞–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                        for (const stopWord of stopWords) {
                                            if (scriptText.includes(stopWord)) {
                                                scriptText = scriptText.split(stopWord)[0];
                                            }
                                        }
                                        
                                        scriptText = scriptText.trim();
                                        
                                        // –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                        const skipWords = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook'];
                                        const lines = scriptText.split('\\n');
                                        const cleanedLines = [];
                                        for (const line of lines) {
                                            const trimmedLine = line.trim();
                                            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                            if (trimmedLine && !trimmedLine.startsWith('#') && 
                                                !skipWords.some(word => trimmedLine.includes(word))) {
                                                cleanedLines.push(trimmedLine);
                                            }
                                        }
                                        scriptText = cleanedLines.join('\\n').trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π script (–Ω–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –Ω–µ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç, –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é)
                                        const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                                   'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                                   'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                                   'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                                   'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                        const isFooterMenu = footerMenuKeywords.some(keyword => scriptText.includes(keyword));
                                        
                                        // –§–∏–ª—å—Ç—Ä—É–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                    const metadataKeywords = ['Video Text Translator', 'Translator', 'Quality', 'Size', 'Resolution', 
                                                             'Width', 'Height', 'Duration', 'Format', 'Codec', 'Frame Rate'];
                                    const isMetadata = metadataKeywords.some(keyword => scriptText.includes(keyword));
                                    
                                    if (scriptText && scriptText.length > 20 && 
                                            !scriptText.startsWith('Analysis') &&
                                            !scriptText.includes('shop.tiktok.com') &&
                                            !scriptText.includes('Generator Image') &&
                                            !scriptText.includes('Limited Time Offer') &&
                                            !scriptText.includes('Annual Plan') &&
                                            !scriptText.includes('Promotion Period') &&
                                            !scriptText.includes('50% OFF') &&
                                            !scriptText.toLowerCase().includes('q4') &&
                                            !scriptText.toLowerCase().includes('monthly plan') &&
                                            !isFooterMenu &&
                                            !isMetadata) {
                                            return scriptText;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if script and len(script) > 10:
                    log.debug("Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript")
                    return script.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ script —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è: {e}")
            return None
    
    async def _extract_hook(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å hook –∏–∑ —Å–µ–∫—Ü–∏–∏ Hook/Hooks (–∞–Ω–≥–ª.) –∏–ª–∏ –•—É–∫/–•—É–∫–∏ (—Ä—É—Å.)
        –í–ê–ñ–ù–û: Hook –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ Script –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ!
        
        –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
        <li id="ai-hook">
            <div class="li-title">...</div>
            <div class="control-content li-content">
                <p class="content-text slot-wrap">...</p>
            </div>
        </li>
        """
        try:
            # –ú–ï–¢–û–î 0: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä—É –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            # –ü—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º (—ç–ª–µ–º–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
            for attempt in range(3):
                try:
                    # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
                    try:
                        await self.page.wait_for_selector('li#ai-hook', timeout=5000, state="visible")
                    except:
                        if attempt < 2:
                            log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç li#ai-hook –Ω–µ –ø–æ—è–≤–∏–ª—Å—è, –∂–¥–µ–º –µ—â–µ...")
                            await self.human_delay(1, 2)
                            continue
                        else:
                            log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-hook –Ω–µ –ø–æ—è–≤–∏–ª—Å—è –∑–∞ 15 —Å–µ–∫—É–Ω–¥")
                    
                    hook_element = await self.page.query_selector('li#ai-hook p.content-text')
                    if hook_element:
                        hook = await hook_element.inner_text()
                        if hook and len(hook.strip()) > 5:
                            log.info(f"      ‚úÖ Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook p.content-text ({len(hook)} —Å–∏–º–≤–æ–ª–æ–≤)")
                            return hook.strip()
                    else:
                        if attempt < 2:
                            log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω, –∂–¥–µ–º –µ—â–µ...")
                            await self.human_delay(1, 2)
                            continue
                        else:
                            log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-hook p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω")
                except Exception as e:
                    if attempt < 2:
                        log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: –æ—à–∏–±–∫–∞ {e}, –ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑...")
                        await self.human_delay(1, 2)
                        continue
                    else:
                        log.debug(f"      ‚Üí –°–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: {e}")
            
            # –ù–û–í–´–ô –ú–ï–¢–û–î: –ò—â–µ–º Script, –∑–∞—Ç–µ–º –∏—â–µ–º Hook –≤ —Å–ª–µ–¥—É—é—â–µ–º —ç–ª–µ–º–µ–Ω—Ç–µ/—Å–µ–∫—Ü–∏–∏
            try:
                # –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏–º Script
                script_keywords = ["Script", "–°—Ü–µ–Ω–∞—Ä–∏–π", "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞"]
                for script_keyword in script_keywords:
                    try:
                        script_locator = self.page.locator(f'text=/{script_keyword}/i').first
                        if await script_locator.count() > 0:
                            # –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ Script, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç "Hook" –∏–ª–∏ "Hooks"
                            # –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ –ø–æ—Å–ª–µ Script
                            try:
                                # –°–ø–æ—Å–æ–± 1: –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å "Hook" –∏–ª–∏ "Hooks" –ø–æ—Å–ª–µ Script
                                parent = script_locator.locator("..")
                                parent_text = await parent.inner_text()
                                
                                # –ò—â–µ–º "Hook" –∏–ª–∏ "Hooks" –≤ —Ç–æ–º –∂–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ
                                if "Hook" in parent_text or "Hooks" in parent_text or "–•—É–∫" in parent_text or "–•—É–∫–∏" in parent_text:
                                    # –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é Script –∏ Hook –≤ —Ç–µ–∫—Å—Ç–µ
                                    script_pos = parent_text.find(script_keyword)
                                    hook_pos = -1
                                    for hook_word in ["Hook", "Hooks", "–•—É–∫", "–•—É–∫–∏"]:
                                        pos = parent_text.find(hook_word, script_pos)
                                        if pos > script_pos:
                                            hook_pos = pos
                                            break
                                    
                                    if hook_pos > script_pos:
                                        # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ "Hook" –∏–ª–∏ "Hooks"
                                        hook_section = parent_text[hook_pos:]
                                        # –£–±–∏—Ä–∞–µ–º "Hook" –∏–ª–∏ "Hooks" –∏–∑ –Ω–∞—á–∞–ª–∞
                                        hook_section = re.sub(r'^Hooks?\s*:?\s*', '', hook_section, flags=re.IGNORECASE)
                                        hook_section = re.sub(r'^–•—É–∫–∏?\s*:?\s*', '', hook_section, flags=re.IGNORECASE)
                                        hook_text = hook_section.strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏ (Target Audience, First seen –∏ —Ç.–¥.)
                                        stop_words = ["Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", 
                                                    "Impressions", "–ü–æ–∫–∞–∑—ã", "Country", "–°—Ç—Ä–∞–Ω–∞", "Country/Region", "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω"]
                                        for stop_word in stop_words:
                                            if stop_word in hook_text:
                                                hook_text = hook_text.split(stop_word)[0].strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                        hook_text = re.sub(r'Quality\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'Size\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'Resolution\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'--', '', hook_text)
                                        hook_text = re.sub(r'\n{2,}', '\n', hook_text).strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞ –≤ –Ω–∞—á–∞–ª–µ
                                        hook_text = re.sub(r'^(Tags|Script|Hooks?)\s*:?\s*', '', hook_text, flags=re.IGNORECASE)
                                        
                                        if hook_text and len(hook_text) > 5 and len(hook_text) < 500:
                                            log.debug(f"Hook –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ Script —á–µ—Ä–µ–∑ '{script_keyword}'")
                                            return hook_text
                            except:
                                pass
                            
                            # –°–ø–æ—Å–æ–± 2: –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π sibling —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ Script
                            try:
                                script_element = await script_locator.element_handle()
                                if script_element:
                                    # –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å —Ç–µ–∫—Å—Ç–æ–º "Hook" –∏–ª–∏ "Hooks"
                                    next_elements = await self.page.evaluate("""
                                        (scriptEl) => {
                                            let current = scriptEl;
                                            // –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å "Hook" –∏–ª–∏ "Hooks"
                                            for (let i = 0; i < 10; i++) {
                                                current = current.nextElementSibling;
                                                if (!current) break;
                                                const text = current.innerText || '';
                                                if (text.includes('Hook') || text.includes('Hooks') || 
                                                    text.includes('–•—É–∫') || text.includes('–•—É–∫–∏')) {
                                                    // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ "Hook" –∏–ª–∏ "Hooks"
                                                    const parts = text.split(/Hooks?\\s*:?\\s*|–•—É–∫–∏?\\s*:?\\s*/i);
                                                    if (parts.length > 1) {
                                                        let hookText = parts[1].trim();
                                                        // –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏
                                                        const stopWords = ['Target Audience', 'First seen', 'Impressions', 'Country'];
                                                        for (const stop of stopWords) {
                                                            if (hookText.includes(stop)) {
                                                                hookText = hookText.split(stop)[0];
                                                            }
                                                        }
                                                        hookText = hookText.replace(/Quality\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/Size\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/Resolution\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/--/g, '');
                                                        hookText = hookText.replace(/\\n{2,}/g, '\\n').trim();
                                                        if (hookText && hookText.length > 5 && hookText.length < 500) {
                                                            return hookText;
                                                        }
                                                    }
                                                }
                                            }
                                            return null;
                                        }
                                    """, script_element)
                                    
                                    if next_elements:
                                        log.debug(f"Hook –Ω–∞–π–¥–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–º —ç–ª–µ–º–µ–Ω—Ç–µ –ø–æ—Å–ª–µ Script")
                                        return next_elements
                            except:
                                pass
                            
                            # –°–ø–æ—Å–æ–± 3: –ò—â–µ–º Hook –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –ø–æ—Å–ª–µ Script
                            try:
                                # –ü–æ–ª—É—á–∞–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –∏—â–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω "Script...Hook"
                                page_text = await self.page.content()
                                # –ò—â–µ–º —á–µ—Ä–µ–∑ JavaScript –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ
                                hook_text = await self.page.evaluate("""
                                    () => {
                                        // –ò—â–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Script"
                                        const allElements = Array.from(document.querySelectorAll('*'));
                                        for (const el of allElements) {
                                            const text = el.innerText || '';
                                            if (text.includes('Script') || text.includes('–°—Ü–µ–Ω–∞—Ä–∏–π')) {
                                                // –ò—â–µ–º –≤ —ç—Ç–æ–º –∂–µ —ç–ª–µ–º–µ–Ω—Ç–µ –∏–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º "Hook" –∏–ª–∏ "Hooks"
                                                let searchEl = el;
                                                for (let depth = 0; depth < 3; depth++) {
                                                    const searchText = searchEl.innerText || '';
                                                    if (searchText.includes('Hook') || searchText.includes('Hooks') || 
                                                        searchText.includes('–•—É–∫') || searchText.includes('–•—É–∫–∏')) {
                                                        // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –º–µ–∂–¥—É Script –∏ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Å–µ–∫—Ü–∏—è–º–∏
                                                        const scriptIndex = searchText.indexOf('Script');
                                                        const hookIndex = searchText.indexOf('Hook', scriptIndex);
                                                        if (hookIndex > scriptIndex) {
                                                            let hookText = searchText.substring(hookIndex);
                                                            // –£–±–∏—Ä–∞–µ–º "Hook" –∏–ª–∏ "Hooks" –∏–∑ –Ω–∞—á–∞–ª–∞
                                                            hookText = hookText.replace(/^Hooks?\\s*:?\\s*/i, '');
                                                            hookText = hookText.replace(/^–•—É–∫–∏?\\s*:?\\s*/i, '');
                                                            // –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏
                                                            const stopWords = ['Target Audience', 'First seen', 'Impressions', 'Country'];
                                                            for (const stop of stopWords) {
                                                                if (hookText.includes(stop)) {
                                                                    hookText = hookText.split(stop)[0];
                                                                }
                                                            }
                                                            hookText = hookText.replace(/Quality\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/Size\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/Resolution\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/--/g, '');
                                                            hookText = hookText.replace(/\\n{2,}/g, '\\n').trim();
                                                            if (hookText && hookText.length > 5 && hookText.length < 500) {
                                                                return hookText;
                                                            }
                                                        }
                                                    }
                                                    searchEl = searchEl.parentElement;
                                                    if (!searchEl) break;
                                                }
                                            }
                                        }
                                        return null;
                                    }
                                """)
                                
                                if hook_text:
                                    log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ—Å–ª–µ Script")
                                    return hook_text
                            except:
                                pass
                    except:
                        continue
            except:
                pass
            
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (—Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±, –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ fallback)
            hook_keywords = ["Hooks", "Hook", "–•—É–∫–∏", "–•—É–∫"]
            
            for keyword in hook_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            parent_text = await locator.locator("..").inner_text()
                            if keyword in parent_text:
                                parts = parent_text.split(keyword, 1)
                                if len(parts) > 1:
                                    hook = parts[1].strip()
                                    # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –º–µ—Ç–∫–∏
                                    stop_words = ["Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", 
                                                "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞", "Impressions", "–ü–æ–∫–∞–∑—ã",
                                                "Limited Time Offer", "Annual Plan", "Promotion Period", "50% OFF",
                                                "Privacy", "Terms", "Copyright", "PIPIADS", "All Rights Reserved",
                                                "AI-agent", "cosmobeauty", "credits", "subscription", "invoice",
                                                "Monthly Credits", "Extra Credits", "data cost", "detail costs",
                                                "Team Setting", "Affiliate Dashboard", "Logout"]
                                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                           "cosmobeauty", "credits", "subscription", "invoice", 
                                                           "Monthly Credits", "Extra Credits", "@gmail.com"]
                                    is_footer_menu = any(keyword in hook for keyword in footer_menu_keywords)
                                    
                                    for stop_word in stop_words:
                                        if stop_word in hook:
                                            hook = hook.split(stop_word)[0].strip()
                                    
                                    # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                    metadata_patterns = [
                                        r'Quality\s*:?\s*[^\n]*',
                                        r'Size\s*:?\s*[^\n]*',
                                        r'Resolution\s*:?\s*[^\n]*',
                                        r'Width\s*:?\s*[^\n]*',
                                        r'Height\s*:?\s*[^\n]*',
                                        r'Duration\s*:?\s*[^\n]*',
                                        r'Format\s*:?\s*[^\n]*',
                                        r'Codec\s*:?\s*[^\n]*',
                                        r'Frame Rate\s*:?\s*[^\n]*',
                                        r'--',  # –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                    ]
                                    for pattern in metadata_patterns:
                                        hook = re.sub(pattern, '', hook, flags=re.IGNORECASE)
                                    hook = re.sub(r'\n{2,}', '\n', hook).strip()  # –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                    
                                    if hook and len(hook) > 5 and not is_footer_menu:
                                        log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Ä–æ–¥–∏—Ç–µ–ª—å)")
                                        return hook
                        except:
                            pass
                        
                        # –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            next_sibling = await locator.evaluate_handle("el => el.nextElementSibling")
                            if next_sibling:
                                hook = await next_sibling.as_element().inner_text()
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                       "cosmobeauty", "credits", "subscription", "invoice", 
                                                       "Monthly Credits", "Extra Credits", "@gmail.com"]
                                is_footer_menu = any(keyword in hook for keyword in footer_menu_keywords)
                                
                                # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                metadata_patterns = [
                                    r'Quality\s*:?\s*[^\n]*',
                                    r'Size\s*:?\s*[^\n]*',
                                    r'Resolution\s*:?\s*[^\n]*',
                                    r'Width\s*:?\s*[^\n]*',
                                    r'Height\s*:?\s*[^\n]*',
                                    r'Duration\s*:?\s*[^\n]*',
                                    r'Format\s*:?\s*[^\n]*',
                                    r'Codec\s*:?\s*[^\n]*',
                                    r'Frame Rate\s*:?\s*[^\n]*',
                                    r'--',  # –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                ]
                                for pattern in metadata_patterns:
                                    hook = re.sub(pattern, '', hook, flags=re.IGNORECASE)
                                hook = re.sub(r'\n{2,}', '\n', hook).strip()  # –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                
                                if hook and len(hook) > 5 and not is_footer_menu:
                                    log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç)")
                                    return hook.strip()
                        except:
                            pass
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                hook = await self.page.evaluate("""
                    () => {
                        const keywords = ['Hooks', 'Hook', '–•—É–∫–∏', '–•—É–∫'];
                        const stopWords = ['Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 
                                         'Transcript', '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞', 'Impressions', '–ü–æ–∫–∞–∑—ã',
                                         'Script', '–°—Ü–µ–Ω–∞—Ä–∏–π', 'Analysis',
                                         'Limited Time Offer', 'Annual Plan', 'Promotion Period', '50% OFF'];
                        
                        // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    let hookText = null;
                                    
                                    // –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ sibling —ç–ª–µ–º–µ–Ω—Ç–∞
                                    let nextSibling = el.nextElementSibling;
                                    if (nextSibling) {
                                        hookText = nextSibling.innerText || '';
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    if (!hookText || hookText.length < 5) {
                                        const parentText = el.parentElement ? el.parentElement.innerText || '' : '';
                                        if (parentText.includes(keyword)) {
                                            const parts = parentText.split(keyword);
                                            if (parts.length > 1) {
                                                hookText = parts[1].trim();
                                            }
                                        }
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 3: –ò—â–µ–º –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö
                                    if (!hookText || hookText.length < 5) {
                                        const children = el.querySelectorAll('p, div, span');
                                        for (const child of children) {
                                            const childText = child.innerText || '';
                                            if (childText.length > 5 && childText.length < 200) {
                                                hookText = childText;
                                                break;
                                            }
                                        }
                                    }
                                    
                                    if (hookText) {
                                        // –£–±–∏—Ä–∞–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞
                                        for (const stopWord of stopWords) {
                                            if (hookText.includes(stopWord)) {
                                                hookText = hookText.split(stopWord)[0];
                                            }
                                        }
                                        
                                        hookText = hookText.trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π hook (–∫–æ—Ä–æ—Ç–∫–∞—è —Ñ—Ä–∞–∑–∞, –Ω–µ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç, –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é)
                                        const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                                   'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                                   'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                                   'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                                   'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                        const isFooterMenu = footerMenuKeywords.some(keyword => hookText.includes(keyword));
                                        
                                        // –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                        const metadataPatterns = [
                                            /Quality\s*:?\s*[^\n]*/gi,
                                            /Size\s*:?\s*[^\n]*/gi,
                                            /Resolution\s*:?\s*[^\n]*/gi,
                                            /Width\s*:?\s*[^\n]*/gi,
                                            /Height\s*:?\s*[^\n]*/gi,
                                            /Duration\s*:?\s*[^\n]*/gi,
                                            /Format\s*:?\s*[^\n]*/gi,
                                            /Codec\s*:?\s*[^\n]*/gi,
                                            /Frame Rate\s*:?\s*[^\n]*/gi,
                                            /--/g,  // –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                        ];
                                        let cleanedHook = hookText;
                                        for (const pattern of metadataPatterns) {
                                            cleanedHook = cleanedHook.replace(pattern, '');
                                        }
                                        cleanedHook = cleanedHook.replace(/\n{2,}/g, '\n').trim();  // –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                        
                                        if (cleanedHook && cleanedHook.length > 5 && cleanedHook.length < 300 &&
                                            !cleanedHook.includes('Limited Time Offer') &&
                                            !cleanedHook.includes('Annual Plan') &&
                                            !cleanedHook.includes('Promotion Period') &&
                                            !cleanedHook.includes('50% OFF') &&
                                            !cleanedHook.toLowerCase().includes('q4') &&
                                            !cleanedHook.toLowerCase().includes('monthly plan') &&
                                            !isFooterMenu) {
                                            return cleanedHook;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if hook and len(hook) > 5:
                    log.debug("Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript")
                    return hook.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ hook —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ hook: {e}")
            return None
    
    async def _extract_audience(self) -> Optional[Dict[str, str]]:
        """
        –ò–∑–≤–ª–µ—á—å –≤–æ–∑—Ä–∞—Å—Ç –∏–∑ –ø–æ–ª—è Audience
        
        –°—Ç—Ä—É–∫—Ç—É—Ä–∞ HTML:
        <div class="addel-info-item">
            <div class="name"> Audience </div>
            <div class="value">
                <div class="audience-info">
                    <div class="audience-info-info">45-55 ... Android...</div>
                </div>
            </div>
        </div>
        """
        try:
            audience_data = {"age": "N/A", "platform": "N/A"}
            
            # –ú–ï–¢–û–î 1: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                # –ò—â–µ–º –±–ª–æ–∫ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "Audience"
                audience_items = await self.page.query_selector_all('div.addel-info-item')
                
                for item in audience_items:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å Audience
                    name_elem = await item.query_selector('div.name')
                    if name_elem:
                        name_text = await name_elem.inner_text()
                        if 'Audience' in name_text or '–ê—É–¥–∏—Ç–æ—Ä–∏—è' in name_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ audience-info-info
                            audience_info = await item.query_selector('div.audience-info-info')
                            if audience_info:
                                text = await audience_info.inner_text()
                                # –ò–∑–≤–ª–µ–∫–∞–µ–º –≤–æ–∑—Ä–∞—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ "45-55" (–º–æ–∂–µ—Ç –±—ã—Ç—å 2 —Ü–∏—Ñ—Ä—ã)
                                age_match = re.search(r'(\d{1,2}-\d{1,2})', text)
                                if age_match:
                                    audience_data["age"] = age_match.group(1)
                                    log.debug(f"      ‚Üí Audience age –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä: {audience_data['age']}")
                                    return audience_data
            except Exception as e:
                log.debug(f"      ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–º –ø–æ–∏—Å–∫–µ audience: {e}")
            
            # –ú–ï–¢–û–î 2: Fallback —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (–µ—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª)
            audience_keywords = ["Audience", "–ê—É–¥–∏—Ç–æ—Ä–∏—è", "Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è"]
            
            for keyword in audience_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç –∞—É–¥–∏—Ç–æ—Ä–∏–∏ —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º –≤–æ–∑—Ä–∞—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ "25-35" –∏–ª–∏ "45-55"
                        age_patterns = [
                            r'–í–æ–∑—Ä–∞—Å—Ç[:\s]+(\d{1,2}-\d{1,2})',
                            r'Age[:\s]+(\d{1,2}-\d{1,2})',
                            r'(\d{1,2}-\d{1,2})',  # –ü—Ä–æ—Å—Ç–æ –≤–æ–∑—Ä–∞—Å—Ç
                        ]
                        
                        for pattern in age_patterns:
                            age_match = re.search(pattern, text, re.IGNORECASE)
                            if age_match:
                                audience_data["age"] = age_match.group(1)
                                log.debug(f"      ‚Üí Audience age –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä: {audience_data['age']}")
                                break
                        
                        if audience_data["age"] != "N/A":
                            return audience_data
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π)
            try:
                result = await self.page.evaluate("""
                    () => {
                        const keywords = ['Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 'Audience', '–ê—É–¥–∏—Ç–æ—Ä–∏—è'];
                        const agePattern = /(\\d{1,2}-\\d{1,2})/;
                        const platformKeywords = ['Android', 'iOS', 'iPhone', 'iPad'];
                        const countryKeywords = ['USA', 'US', 'United States', '–†–æ—Å—Å–∏—è', 'Russia', 'Philippines', 
                                                '–§–∏–ª–∏–ø–ø–∏–Ω—ã', 'China', '–ö–∏—Ç–∞–π', 'India', '–ò–Ω–¥–∏—è'];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    const result = {age: 'N/A', platform: 'N/A', country: 'N/A'};
                                    
                                    // –ò—â–µ–º –≤–æ–∑—Ä–∞—Å—Ç
                                    const ageMatch = text.match(agePattern);
                                    if (ageMatch) {
                                        result.age = ageMatch[1];
                                    }
                                    
                                    // –ò—â–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
                                    for (const platform of platformKeywords) {
                                        if (text.includes(platform)) {
                                            result.platform = (platform === 'iOS' || platform === 'iPhone' || platform === 'iPad') ? 'iOS' : 'Android';
                                            break;
                                        }
                                    }
                                    
                                    // –ò—â–µ–º —Å—Ç—Ä–∞–Ω—É
                                    for (const country of countryKeywords) {
                                        if (text.includes(country)) {
                                            result.country = country;
                                            break;
                                        }
                                    }
                                    
                                    if (result.age !== 'N/A' || result.platform !== 'N/A' || result.country !== 'N/A') {
                                        return result;
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if result:
                    audience_data.update(result)
                    return audience_data
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ audience —á–µ—Ä–µ–∑ JS: {e}")
            
            return audience_data
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–∏: {e}")
            return None
    
    async def _extract_country(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å —Å—Ç—Ä–∞–Ω—É –∏–∑ –ø–æ–ª—è 'Country/Region' –∏–ª–∏ '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω' (–û–¢–î–ï–õ–¨–ù–û –æ—Ç Audience!)"""
        try:
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            try:
                await self.page.wait_for_selector('div.addel-info-item', timeout=5000, state="visible")
            except:
                log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç—ã div.addel-info-item –Ω–µ –ø–æ—è–≤–∏–ª–∏—Å—å –∑–∞ 5 —Å–µ–∫—É–Ω–¥")
            
            country_keywords = ["Country/Region", "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω", "Country", "–°—Ç—Ä–∞–Ω–∞", "Region", "–†–µ–≥–∏–æ–Ω"]
            
            # –ú–ï–¢–û–î 0: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                country_items = await self.page.query_selector_all('div.addel-info-item')
                
                for item in country_items:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å Country/Region
                    name_elem = await item.query_selector('div.name')
                    if name_elem:
                        name_text = await name_elem.inner_text()
                        if 'Country/Region' in name_text or '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω' in name_text or 'Country' in name_text or '–°—Ç—Ä–∞–Ω–∞' in name_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º —Å—Ç—Ä–∞–Ω—É
                            value_elem = await item.query_selector('div.ellipsis, div.value')
                            if value_elem:
                                country_text = await value_elem.inner_text()
                                # –£–±–∏—Ä–∞–µ–º (1) –∏ —Ç.–¥.
                                country = re.sub(r'\([0-9]+\)', '', country_text).strip()
                                if country and len(country) > 0:
                                    log.info(f"      ‚úÖ Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä: {country}")
                                    return country
            except Exception as e:
                log.debug(f"      ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–º –ø–æ–∏—Å–∫–µ country: {e}")
            
            for keyword in country_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω—ã —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º —Å—Ç—Ä–∞–Ω—É (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫)
                        country_patterns = [
                            r'United States(?:\([0-9]+\))?',  # United States(1)
                            r'USA(?:\([0-9]+\))?',
                            r'US(?:\([0-9]+\))?',
                            r'Philippines(?:\([0-9]+\))?',
                            r'–§–∏–ª–∏–ø–ø–∏–Ω—ã(?:\([0-9]+\))?',
                            r'Russia(?:\([0-9]+\))?',
                            r'–†–æ—Å—Å–∏—è(?:\([0-9]+\))?',
                            r'China(?:\([0-9]+\))?',
                            r'–ö–∏—Ç–∞–π(?:\([0-9]+\))?',
                            r'India(?:\([0-9]+\))?',
                            r'–ò–Ω–¥–∏—è(?:\([0-9]+\))?',
                            r'Brazil(?:\([0-9]+\))?',
                            r'–ë—Ä–∞–∑–∏–ª–∏—è(?:\([0-9]+\))?',
                            r'Germany(?:\([0-9]+\))?',
                            r'–ì–µ—Ä–º–∞–Ω–∏—è(?:\([0-9]+\))?',
                            r'France(?:\([0-9]+\))?',
                            r'–§—Ä–∞–Ω—Ü–∏—è(?:\([0-9]+\))?',
                            r'UK(?:\([0-9]+\))?',
                            r'United Kingdom(?:\([0-9]+\))?',
                        ]
                        
                        for pattern in country_patterns:
                            match = re.search(pattern, text, re.IGNORECASE)
                            if match:
                                country = match.group(0)
                                # –£–±–∏—Ä–∞–µ–º (1) –∏ —Ç.–¥.
                                country = re.sub(r'\([0-9]+\)', '', country).strip()
                                log.debug(f"Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}': {country}")
                                return country
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript
            try:
                country = await self.page.evaluate("""
                    () => {
                        const keywords = ['Country/Region', '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω', 'Country', '–°—Ç—Ä–∞–Ω–∞'];
                        const countryPatterns = [
                            /United States(?:\\([0-9]+\\))?/i,
                            /USA(?:\\([0-9]+\\))?/i,
                            /Philippines(?:\\([0-9]+\\))?/i,
                            /Russia(?:\\([0-9]+\\))?/i,
                            /China(?:\\([0-9]+\\))?/i,
                            /India(?:\\([0-9]+\\))?/i
                        ];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    for (const pattern of countryPatterns) {
                                        const match = text.match(pattern);
                                        if (match) {
                                            return match[0].replace(/\\([0-9]+\\)/g, '').trim();
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if country:
                    log.debug(f"Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript: {country}")
                    return country.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ country —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ country: {e}")
            return None
    
    async def _extract_first_seen(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å First seen –≤ —Ñ–æ—Ä–º–∞—Ç–µ 'Oct 27 2025' - —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ 'Oct 28 2025 ~ Nov 10 2025'"""
        try:
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã
            first_seen_keywords = ["First seen - Last seen", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", "First Seen"]
            
            for keyword in first_seen_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç –¥–∞—Ç—ã —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ "Oct 27 2025" –∏–ª–∏ "Oct 27, 2025"
                        # –ò—â–µ–º –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ "Oct 28 2025 ~ Nov 10 2025"
                        date_patterns = [
                            r'([A-Z][a-z]{2}\s+\d{1,2}\s+\d{4})',  # Oct 27 2025
                            r'([A-Z][a-z]{2}\s+\d{1,2},\s+\d{4})',  # Oct 27, 2025
                            r'(\d{1,2}\s+[A-Z][a-z]{2}\s+\d{4})',  # 27 Oct 2025
                        ]
                        
                        for pattern in date_patterns:
                            # –ò—â–µ–º –ø–µ—Ä–≤—É—é –¥–∞—Ç—É (–¥–æ ~ –∏–ª–∏ –∫–æ–Ω—Ü–∞ —Å—Ç—Ä–æ–∫–∏)
                            date_match = re.search(pattern, text)
                            if date_match:
                                date_str = date_match.group(1)
                                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ñ–æ—Ä–º–∞—Ç (—É–±–∏—Ä–∞–µ–º –∑–∞–ø—è—Ç—É—é –µ—Å–ª–∏ –µ—Å—Ç—å)
                                date_str = date_str.replace(',', '').strip()
                                log.debug(f"First seen –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}': {date_str}")
                                return date_str
                        
                        # –¢–∞–∫–∂–µ –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –¥–∞—Ç—É –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
                        if keyword in text:
                            parts = text.split(keyword, 1)
                            if len(parts) > 1:
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–æ ~ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω)
                                after_keyword = parts[1].split('~')[0].strip()
                                for pattern in date_patterns:
                                    date_match = re.search(pattern, after_keyword)
                                    if date_match:
                                        date_str = date_match.group(1).replace(',', '').strip()
                                        log.debug(f"First seen –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ '{keyword}': {date_str}")
                                        return date_str
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                first_seen = await self.page.evaluate("""
                    () => {
                        const keywords = ['First seen - Last seen', 'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 'First Seen'];
                        const datePatterns = [
                            /([A-Z][a-z]{2}\\s+\\d{1,2}\\s+\\d{4})/,  // Oct 27 2025
                            /([A-Z][a-z]{2}\\s+\\d{1,2},\\s+\\d{4})/,  // Oct 27, 2025
                            /(\\d{1,2}\\s+[A-Z][a-z]{2}\\s+\\d{4})/   // 27 Oct 2025
                        ];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    // –ò—â–µ–º –¥–∞—Ç—É –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    const index = text.indexOf(keyword);
                                    let afterKeyword = text.substring(index + keyword.length);
                                    
                                    // –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–æ ~ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω)
                                    if (afterKeyword.includes('~')) {
                                        afterKeyword = afterKeyword.split('~')[0];
                                    }
                                    
                                    for (const pattern of datePatterns) {
                                        const match = afterKeyword.match(pattern);
                                        if (match) {
                                            const dateStr = match[1].replace(',', '').trim();
                                            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤—É—é –Ω–∞–π–¥–µ–Ω–Ω—É—é –¥–∞—Ç—É (–±–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫ - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç –≤ _filter_videos)
                                            return dateStr;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if first_seen:
                    log.debug(f"First seen –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript: {first_seen}")
                    return first_seen.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ first_seen —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ first_seen: {e}")
            return None


```

```python
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Parser Engine
"""

import asyncio
import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ src
sys.path.insert(0, str(Path(__file__).parent))

from src.browser_manager import BrowserManager
from src.parser_engine import ParserEngine, ProductData
from src.sheets_writer import SheetsWriter
from src import config
from src import logger

log = logger.get_logger("TestParserEngine")


async def test_parser_engine():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Parser Engine"""
    
    browser_manager = None
    try:
        log.info("=" * 60)
        log.info("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï PARSER ENGINE")
        log.info("=" * 60)
        
        # 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
        log.info("\n1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞...")
        browser_manager = BrowserManager()
        success = await browser_manager.initialize(headless=False)  # headful –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä")
            return
        
        # 2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies (–µ—Å–ª–∏ –µ—Å—Ç—å)
        log.info("\n2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies...")
        await browser_manager.load_cookies()
        
        # 3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–∞—á–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads
        log.info("\n3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads...")
        success = await browser_manager.navigate_with_retry(
            config.PIPIADS_INITIAL_URL,
            wait_until="domcontentloaded",
            timeout=30000
        )
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É")
            return
        
        await browser_manager.human_delay(2, 3)
        
        # 4. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
        log.info("\n4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...")
        is_logged_in = await browser_manager._check_logged_in_strict()
        if not is_logged_in:
            log.info("–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...")
            success = await browser_manager.login_to_pipiads()
            if not success:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è")
                return
            await browser_manager.save_cookies()
        else:
            log.info("‚úÖ –£–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω")
        
        # 5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine
        log.info("\n5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine...")
        parser = ParserEngine(browser_manager.page)
        parser.set_browser_manager(browser_manager)
        
        # 6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets (–¥–æ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤)
        log.info("\n6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets...")
        sheets_writer = None
        try:
            sheets_writer = SheetsWriter()
            if sheets_writer.connect():
                log.info("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets —É—Å–ø–µ—à–Ω–æ")
            else:
                log.warning("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Google Sheets, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        except Exception as e:
            log.warning(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Google Sheets: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        
        # 7. –¶–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        log.info("\n" + "=" * 80)
        log.info("7. –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–û–í")
        log.info("=" * 80)
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        # –£–°–õ–ê–ë–õ–ï–ù–û –¥–ª—è —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏: —Å–Ω–∏–∂–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
        MIN_PRODUCTS_TO_COLLECT = 3   # –¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–º–æ–∂–Ω–æ —Å–Ω–∏–∑–∏—Ç—å –¥–æ 1-2)
        MAX_PRODUCTS_TO_CHECK = 15     # –ú–∞–∫—Å–∏–º—É–º —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é (—É–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –≤—ã–±–æ—Ä–∞)
        PRODUCTS_PER_PAGE = 20         # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        
        successful_products = 0  # –°—á–µ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        checked_products = 0      # –°—á–µ—Ç—á–∏–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        skipped_products = []     # –°–ø–∏—Å–æ–∫ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        banned_products = set()   # Ban-list: URL —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ)
        all_products_analytics = []  # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –í–°–ï–• —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è summary-—Ñ–∞–π–ª–∞
        
        def normalize_url(url: str) -> str:
            """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL (—É–±—Ä–∞—Ç—å —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É)"""
            if not url:
                return ""
            url = url.strip().rstrip('/')
            # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if '?' in url:
                url = url.split('?')[0]
            return url
        
        # –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏
        while successful_products < MIN_PRODUCTS_TO_COLLECT and checked_products < MAX_PRODUCTS_TO_CHECK:
            
            # 7.1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
            log.info(f"\n{'='*80}")
            log.info(f"–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã...")
            log.info(f"–ü—Ä–æ–≥—Ä–µ—Å—Å: {successful_products}/{MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ, "
                    f"{checked_products}/{MAX_PRODUCTS_TO_CHECK} –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ")
            log.info(f"{'='*80}")
            
            try:
                products = await parser.get_products_from_search_page(count=PRODUCTS_PER_PAGE)
            except Exception as e:
                log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
                break
            
            if not products:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã, –∑–∞–≤–µ—Ä—à–∞–µ–º")
                break
            
            log.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
            
            # 7.1.5. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ URL (–ø—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è)
            # –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º banned_products –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
            unique_products = []
            duplicate_count = 0
            seen_urls = set()  # –î–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
            
            for product in products:
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ü—Ä–æ–ø—É—Å–∫ —Ç–æ–≤–∞—Ä–∞ –±–µ–∑ URL")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ç–∏–≤ banned_products (—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)
                if product_url in banned_products:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (—É–∂–µ –≤ ban-list): {product_url}")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
                if product_url in seen_urls:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (–≤ —Ç–µ–∫—É—â–µ–º —Å–ø–∏—Å–∫–µ): {product_url}")
                    continue
                
                seen_urls.add(product_url)
                # –û–±–Ω–æ–≤–ª—è–µ–º URL –≤ —Å–ª–æ–≤–∞—Ä–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π
                product['url'] = product_url
                unique_products.append(product)
            
            if duplicate_count > 0:
                log.info(f"üîç –ù–∞–π–¥–µ–Ω–æ {duplicate_count} –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, –æ—Å—Ç–∞–≤–ª–µ–Ω–æ {len(unique_products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤")
            
            products = unique_products  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
            log.info(f"‚úÖ –ü–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏: {len(products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            
            # 7.2. –¶–∏–∫–ª –ø–æ —Ç–æ–≤–∞—Ä–∞–º –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            for product_index, product in enumerate(products):
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    log.info(f"\nüéØ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
                    break
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
                if checked_products >= MAX_PRODUCTS_TO_CHECK:
                    log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
                    break
                
                # ‚ö†Ô∏è –ü–†–û–í–ï–†–ö–ê BAN-LIST: –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                    continue
                
                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
                if product_url in banned_products:
                    log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: {product_url}")
                    log.warning(f"   –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.")
                    continue
                
                # –û—Ç–º–µ—á–∞–µ–º —Ç–æ–≤–∞—Ä –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –°–†–ê–ó–£ (–¥–æ –∫–ª–∏–∫–∞) - —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–≤–∞–∂–¥—ã
                banned_products.add(product_url)
                log.info(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: {product_url}")
                
                checked_products += 1
                
                # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–∞
                log.info(f"\n{'='*80}")
                log.info(f"üì¶ –¢–û–í–ê–† {checked_products}/{MAX_PRODUCTS_TO_CHECK} "
                        f"(—É—Å–ø–µ—à–Ω—ã—Ö: {successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                log.info(f"{'='*80}")
                log.info(f"–ù–∞–∑–≤–∞–Ω–∏–µ: {product.get('name', 'N/A')[:70]}...")
                log.info(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {product.get('category', 'N/A')}")
                log.info(f"URL: {product_url}")
                
                try:
                    # 7.3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ (–ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ URL)
                    # –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥–∞–µ–º banned_products –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
                    product_data = await parser.get_product_details_with_return(
                        product_url=product_url,
                        sheets_writer=sheets_writer,
                        banned_products=banned_products
                    )
                    
                    # 7.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    if product_data is None:
                        # –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
                        log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞")
                        
                        skipped_products.append({
                            "name": product.get('name', 'N/A'),
                            "reason": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ",
                            "videos_found": 0
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ)
                        all_products_analytics.append({
                            "product_name": product.get('name', 'N/A'),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": 0,
                            "top_3_videos": []
                        })
                        continue
                    
                    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç (–µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª—Å—è —Å—Ç–∞—Ç—É—Å "duplicate")
                    if isinstance(product_data, dict) and product_data.get("status") == "duplicate":
                        duplicate_url = product_data.get('product_url', 'N/A')
                        log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): {duplicate_url}")
                        duplicate_count += 1
                        continue
                    
                    if isinstance(product_data, dict) and product_data.get("status") == "insufficient_videos":
                        # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                        log.warning(f"‚è≠Ô∏è  –ü–†–û–ü–£–°–ö: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù–∞–π–¥–µ–Ω–æ: {product_data.get('videos_found', 0)} –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù—É–∂–Ω–æ: {product_data.get('videos_required', 3)} –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": product_data.get('product_name', product.get('name', 'N/A')),
                            "reason": product_data.get('reason', '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ'),
                            "videos_found": product_data.get('videos_found', 0)
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ - —Ç–æ–≤–∞—Ä –≤–µ—Ä–Ω—É–ª insufficient_videos)
                        all_products_analytics.append({
                            "product_name": product_data.get('product_name', product.get('name', 'N/A')),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": product_data.get('videos_found', 0),
                            "top_3_videos": []  # –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–ø-3
                        })
                        continue
                    
                    # 7.5. –°–±–æ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è summary
                    analytics_entry = {
                        "product_name": getattr(product_data, 'product_name', 'N/A'),
                        "product_url": getattr(product_data, 'pipiads_link', product_url),
                        "success": False,
                        "videos_found": len(getattr(product_data, 'videos', [])),
                        "top_3_videos": []
                    }
                    
                    # –ò–∑–≤–ª–µ–∫–∞–µ–º –¢–û–ü-3 –≤–∏–¥–µ–æ (–ø–æ impression) –∏–∑ –í–°–ï–• –≤–∏–¥–µ–æ
                    if hasattr(product_data, '_all_videos_raw'):
                        all_videos = product_data._all_videos_raw
                        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ impression (desc) –∏ –±–µ—Ä–µ–º —Ç–æ–ø-3
                        sorted_videos = sorted(all_videos, key=lambda v: v.get('impression', 0), reverse=True)
                        for i, video in enumerate(sorted_videos[:3], 1):
                            analytics_entry["top_3_videos"].append({
                                "rank": i,
                                "impression": video.get('impression', 0),
                                "first_seen": video.get('first_seen', 'N/A'),
                                "ad_search_url": video.get('ad_search_url', 'N/A')
                            })
                    
                    # 7.6. –£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞
                    if hasattr(product_data, 'videos') and len(product_data.videos) >= 3:
                        successful_products += 1
                        analytics_entry["success"] = True
                        
                        log.info(f"\n‚úÖ –£–°–ü–ï–•! –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω ({successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                        log.info(f"   –ù–∞–∑–≤–∞–Ω–∏–µ: {product_data.product_name[:70]}...")
                        log.info(f"   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ: {len(product_data.videos)}")
                        
                        # –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                        for i, video in enumerate(product_data.videos[:3], 1):
                            log.info(f"   –í–∏–¥–µ–æ {i}: {video.get('impression', 0)} impressions, "
                                    f"{video.get('country', 'N/A')}, {video.get('audience_age', 'N/A')}")
                        
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ –∏ –∫–æ–ø–∏—Ä—É–µ–º –≤ "–£—Å–ø–µ—à–Ω—ã–µ" –µ—Å–ª–∏ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                        if sheets_writer and hasattr(product_data, '_sheets_row'):
                            try:
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã A-Z (–∫—Ä–æ–º–µ C) –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                                if sheets_writer.is_row_complete(product_data._sheets_row):
                                    sheets_writer.copy_to_success_sheet(product_data._sheets_row)
                                    log.info(f"  ‚úÖ –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ ‚Üí —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ '–£—Å–ø–µ—à–Ω—ã–µ'")
                                else:
                                    log.warning(f"  ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ (–µ—Å—Ç—å –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏)")
                            except Exception as e:
                                log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ '–£—Å–ø–µ—à–Ω—ã–µ': {e}")
                    
                    # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
                    all_products_analytics.append(analytics_entry)
                    
                    # 7.7. –ï—Å–ª–∏ –≤–∏–¥–µ–æ –º–µ–Ω—å—à–µ 3 - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                    if not analytics_entry["success"]:
                        log.warning(f"‚ö†Ô∏è –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω, –Ω–æ –º–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": getattr(product_data, 'product_name', product.get('name', 'N/A')),
                            "reason": "–ú–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏",
                            "videos_found": len(getattr(product_data, 'videos', []))
                        })
                
                except Exception as e:
                    log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞: {e}")
                    import traceback
                    log.error(traceback.format_exc())
                    
                    skipped_products.append({
                        "name": product.get('name', 'N/A'),
                        "reason": f"–ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {str(e)[:50]}",
                        "videos_found": 0
                    })
            
            # 7.6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –≤—ã—Ö–æ–¥–∞ –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
            if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                break
            
            if checked_products >= MAX_PRODUCTS_TO_CHECK:
                break
        
        # 8. –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç
        log.info(f"\n{'='*80}")
        log.info("üìä –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢")
        log.info(f"{'='*80}")
        log.info(f"‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {successful_products}")
        log.info(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {len(skipped_products)}")
        log.info(f"üîç –í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {checked_products}")
        log.info(f"üö´ –¢–æ–≤–∞—Ä–æ–≤ –≤ ban-list: {len(banned_products)}")
        log.info(f"{'='*80}")
        
        # –í—ã–≤–æ–¥ ban-list
        if banned_products:
            log.info(f"\nüö´ BAN-LIST (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã):")
            for i, product_url in enumerate(sorted(banned_products), 1):
                log.info(f"   {i}. {product_url}")
        
        if skipped_products:
            log.info(f"\n‚è≠Ô∏è  –°–ü–ò–°–û–ö –ü–†–û–ü–£–©–ï–ù–ù–´–• –¢–û–í–ê–†–û–í:")
            for i, skipped in enumerate(skipped_products, 1):
                log.info(f"   {i}. {skipped['name'][:60]}...")
                log.info(f"      –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}")
                log.info(f"      –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}")
        
        if successful_products >= MIN_PRODUCTS_TO_COLLECT:
            log.info(f"\nüéâ –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
        elif checked_products >= MAX_PRODUCTS_TO_CHECK:
            log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
            log.warning(f"   –°–æ–±—Ä–∞–Ω–æ —Ç–æ–ª—å–∫–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ {MIN_PRODUCTS_TO_COLLECT}")
        
        # 9. –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
        log.info("\n" + "=" * 60)
        log.info("üìù –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –≤–∏–¥–µ–æ...")
        log.info("=" * 60)
        try:
            from datetime import datetime
            import os
            
            summary_dir = "logs/summaries"
            os.makedirs(summary_dir, exist_ok=True)
            
            timestamp = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
            summary_file = f"{summary_dir}/iteration_{timestamp}.md"
            
            with open(summary_file, "w", encoding="utf-8") as f:
                f.write(f"# üìä –ò—Ç–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
                
                f.write("## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã\n\n")
                f.write(f"- **–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ:** {successful_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–ø—É—â–µ–Ω–æ:** {len(skipped_products)} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** {checked_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **Ban-list:** {len(banned_products)} —Ç–æ–≤–∞—Ä–æ–≤\n\n")
                
                if successful_products > 0:
                    f.write("### üéâ SUCCESS\n\n")
                    f.write(f"‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ —Å >= 3 –≤–∏–¥–µ–æ\n\n")
                
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                # –ù–û–í–´–ô –ë–õ–û–ö: –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                if all_products_analytics:
                    f.write("---\n\n")
                    f.write("## üìπ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º\n\n")
                    f.write(f"**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:** >= 5K impressions, –≤–æ–∑—Ä–∞—Å—Ç <= 30 –¥–Ω–µ–π\n\n")
                    
                    for idx, product in enumerate(all_products_analytics, 1):
                        status_icon = "‚úÖ" if product["success"] else "‚ùå"
                        f.write(f"### {status_icon} –¢–æ–≤–∞—Ä #{idx}: {product['product_name'][:80]}\n\n")
                        f.write(f"- **–°—Å—ã–ª–∫–∞:** [{product['product_url']}]({product['product_url']})\n")
                        f.write(f"- **–°—Ç–∞—Ç—É—Å:** {'–£–°–ü–ï–• (>= 3 –≤–∏–¥–µ–æ)' if product['success'] else '–ü–†–û–ü–£–©–ï–ù (< 3 –≤–∏–¥–µ–æ)'}\n")
                        f.write(f"- **–ù–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ:** {product['videos_found']}\n\n")
                        
                        # –¢–û–ü-3 –≤–∏–¥–µ–æ (–¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –∫—Ä–∏—Ç–µ—Ä–∏–∏)
                        if product['top_3_videos']:
                            f.write("#### üèÜ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ impression:\n\n")
                            for video in product['top_3_videos']:
                                impression = video['impression']
                                first_seen = video['first_seen']
                                ad_url = video['ad_search_url']
                                
                                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
                                meets_criteria = impression >= 5000  # –ü—Ä–æ–≤–µ—Ä–∫–∞ impression
                                criteria_icon = "‚úÖ" if meets_criteria else "‚ö†Ô∏è"
                                
                                f.write(f"{video['rank']}. {criteria_icon} **{impression:,} impressions** | "
                                       f"First seen: {first_seen}\n")
                                if ad_url and ad_url != 'N/A':
                                    f.write(f"   - –°—Å—ã–ª–∫–∞: [{ad_url}]({ad_url})\n")
                                f.write("\n")
                        else:
                            f.write("   ‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ (–≤–æ–∑–º–æ–∂–Ω–æ, –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞)\n\n")
                        
                        f.write("---\n\n")
                
                # –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
                if skipped_products:
                    f.write("### ‚è≠Ô∏è –ü–†–û–ü–£–©–ï–ù–ù–´–ï –¢–û–í–ê–†–´ (–∫—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫)\n\n")
                    for i, skipped in enumerate(skipped_products, 1):
                        f.write(f"{i}. **{skipped['name'][:60]}...**\n")
                        f.write(f"   - –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}\n")
                        f.write(f"   - –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}\n\n")
                
                # Ban-list
                if banned_products:
                    f.write("### üö´ Ban-list (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)\n\n")
                    for i, product_url in enumerate(sorted(banned_products), 1):
                        f.write(f"{i}. `{product_url}`\n")
                    f.write("\n")
                
                f.write("## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏\n\n")
                f.write(f"- **–¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:** {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–õ–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫:** {MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤–∏–¥–µ–æ:** >= 5K impressions, <= 30 –¥–Ω–µ–π\n\n")
                
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    f.write("## üéØ –°—Ç–∞—Ç—É—Å: –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê ‚úÖ\n\n")
                elif checked_products >= MAX_PRODUCTS_TO_CHECK:
                    f.write("## ‚ö†Ô∏è –°—Ç–∞—Ç—É—Å: –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫\n\n")
                else:
                    f.write("## ‚ùå –°—Ç–∞—Ç—É—Å: –ü—Ä–µ—Ä–≤–∞–Ω–æ\n\n")
            
            log.info(f"‚úÖ Summary —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {summary_file}")
        except Exception as e:
            log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ summary: {e}")
            import traceback
            log.error(traceback.format_exc())
        
        log.info("\n" + "=" * 60)
        log.info("‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û")
        log.info("=" * 60)
        
        # –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)
        log.info("\n‚è∏Ô∏è –û–∂–∏–¥–∞–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –±—Ä–∞—É–∑–µ—Ä–∞ (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)...")
        log.info("   –ù–∞–∂–º–∏—Ç–µ Ctrl+C, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å —Ä–∞–Ω—å—à–µ")
        try:
            await asyncio.sleep(10)
        except KeyboardInterrupt:
            log.info("   –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        
    except KeyboardInterrupt:
        log.warning("\n‚ö†Ô∏è –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Ctrl+C)")
    except Exception as e:
        log.error(f"\n{'='*60}")
        log.error(f"‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}")
        log.error(f"{'='*60}")
        import traceback
        log.error("–ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:")
        log.error(traceback.format_exc())
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
        if browser_manager and browser_manager.page:
            try:
                screenshot_path = config.SCREENSHOTS_DIR / f"error_test_{int(asyncio.get_event_loop().time())}.png"
                await browser_manager.page.screenshot(path=str(screenshot_path), full_page=True)
                log.info(f"üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {screenshot_path}")
            except Exception as e2:
                log.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç: {e2}")
        
        log.error("\n‚ö†Ô∏è –ë—Ä–∞—É–∑–µ—Ä –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞ 30 —Å–µ–∫—É–Ω–¥...")
        try:
            await asyncio.sleep(30)
        except:
            pass
    
    finally:
        if browser_manager:
            await browser_manager.close()


if __name__ == "__main__":
    asyncio.run(test_parser_engine())


```

–î–æ–±–∞–≤–ª—è—é –∫–ª–∏–∫ –Ω–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä:


```python
"""
Parser Engine - –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö —Å Pipiads
"""

import asyncio
import re
import time
from typing import List, Dict, Optional, Any
from datetime import datetime

from playwright.async_api import Page, TimeoutError as PlaywrightTimeoutError

from . import config
from . import logger
from . import validator

log = logger.get_logger("ParserEngine")


class ProductData:
    """–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞"""
    def __init__(self):
        self.product_name: str = ""
        self.category: str = ""
        self.pipiads_link: str = ""
        self.videos: List[Dict[str, Any]] = []


class ParserEngine:
    """–ü–∞—Ä—Å–µ—Ä –¥–∞–Ω–Ω—ã—Ö —Å Pipiads"""
    
    def __init__(self, page: Page):
        self.page = page
        self.browser_manager = None  # –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ human_delay
    
    def set_browser_manager(self, browser_manager):
        """–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ browser_manager –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è human_delay"""
        self.browser_manager = browser_manager
    
    async def human_delay(self, min_seconds: float = 1, max_seconds: float = 3):
        """–ò–º–∏—Ç–∞—Ü–∏—è —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏"""
        if self.browser_manager:
            await self.browser_manager.human_delay(min_seconds, max_seconds)
        else:
            delay = asyncio.sleep(1)  # Fallback
            await delay
    
    async def scroll_to_element(self, selector: str, timeout: int = 10000):
        """
        –°–∫—Ä–æ–ª–ª–∏—Ç—å –¥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
        
        Args:
            selector: –°–µ–ª–µ–∫—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞
            timeout: –¢–∞–π–º–∞—É—Ç –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
        """
        try:
            element = await self.page.wait_for_selector(selector, timeout=timeout, state="visible")
            if element:
                await element.scroll_into_view_if_needed()
                await self.human_delay(0.5, 1)
                return True
        except:
            pass
        return False
    
    async def get_products_from_search_page(self, count: int = 3) -> List[Dict[str, str]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞
        
        Args:
            count: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ (–¥–ª—è MVP-0: 1, –ø–æ—Ç–æ–º —Ä–∞—Å—à–∏—Ä–∏–º –¥–æ 3)
        
        Returns:
            –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–æ–≤: [{"name": "...", "category": "...", "url": "..."}]
        """
        log.info(f"–ü–æ–ª—É—á–µ–Ω–∏–µ {count} —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞...")
        
        try:
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (domcontentloaded –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º networkidle)
            await self.page.wait_for_load_state("domcontentloaded")
            await self.human_delay(2, 3)
            
            # –°–∫—Ä–æ–ª–ª–∏–º –≤–Ω–∏–∑, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
            log.info("–°–∫—Ä–æ–ª–ª–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤...")
            for i in range(3):  # –°–∫—Ä–æ–ª–ª–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
                await self.page.evaluate("window.scrollBy(0, 500)")
                await self.human_delay(1, 2)
            
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤
            await self.human_delay(2, 3)
            
            # –ò—â–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ - –ø—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
            product_selectors = [
                'a[href*="/tiktok-shop-product/"]',
                '[class*="product"]',
                '[class*="card"]',
                'div[class*="item"]',
            ]
            
            products = []
            product_ids = set()  # –î–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ product_id
            
            def extract_product_id(url: str) -> str:
                """–ò–∑–≤–ª–µ—á—å product_id –∏–∑ URL"""
                # https://www.pipiads.com/tiktok-shop-product/1729732622305364547/
                # ‚Üí 1729732622305364547
                url_normalized = url.rstrip('/')
                parts = url_normalized.split('/')
                return parts[-1] if parts else ""
            
            for selector in product_selectors:
                try:
                    elements = await self.page.query_selector_all(selector)
                    log.info(f"üîç –ù–∞–π–¥–µ–Ω–æ {len(elements)} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º '{selector}'")
                    
                    for element in elements:
                        if len(products) >= count:
                            break
                        
                        try:
                            # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É
                            href = await element.get_attribute("href")
                            if not href:
                                # –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ —Å—Å—ã–ª–∫–∞, –∏—â–µ–º —Å—Å—ã–ª–∫—É –≤–Ω—É—Ç—Ä–∏
                                link_element = await element.query_selector('a[href*="/tiktok-shop-product/"]')
                                if link_element:
                                    href = await link_element.get_attribute("href")
                            
                            if href and "/tiktok-shop-product/" in href:
                                # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π URL
                                if href.startswith("/"):
                                    url = f"https://www.pipiads.com{href}"
                                elif href.startswith("http"):
                                    url = href
                                else:
                                    url = f"https://www.pipiads.com/{href}"
                                
                                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º URL (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ)
                                url = url.rstrip('/')
                                
                                # –ò–∑–≤–ª–µ–∫–∞–µ–º product_id –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
                                product_id = extract_product_id(url)
                                
                                if not product_id:
                                    log.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å product_id –∏–∑ URL: {url}")
                                    continue
                                
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä (–ø–æ product_id)
                                if product_id in product_ids:
                                    log.info(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id={product_id}): {url}")
                                    continue
                                
                                product_ids.add(product_id)
                                log.info(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #{len(products) + 1}: product_id={product_id}, url={url}")
                                
                                # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
                                name = ""
                                name_selectors = [
                                    'h1', 'h2', 'h3',
                                    '[class*="title"]',
                                    '[class*="name"]',
                                    'a',
                                ]
                                
                                for name_sel in name_selectors:
                                    try:
                                        name_elem = await element.query_selector(name_sel)
                                        if name_elem:
                                            name = await name_elem.inner_text()
                                            if name and len(name) > 5:  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏—è
                                                break
                                    except:
                                        continue
                                
                                # –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                                category = ""
                                category_selectors = [
                                    '[class*="category"]',
                                    '[class*="tag"]',
                                    'span',
                                ]
                                
                                for cat_sel in category_selectors:
                                    try:
                                        cat_elem = await element.query_selector(cat_sel)
                                        if cat_elem:
                                            text = await cat_elem.inner_text()
                                            if text and len(text) < 50:  # –ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±—ã—á–Ω–æ –∫–æ—Ä–æ—Ç–∫–∞—è
                                                category = text
                                                break
                                    except:
                                        continue
                                
                                if url and product_id:
                                    products.append({
                                        "name": name.strip() if name else "N/A",
                                        "category": category.strip() if category else "N/A",
                                        "url": url,
                                        "product_id": product_id  # –î–æ–±–∞–≤–ª—è–µ–º product_id –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
                                    })
                                    log.info(f"   üì¶ –¢–æ–≤–∞—Ä {len(products)}: {name[:50] if name else 'N/A'}... (ID: {product_id})")
                                
                        except Exception as e:
                            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —ç–ª–µ–º–µ–Ω—Ç–∞: {e}")
                            continue
                    
                    if len(products) >= count:
                        break
                        
                except Exception as e:
                    log.debug(f"–û—à–∏–±–∫–∞ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º {selector}: {e}")
                    continue
            
            if len(products) < count:
                log.warning(f"–ù–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ {count} –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã—Ö")
            
            log.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤")
            return products[:count]
            
        except Exception as e:
            log.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
            import traceback
            log.error(traceback.format_exc())
            return []
    
    async def get_product_details(self, product_url: str, sheets_writer=None) -> ProductData:
        """
        –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞ –∏ –≤–∏–¥–µ–æ
        
        Args:
            product_url: URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞
        
        Returns:
            ProductData —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞ –∏ –≤–∏–¥–µ–æ
        """
        log.info("=" * 80)
        log.info(f"üîÑ –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–ê")
        log.info(f"URL: {product_url}")
        log.info("=" * 80)
        
        product_data = ProductData()
        product_data.pipiads_link = product_url
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è page
        if not self.page:
            log.error("‚ùå –û–®–ò–ë–ö–ê: page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
            return product_data
        
        try:
            # –®–ê–ì 1: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞
            log.info("\nüìå –®–ê–ì 1: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞...")
            try:
                log.info(f"  ‚Üí –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {product_url}")
                if not self.page:
                    raise Exception("Page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
                await self.page.goto(product_url, wait_until="domcontentloaded", timeout=30000)
                log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            except Exception as e:
                log.error(f"  ‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {e}")
                log.error(f"  ‚Üí –¢–∏–ø –æ—à–∏–±–∫–∏: {type(e).__name__}")
                import traceback
                log.error(f"  ‚Üí –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:\n{traceback.format_exc()}")
                # –ü—Ä–æ–±—É–µ–º –ø–æ–¥–æ–∂–¥–∞—Ç—å –µ—â–µ –Ω–µ–º–Ω–æ–≥–æ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                try:
                    await self.human_delay(2, 3)
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Å–µ –µ—â–µ –¥–æ—Å—Ç—É–ø–Ω–∞
                    if self.page:
                        current_url = self.page.url
                        log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
                except Exception as e2:
                    log.error(f"  ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e2}")
                    return product_data
            
            try:
                await self.human_delay(0.5, 1)
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–¥–µ—Ä–∂–∫–µ: {e}")
            
            # –®–ê–ì 1.5: –ü–µ—Ä–µ–≤–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫
            log.info("\nüìå –®–ê–ì 1.5: –ü–µ—Ä–µ–≤–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫...")
            try:
                current_url = self.page.url
                log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
                
                # –ï—Å–ª–∏ URL —Å–æ–¥–µ—Ä–∂–∏—Ç /ru/, –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ /en/
                if "/ru/" in current_url:
                    english_url = current_url.replace("/ru/", "/en/")
                    log.info(f"  ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫—É—é –≤–µ—Ä—Å–∏—é: {english_url}")
                    await self.page.goto(english_url, wait_until="domcontentloaded", timeout=30000)
                    await self.human_delay(1, 2)
                    log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π")
                else:
                    # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞
                    log.info("  ‚Üí –ü–æ–∏—Å–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —è–∑—ã–∫–∞...")
                    lang_selectors = [
                        'a[href*="/en/"]',
                        'button:has-text("English")',
                        '[class*="language"]',
                        '[class*="lang"]',
                        'select[name*="lang"]',
                    ]
                    
                    lang_found = False
                    for selector in lang_selectors:
                        try:
                            lang_element = await self.page.query_selector(selector)
                            if lang_element:
                                is_visible = await lang_element.is_visible()
                                if is_visible:
                                    await lang_element.click()
                                    await self.human_delay(1, 2)
                                    log.info(f"  ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ –Ω–∞–π–¥–µ–Ω –∏ –Ω–∞–∂–∞—Ç: {selector}")
                                    lang_found = True
                                    break
                        except:
                            continue
                    
                    if not lang_found:
                        log.warning("  ‚ö†Ô∏è –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –Ω–∞ —Ç–µ–∫—É—â–µ–º —è–∑—ã–∫–µ")
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            # –®–ê–ì 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Product Name
            log.info("\nüìå –®–ê–ì 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Product Name...")
            try:
                # –°–∫—Ä–æ–ª–ª–∏–º –≤–≤–µ—Ä—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
                log.info("  ‚Üí –°–∫—Ä–æ–ª–ª–∏–º –≤–≤–µ—Ä—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞...")
                if not self.page:
                    raise Exception("Page –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
                await self.page.evaluate("window.scrollTo(0, 0)")
                await self.human_delay(0.3, 0.5)
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ: {e}")
                # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É
            
            # –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ - –ø—Ä–æ–±—É–µ–º –±–æ–ª—å—à–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –∏ –º–µ—Ç–æ–¥–æ–≤
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã...")
            try:
                # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
                name_selectors = [
                    'h1:first-of-type',
                    'h1[class*="product"]',
                    'h1[class*="title"]',
                    '[class*="product-title"]',
                    '[class*="product-name"]',
                    '[class*="product_title"]',
                    '[class*="product_name"]',
                    'h1',
                    'h2:first-of-type',
                    '[data-testid*="title"]',
                    '[data-testid*="name"]',
                    '[data-testid*="product-title"]',
                ]
                
                for selector in name_selectors:
                    try:
                        elements = await self.page.query_selector_all(selector)
                        for element in elements:
                            name = await element.inner_text()
                            if name and len(name) > 3:
                                # –§–∏–ª—å—Ç—Ä—É–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã
                                name_lower = name.lower()
                                skip_words = ['–æ—Å—Ç–∞—Ç–æ–∫', 'remain', 'stock', '–º–µ—Å—è—Ü', 'month', '–∫–æ–º–∏—Å—Å–∏—è', 'commission', 
                                            'tiktok shop product detail', 'category', '–∫–∞—Ç–µ–≥–æ—Ä–∏—è']
                                if any(skip in name_lower for skip in skip_words):
                                    continue
                                # –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å "TikTok Shop Product Detail:" –µ—Å–ª–∏ –µ—Å—Ç—å
                                if "TikTok Shop Product Detail:" in name:
                                    name = name.split("TikTok Shop Product Detail:")[-1].strip()
                                # –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
                                if name.lower().startswith('tiktok shop product'):
                                    name = re.sub(r'^tiktok shop product\s*:?\s*', '', name, flags=re.IGNORECASE).strip()
                                if name.lower().endswith('tiktok shop product'):
                                    name = re.sub(r'\s*tiktok shop product\s*$', '', name, flags=re.IGNORECASE).strip()
                                # –£–±–∏—Ä–∞–µ–º, –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ "TikTok Shop Product"
                                if name.lower() == 'tiktok shop product' or name.lower() == 'tiktok shop product detail':
                                    continue
                                if ":" in name and len(name.split(":")[0]) < 20:
                                    name = name.split(":", 1)[-1].strip()
                                product_data.product_name = name.strip()
                                if len(product_data.product_name) > 5:
                                    log.info(f"  ‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞–π–¥–µ–Ω–æ: {product_data.product_name[:50]}...")
                                    break
                        if product_data.product_name and len(product_data.product_name) > 5:
                            break
                    except:
                        continue
                
                # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
                if not product_data.product_name or len(product_data.product_name) <= 5:
                    try:
                        product_name = await self.page.evaluate("""
                            () => {
                                // –ò—â–µ–º h1
                                const h1 = document.querySelector('h1');
                                if (h1) {
                                    const text = h1.innerText.trim();
                                    if (text && text.length > 5 && !text.toLowerCase().includes('tiktok shop product detail')) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º –≤ —ç–ª–µ–º–µ–Ω—Ç–∞—Ö —Å –∫–ª–∞—Å—Å–æ–º product
                                const productElements = document.querySelectorAll('[class*="product"][class*="title"], [class*="product"][class*="name"]');
                                for (const el of productElements) {
                                    const text = el.innerText.trim();
                                    if (text && text.length > 5) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º —Å–∞–º—ã–π –±–æ–ª—å—à–æ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–æ–±—ã—á–Ω–æ —ç—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞)
                                // –ù–û –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã —Ç–∏–ø–∞ "Ad Analysis"
                                const headings = document.querySelectorAll('h1, h2, h3');
                                let maxLength = 0;
                                let bestHeading = null;
                                for (const h of headings) {
                                    const text = h.innerText.trim();
                                    const skipWords = ['tiktok', 'shop', 'product', 'detail', 'category', 'commission', 
                                                      '–æ—Å—Ç–∞—Ç–æ–∫', 'remain', 'stock', 'ad analysis', 'analysis', 
                                                      'limited time', 'promotion', 'annual plan', 'tiktok shop product'];
                                    const textLower = text.toLowerCase();
                                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã (–º–µ–Ω—å—à–µ 20 —Å–∏–º–≤–æ–ª–æ–≤) - —ç—Ç–æ –æ–±—ã—á–Ω–æ –Ω–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
                                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º "TikTok Shop Product" –∏ –ø–æ—Ö–æ–∂–∏–µ —Ç–µ–∫—Å—Ç—ã
                                    if (!skipWords.some(word => textLower.includes(word)) && 
                                        text.length > maxLength && text.length > 20 &&
                                        !textLower.includes('tiktok shop product')) {
                                        maxLength = text.length;
                                        bestHeading = text;
                                    }
                                }
                                if (bestHeading) {
                                    return bestHeading;
                                }
                                
                                // –ò—â–µ–º –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–∞—Ö - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ–±—ã—á–Ω–æ –¥–ª–∏–Ω–Ω–æ–µ
                                // –ù–∞–ø—Ä–∏–º–µ—Ä: "[BUY 1 TAKE 11] SHEEureka Scrub Facial Cleanser..."
                                // –ù–û –∏—Å–∫–ª—é—á–∞–µ–º —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                           'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                           'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                           'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                           'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                const textBlocks = document.querySelectorAll('p, div, span');
                                for (const block of textBlocks) {
                                    const text = block.innerText.trim();
                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    const isFooterMenu = footerMenuKeywords.some(keyword => text.includes(keyword));
                                    if (isFooterMenu) continue;
                                    
                                    // –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –æ–±—ã—á–Ω–æ –¥–ª–∏–Ω–Ω–æ–µ (–±–æ–ª—å—à–µ 30 —Å–∏–º–≤–æ–ª–æ–≤) –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–æ–≤–∞ —Ç–∏–ø–∞ "Set", "Kit", "Mask" –∏ —Ç.–¥.
                                    // –ò–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å "[" (–Ω–∞–ø—Ä–∏–º–µ—Ä "[BUY 1 TAKE 11]")
                                    if (text.length > 30 && text.length < 500 && 
                                        !text.toLowerCase().includes('ad analysis') &&
                                        !text.toLowerCase().includes('limited time') &&
                                        !text.toLowerCase().includes('promotion') &&
                                        !text.toLowerCase().includes('annual plan') &&
                                        (text.startsWith('[') || text.includes('Set') || text.includes('Kit') || 
                                         text.includes('Mask') || text.includes('Cleanser') || text.includes('Gift') ||
                                         text.includes('Scrub') || text.includes('Facial') || text.includes('Repairing'))) {
                                        return text;
                                    }
                                }
                                
                                // –ò—â–µ–º –≤ –º–µ—Ç–∞-—Ç–µ–≥–∞—Ö
                                const ogTitle = document.querySelector('meta[property="og:title"]');
                                if (ogTitle && ogTitle.content) {
                                    let title = ogTitle.content;
                                    if (title.includes('TikTok Shop Product Detail:')) {
                                        title = title.split('TikTok Shop Product Detail:')[1].trim();
                                    }
                                    // –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞
                                    if (title.toLowerCase().startsWith('tiktok shop product')) {
                                        title = title.replace(/^tiktok shop product\s*:?\s*/i, '').trim();
                                    }
                                    if (title && title.length > 5 && !title.toLowerCase().includes('tiktok shop product')) {
                                        return title;
                                    }
                                }
                                
                                return null;
                            }
                        """)
                        if product_name and len(product_name) > 5:
                            product_name = product_name.strip()
                            # –£–±–∏—Ä–∞–µ–º "TikTok Shop Product" –∏–∑ –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞
                            if product_name.lower().startswith('tiktok shop product'):
                                product_name = re.sub(r'^tiktok shop product\s*:?\s*', '', product_name, flags=re.IGNORECASE).strip()
                            if product_name.lower().endswith('tiktok shop product'):
                                product_name = re.sub(r'\s*tiktok shop product\s*$', '', product_name, flags=re.IGNORECASE).strip()
                            # –£–±–∏—Ä–∞–µ–º, –µ—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ "TikTok Shop Product"
                            if product_name.lower() == 'tiktok shop product' or product_name.lower() == 'tiktok shop product detail':
                                product_name = None
                            if product_name and len(product_name) > 5:
                                product_data.product_name = product_name
                                log.info(f"  ‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞–π–¥–µ–Ω–æ (—á–µ—Ä–µ–∑ JS): {product_data.product_name[:50]}...")
                    except Exception as e:
                        log.debug(f"  ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —á–µ—Ä–µ–∑ JS: {e}")
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞: {e}")
            
            if not product_data.product_name or len(product_data.product_name) <= 5:
                log.warning("  ‚ö†Ô∏è –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                product_data.product_name = "N/A"
            
            # –®–ê–ì 3: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Category
            log.info("\nüìå –®–ê–ì 3: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Category...")
            try:
                log.info("  ‚Üí –ü–æ–∏—Å–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–∞...")
                
                # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
                category_selectors = [
                    '[class*="category"]',
                    '[class*="tag"]',
                    'span:has-text("Category")',
                    'span:has-text("–ö–∞—Ç–µ–≥–æ—Ä–∏—è")',
                    'text=/Category/i',
                    'text=/–ö–∞—Ç–µ–≥–æ—Ä–∏—è/i',
                    'div:has-text("Category")',
                    'div:has-text("–ö–∞—Ç–µ–≥–æ—Ä–∏—è")',
                ]
                
                for selector in category_selectors:
                    try:
                        elements = await self.page.query_selector_all(selector)
                        for element in elements:
                            category = await element.inner_text()
                            if category:
                                # –û—á–∏—â–∞–µ–º –æ—Ç –ª–∏—à–Ω–µ–≥–æ —Ç–µ–∫—Å—Ç–∞
                                category = re.sub(r'Category\s*:', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'–ö–∞—Ç–µ–≥–æ—Ä–∏—è\s*:', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'Commission\s*Rate\s*:.*', '', category, flags=re.IGNORECASE)
                                category = re.sub(r'–ö–æ–º–∏—Å—Å–∏—è\s*:.*', '', category, flags=re.IGNORECASE)
                                # –£–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä "15.00%")
                                category = re.sub(r'\s*\d+\.?\d*\s*%', '', category)
                                # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ —Å–∏–º–≤–æ–ª—ã > –∏ –ø—Ä–æ–±–µ–ª—ã
                                category = re.sub(r'\s*>\s*', ' > ', category)
                                category = category.strip()
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é —á–∞—Å—Ç—å –¥–æ "Commission" –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É
                                if "Commission" in category or "–ö–æ–º–∏—Å—Å–∏—è" in category:
                                    category = category.split("Commission")[0].split("–ö–æ–º–∏—Å—Å–∏—è")[0].strip()
                                if len(category) > 100:
                                    category = category[:100]
                                if category and len(category) > 3:
                                    product_data.category = category
                                    log.info(f"  ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–∞: {product_data.category}")
                                    break
                        if product_data.category:
                            break
                    except:
                        continue
                
                # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π)
                if not product_data.category:
                    try:
                        category = await self.page.evaluate("""
                            () => {
                                // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Category" –∏–ª–∏ "–ö–∞—Ç–µ–≥–æ—Ä–∏—è"
                                const allElements = document.querySelectorAll('*');
                                for (const el of allElements) {
                                    const text = el.innerText || '';
                                    if (text.includes('Category') || text.includes('–ö–∞—Ç–µ–≥–æ—Ä–∏—è')) {
                                        // –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ—Å–ª–µ "Category:" –∏–ª–∏ "–ö–∞—Ç–µ–≥–æ—Ä–∏—è:"
                                        let categoryText = text;
                                        if (categoryText.includes('Category:')) {
                                            categoryText = categoryText.split('Category:')[1];
                                        } else if (categoryText.includes('–ö–∞—Ç–µ–≥–æ—Ä–∏—è:')) {
                                            categoryText = categoryText.split('–ö–∞—Ç–µ–≥–æ—Ä–∏—è:')[1];
                                        }
                                        
                                        // –£–±–∏—Ä–∞–µ–º "Commission Rate" –∏ –≤—Å–µ –ø–æ—Å–ª–µ
                                        if (categoryText.includes('Commission Rate') || categoryText.includes('–ö–æ–º–∏—Å—Å–∏—è')) {
                                            categoryText = categoryText.split('Commission Rate')[0].split('–ö–æ–º–∏—Å—Å–∏—è')[0];
                                        }
                                        
                                        // –£–±–∏—Ä–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä "15.00%")
                                        categoryText = categoryText.replace(/\s*\d+\.?\d*\s*%/g, '');
                                        
                                        categoryText = categoryText.trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é (—Å–æ–¥–µ—Ä–∂–∏—Ç ">" –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–æ–≤)
                                        if (categoryText && categoryText.length > 3 && 
                                            (categoryText.includes('>') || categoryText.split(' ').length >= 2)) {
                                            return categoryText.substring(0, 100);
                                        }
                                    }
                                }
                                return null;
                            }
                        """)
                        if category and len(category) > 3:
                            product_data.category = category.strip()
                            log.info(f"  ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–π–¥–µ–Ω–∞ (—á–µ—Ä–µ–∑ JS): {product_data.category}")
                    except Exception as e:
                        log.debug(f"  ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ JS: {e}")
                
                if not product_data.category:
                    log.warning("  ‚ö†Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ 'N/A'")
                    product_data.category = "N/A"
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {e}")
                product_data.category = "N/A"
            
            # –®–ê–ì 3.5: –ó–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets (–µ—Å–ª–∏ sheets_writer –ø–µ—Ä–µ–¥–∞–Ω)
            # –í–ê–ñ–ù–û: –ï—Å–ª–∏ —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ
            if sheets_writer:
                log.info("\nüìå –®–ê–ì 3.5: –ó–∞–ø–∏—Å—å –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets...")
                try:
                    row_number = sheets_writer.write_basic_product_data(
                        product_data.product_name,
                        product_data.category,
                        product_data.pipiads_link
                    )
                    if row_number > 0:
                        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ
                        product_data._sheets_row = row_number
                        log.info(f"  ‚úÖ –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {row_number})")
                    else:
                        # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–≤–æ–∑–º–æ–∂–Ω–æ, —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã),
                        # –Ω–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö
                        log.warning("  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–≤–æ–∑–º–æ–∂–Ω–æ, —è—á–µ–π–∫–∏ –∑–∞—â–∏—â–µ–Ω—ã)")
                        log.info("  ‚Üí –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö...")
                        row_number = sheets_writer.find_next_empty_row()
                        product_data._sheets_row = row_number
                        log.info(f"  ‚úÖ –ë—É–¥–µ–º –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫—É {row_number}")
                except Exception as e:
                    log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö: {e}")
                    # –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ
                    try:
                        row_number = sheets_writer.find_next_empty_row()
                        product_data._sheets_row = row_number
                        log.info(f"  ‚Üí –ë—É–¥–µ–º –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç—Ä–æ–∫—É {row_number}")
                    except:
                        pass
            
            # –®–ê–ì 4: –ü–æ–∏—Å–∫ –±–ª–æ–∫–∞ "TikTok Ads"
            log.info("\nüìå –®–ê–ì 4: –ü–æ–∏—Å–∫ –±–ª–æ–∫–∞ 'TikTok Ads'...")
            log.info("  ‚Üí –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–Ω–∏–∑ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞...")
            
            # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–Ω–∏–∑, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç
            # –ë–ª–æ–∫ "TikTok Ads" –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            try:
                log.info("  ‚Üí –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–Ω–∏–∑ (–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ)...")
                # –ü–æ–ª—É—á–∞–µ–º –≤—ã—Å–æ—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                page_height = await self.page.evaluate("document.body.scrollHeight")
                viewport_height = await self.page.evaluate("window.innerHeight")
                log.info(f"  ‚Üí –í—ã—Å–æ—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {page_height}px, –≤—ã—Å–æ—Ç–∞ viewport: {viewport_height}px")
                
                # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ (–∫–∞–∫ —á–µ–ª–æ–≤–µ–∫)
                scroll_steps = max(3, page_height // viewport_height)
                scroll_step = page_height // scroll_steps
                
                for step in range(scroll_steps):
                    scroll_position = scroll_step * (step + 1)
                    await self.page.evaluate(f"window.scrollTo(0, {scroll_position})")
                    await self.human_delay(0.3, 0.5)
                    log.debug(f"  ‚Üí –ü—Ä–æ–∫—Ä—É—Ç–∫–∞: {scroll_position}/{page_height}px")
                
                # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ —Å–∞–º–æ–≥–æ –Ω–∏–∑–∞
                await self.page.evaluate("window.scrollTo(0, document.body.scrollHeight)")
                await self.human_delay(1, 2)  # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–∫—Ä—É—á–µ–Ω–∞ –≤–Ω–∏–∑")
            except Exception as e:
                log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            log.info("  ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (–∫–∞–∫ Ctrl+F)...")
            tiktok_ads_found = False
            tiktok_ads_element = None
            
            # –°–Ω–∞—á–∞–ª–∞ –∂–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            await self.human_delay(0.5, 1)
            
            # –í–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
            tiktok_ads_texts = [
                "TikTok Ads",  # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π
                "–†–µ–∫–ª–∞–º–∞ –¢–∏–∫–¢–æ–∫",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 1
                "–†–µ–∫–ª–∞–º–∞ TikTok",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 2
                "TikTok –†–µ–∫–ª–∞–º–∞",  # –†—É—Å—Å–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç 3
            ]
            
            # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –±–ª–æ–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä —Å —Ç–µ–∫—Å—Ç–æ–º (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±)
            log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ Playwright locator...")
            for text_variant in tiktok_ads_texts:
                try:
                    # –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Ç–µ–∫—Å—Ç (—Ä–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ)
                    locator = self.page.locator(f'text=/{text_variant}/i').first
                    if await locator.count() > 0:
                        tiktok_ads_element = await locator.element_handle()
                        if tiktok_ads_element:
                            # –°–∫—Ä–æ–ª–ª–∏–º –∫ —ç–ª–µ–º–µ–Ω—Ç—É
                            await tiktok_ads_element.scroll_into_view_if_needed()
                            await self.human_delay(0.3, 0.5)
                            tiktok_ads_found = True
                            log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ Playwright locator")
                            break
                except Exception as e:
                    log.debug(f"–ü–æ–∏—Å–∫ '{text_variant}' —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä –Ω–µ —É–¥–∞–ª—Å—è: {e}")
                    continue
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ JavaScript –ø–æ–∏—Å–∫ (–∫–∞–∫ Ctrl+F)
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript TreeWalker...")
                for text_variant in tiktok_ads_texts:
                    try:
                        # –ò—Å–ø–æ–ª—å–∑—É–µ–º JavaScript –¥–ª—è –ø–æ–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å —Ç–µ–∫—Å—Ç–æ–º
                        # –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è regex
                        escaped_text = text_variant.replace("\\", "\\\\").replace("/", "\\/")
                        tiktok_ads_element = await self.page.evaluate_handle(f"""
                            () => {{
                                const walker = document.createTreeWalker(
                                    document.body,
                                    NodeFilter.SHOW_TEXT,
                                    null,
                                    false
                                );
                                
                                let node;
                                while (node = walker.nextNode()) {{
                                    if (node.textContent && /{escaped_text}/i.test(node.textContent)) {{
                                        // –ù–∞—Ö–æ–¥–∏–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç
                                        let parent = node.parentElement;
                                        while (parent && parent !== document.body) {{
                                            if (parent.offsetHeight > 0 && parent.offsetWidth > 0) {{
                                                return parent;
                                            }}
                                            parent = parent.parentElement;
                                        }}
                                    }}
                                }}
                                return null;
                            }}
                        """)
                        
                        if tiktok_ads_element and await tiktok_ads_element.as_element():
                            element = await tiktok_ads_element.as_element()
                            await element.scroll_into_view_if_needed()
                            await self.human_delay(0.3, 0.5)
                            tiktok_ads_found = True
                            log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript TreeWalker")
                            break
                    except Exception as e:
                        log.debug(f"JavaScript –ø–æ–∏—Å–∫ '{text_variant}' –Ω–µ —É–¥–∞–ª—Å—è: {e}")
                        continue
            
            # –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ query_selector
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 3: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ query_selector —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ —Ç–µ–∫—Å—Ç–∞...")
                try:
                    # –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞ (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
                    text_variants = []
                    for text in tiktok_ads_texts:
                        text_variants.extend([
                            f'text="{text}"',
                            f'text={text}',
                            f'*:has-text("{text}")',
                        ])
                    
                    for variant in text_variants:
                        try:
                            element = await self.page.query_selector(variant)
                            if element:
                                is_visible = await element.is_visible()
                                if is_visible:
                                    await element.scroll_into_view_if_needed()
                                    await self.human_delay(0.3, 0.5)
                                    tiktok_ads_found = True
                                    tiktok_ads_element = element
                                    log.info(f"  ‚úÖ –ë–ª–æ–∫ –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ query_selector: {variant}")
                                    break
                        except:
                            continue
                except Exception as e:
                    log.debug(f"Query selector –ø–æ–∏—Å–∫ –Ω–µ —É–¥–∞–ª—Å—è: {e}")
            
            # –ü–æ–ø—ã—Ç–∫–∞ 4: –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –µ—â–µ —Ä–∞–∑ –∏ –ø–æ–∏—Å–∫–∞—Ç—å —Å–Ω–æ–≤–∞
            if not tiktok_ads_found:
                log.info("  ‚Üí –ü–æ–ø—ã—Ç–∫–∞ 4: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∏ –ø–æ–∏—Å–∫...")
                try:
                    # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –µ—â–µ —Ä–∞–∑ –º–µ–¥–ª–µ–Ω–Ω–æ
                    await self.page.evaluate("window.scrollTo(0, 0)")  # –í –Ω–∞—á–∞–ª–æ
                    await self.human_delay(0.5, 1)
                    
                    # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑ –º–µ–¥–ª–µ–Ω–Ω–æ, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—è—Å—å –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
                    page_height = await self.page.evaluate("document.body.scrollHeight")
                    scroll_increment = 300  # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –ø–æ 300px
                    
                    for scroll_pos in range(0, page_height, scroll_increment):
                        await self.page.evaluate(f"window.scrollTo(0, {scroll_pos})")
                        await self.human_delay(0.2, 0.3)
                        
                        # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –Ω–∞ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ (–≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞)
                        for text_variant in tiktok_ads_texts:
                            try:
                                # –ó–∞–º–µ–Ω—è–µ–º –ø—Ä–æ–±–µ–ª—ã –Ω–∞ \s+ –¥–ª—è regex
                                regex_pattern = text_variant.replace(" ", "\\s+")
                                locator = self.page.locator(f'text=/{regex_pattern}/i').first
                                if await locator.count() > 0:
                                    tiktok_ads_element = await locator.element_handle()
                                    if tiktok_ads_element:
                                        await tiktok_ads_element.scroll_into_view_if_needed()
                                        await self.human_delay(0.3, 0.5)
                                        tiktok_ads_found = True
                                        log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ {scroll_pos}px")
                                        break
                            except:
                                continue
                        
                        if tiktok_ads_found:
                            break
                    
                    if not tiktok_ads_found:
                        # –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ —Å–∞–º–æ–≥–æ –Ω–∏–∑–∞ –µ—â–µ —Ä–∞–∑
                        await self.page.evaluate("window.scrollTo(0, document.body.scrollHeight)")
                        await self.human_delay(1, 2)
                        
                        # –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–∏—Å–∫–∞ (–≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞)
                        for text_variant in tiktok_ads_texts:
                            try:
                                # –ó–∞–º–µ–Ω—è–µ–º –ø—Ä–æ–±–µ–ª—ã –Ω–∞ \s+ –¥–ª—è regex
                                regex_pattern = text_variant.replace(" ", "\\s+")
                                locator = self.page.locator(f'text=/{regex_pattern}/i').first
                                if await locator.count() > 0:
                                    tiktok_ads_element = await locator.element_handle()
                                    if tiktok_ads_element:
                                        await tiktok_ads_element.scroll_into_view_if_needed()
                                        await self.human_delay(0.3, 0.5)
                                        tiktok_ads_found = True
                                        log.info(f"  ‚úÖ –ë–ª–æ–∫ '{text_variant}' –Ω–∞–π–¥–µ–Ω –≤ —Å–∞–º–æ–º –Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã")
                                        break
                            except:
                                continue
                except Exception as e:
                    log.debug(f"–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –Ω–µ –ø–æ–º–æ–≥–ª–∞: {e}")
            
            if not tiktok_ads_found:
                log.error("  ‚ùå –ë–ª–æ–∫ 'TikTok Ads' –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫")
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                try:
                    screenshot_path = config.SCREENSHOTS_DIR / f"tiktok_ads_not_found_{int(time.time())}.png"
                    await self.page.screenshot(path=str(screenshot_path), full_page=True)
                    log.info(f"  üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {screenshot_path}")
                except:
                    pass
                log.error("  ‚ùå –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: –±–ª–æ–∫ 'TikTok Ads' –Ω–µ –Ω–∞–π–¥–µ–Ω")
                return product_data
            
            log.info("  ‚úÖ –ë–ª–æ–∫ 'TikTok Ads' —É—Å–ø–µ—à–Ω–æ –Ω–∞–π–¥–µ–Ω")
            
            # –®–ê–ì 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ "First seen"
            log.info("\nüìå –®–ê–ì 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ 'First seen'...")
            sort_success = await self._set_sort_by_first_seen()
            if not sort_success:
                log.warning("  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
            
            # –®–ê–ì 6: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–∏–¥–µ–æ
            log.info("\nüìå –®–ê–ì 6: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ 'TikTok Ads'...")
            videos = await self._get_videos_from_tiktok_ads_block()
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ {len(videos)} –≤–∏–¥–µ–æ –≤ –±–ª–æ–∫–µ")
            
            # –®–ê–ì 7: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ
            log.info(f"\nüìå –®–ê–ì 7: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ (impression >= {config.MIN_IMPRESSIONS}, –¥–∞—Ç–∞ <= {config.DAYS_BACK} –¥–Ω–µ–π)...")
            filtered_videos = await self._filter_videos(videos)
            log.info(f"  ‚Üí –ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: {len(filtered_videos)} –≤–∏–¥–µ–æ")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –í–°–ï –≤–∏–¥–µ–æ (–¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏) –≤ ProductData
            product_data._all_videos_raw = videos[:20]  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–≤—ã–µ 20 –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
            
            # –í–ê–ñ–ù–û: –ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ 0 –≤–∏–¥–µ–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä
            if len(filtered_videos) == 0:
                log.warning(f"  ‚ö†Ô∏è –ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ (>= {config.MIN_IMPRESSIONS} impressions, <= {config.DAYS_BACK} –¥–Ω–µ–π)")
                log.warning(f"  ‚ö†Ô∏è –¢–æ–≤–∞—Ä –±—É–¥–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω")
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ —Ç–æ–≤–∞—Ä–∞
                product_data._insufficient_videos = True
                product_data._videos_found = len(videos)
                return product_data
            
            # –í—ã–±–æ—Ä —Ç–æ–ø-3 –≤–∏–¥–µ–æ
            video_count = 3
            selected_videos = filtered_videos[:video_count]
            
            log.info(f"  ‚úÖ –í—ã–±—Ä–∞–Ω–æ {len(selected_videos)} –≤–∏–¥–µ–æ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            
            # –®–ê–ì 8: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
            log.info(f"\nüìå –®–ê–ì 8: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –¥–ª—è {len(selected_videos)} –≤–∏–¥–µ–æ...")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
            product_page_url = self.page.url
            log.info(f"  ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞: {product_page_url}")
            
            for i, video in enumerate(selected_videos, 1):
                log.info(f"\n  üé¨ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ {i}/{len(selected_videos)}...")
                log.info(f"    ‚Üí Impression: {video.get('impression', 0)}, First seen: {video.get('first_seen', 'N/A')}")
                
                # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ (–ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ ad-search –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
                video_details = await self._get_video_details(video)
                
                if video_details:
                    product_data.videos.append(video_details)
                    log.info(f"    ‚úÖ –í–∏–¥–µ–æ {i} –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ")
                else:
                    log.warning(f"    ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –¥–ª—è –≤–∏–¥–µ–æ {i}")
                
                # –í–ê–ñ–ù–û: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
                log.info(f"    ‚Üí –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ {i}...")
                try:
                    await self.page.goto(product_page_url, wait_until="domcontentloaded", timeout=30000)
                    await self.human_delay(1, 2)
                    
                    # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –±–ª–æ–∫–∞ TikTok Ads (—á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ –≤–∏–¥–µ–æ)
                    try:
                        await self.page.wait_for_selector('a[href*="/ad-search/"]', timeout=10000, state="visible")
                        log.info(f"    ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ —É—Å–ø–µ—à–µ–Ω (–≤–∏–¥–µ–æ {i})")
                    except:
                        log.warning(f"    ‚ö†Ô∏è –ë–ª–æ–∫ TikTok Ads –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º...")
                except Exception as e:
                    log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞: {e}")
                    # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–ª–µ–¥—É—é—â–∏—Ö –≤–∏–¥–µ–æ –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤–æ–∑–≤—Ä–∞—Ç–∞
                
                await self.human_delay(0.5, 1)
            
            # –ó–∞–ø–æ–ª–Ω—è–µ–º N/A –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤–∏–¥–µ–æ (–Ω—É–∂–Ω–æ 3 –≤–∏–¥–µ–æ)
            while len(product_data.videos) < video_count:
                product_data.videos.append({
                    "tiktok_link": "N/A",
                    "impression": 0,
                    "script": "N/A",
                    "hook": "N/A",
                    "audience_age": "N/A",
                    "country": "N/A",
                    "first_seen": "N/A",
                })
            
            log.info(f"\n‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {len(product_data.videos)} –≤–∏–¥–µ–æ –¥–ª—è —Ç–æ–≤–∞—Ä–∞")
            
            # –®–ê–ì 9: –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ –≤ Google Sheets (–µ—Å–ª–∏ sheets_writer –ø–µ—Ä–µ–¥–∞–Ω)
            if sheets_writer:
                if hasattr(product_data, '_sheets_row') and product_data._sheets_row > 0:
                    log.info(f"\nüìå –®–ê–ì 9: –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {product_data._sheets_row})...")
                    log.info(f"  ‚Üí –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ –¥–ª—è –∑–∞–ø–∏—Å–∏: {len(product_data.videos)}")
                    
                    # –õ–æ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é
                    for i, video in enumerate(product_data.videos[:3], 1):
                        log.info(f"  ‚Üí –í–∏–¥–µ–æ {i}: tiktok={video.get('tiktok_link', 'N/A')[:50]}, "
                                f"impression={video.get('impression', 'N/A')}, "
                                f"script={len(str(video.get('script', 'N/A')))} —Å–∏–º–≤–æ–ª–æ–≤, "
                                f"hook={len(str(video.get('hook', 'N/A')))} —Å–∏–º–≤–æ–ª–æ–≤, "
                                f"audience={video.get('audience_age', 'N/A')}, "
                                f"country={video.get('country', 'N/A')}, "
                                f"first_seen={video.get('first_seen', 'N/A')}")
                    
                    try:
                        # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏
                        video_data_dict = {
                            "product_name": product_data.product_name,
                            "category": product_data.category,
                            "pipiads_link": product_data.pipiads_link,
                            "videos": product_data.videos
                        }
                        
                        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (update_basic=False - –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ F-Z)
                        success = sheets_writer.write_product_data(
                            product_data._sheets_row,
                            video_data_dict,
                            update_basic=False
                        )
                        
                        if success:
                            log.info(f"  ‚úÖ –î–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ Google Sheets (—Å—Ç—Ä–æ–∫–∞ {product_data._sheets_row}, —Å—Ç–æ–ª–±—Ü—ã F-Z)")
                        else:
                            log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –≤ Google Sheets")
                    except Exception as e:
                        log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ: {e}")
                        import traceback
                        log.error(traceback.format_exc())
                else:
                    log.warning(f"  ‚ö†Ô∏è –ù–µ—Ç –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ –¥–∞–Ω–Ω—ã—Ö (_sheets_row –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)")
            
            log.info("=" * 80)
            log.info("‚úÖ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û")
            log.info("=" * 80)
            return product_data
            
        except Exception as e:
            log.error("\n" + "=" * 80)
            log.error(f"‚ùå –û–®–ò–ë–ö–ê –ü–†–ò –û–ë–†–ê–ë–û–¢–ö–ï –¢–û–í–ê–†–ê: {e}")
            log.error("=" * 80)
            import traceback
            log.error(traceback.format_exc())
            return product_data
    
    async def return_to_main_page(self, main_page_url: str) -> bool:
        """
        –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–æ–≤–∞—Ä–æ–≤
        
        Args:
            main_page_url: URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ —Ç–æ–≤–∞—Ä)
        
        Returns:
            True –µ—Å–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç —É—Å–ø–µ—à–µ–Ω, False –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        """
        try:
            log.info("\nüîô –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ —Å–ø–∏—Å–∫–æ–º —Ç–æ–≤–∞—Ä–æ–≤...")
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π URL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            current_url = self.page.url
            log.info(f"  ‚Üí –¢–µ–∫—É—â–∏–π URL: {current_url}")
            log.info(f"  ‚Üí –¶–µ–ª–µ–≤–æ–π URL: {main_page_url}")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            if current_url == main_page_url:
                log.info("  ‚ÑπÔ∏è  –£–∂–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
                return True
            
            # –ú–ï–¢–û–î 1: –ü—Ä—è–º–æ–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π URL (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            await self.page.goto(main_page_url, wait_until="domcontentloaded", timeout=30000)  # –£–≤–µ–ª–∏—á–µ–Ω –¥–æ 30 —Å–µ–∫
            await self.human_delay(1, 2)
            
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ë–ï–ó networkidle - –æ–Ω –≤—ã–∑—ã–≤–∞–µ—Ç —Ç–∞–π–º–∞—É—Ç—ã!)
            await self.page.wait_for_load_state("domcontentloaded", timeout=5000)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞
            new_url = self.page.url
            log.info(f"  ‚Üí –ù–æ–≤—ã–π URL: {new_url}")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤
            try:
                await self.page.wait_for_selector('a[href*="/tiktok-shop-product/"]', timeout=10000)
                
                # –î–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ä–µ–º—è –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
                await self.human_delay(2, 3)
                
                log.info("  ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —É—Å–ø–µ—à–µ–Ω")
                return True
            except:
                log.warning("  ‚ö†Ô∏è –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞")
                return False
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É: {e}")
            import traceback
            log.error(traceback.format_exc())
            return False
    
    async def get_product_details_with_return(self, product_url: str, sheets_writer=None, banned_products=None):
        """
        –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–≤–∞—Ä –ø–æ URL –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        
        –ê–ª–≥–æ—Ä–∏—Ç–º:
        1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        2. –ù–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ URL –∏ –∫–ª–∏–∫–Ω—É—Ç—å
        3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ban-list (–µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω)
        4. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–≤–∞—Ä (get_product_details)
        5. –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        
        Args:
            product_url: URL —Ç–æ–≤–∞—Ä–∞ (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π)
            sheets_writer: –û–±—ä–µ–∫—Ç –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ Google Sheets
            banned_products: –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö URL (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
        
        Returns:
            ProductData –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ
            Dict —Å–æ status="insufficient_videos" –µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ
            Dict —Å–æ status="duplicate" –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
            None –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        """
        log.info(f"\n{'='*80}")
        log.info(f"üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê: {product_url}")
        log.info(f"{'='*80}")
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        main_page_url = self.page.url
        log.info(f"  ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {main_page_url}")
        
        def normalize_url(url: str) -> str:
            """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL (—É–±—Ä–∞—Ç—å —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É)"""
            if not url:
                return ""
            url = url.strip().rstrip('/')
            # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if '?' in url:
                url = url.split('?')[0]
            return url
        
        try:
            # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º URL —Ç–æ–≤–∞—Ä–∞
            product_url = normalize_url(product_url)
            
            if not product_url:
                log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                return None
            
            # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
            if banned_products is not None and product_url in banned_products:
                log.warning(f"  üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: {product_url}")
                log.warning(f"     –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.")
                return {"status": "duplicate", "product_url": product_url}
            
            # –®–ê–ì 1: –ù–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ URL –∏ –∫–ª–∏–∫–Ω—É—Ç—å
            log.info(f"\nüìå –®–ê–ì 1: –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ URL...")
            
            try:
                # –ò—â–µ–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤
                product_links = await self.page.query_selector_all('a[href*="/tiktok-shop-product/"]')
                
                if not product_links:
                    log.error("  ‚ùå –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
                    return None
                
                # –ò—â–µ–º —Ç–æ–≤–∞—Ä –ø–æ URL (–ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ URL)
                product_link = None
                for link in product_links:
                    href = await link.get_attribute("href")
                    if not href:
                        continue
                    
                    # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π URL
                    if href.startswith("/"):
                        link_url = f"https://www.pipiads.com{href}"
                    elif href.startswith("http"):
                        link_url = href
                    else:
                        link_url = f"https://www.pipiads.com/{href}"
                    
                    # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º URL —Å—Å—ã–ª–∫–∏
                    link_url = normalize_url(link_url)
                    
                    if link_url == product_url:
                        product_link = link
                        break
                
                if not product_link:
                    log.error(f"  ‚ùå –¢–æ–≤–∞—Ä —Å URL {product_url} –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
                    return None
                
                log.info(f"  ‚úÖ –¢–æ–≤–∞—Ä –Ω–∞–π–¥–µ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {product_url}")
                
                # –ö–ª–∏–∫–∞–µ–º –Ω–∞ —Ç–æ–≤–∞—Ä
                log.info("  ‚Üí –ö–ª–∏–∫ –Ω–∞ —Ç–æ–≤–∞—Ä...")
                await product_link.click()
                await self.human_delay(1, 2)
                log.info("  ‚úÖ –ö–ª–∏–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω, –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞...")
                
                # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–∞
                await self.page.wait_for_load_state("domcontentloaded", timeout=10000)
                await self.human_delay(1, 2)
                log.info("  ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–æ–≤–∞—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
                
            except Exception as e:
                log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ/–∫–ª–∏–∫–µ –Ω–∞ —Ç–æ–≤–∞—Ä: {e}")
                import traceback
                log.error(traceback.format_exc())
                return None
            
            # –®–ê–ì 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ get_product_details
            log.info(f"\nüìå –®–ê–ì 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞...")
            product_data = await self.get_product_details(product_url, sheets_writer=sheets_writer)
            
            # –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–¥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é)
            log.info(f"\nüìå –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞...")
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω –∏ –µ—Å—Ç—å –≤–∏–¥–µ–æ
            if not product_data:
                log.warning("  ‚ö†Ô∏è product_data –ø—É—Å—Ç")
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                await self.return_to_main_page(main_page_url)
                return None
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ —Ç–æ–≤–∞—Ä –ø—Ä–æ–ø—É—â–µ–Ω –∏–∑-–∑–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
            if hasattr(product_data, '_insufficient_videos') and product_data._insufficient_videos:
                videos_found = getattr(product_data, '_videos_found', 0)
                log.warning(f"  ‚ö†Ô∏è –¢–æ–≤–∞—Ä –ø—Ä–æ–ø—É—â–µ–Ω: –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ (–Ω–∞–π–¥–µ–Ω–æ –≤—Å–µ–≥–æ: {videos_found})")
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                await self.return_to_main_page(main_page_url)
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª–æ–≤–∞—Ä—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "insufficient_videos"
                return {
                    "status": "insufficient_videos",
                    "product_name": getattr(product_data, 'product_name', 'N/A'),
                    "videos_found": videos_found,
                    "videos_required": 3,
                    "reason": f"–ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (>= {config.MIN_IMPRESSIONS} impressions, <= {config.DAYS_BACK} –¥–Ω–µ–π) –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ"
                }
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ
            videos_count = len(product_data.videos) if hasattr(product_data, 'videos') else 0
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ –≤–∏–¥–µ–æ: {videos_count}")
            
            # –ï—Å–ª–∏ –≤–∏–¥–µ–æ –º–µ–Ω—å—à–µ 3 - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
            if videos_count < 3:
                log.warning(f"  ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ: {videos_count} < 3")
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                await self.return_to_main_page(main_page_url)
                
                # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª–æ–≤–∞—Ä—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "insufficient_videos"
                return {
                    "status": "insufficient_videos",
                    "product_name": getattr(product_data, 'product_name', 'N/A'),
                    "videos_found": videos_count,
                    "videos_required": 3,
                    "reason": f"–ù–∞–π–¥–µ–Ω–æ —Ç–æ–ª—å–∫–æ {videos_count} –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏"
                }
            
            # –®–ê–ì 4: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            log.info(f"\nüìå –®–ê–ì 4: –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É...")
            await self.return_to_main_page(main_page_url)
            
            # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä
            log.info(f"  ‚úÖ –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω —É—Å–ø–µ—à–Ω–æ ({videos_count} –≤–∏–¥–µ–æ)")
            return product_data
            
        except Exception as e:
            log.error(f"\n‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É {product_index}: {e}")
            import traceback
            log.error(traceback.format_exc())
            
            # –ü—ã—Ç–∞–µ–º—Å—è –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
            try:
                await self.return_to_main_page(main_page_url)
            except:
                log.error("  ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏")
            
            return None
    
    async def _set_sort_by_first_seen(self) -> bool:
        """
        –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É "First seen" –≤ dropdown
        
        Returns:
            True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ
        """
        log.info("  ‚Üí –ü–æ–∏—Å–∫ dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏...")
        try:
            # –ò—â–µ–º dropdown "Sort by"
            sort_selectors = [
                'select:has-text("Sort by")',
                'select',
                '[class*="sort"]',
                'text="Sort by: First seen"',
                'text="Sort by"',
            ]
            
            dropdown = None
            for selector in sort_selectors:
                try:
                    dropdown = await self.page.query_selector(selector)
                    if dropdown:
                        is_visible = await dropdown.is_visible()
                        if is_visible:
                            log.debug(f"–ù–∞–π–¥–µ–Ω dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: {selector}")
                            break
                        else:
                            dropdown = None
                except:
                    continue
            
            if not dropdown:
                # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ —Ç–µ–∫—Å—Ç—É "Sort by: First seen"
                try:
                    sort_text = await self.page.query_selector('text="Sort by: First seen"')
                    if sort_text:
                        # –ö–ª–∏–∫–∞–µ–º –Ω–∞ —Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å dropdown
                        await sort_text.click()
                        await self.human_delay(0.5, 1)
                        
                        # –ò—â–µ–º –æ–ø—Ü–∏—é "First seen"
                        first_seen_option = await self.page.query_selector('text="First seen"')
                        if first_seen_option:
                            await first_seen_option.click()
                            await self.human_delay(1, 2)
                            log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (—á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç)")
                            return True
                except:
                    pass
                
                log.warning("Dropdown —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å")
                return False
            
            # –ï—Å–ª–∏ —ç—Ç–æ select —ç–ª–µ–º–µ–Ω—Ç
            tag_name = await dropdown.evaluate("el => el.tagName.toLowerCase()")
            if tag_name == "select":
                # –í—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é —á–µ—Ä–µ–∑ value –∏–ª–∏ —Ç–µ–∫—Å—Ç
                try:
                    log.info("  ‚Üí –ù–∞–π–¥–µ–Ω select —ç–ª–µ–º–µ–Ω—Ç, –≤—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é 'First seen'...")
                    await dropdown.select_option(label="First seen")
                    await self.human_delay(1, 2)
                    log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (select)")
                    return True
                except:
                    pass
            
            # –ï—Å–ª–∏ —ç—Ç–æ –∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown - –∫–ª–∏–∫–∞–µ–º –∏ –≤—ã–±–∏—Ä–∞–µ–º –æ–ø—Ü–∏—é
            log.info("  ‚Üí –ù–∞–π–¥–µ–Ω –∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown, –æ—Ç–∫—Ä—ã–≤–∞–µ–º...")
            await dropdown.click()
            await self.human_delay(0.5, 1)
            
            # –ò—â–µ–º –æ–ø—Ü–∏—é "First seen"
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –æ–ø—Ü–∏–∏ 'First seen'...")
            option_selectors = [
                'text="First seen"',
                'text="Sort by: First seen"',
                '[role="option"]:has-text("First seen")',
            ]
            
            for opt_sel in option_selectors:
                try:
                    option = await self.page.query_selector(opt_sel)
                    if option:
                        await option.click()
                        await self.human_delay(1, 2)
                        log.info("  ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ 'First seen' —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ (–∫–∞—Å—Ç–æ–º–Ω—ã–π dropdown)")
                        return True
                except:
                    continue
            
            log.warning("  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É 'First seen'")
            return False
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: {e}")
            return False
    
    async def _get_videos_from_tiktok_ads_block(self) -> List[Dict[str, Any]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ TikTok Ads
        
        Returns:
            –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        videos = []
        
        try:
            log.info("  ‚Üí –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ...")
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ
            await self.human_delay(0.5, 1)
            
            # –ò—â–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ - –ø—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
            log.info("  ‚Üí –ü–æ–∏—Å–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã...")
            video_card_selectors = [
                '[class*="video"]',
                '[class*="card"]',
                '[class*="ad"]',
                'div[class*="item"]',
                'a[href*="/ad-search/"]',
            ]
            
            video_elements = []
            for selector in video_card_selectors:
                try:
                    elements = await self.page.query_selector_all(selector)
                    if elements:
                        log.debug(f"–ù–∞–π–¥–µ–Ω–æ {len(elements)} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º {selector}")
                        # –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ, —á—Ç–æ —Å–æ–¥–µ—Ä–∂–∞—Ç –≤–∏–¥–µ–æ (–∏–º–µ—é—Ç thumbnail –∏–ª–∏ play button)
                        for elem in elements:
                            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –∫–∞—Ä—Ç–æ—á–∫–∞ –≤–∏–¥–µ–æ
                            has_play_button = await elem.query_selector('[class*="play"], svg, [class*="thumbnail"]')
                            if has_play_button or '/ad-search/' in str(await elem.get_attribute("href") or ""):
                                video_elements.append(elem)
                        if video_elements:
                            break
                except:
                    continue
            
            log.info(f"  ‚Üí –ù–∞–π–¥–µ–Ω–æ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ")
            
            # –û–ì–†–ê–ù–ò–ß–ï–ù–ò–ï: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 50 –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
            max_cards = 50
            if len(video_elements) > max_cards:
                log.info(f"  ‚Üí –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ {max_cards} –∏–∑ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫")
                video_elements = video_elements[:max_cards]
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
            log.info("  ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–µ–∫...")
            log.info(f"  ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∞ {len(video_elements)} –∫–∞—Ä—Ç–æ—á–µ–∫...")
            
            successful_extractions = 0
            for i, card in enumerate(video_elements, 1):
                try:
                    video_data = await self._extract_video_data_from_card(card, i)
                    if video_data:
                        videos.append(video_data)
                        impression = video_data.get('impression', 0)
                        first_seen = video_data.get('first_seen', 'N/A')
                        
                        # –õ–û–ì–ò–†–£–ï–ú –ö–ê–ñ–î–û–ï –í–ò–î–ï–û (–∫–∞–∫ –ø—Ä–æ—Å–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
                        log.info(f"  üìπ –í–∏–¥–µ–æ {i}: impression={impression}, first_seen={first_seen}")
                        
                        if impression > 0 or first_seen != 'N/A':
                            successful_extractions += 1
                except Exception as e:
                    log.warning(f"  ‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ {i}: {e}")
                    continue
            
            log.info(f"  ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–æ {len(videos)} –≤–∏–¥–µ–æ –∏–∑ –±–ª–æ–∫–∞ (—É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–æ: {successful_extractions})")
            return videos
            
        except Exception as e:
            log.error(f"  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –≤–∏–¥–µ–æ: {e}")
            return []
    
    async def _extract_video_data_from_card(self, card_element, card_index: int = 0) -> Optional[Dict[str, Any]]:
        """
        –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ
        
        Args:
            card_element: –≠–ª–µ–º–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∏–¥–µ–æ
            card_index: –ò–Ω–¥–µ–∫—Å –∫–∞—Ä—Ç–æ—á–∫–∏ (–¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ –∏–ª–∏ None
        """
        try:
            video_data = {
                "ad_search_url": None,
                "impression": 0,
                "first_seen": None,
                "card_element": card_element,  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –∫–ª–∏–∫–∞
            }
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï IMPRESSION ==========
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ HTML-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
            # –ò—â–µ–º div.data-count > div.item –≥–¥–µ caption = "Impression"
            try:
                # –ò—â–µ–º –≤—Å–µ –±–ª–æ–∫–∏ data-count
                data_count_items = await card_element.query_selector_all('div.data-count div.item')
                
                if card_index <= 3:
                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –Ω–∞–π–¥–µ–Ω–æ {len(data_count_items)} –±–ª–æ–∫–æ–≤ div.item")
                
                for idx, item in enumerate(data_count_items):
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å impression
                    caption_elem = await item.query_selector('p.caption')
                    if caption_elem:
                        caption_text = await caption_elem.inner_text()
                        
                        if card_index <= 3:
                            log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}, –±–ª–æ–∫ {idx}: caption = '{caption_text}'")
                        
                        if 'Impression' in caption_text or '–ü–æ–∫–∞–∑' in caption_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
                            value_elem = await item.query_selector('p.value')
                            if value_elem:
                                # –ü–æ–ø—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
                                impression_str_inner = (await value_elem.inner_text()).strip()
                                impression_str_html = (await value_elem.inner_html()).strip()
                                impression_str_content = (await value_elem.text_content()).strip()
                                
                                # –í–°–ï–ì–î–ê –ª–æ–≥–∏—Ä—É–µ–º RAW-–∑–Ω–∞—á–µ–Ω–∏–µ (–¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–∞—Ä—Ç–æ—á–µ–∫)
                                if card_index <= 3:
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (inner_text) = '{impression_str_inner}'")
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (inner_html) = '{impression_str_html}'")
                                    log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression RAW (text_content) = '{impression_str_content}'")
                                
                                # –ò—Å–ø–æ–ª—å–∑—É–µ–º inner_text –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ç–æ—á–Ω–∏–∫
                                impression_str = impression_str_inner
                                impression = validator.parse_impressions(impression_str)
                                if impression:
                                    video_data["impression"] = impression
                                    if card_index <= 3:
                                        log.info(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: impression PARSED = {impression}")
                                    break
                                else:
                                    if card_index <= 3:
                                        log.warning(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: parse_impressions –≤–µ—Ä–Ω—É–ª None –¥–ª—è '{impression_str}'")
            except Exception as e:
                if card_index <= 3:
                    log.error(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ impression: {e}")
                    import traceback
                    log.error(traceback.format_exc())
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï FIRST SEEN ==========
            # –ò—â–µ–º div.create-time > span —Å –¥–∞—Ç–æ–π
            try:
                create_time_elem = await card_element.query_selector('div.create-time span')
                if create_time_elem:
                    date_text = (await create_time_elem.inner_text()).strip()
                    # –õ–æ–≥–∏—Ä—É–µ–º RAW-–∑–Ω–∞—á–µ–Ω–∏–µ
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: first_seen RAW='{date_text}'")
                    
                    # –§–æ—Ä–º–∞—Ç: "Nov 05 2025-Nov 11 2025" - –±–µ—Ä–µ–º –ü–ï–†–í–£–Æ –¥–∞—Ç—É (–¥–æ –¥–µ—Ñ–∏—Å–∞)
                    # –ò—Å–ø–æ–ª—å–∑—É–µ–º regex –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–µ—Ä–≤–æ–π –¥–∞—Ç—ã
                    match = re.match(r'([A-Z][a-z]{2}\s+\d{1,2}\s+\d{4})', date_text)
                    if match:
                        first_seen_str = match.group(1)
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –¥–∞—Ç—ã
                        parsed_date = validator.parse_video_date(first_seen_str)
                        if parsed_date:
                            video_data["first_seen"] = first_seen_str
                            log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: first_seen parsed='{first_seen_str}'")
            except Exception as e:
                if card_index <= 3:
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ first_seen —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä: {e}")
            
            # ========== –ò–ó–í–õ–ï–ß–ï–ù–ò–ï AD-SEARCH –°–°–´–õ–ö–ò ==========
            try:
                link_element = await card_element.query_selector('a.btn-detail[href*="/ad-search/"]')
                if link_element:
                    href = await link_element.get_attribute("href")
                    if href:
                        if href.startswith("/"):
                            video_data["ad_search_url"] = f"https://www.pipiads.com{href}"
                        elif href.startswith("http"):
                            video_data["ad_search_url"] = href
                        else:
                            video_data["ad_search_url"] = f"https://www.pipiads.com/{href}"
                        if card_index <= 3:
                            log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: ad_search_url = {video_data['ad_search_url']}")
            except Exception as e:
                if card_index <= 3:
                    log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ ad_search_url: {e}")
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Å—Å—ã–ª–∫—É, –Ω–æ –µ—Å—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∞ - –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –Ω–µ—ë
            if not video_data["ad_search_url"]:
                video_data["card_element"] = card_element
            
            # –õ–æ–≥–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–≤—ã—Ö 3 –∫–∞—Ä—Ç–æ—á–µ–∫
            if card_index <= 3:
                log.debug(f"  ‚Üí –ö–∞—Ä—Ç–æ—á–∫–∞ {card_index}: –∏—Ç–æ–≥–æ - impression={video_data['impression']}, first_seen={video_data['first_seen']}, ad_search_url={bool(video_data['ad_search_url'])}")
            
            return video_data
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ {card_index}: {e}")
            import traceback
            log.debug(traceback.format_exc())
            return None
    
    async def _filter_videos(self, videos: List[Dict[str, Any]]) -> List[Dict[str, Any]]:
        """
        –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
        
        Args:
            videos: –°–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        
        Returns:
            –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤–∏–¥–µ–æ
        """
        filtered = []
        
        for video in videos:
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ impression (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π "170.6K" –∏–ª–∏ —á–∏—Å–ª–æ–º)
            impression = video.get("impression", 0)
            impression_num = 0
            if isinstance(impression, str):
                # –ü–∞—Ä—Å–∏–º —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                impression_num = validator.parse_impressions(impression) or 0
            elif isinstance(impression, (int, float)):
                impression_num = int(impression)
            
            if not validator.validate_impressions(impression_num, config.MIN_IMPRESSIONS):
                log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: impression {impression} ({impression_num}) < {config.MIN_IMPRESSIONS}")
                continue
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
            first_seen = video.get("first_seen")
            if first_seen and first_seen != "N/A" and first_seen is not None:
                parsed_date = validator.parse_video_date(first_seen)
                if parsed_date:
                    if not validator.is_date_within_days(parsed_date, config.DAYS_BACK):
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –¥–∞—Ç–∞ {first_seen} —Å—Ç–∞—Ä—à–µ {config.DAYS_BACK} –¥–Ω–µ–π")
                        continue
                else:
                    # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å, –Ω–æ –µ—Å—Ç—å impression >= 50k, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –¥–∞—Ç—ã
                    if impression >= config.MIN_IMPRESSIONS:
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–∏–Ω—è—Ç–æ: –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É {first_seen}, –Ω–æ impression {impression} >= {config.MIN_IMPRESSIONS}")
                    else:
                        log.debug(f"–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –¥–∞—Ç—É {first_seen} –∏ impression {impression} < {config.MIN_IMPRESSIONS}")
                        continue
            # –ï—Å–ª–∏ –¥–∞—Ç—ã –Ω–µ—Ç, –Ω–æ impression >= 50k, –ø—Ä–∏–Ω–∏–º–∞–µ–º –≤–∏–¥–µ–æ
            elif impression >= config.MIN_IMPRESSIONS:
                log.debug(f"–í–∏–¥–µ–æ –ø—Ä–∏–Ω—è—Ç–æ: –Ω–µ—Ç –¥–∞—Ç—ã, –Ω–æ impression {impression} >= {config.MIN_IMPRESSIONS}")
            else:
                log.debug("–í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ: –Ω–µ—Ç –¥–∞—Ç—ã first_seen –∏ impression < –º–∏–Ω–∏–º—É–º–∞")
                continue
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
            video["_impression_num"] = impression_num
            filtered.append(video)
        
        # –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: —Å–Ω–∞—á–∞–ª–∞ –ø–æ –¥–∞—Ç–µ (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ), –ø–æ—Ç–æ–º –ø–æ impressions (—Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ)
        # –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ ad_search_url (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π), –∑–∞—Ç–µ–º tiktok_link, –∑–∞—Ç–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—è
        seen_videos = set()
        unique_videos = []
        for video in filtered:
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞)
            # 1. ad_search_url (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ)
            # 2. tiktok_link (–µ—Å–ª–∏ ad_search_url –Ω–µ—Ç)
            # 3. –ö–æ–º–±–∏–Ω–∞—Ü–∏—è impression + first_seen (fallback)
            video_id = None
            
            # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º ad_search_url (—É–±–∏—Ä–∞–µ–º —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ)
            ad_search_url = video.get("ad_search_url", "")
            if ad_search_url and ad_search_url != "N/A":
                ad_search_url = ad_search_url.rstrip('/')
                video_id = f"ad_search:{ad_search_url}"
            elif video.get("tiktok_link") and video.get("tiktok_link") != "N/A":
                video_id = f"tiktok:{video.get('tiktok_link')}"
            else:
                # Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—é impression + first_seen
                impression = video.get("impression", 0)
                first_seen = video.get("first_seen", "N/A")
                video_id = f"fallback:{impression}:{first_seen}"
            
            if video_id and video_id not in seen_videos:
                seen_videos.add(video_id)
                unique_videos.append(video)
            else:
                log.info(f"‚è≠Ô∏è  –í–∏–¥–µ–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ –∫–∞–∫ –¥—É–±–ª–∏–∫–∞—Ç: {video_id}")
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º: —Å–Ω–∞—á–∞–ª–∞ –ø–æ –¥–∞—Ç–µ (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ), –ø–æ—Ç–æ–º –ø–æ impressions (—Å–∞–º—ã–µ –±–æ–ª—å—à–∏–µ)
        def sort_key(v):
            parsed_date = validator.parse_video_date(v.get("first_seen", ""))
            if parsed_date:
                date_timestamp = -parsed_date.timestamp()  # –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ —É–±—ã–≤–∞–Ω–∏—é (—Å–∞–º—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ)
            else:
                date_timestamp = 0  # –í–∏–¥–µ–æ –±–µ–∑ –¥–∞—Ç—ã –≤ –∫–æ–Ω–µ—Ü
            return (date_timestamp, -v.get("_impression_num", 0))
        
        unique_videos.sort(key=sort_key)
        
        # –ë–µ—Ä–µ–º —Ç–æ–ø-3
        top_videos = unique_videos[:3]
        
        log.info(f"‚úÖ –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ {len(filtered)} –≤–∏–¥–µ–æ –∏–∑ {len(videos)}, —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö: {len(unique_videos)}, —Ç–æ–ø-3: {len(top_videos)}")
        return top_videos
    
    async def _get_video_details(self, video: Dict[str, Any]) -> Optional[Dict[str, Any]]:
        """
        –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –≤–∏–¥–µ–æ
        
        Args:
            video: –°–ª–æ–≤–∞—Ä—å —Å –±–∞–∑–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ (–∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        try:
            # –ï—Å–ª–∏ –µ—Å—Ç—å ad_search_url, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞–ø—Ä—è–º—É—é
            if video.get("ad_search_url"):
                log.info(f"    ‚Üí –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É ad-search: {video['ad_search_url']}")
                await self.page.goto(video["ad_search_url"], wait_until="domcontentloaded", timeout=30000)
                await self.human_delay(0.5, 1)
                log.info("    ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ad-search –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            else:
                # –ï—Å–ª–∏ –Ω–µ—Ç URL, –∫–ª–∏–∫–∞–µ–º –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É
                # –í–ê–ñ–ù–û: –≠–ª–µ–º–µ–Ω—Ç –º–æ–∂–µ—Ç –∏—Å—á–µ–∑–Ω—É—Ç—å –∏–∑ DOM, –ø–æ—ç—Ç–æ–º—É –∏—â–µ–º –µ–≥–æ –∑–∞–Ω–æ–≤–æ
                card_element = video.get("card_element")
                if not card_element:
                    log.error("    ‚ùå –ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ –ø–µ—Ä–µ–π—Ç–∏ –∫ –≤–∏–¥–µ–æ (–Ω–µ—Ç URL –∏ —ç–ª–µ–º–µ–Ω—Ç–∞)")
                    return None
                
                log.info("    ‚Üí –ö–ª–∏–∫ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –≤–∏–¥–µ–æ...")
                try:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –µ—â–µ –≤ DOM
                    is_attached = await card_element.evaluate("el => el.isConnected")
                    if not is_attached:
                        log.warning("    ‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç –∏—Å—á–µ–∑ –∏–∑ DOM, –ø—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –∑–∞–Ω–æ–≤–æ...")
                        # –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ –ø–æ ad_search_url –∏–ª–∏ –¥—Ä—É–≥–∏–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º
                        # –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None
                        log.error("    ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ")
                        return None
                    
                    await card_element.click()
                    await self.human_delay(0.5, 1)
                    log.info("    ‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ –≤–∏–¥–µ–æ –æ—Ç–∫—Ä—ã—Ç–∞")
                except Exception as e:
                    log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É: {e}")
                    log.warning("    ‚ö†Ô∏è –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç –∑–∞–Ω–æ–≤–æ...")
                    # –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –∏—Å—á–µ–∑, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None
                    return None
                
                # –ñ–¥–µ–º –æ—Ç–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞/–º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                # –ò—â–µ–º –∫–Ω–æ–ø–∫—É "More detail"
                log.info("    ‚Üí –ü–æ–∏—Å–∫ –∫–Ω–æ–ø–∫–∏ 'More detail'...")
                more_detail_selectors = [
                    'text="More detail"',
                    'text="More Detail"',
                    'button:has-text("More detail")',
                    'a:has-text("More detail")',
                ]
                
                more_detail_button = None
                for selector in more_detail_selectors:
                    try:
                        more_detail_button = await self.page.wait_for_selector(selector, timeout=5000, state="visible")
                        if more_detail_button:
                            log.info(f"    ‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ 'More detail' (—Å–µ–ª–µ–∫—Ç–æ—Ä: {selector})")
                            break
                    except:
                        continue
                
                if not more_detail_button:
                    log.error("    ‚ùå –ö–Ω–æ–ø–∫–∞ 'More detail' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
                    return None
                
                # –ö–ª–∏–∫–∞–µ–º –Ω–∞ "More detail"
                log.info("    ‚Üí –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É 'More detail'...")
                await more_detail_button.click()
                await self.human_delay(0.5, 1)
                
                # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
                log.info("    ‚Üí –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search...")
                await self.page.wait_for_load_state("domcontentloaded", timeout=10000)
                await self.human_delay(0.3, 0.5)
                log.info("    ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ ad-search –∑–∞–≥—Ä—É–∂–µ–Ω–∞")
            
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
            # –ü–µ—Ä–µ–¥–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏) –¥–ª—è fallback
            log.info("    ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search...")
            
            # –í–ê–ñ–ù–û: –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º domcontentloaded (–±—ã—Å—Ç—Ä–µ–µ) + –∑–∞–¥–µ—Ä–∂–∫–∞ + –æ–∂–∏–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            await self.page.wait_for_load_state("domcontentloaded", timeout=10000)
            await self.human_delay(2, 3)  # –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (Script, Hook, Audience) —Å retry
            elements_found = False
            for attempt in range(3):  # 3 –ø–æ–ø—ã—Ç–∫–∏
                try:
                    # –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                    await self.page.wait_for_selector('li#ai-script, li#ai-hook, div.addel-info-item', timeout=5000, state="visible")
                    log.info(f"    ‚úÖ –ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search (–ø–æ–ø—ã—Ç–∫–∞ {attempt + 1})")
                    elements_found = True
                    break
                except:
                    if attempt < 2:
                        log.debug(f"    ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –∂–¥–µ–º –µ—â–µ...")
                        await self.human_delay(2, 3)
                    else:
                        log.warning("    ‚ö†Ô∏è –ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ—Å–ª–µ 3 –ø–æ–ø—ã—Ç–æ–∫, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ...")
            
            return await self._extract_ad_search_data(video)
            
        except Exception as e:
            log.error(f"    ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–µ—Ç–∞–ª–µ–π –≤–∏–¥–µ–æ: {e}")
            import traceback
            log.error(traceback.format_exc())
            return None
    
    async def _extract_ad_search_data(self, original_video: Optional[Dict[str, Any]] = None) -> Dict[str, Any]:
        """
        –ò–∑–≤–ª–µ—á—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ad-search
        
        Args:
            original_video: –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (–¥–ª—è fallback impressions)
        
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–∏–¥–µ–æ
        """
        video_data = {
            "tiktok_link": "N/A",
            "impression": 0,
            "script": "N/A",
            "hook": "N/A",
            "audience_age": "N/A",
            "country": "N/A",
            "first_seen": "N/A",
        }
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è fallback
        if original_video:
            original_impression = original_video.get("impression")
            if original_impression:
                video_data["_original_impression"] = original_impression
        
        try:
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            await self.page.wait_for_load_state("domcontentloaded")
            await self.human_delay(0.3, 0.5)
            
            # –ü–æ–ª—É—á–∞–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ø–æ–∏—Å–∫–∞
            page_text = await self.page.content()
            
            # 1. TikTok —Å—Å—ã–ª–∫–∞ (–∏–∑ –ø–æ–ª—è "TikTok Post" (–∞–Ω–≥–ª.) –∏–ª–∏ "–ü–æ—Å—Ç TikTok" (—Ä—É—Å.))
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ TikTok —Å—Å—ã–ª–∫–∏...")
            
            # –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –ø–æ —Ç–µ–∫—Å—Ç—É "TikTok Post" –∏–ª–∏ "–ü–æ—Å—Ç TikTok"
            tiktok_post_selectors = [
                'text=/TikTok Post/i',  # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
                'text=/–ü–æ—Å—Ç TikTok/i',  # –†—É—Å—Å–∫–∏–π fallback
            ]
            
            for selector in tiktok_post_selectors:
                try:
                    locator = self.page.locator(selector).first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Å—Å—ã–ª–∫—É —Ä—è–¥–æ–º
                        try:
                            parent_locator = locator.locator("..")
                            # –ò—â–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å—Å—ã–ª–∫–∞–º —Å /v/)
                            link = await parent_locator.locator('a[href*="m.tiktok.com/v/"]').first.element_handle()
                            if not link:
                                link = await parent_locator.locator('a[href*="tiktok.com/v/"]').first.element_handle()
                            if not link:
                                link = await parent_locator.locator('a[href*="tiktok.com"]').first.element_handle()
                            if link:
                                href = await link.get_attribute("href")
                                if href:
                                    # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä—ã –≤ TikTok Shop
                                    if "shop.tiktok.com/view/product" in href or "/view/product" in href:
                                        log.debug(f"      ‚Üí –ü—Ä–æ–ø—É—â–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä: {href[:50]}...")
                                        continue
                                    # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ
                                    if "/v/" in href or "m.tiktok.com" in href:
                                        video_data["tiktok_link"] = href
                                        log.info(f"      ‚úÖ TikTok —Å—Å—ã–ª–∫–∞ –Ω–∞–π–¥–µ–Ω–∞: {href[:50]}...")
                                        break
                        except:
                            pass
                except:
                    continue
            
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç, –∏—â–µ–º –≤—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ TikTok
            # –í–ê–ñ–ù–û: –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ (m.tiktok.com/v/...), –ù–ï –Ω–∞ —Ç–æ–≤–∞—Ä—ã (shop.tiktok.com/view/product/...)
            if video_data["tiktok_link"] == "N/A":
                tiktok_link_selectors = [
                    'a[href*="m.tiktok.com/v/"]',  # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ
                    'a[href*="tiktok.com/v/"]',    # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                    'a[href*="tiktok.com"]',       # Fallback
                ]
                
                for selector in tiktok_link_selectors:
                    try:
                        links = await self.page.query_selector_all(selector)
                        for link in links:
                            href = await link.get_attribute("href")
                            if href and "tiktok.com" in href:
                                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–æ–≤–∞—Ä—ã –≤ TikTok Shop
                                if "shop.tiktok.com/view/product" in href or "/view/product" in href:
                                    log.debug(f"      ‚Üí –ü—Ä–æ–ø—É—â–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä: {href[:50]}...")
                                    continue
                                
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ (—Å–æ–¥–µ—Ä–∂–∞—Ç /v/ –≤ –ø—É—Ç–∏)
                                if "/v/" in href or "m.tiktok.com" in href:
                                    video_data["tiktok_link"] = href
                                    log.info(f"      ‚úÖ TikTok —Å—Å—ã–ª–∫–∞ –Ω–∞–π–¥–µ–Ω–∞: {href[:50]}...")
                                    break
                        if video_data["tiktok_link"] != "N/A":
                            break
                    except:
                        continue
            
            if video_data["tiktok_link"] == "N/A":
                log.warning("      ‚ö†Ô∏è TikTok —Å—Å—ã–ª–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
            
            # 2. Impressions - –ö–†–ò–¢–ò–ß–ù–û: "Impressions" (–∞–Ω–≥–ª.) –∏–ª–∏ "–ü–æ–∫–∞–∑—ã" (—Ä—É—Å.), –Ω–µ "Likes" –∏–ª–∏ "–ù—Ä–∞–≤–∏—Ç—Å—è"!
            # –ò—â–µ–º –≤ —Ä–∞–∑–¥–µ–ª–µ "Data/–î–∞–Ω–Ω—ã–µ" –≤ –ø—É–Ω–∫—Ç–µ "Impression/–ü–æ–∫–∞–∑"
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ impressions...")
            impression_text = await self._extract_impressions()
            if impression_text:
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (–µ—Å–ª–∏ –æ–Ω —É–∂–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "170.6K" –∏–ª–∏ "339.9M")
                if impression_text.upper().endswith(('K', 'M')):
                    video_data["impression"] = impression_text
                    log.info(f"      ‚úÖ Impressions (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç): {impression_text}")
                else:
                    # –ü–∞—Ä—Å–∏–º —á–∏—Å–ª–æ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ–±—Ä–∞—Ç–Ω–æ
                    impression_num = validator.parse_impressions(impression_text) or 0
                    video_data["impression"] = validator.format_impressions(impression_num)
                    log.info(f"      ‚úÖ Impressions (—Å—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–æ): {video_data['impression']}")
            else:
                # –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –æ–Ω–∏ –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                # (–∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞)
                original_impression = video_data.get("_original_impression")
                if original_impression:
                    if isinstance(original_impression, (int, float)) and original_impression > 0:
                        video_data["impression"] = validator.format_impressions(int(original_impression))
                        log.info(f"      ‚úÖ Impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏: {video_data['impression']}")
                    elif isinstance(original_impression, str) and original_impression != "N/A":
                        video_data["impression"] = original_impression
                        log.info(f"      ‚úÖ Impressions –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ (—Å—Ç—Ä–æ–∫–∞): {original_impression}")
                    else:
                        video_data["impression"] = "N/A"
                        log.warning("      ‚ö†Ô∏è Impressions –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ad-search, –Ω–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ")
                else:
                    video_data["impression"] = "N/A"
                    log.warning("      ‚ö†Ô∏è Impressions –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
            
            # 3. Script (–∏–∑ "Transcript" –∏–ª–∏ "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞")
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è (script)...")
            log.info(f"      ‚Üí –¢–µ–∫—É—â–∏–π URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {self.page.url}")
            script = await self._extract_script()
            if script:
                video_data["script"] = script
                log.info(f"      ‚úÖ Script –Ω–∞–π–¥–µ–Ω ({len(script)} —Å–∏–º–≤–æ–ª–æ–≤): {script[:100]}...")
            else:
                video_data["script"] = "N/A"
                log.warning("      ‚ö†Ô∏è Script –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-script p.content-text –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 4. Hook (–∏–∑ —Å–µ–∫—Ü–∏–∏ Hook –∏–ª–∏ Hooks)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ hook...")
            hook = await self._extract_hook()
            if not hook:
                # –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫, –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω
                log.warning("      ‚ö†Ô∏è Hook –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫...")
                await self.human_delay(1, 2)  # –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É
                hook = await self._extract_hook()
            
            if hook:
                video_data["hook"] = hook
                log.info(f"      ‚úÖ Hook –Ω–∞–π–¥–µ–Ω ({len(hook)} —Å–∏–º–≤–æ–ª–æ–≤): {hook[:100]}...")
            else:
                video_data["hook"] = "N/A"
                log.warning("      ‚ö†Ô∏è Hook –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook p.content-text –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 5. Audience Age (–∏–∑ –ø–æ–ª—è Audience/–ê—É–¥–∏—Ç–æ—Ä–∏—è)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∞—É–¥–∏—Ç–æ—Ä–∏–∏...")
            audience_data = await self._extract_audience()
            if audience_data:
                age = audience_data.get("age", "N/A")
                platform = audience_data.get("platform", "N/A")
                # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ "35-45" –∏–ª–∏ "35-45 Android" (–µ—Å–ª–∏ –µ—Å—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞)
                # –í —Å—Ç—Ä–æ–∫–µ 6 —Ç–æ–ª—å–∫–æ –≤–æ–∑—Ä–∞—Å—Ç "25-35", –±–µ–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
                video_data["audience_age"] = age if age != "N/A" else "N/A"
                log.info(f"      ‚úÖ Audience: {video_data['audience_age']}")
            else:
                video_data["audience_age"] = "N/A"
                log.info("      ‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
            
            # 6. Country (–∏–∑ –ø–æ–ª—è "Country/Region" –∏–ª–∏ "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω" - –û–¢–î–ï–õ–¨–ù–û –æ—Ç Audience!)
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã...")
            country = await self._extract_country()
            if country:
                video_data["country"] = country
                log.info(f"      ‚úÖ Country: {country}")
            else:
                video_data["country"] = "N/A"
                log.warning("      ‚ö†Ô∏è Country –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
                log.warning(f"      ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä div.addel-info-item —Å 'Country/Region' –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ: {self.page.url}")
            
            # 7. First seen (—Ñ–æ—Ä–º–∞—Ç "Oct 27 2025" - –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ "Oct 28 2025 ~ Nov 10 2025")
            log.info("      ‚Üí –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞—Ç—ã First seen...")
            first_seen = await self._extract_first_seen()
            if first_seen:
                video_data["first_seen"] = first_seen
                log.info(f"      ‚úÖ First seen: {first_seen}")
            else:
                video_data["first_seen"] = "N/A"
                log.info("      ‚ö†Ô∏è First seen –Ω–µ –Ω–∞–π–¥–µ–Ω, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ 'N/A'")
            
            log.info(f"    ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ—á–µ–Ω—ã: impression={video_data['impression']}, first_seen={video_data['first_seen']}")
            return video_data
            
        except Exception as e:
            log.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö ad-search: {e}")
            return video_data
    
    async def _extract_impressions(self) -> Optional[str]:
        """
        –ò–∑–≤–ª–µ—á—å impressions - –ö–†–ò–¢–ò–ß–ù–û: –≤ —Ä–∞–∑–¥–µ–ª–µ "Data/–î–∞–Ω–Ω—ã–µ" –≤ –ø—É–Ω–∫—Ç–µ "Impression/–ü–æ–∫–∞–∑"
        –í–ê–ñ–ù–û: –ù–ï –±—Ä–∞—Ç—å —à–∞–±–ª–æ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã!
        
        Returns:
            –°—Ç—Ä–æ–∫–∞ —Å impressions (–Ω–∞–ø—Ä–∏–º–µ—Ä "170.6K", "339.9M") –∏–ª–∏ None
        """
        try:
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM (–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ)
            try:
                impression_data = await self.page.evaluate("""
                    () => {
                        // –ò—â–µ–º —Ä–∞–∑–¥–µ–ª "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                        const dataKeywords = ['Data', '–î–∞–Ω–Ω—ã–µ'];
                        const impressionKeywords = ['Impression', '–ü–æ–∫–∞–∑', '–ü–æ–∫–∞–∑—ã'];
                        
                        // –ò—â–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —ç–ª–µ–º–µ–Ω—Ç "Data" –∏–ª–∏ "–î–∞–Ω–Ω—ã–µ"
                            for (const dataKeyword of dataKeywords) {
                                if (text.includes(dataKeyword)) {
                                    // –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –∏—â–µ–º "Impression" –∏–ª–∏ "–ü–æ–∫–∞–∑"
                                    for (const impKeyword of impressionKeywords) {
                                        if (text.includes(impKeyword)) {
                                            // –ò—â–µ–º —á–∏—Å–ª–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "170.6K", "403.2M" –∏ —Ç.–¥.
                                            const patterns = [
                                                new RegExp(impKeyword + '[\\s:]*([\\d.,]+[KM]?)', 'i'),
                                                new RegExp('([\\d.,]+[KM]?)\\s*' + impKeyword, 'i')
                                            ];
                                            
                                            for (const pattern of patterns) {
                                                const match = text.match(pattern);
                                                if (match && match[1]) {
                                                    const value = match[1];
                                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ —á–∏—Å–ª–æ (–Ω–µ —à–∞–±–ª–æ–Ω–Ω–æ–µ)
                                                    // –û–±—ã—á–Ω–æ —Ä–µ–∞–ª—å–Ω—ã–µ impressions –æ—Ç 50K –¥–æ 500M
                                                    const numValue = parseFloat(value.replace(/[KM]/i, ''));
                                                    if (numValue >= 0.05 && numValue <= 1000) {
                                                        return value;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        
                        // Fallback: –∏—â–µ–º –Ω–∞–ø—Ä—è–º—É—é "Impression" –∏–ª–∏ "–ü–æ–∫–∞–∑" (–ù–ï "Likes"!)
                        for (const impKeyword of impressionKeywords) {
                            const elements = Array.from(document.querySelectorAll('*')).filter(el => {
                                const text = el.innerText || '';
                                return text.includes(impKeyword) && !text.toLowerCase().includes('likes') && !text.toLowerCase().includes('–Ω—Ä–∞–≤–∏—Ç—Å—è');
                            });
                            
                            for (const el of elements) {
                                const text = el.innerText || '';
                                const patterns = [
                                    new RegExp(impKeyword + '[\\s:]*([\\d.,]+[KM]?)', 'i'),
                                    new RegExp('([\\d.,]+[KM]?)\\s*' + impKeyword, 'i')
                                ];
                                
                                for (const pattern of patterns) {
                                    const match = text.match(pattern);
                                    if (match && match[1]) {
                                        const value = match[1];
                                        const numValue = parseFloat(value.replace(/[KM]/i, ''));
                                        if (numValue >= 0.05 && numValue <= 1000) {
                                            return value;
                                        }
                                    }
                                }
                            }
                        }
                        
                        return null;
                    }
                """)
                
                if impression_data:
                    log.debug(f"–ù–∞–π–¥–µ–Ω–æ impressions —á–µ—Ä–µ–∑ JavaScript: {impression_data}")
                    return impression_data
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ impressions —á–µ—Ä–µ–∑ JS: {e}")
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (fallback)
            data_keywords = ["Data", "–î–∞–Ω–Ω—ã–µ"]
            
            for keyword in data_keywords:
                try:
                    data_locator = self.page.locator(f'text=/{keyword}/i').first
                    if await data_locator.count() > 0:
                        impression_keywords = ["Impression", "–ü–æ–∫–∞–∑", "–ü–æ–∫–∞–∑—ã"]
                        for imp_keyword in impression_keywords:
                            try:
                                parent_text = await data_locator.locator("..").inner_text()
                                if imp_keyword in parent_text and "Likes" not in parent_text and "–ù—Ä–∞–≤–∏—Ç—Å—è" not in parent_text:
                                    pattern = rf'{imp_keyword}[:\s]*([\d.,]+[KM]?)'
                                    match = re.search(pattern, parent_text, re.IGNORECASE)
                                    if match:
                                        impression_str = match.group(1)
                                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —à–∞–±–ª–æ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                                        num_value = validator.parse_impressions(impression_str)
                                        if num_value and 50000 <= num_value <= 1000000000:  # –û—Ç 50K –¥–æ 1B
                                            log.debug(f"–ù–∞–π–¥–µ–Ω–æ impressions –≤ —Ä–∞–∑–¥–µ–ª–µ Data: {impression_str}")
                                            return impression_str
                            except:
                                continue
                except:
                    continue
            
            log.warning("–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ 'Impression' –∏–ª–∏ '–ü–æ–∫–∞–∑' –≤ —Ä–∞–∑–¥–µ–ª–µ Data")
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ impressions: {e}")
            return None
    
    async def _extract_script(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å —Å—Ü–µ–Ω–∞—Ä–∏–π –∏–∑ —Å–µ–∫—Ü–∏–∏ 'Script' –∏–ª–∏ '–°—Ü–µ–Ω–∞—Ä–∏–π' (–∏–ª–∏ 'Transcript' –∏–ª–∏ '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞')
        
        –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
        <li id="ai-script">
            <div class="li-title">...</div>
            <div class="control-content li-content">
                <p class="content-text slot-wrap">...</p>
            </div>
        </li>
        """
        try:
            # –ú–ï–¢–û–î 0: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä—É –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            # –ü—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º (—ç–ª–µ–º–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
            for attempt in range(3):
                try:
                    # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
                    try:
                        await self.page.wait_for_selector('li#ai-script', timeout=5000, state="visible")
                    except:
                        if attempt < 2:
                            log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç li#ai-script –Ω–µ –ø–æ—è–≤–∏–ª—Å—è, –∂–¥–µ–º –µ—â–µ...")
                            await self.human_delay(1, 2)
                            continue
                        else:
                            log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-script –Ω–µ –ø–æ—è–≤–∏–ª—Å—è –∑–∞ 15 —Å–µ–∫—É–Ω–¥")
                    
                    script_element = await self.page.query_selector('li#ai-script p.content-text')
                    if script_element:
                        script = await script_element.inner_text()
                        if script and len(script.strip()) > 10:
                            log.info(f"      ‚úÖ Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-script p.content-text ({len(script)} —Å–∏–º–≤–æ–ª–æ–≤)")
                            return script.strip()
                    else:
                        if attempt < 2:
                            log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω, –∂–¥–µ–º –µ—â–µ...")
                            await self.human_delay(1, 2)
                            continue
                        else:
                            log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-script p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω")
                except Exception as e:
                    if attempt < 2:
                        log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: –æ—à–∏–±–∫–∞ {e}, –ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑...")
                        await self.human_delay(1, 2)
                        continue
                    else:
                        log.debug(f"      ‚Üí –°–µ–ª–µ–∫—Ç–æ—Ä li#ai-script –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: {e}")
            
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏ —Ä—É—Å—Å–∫–∏–π)
            script_keywords = ["Script", "–°—Ü–µ–Ω–∞—Ä–∏–π", "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞", "–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç"]
            
            for keyword in script_keywords:
                try:
                    # –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å —Ç–µ–∫—Å—Ç–æ–º
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            parent_text = await locator.locator("..").inner_text()
                            if keyword in parent_text:
                                parts = parent_text.split(keyword, 1)
                                if len(parts) > 1:
                                    script = parts[1].strip()
                                    # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –º–µ—Ç–∫–∏
                                    stop_words = ["Hook", "–•—É–∫", "Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", 
                                                "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", "Impressions", "–ü–æ–∫–∞–∑—ã",
                                                "Limited Time Offer", "Annual Plan", "Promotion Period", "50% OFF",
                                                "Privacy", "Terms", "Copyright", "PIPIADS", "All Rights Reserved",
                                                "AI-agent", "cosmobeauty", "credits", "subscription", "invoice",
                                                "Monthly Credits", "Extra Credits", "data cost", "detail costs",
                                                "Team Setting", "Affiliate Dashboard", "Logout"]
                                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                           "cosmobeauty", "credits", "subscription", "invoice", 
                                                           "Monthly Credits", "Extra Credits", "@gmail.com"]
                                    is_footer_menu = any(keyword in script for keyword in footer_menu_keywords)
                                    
                                    for stop_word in stop_words:
                                        if stop_word in script:
                                            script = script.split(stop_word)[0].strip()
                                    # –§–∏–ª—å—Ç—Ä—É–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (Video Text Translator, Quality, Size –∏ —Ç.–¥.)
                                    metadata_keywords = ["Video Text Translator", "Translator", "Quality", "Size", "Resolution", 
                                                        "Width", "Height", "Duration", "Format", "Codec", "Frame Rate"]
                                    is_metadata = any(keyword in script for keyword in metadata_keywords)
                                    
                                    # –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                    lines = script.split('\n')
                                    cleaned_lines = []
                                    skip_words = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook']
                                    for line in lines:
                                        line = line.strip()
                                        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                        if line and not line.startswith('#') and not any(skip in line for skip in skip_words):
                                            cleaned_lines.append(line)
                                    script = '\n'.join(cleaned_lines).strip()
                                    
                                    if script and len(script) > 10 and not is_footer_menu and not is_metadata:
                                        log.debug(f"Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Ä–æ–¥–∏—Ç–µ–ª—å)")
                                        return script
                        except:
                            pass
                        
                        # –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            next_sibling = await locator.evaluate_handle("el => el.nextElementSibling")
                            if next_sibling:
                                script = await next_sibling.as_element().inner_text()
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                       "cosmobeauty", "credits", "subscription", "invoice", 
                                                       "Monthly Credits", "Extra Credits", "@gmail.com"]
                                is_footer_menu = any(keyword in script for keyword in footer_menu_keywords)
                                # –§–∏–ª—å—Ç—Ä—É–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                metadata_keywords = ["Video Text Translator", "Translator", "Quality", "Size", "Resolution"]
                                is_metadata = any(keyword in script for keyword in metadata_keywords)
                                
                                # –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                lines = script.split('\n')
                                cleaned_lines = []
                                skip_words = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook']
                                for line in lines:
                                    line = line.strip()
                                    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                    if line and not line.startswith('#') and not any(skip in line for skip in skip_words):
                                        cleaned_lines.append(line)
                                script = '\n'.join(cleaned_lines).strip()
                                
                                if script and len(script) > 10 and not is_footer_menu and not is_metadata:
                                    log.debug(f"Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç)")
                                    return script.strip()
                        except:
                            pass
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                script = await self.page.evaluate("""
                    () => {
                        const keywords = ['Script', '–°—Ü–µ–Ω–∞—Ä–∏–π', 'Transcript', '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞', '–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç'];
                        const stopWords = ['Hook', '–•—É–∫', 'Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 
                                          'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 'Impressions', '–ü–æ–∫–∞–∑—ã',
                                          'Analysis', 'Advertiser', 'Display Name', 'Ad Copy',
                                          'Limited Time Offer', 'Annual Plan', 'Promotion Period', '50% OFF'];
                        
                        // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    // –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ (–æ–±—ã—á–Ω–æ —ç—Ç–æ —Å–∞–º script)
                                    let scriptText = null;
                                    
                                    // –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ sibling —ç–ª–µ–º–µ–Ω—Ç–∞
                                    let nextSibling = el.nextElementSibling;
                                    if (nextSibling) {
                                        scriptText = nextSibling.innerText || '';
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    if (!scriptText || scriptText.length < 10) {
                                        const parentText = el.parentElement ? el.parentElement.innerText || '' : '';
                                        if (parentText.includes(keyword)) {
                                            const parts = parentText.split(keyword);
                                            if (parts.length > 1) {
                                                scriptText = parts[1].trim();
                                            }
                                        }
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 3: –ò—â–µ–º –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö (–æ–±—ã—á–Ω–æ script –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –±–ª–æ–∫–µ)
                                    if (!scriptText || scriptText.length < 10) {
                                        const children = el.querySelectorAll('p, div, span');
                                        for (const child of children) {
                                            const childText = child.innerText || '';
                                            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç—ã
                                            if (childText.length > 20 && 
                                                !childText.includes('Advertiser') && 
                                                !childText.includes('Display Name') &&
                                                !childText.includes('Analysis') &&
                                                !childText.includes('Generator') &&
                                                !childText.includes('Limited Time Offer') &&
                                                !childText.includes('Annual Plan') &&
                                                !childText.includes('Promotion Period') &&
                                                !childText.includes('50% OFF')) {
                                                scriptText = childText;
                                                break;
                                            }
                                        }
                                    }
                                    
                                    if (scriptText) {
                                        // –£–±–∏—Ä–∞–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                        for (const stopWord of stopWords) {
                                            if (scriptText.includes(stopWord)) {
                                                scriptText = scriptText.split(stopWord)[0];
                                            }
                                        }
                                        
                                        scriptText = scriptText.trim();
                                        
                                        // –£–±–∏—Ä–∞–µ–º —Ç–µ–≥–∏ (—Å—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å #) –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                        const skipWords = ['Tags', 'Script', 'Hooks', 'Tag', 'Hook'];
                                        const lines = scriptText.split('\\n');
                                        const cleanedLines = [];
                                        for (const line of lines) {
                                            const trimmedLine = line.trim();
                                            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–≥–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #), –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞
                                            if (trimmedLine && !trimmedLine.startsWith('#') && 
                                                !skipWords.some(word => trimmedLine.includes(word))) {
                                                cleanedLines.push(trimmedLine);
                                            }
                                        }
                                        scriptText = cleanedLines.join('\\n').trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π script (–Ω–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –Ω–µ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç, –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é)
                                        const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                                   'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                                   'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                                   'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                                   'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                        const isFooterMenu = footerMenuKeywords.some(keyword => scriptText.includes(keyword));
                                        
                                        // –§–∏–ª—å—Ç—Ä—É–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                    const metadataKeywords = ['Video Text Translator', 'Translator', 'Quality', 'Size', 'Resolution', 
                                                             'Width', 'Height', 'Duration', 'Format', 'Codec', 'Frame Rate'];
                                    const isMetadata = metadataKeywords.some(keyword => scriptText.includes(keyword));
                                    
                                    if (scriptText && scriptText.length > 20 && 
                                            !scriptText.startsWith('Analysis') &&
                                            !scriptText.includes('shop.tiktok.com') &&
                                            !scriptText.includes('Generator Image') &&
                                            !scriptText.includes('Limited Time Offer') &&
                                            !scriptText.includes('Annual Plan') &&
                                            !scriptText.includes('Promotion Period') &&
                                            !scriptText.includes('50% OFF') &&
                                            !scriptText.toLowerCase().includes('q4') &&
                                            !scriptText.toLowerCase().includes('monthly plan') &&
                                            !isFooterMenu &&
                                            !isMetadata) {
                                            return scriptText;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if script and len(script) > 10:
                    log.debug("Script –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript")
                    return script.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ script —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è: {e}")
            return None
    
    async def _extract_hook(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å hook –∏–∑ —Å–µ–∫—Ü–∏–∏ Hook/Hooks (–∞–Ω–≥–ª.) –∏–ª–∏ –•—É–∫/–•—É–∫–∏ (—Ä—É—Å.)
        –í–ê–ñ–ù–û: Hook –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ Script –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ!
        
        –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
        <li id="ai-hook">
            <div class="li-title">...</div>
            <div class="control-content li-content">
                <p class="content-text slot-wrap">...</p>
            </div>
        </li>
        """
        try:
            # –ú–ï–¢–û–î 0: –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä—É –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            # –ü—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º (—ç–ª–µ–º–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
            for attempt in range(3):
                try:
                    # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
                    try:
                        await self.page.wait_for_selector('li#ai-hook', timeout=5000, state="visible")
                    except:
                        if attempt < 2:
                            log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç li#ai-hook –Ω–µ –ø–æ—è–≤–∏–ª—Å—è, –∂–¥–µ–º –µ—â–µ...")
                            await self.human_delay(1, 2)
                            continue
                        else:
                            log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-hook –Ω–µ –ø–æ—è–≤–∏–ª—Å—è –∑–∞ 15 —Å–µ–∫—É–Ω–¥")
                    
                    hook_element = await self.page.query_selector('li#ai-hook p.content-text')
                    if hook_element:
                        hook = await hook_element.inner_text()
                        if hook and len(hook.strip()) > 5:
                            log.info(f"      ‚úÖ Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook p.content-text ({len(hook)} —Å–∏–º–≤–æ–ª–æ–≤)")
                            return hook.strip()
                    else:
                        if attempt < 2:
                            log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: —ç–ª–µ–º–µ–Ω—Ç p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω, –∂–¥–µ–º –µ—â–µ...")
                            await self.human_delay(1, 2)
                            continue
                        else:
                            log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç li#ai-hook p.content-text –Ω–µ –Ω–∞–π–¥–µ–Ω")
                except Exception as e:
                    if attempt < 2:
                        log.debug(f"      ‚Üí –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}: –æ—à–∏–±–∫–∞ {e}, –ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑...")
                        await self.human_delay(1, 2)
                        continue
                    else:
                        log.debug(f"      ‚Üí –°–µ–ª–µ–∫—Ç–æ—Ä li#ai-hook –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: {e}")
            
            # –ù–û–í–´–ô –ú–ï–¢–û–î: –ò—â–µ–º Script, –∑–∞—Ç–µ–º –∏—â–µ–º Hook –≤ —Å–ª–µ–¥—É—é—â–µ–º —ç–ª–µ–º–µ–Ω—Ç–µ/—Å–µ–∫—Ü–∏–∏
            try:
                # –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏–º Script
                script_keywords = ["Script", "–°—Ü–µ–Ω–∞—Ä–∏–π", "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞"]
                for script_keyword in script_keywords:
                    try:
                        script_locator = self.page.locator(f'text=/{script_keyword}/i').first
                        if await script_locator.count() > 0:
                            # –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ Script, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç "Hook" –∏–ª–∏ "Hooks"
                            # –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ –ø–æ—Å–ª–µ Script
                            try:
                                # –°–ø–æ—Å–æ–± 1: –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å "Hook" –∏–ª–∏ "Hooks" –ø–æ—Å–ª–µ Script
                                parent = script_locator.locator("..")
                                parent_text = await parent.inner_text()
                                
                                # –ò—â–µ–º "Hook" –∏–ª–∏ "Hooks" –≤ —Ç–æ–º –∂–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ
                                if "Hook" in parent_text or "Hooks" in parent_text or "–•—É–∫" in parent_text or "–•—É–∫–∏" in parent_text:
                                    # –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é Script –∏ Hook –≤ —Ç–µ–∫—Å—Ç–µ
                                    script_pos = parent_text.find(script_keyword)
                                    hook_pos = -1
                                    for hook_word in ["Hook", "Hooks", "–•—É–∫", "–•—É–∫–∏"]:
                                        pos = parent_text.find(hook_word, script_pos)
                                        if pos > script_pos:
                                            hook_pos = pos
                                            break
                                    
                                    if hook_pos > script_pos:
                                        # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ "Hook" –∏–ª–∏ "Hooks"
                                        hook_section = parent_text[hook_pos:]
                                        # –£–±–∏—Ä–∞–µ–º "Hook" –∏–ª–∏ "Hooks" –∏–∑ –Ω–∞—á–∞–ª–∞
                                        hook_section = re.sub(r'^Hooks?\s*:?\s*', '', hook_section, flags=re.IGNORECASE)
                                        hook_section = re.sub(r'^–•—É–∫–∏?\s*:?\s*', '', hook_section, flags=re.IGNORECASE)
                                        hook_text = hook_section.strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏ (Target Audience, First seen –∏ —Ç.–¥.)
                                        stop_words = ["Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", 
                                                    "Impressions", "–ü–æ–∫–∞–∑—ã", "Country", "–°—Ç—Ä–∞–Ω–∞", "Country/Region", "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω"]
                                        for stop_word in stop_words:
                                            if stop_word in hook_text:
                                                hook_text = hook_text.split(stop_word)[0].strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
                                        hook_text = re.sub(r'Quality\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'Size\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'Resolution\s*:?\s*[^\n]*', '', hook_text, flags=re.IGNORECASE)
                                        hook_text = re.sub(r'--', '', hook_text)
                                        hook_text = re.sub(r'\n{2,}', '\n', hook_text).strip()
                                        
                                        # –£–±–∏—Ä–∞–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–ª–æ–≤–∞ –≤ –Ω–∞—á–∞–ª–µ
                                        hook_text = re.sub(r'^(Tags|Script|Hooks?)\s*:?\s*', '', hook_text, flags=re.IGNORECASE)
                                        
                                        if hook_text and len(hook_text) > 5 and len(hook_text) < 500:
                                            log.debug(f"Hook –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ Script —á–µ—Ä–µ–∑ '{script_keyword}'")
                                            return hook_text
                            except:
                                pass
                            
                            # –°–ø–æ—Å–æ–± 2: –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π sibling —ç–ª–µ–º–µ–Ω—Ç –ø–æ—Å–ª–µ Script
                            try:
                                script_element = await script_locator.element_handle()
                                if script_element:
                                    # –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å —Ç–µ–∫—Å—Ç–æ–º "Hook" –∏–ª–∏ "Hooks"
                                    next_elements = await self.page.evaluate("""
                                        (scriptEl) => {
                                            let current = scriptEl;
                                            // –ò—â–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç —Å "Hook" –∏–ª–∏ "Hooks"
                                            for (let i = 0; i < 10; i++) {
                                                current = current.nextElementSibling;
                                                if (!current) break;
                                                const text = current.innerText || '';
                                                if (text.includes('Hook') || text.includes('Hooks') || 
                                                    text.includes('–•—É–∫') || text.includes('–•—É–∫–∏')) {
                                                    // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ "Hook" –∏–ª–∏ "Hooks"
                                                    const parts = text.split(/Hooks?\\s*:?\\s*|–•—É–∫–∏?\\s*:?\\s*/i);
                                                    if (parts.length > 1) {
                                                        let hookText = parts[1].trim();
                                                        // –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏
                                                        const stopWords = ['Target Audience', 'First seen', 'Impressions', 'Country'];
                                                        for (const stop of stopWords) {
                                                            if (hookText.includes(stop)) {
                                                                hookText = hookText.split(stop)[0];
                                                            }
                                                        }
                                                        hookText = hookText.replace(/Quality\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/Size\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/Resolution\\s*:?\\s*[^\\n]*/gi, '');
                                                        hookText = hookText.replace(/--/g, '');
                                                        hookText = hookText.replace(/\\n{2,}/g, '\\n').trim();
                                                        if (hookText && hookText.length > 5 && hookText.length < 500) {
                                                            return hookText;
                                                        }
                                                    }
                                                }
                                            }
                                            return null;
                                        }
                                    """, script_element)
                                    
                                    if next_elements:
                                        log.debug(f"Hook –Ω–∞–π–¥–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–º —ç–ª–µ–º–µ–Ω—Ç–µ –ø–æ—Å–ª–µ Script")
                                        return next_elements
                            except:
                                pass
                            
                            # –°–ø–æ—Å–æ–± 3: –ò—â–µ–º Hook –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –ø–æ—Å–ª–µ Script
                            try:
                                # –ü–æ–ª—É—á–∞–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –∏—â–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω "Script...Hook"
                                page_text = await self.page.content()
                                # –ò—â–µ–º —á–µ—Ä–µ–∑ JavaScript –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ
                                hook_text = await self.page.evaluate("""
                                    () => {
                                        // –ò—â–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º "Script"
                                        const allElements = Array.from(document.querySelectorAll('*'));
                                        for (const el of allElements) {
                                            const text = el.innerText || '';
                                            if (text.includes('Script') || text.includes('–°—Ü–µ–Ω–∞—Ä–∏–π')) {
                                                // –ò—â–µ–º –≤ —ç—Ç–æ–º –∂–µ —ç–ª–µ–º–µ–Ω—Ç–µ –∏–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º "Hook" –∏–ª–∏ "Hooks"
                                                let searchEl = el;
                                                for (let depth = 0; depth < 3; depth++) {
                                                    const searchText = searchEl.innerText || '';
                                                    if (searchText.includes('Hook') || searchText.includes('Hooks') || 
                                                        searchText.includes('–•—É–∫') || searchText.includes('–•—É–∫–∏')) {
                                                        // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –º–µ–∂–¥—É Script –∏ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Å–µ–∫—Ü–∏—è–º–∏
                                                        const scriptIndex = searchText.indexOf('Script');
                                                        const hookIndex = searchText.indexOf('Hook', scriptIndex);
                                                        if (hookIndex > scriptIndex) {
                                                            let hookText = searchText.substring(hookIndex);
                                                            // –£–±–∏—Ä–∞–µ–º "Hook" –∏–ª–∏ "Hooks" –∏–∑ –Ω–∞—á–∞–ª–∞
                                                            hookText = hookText.replace(/^Hooks?\\s*:?\\s*/i, '');
                                                            hookText = hookText.replace(/^–•—É–∫–∏?\\s*:?\\s*/i, '');
                                                            // –£–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ü–∏–∏
                                                            const stopWords = ['Target Audience', 'First seen', 'Impressions', 'Country'];
                                                            for (const stop of stopWords) {
                                                                if (hookText.includes(stop)) {
                                                                    hookText = hookText.split(stop)[0];
                                                                }
                                                            }
                                                            hookText = hookText.replace(/Quality\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/Size\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/Resolution\\s*:?\\s*[^\\n]*/gi, '');
                                                            hookText = hookText.replace(/--/g, '');
                                                            hookText = hookText.replace(/\\n{2,}/g, '\\n').trim();
                                                            if (hookText && hookText.length > 5 && hookText.length < 500) {
                                                                return hookText;
                                                            }
                                                        }
                                                    }
                                                    searchEl = searchEl.parentElement;
                                                    if (!searchEl) break;
                                                }
                                            }
                                        }
                                        return null;
                                    }
                                """)
                                
                                if hook_text:
                                    log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ—Å–ª–µ Script")
                                    return hook_text
                            except:
                                pass
                    except:
                        continue
            except:
                pass
            
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (—Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±, –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ fallback)
            hook_keywords = ["Hooks", "Hook", "–•—É–∫–∏", "–•—É–∫"]
            
            for keyword in hook_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            parent_text = await locator.locator("..").inner_text()
                            if keyword in parent_text:
                                parts = parent_text.split(keyword, 1)
                                if len(parts) > 1:
                                    hook = parts[1].strip()
                                    # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –º–µ—Ç–∫–∏
                                    stop_words = ["Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", 
                                                "Transcript", "–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞", "Impressions", "–ü–æ–∫–∞–∑—ã",
                                                "Limited Time Offer", "Annual Plan", "Promotion Period", "50% OFF",
                                                "Privacy", "Terms", "Copyright", "PIPIADS", "All Rights Reserved",
                                                "AI-agent", "cosmobeauty", "credits", "subscription", "invoice",
                                                "Monthly Credits", "Extra Credits", "data cost", "detail costs",
                                                "Team Setting", "Affiliate Dashboard", "Logout"]
                                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                    footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                           "cosmobeauty", "credits", "subscription", "invoice", 
                                                           "Monthly Credits", "Extra Credits", "@gmail.com"]
                                    is_footer_menu = any(keyword in hook for keyword in footer_menu_keywords)
                                    
                                    for stop_word in stop_words:
                                        if stop_word in hook:
                                            hook = hook.split(stop_word)[0].strip()
                                    
                                    # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                    metadata_patterns = [
                                        r'Quality\s*:?\s*[^\n]*',
                                        r'Size\s*:?\s*[^\n]*',
                                        r'Resolution\s*:?\s*[^\n]*',
                                        r'Width\s*:?\s*[^\n]*',
                                        r'Height\s*:?\s*[^\n]*',
                                        r'Duration\s*:?\s*[^\n]*',
                                        r'Format\s*:?\s*[^\n]*',
                                        r'Codec\s*:?\s*[^\n]*',
                                        r'Frame Rate\s*:?\s*[^\n]*',
                                        r'--',  # –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                    ]
                                    for pattern in metadata_patterns:
                                        hook = re.sub(pattern, '', hook, flags=re.IGNORECASE)
                                    hook = re.sub(r'\n{2,}', '\n', hook).strip()  # –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                    
                                    if hook and len(hook) > 5 and not is_footer_menu:
                                        log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Ä–æ–¥–∏—Ç–µ–ª—å)")
                                        return hook
                        except:
                            pass
                        
                        # –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        try:
                            next_sibling = await locator.evaluate_handle("el => el.nextElementSibling")
                            if next_sibling:
                                hook = await next_sibling.as_element().inner_text()
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é
                                footer_menu_keywords = ["Privacy", "Terms", "Copyright", "PIPIADS", "AI-agent", 
                                                       "cosmobeauty", "credits", "subscription", "invoice", 
                                                       "Monthly Credits", "Extra Credits", "@gmail.com"]
                                is_footer_menu = any(keyword in hook for keyword in footer_menu_keywords)
                                
                                # –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                metadata_patterns = [
                                    r'Quality\s*:?\s*[^\n]*',
                                    r'Size\s*:?\s*[^\n]*',
                                    r'Resolution\s*:?\s*[^\n]*',
                                    r'Width\s*:?\s*[^\n]*',
                                    r'Height\s*:?\s*[^\n]*',
                                    r'Duration\s*:?\s*[^\n]*',
                                    r'Format\s*:?\s*[^\n]*',
                                    r'Codec\s*:?\s*[^\n]*',
                                    r'Frame Rate\s*:?\s*[^\n]*',
                                    r'--',  # –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                ]
                                for pattern in metadata_patterns:
                                    hook = re.sub(pattern, '', hook, flags=re.IGNORECASE)
                                hook = re.sub(r'\n{2,}', '\n', hook).strip()  # –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                
                                if hook and len(hook) > 5 and not is_footer_menu:
                                    log.debug(f"Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}' (—Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç)")
                                    return hook.strip()
                        except:
                            pass
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                hook = await self.page.evaluate("""
                    () => {
                        const keywords = ['Hooks', 'Hook', '–•—É–∫–∏', '–•—É–∫'];
                        const stopWords = ['Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 
                                         'Transcript', '–ê–Ω–∞–ª–∏–∑ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞', 'Impressions', '–ü–æ–∫–∞–∑—ã',
                                         'Script', '–°—Ü–µ–Ω–∞—Ä–∏–π', 'Analysis',
                                         'Limited Time Offer', 'Annual Plan', 'Promotion Period', '50% OFF'];
                        
                        // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    let hookText = null;
                                    
                                    // –°–ø–æ—Å–æ–± 1: –¢–µ–∫—Å—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ sibling —ç–ª–µ–º–µ–Ω—Ç–∞
                                    let nextSibling = el.nextElementSibling;
                                    if (nextSibling) {
                                        hookText = nextSibling.innerText || '';
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 2: –¢–µ–∫—Å—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    if (!hookText || hookText.length < 5) {
                                        const parentText = el.parentElement ? el.parentElement.innerText || '' : '';
                                        if (parentText.includes(keyword)) {
                                            const parts = parentText.split(keyword);
                                            if (parts.length > 1) {
                                                hookText = parts[1].trim();
                                            }
                                        }
                                    }
                                    
                                    // –°–ø–æ—Å–æ–± 3: –ò—â–µ–º –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö
                                    if (!hookText || hookText.length < 5) {
                                        const children = el.querySelectorAll('p, div, span');
                                        for (const child of children) {
                                            const childText = child.innerText || '';
                                            if (childText.length > 5 && childText.length < 200) {
                                                hookText = childText;
                                                break;
                                            }
                                        }
                                    }
                                    
                                    if (hookText) {
                                        // –£–±–∏—Ä–∞–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞
                                        for (const stopWord of stopWords) {
                                            if (hookText.includes(stopWord)) {
                                                hookText = hookText.split(stopWord)[0];
                                            }
                                        }
                                        
                                        hookText = hookText.trim();
                                        
                                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π hook (–∫–æ—Ä–æ—Ç–∫–∞—è —Ñ—Ä–∞–∑–∞, –Ω–µ –ø—Ä–æ–º–æ-—Ç–µ–∫—Å—Ç, –Ω–µ —Ñ—É—Ç–µ—Ä/–º–µ–Ω—é)
                                        const footerMenuKeywords = ['Privacy', 'Terms', 'Copyright', 'PIPIADS', 'All Rights Reserved',
                                                                   'AI-agent', 'cosmobeauty', 'credits', 'subscription', 'invoice',
                                                                   'Monthly Credits', 'Extra Credits', 'data cost', 'detail costs',
                                                                   'Team Setting', 'Affiliate Dashboard', 'Logout', '@gmail.com',
                                                                   'English', 'Fran√ßais', 'Deutsch', 'Espa√±ol', 'Portugu√™s'];
                                        const isFooterMenu = footerMenuKeywords.some(keyword => hookText.includes(keyword));
                                        
                                        // –£–±–∏—Ä–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∏–¥–µ–æ (Quality, Size, Resolution –∏ —Ç.–¥.)
                                        const metadataPatterns = [
                                            /Quality\s*:?\s*[^\n]*/gi,
                                            /Size\s*:?\s*[^\n]*/gi,
                                            /Resolution\s*:?\s*[^\n]*/gi,
                                            /Width\s*:?\s*[^\n]*/gi,
                                            /Height\s*:?\s*[^\n]*/gi,
                                            /Duration\s*:?\s*[^\n]*/gi,
                                            /Format\s*:?\s*[^\n]*/gi,
                                            /Codec\s*:?\s*[^\n]*/gi,
                                            /Frame Rate\s*:?\s*[^\n]*/gi,
                                            /--/g,  // –£–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ "--"
                                        ];
                                        let cleanedHook = hookText;
                                        for (const pattern of metadataPatterns) {
                                            cleanedHook = cleanedHook.replace(pattern, '');
                                        }
                                        cleanedHook = cleanedHook.replace(/\n{2,}/g, '\n').trim();  // –£–±–∏—Ä–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                                        
                                        if (cleanedHook && cleanedHook.length > 5 && cleanedHook.length < 300 &&
                                            !cleanedHook.includes('Limited Time Offer') &&
                                            !cleanedHook.includes('Annual Plan') &&
                                            !cleanedHook.includes('Promotion Period') &&
                                            !cleanedHook.includes('50% OFF') &&
                                            !cleanedHook.toLowerCase().includes('q4') &&
                                            !cleanedHook.toLowerCase().includes('monthly plan') &&
                                            !isFooterMenu) {
                                            return cleanedHook;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if hook and len(hook) > 5:
                    log.debug("Hook –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript")
                    return hook.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ hook —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ hook: {e}")
            return None
    
    async def _extract_audience(self) -> Optional[Dict[str, str]]:
        """
        –ò–∑–≤–ª–µ—á—å –≤–æ–∑—Ä–∞—Å—Ç –∏–∑ –ø–æ–ª—è Audience
        
        –°—Ç—Ä—É–∫—Ç—É—Ä–∞ HTML:
        <div class="addel-info-item">
            <div class="name"> Audience </div>
            <div class="value">
                <div class="audience-info">
                    <div class="audience-info-info">45-55 ... Android...</div>
                </div>
            </div>
        </div>
        """
        try:
            audience_data = {"age": "N/A", "platform": "N/A"}
            
            # –ú–ï–¢–û–î 1: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                # –ò—â–µ–º –±–ª–æ–∫ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º "Audience"
                audience_items = await self.page.query_selector_all('div.addel-info-item')
                
                for item in audience_items:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å Audience
                    name_elem = await item.query_selector('div.name')
                    if name_elem:
                        name_text = await name_elem.inner_text()
                        if 'Audience' in name_text or '–ê—É–¥–∏—Ç–æ—Ä–∏—è' in name_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ audience-info-info
                            audience_info = await item.query_selector('div.audience-info-info')
                            if audience_info:
                                text = await audience_info.inner_text()
                                # –ò–∑–≤–ª–µ–∫–∞–µ–º –≤–æ–∑—Ä–∞—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ "45-55" (–º–æ–∂–µ—Ç –±—ã—Ç—å 2 —Ü–∏—Ñ—Ä—ã)
                                age_match = re.search(r'(\d{1,2}-\d{1,2})', text)
                                if age_match:
                                    audience_data["age"] = age_match.group(1)
                                    log.debug(f"      ‚Üí Audience age –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä: {audience_data['age']}")
                                    return audience_data
            except Exception as e:
                log.debug(f"      ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–º –ø–æ–∏—Å–∫–µ audience: {e}")
            
            # –ú–ï–¢–û–î 2: Fallback —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã (–µ—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª)
            audience_keywords = ["Audience", "–ê—É–¥–∏—Ç–æ—Ä–∏—è", "Target Audience", "–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è"]
            
            for keyword in audience_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç –∞—É–¥–∏—Ç–æ—Ä–∏–∏ —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º –≤–æ–∑—Ä–∞—Å—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ "25-35" –∏–ª–∏ "45-55"
                        age_patterns = [
                            r'–í–æ–∑—Ä–∞—Å—Ç[:\s]+(\d{1,2}-\d{1,2})',
                            r'Age[:\s]+(\d{1,2}-\d{1,2})',
                            r'(\d{1,2}-\d{1,2})',  # –ü—Ä–æ—Å—Ç–æ –≤–æ–∑—Ä–∞—Å—Ç
                        ]
                        
                        for pattern in age_patterns:
                            age_match = re.search(pattern, text, re.IGNORECASE)
                            if age_match:
                                audience_data["age"] = age_match.group(1)
                                log.debug(f"      ‚Üí Audience age –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä: {audience_data['age']}")
                                break
                        
                        if audience_data["age"] != "N/A":
                            return audience_data
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π)
            try:
                result = await self.page.evaluate("""
                    () => {
                        const keywords = ['Target Audience', '–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è', 'Audience', '–ê—É–¥–∏—Ç–æ—Ä–∏—è'];
                        const agePattern = /(\\d{1,2}-\\d{1,2})/;
                        const platformKeywords = ['Android', 'iOS', 'iPhone', 'iPad'];
                        const countryKeywords = ['USA', 'US', 'United States', '–†–æ—Å—Å–∏—è', 'Russia', 'Philippines', 
                                                '–§–∏–ª–∏–ø–ø–∏–Ω—ã', 'China', '–ö–∏—Ç–∞–π', 'India', '–ò–Ω–¥–∏—è'];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    const result = {age: 'N/A', platform: 'N/A', country: 'N/A'};
                                    
                                    // –ò—â–µ–º –≤–æ–∑—Ä–∞—Å—Ç
                                    const ageMatch = text.match(agePattern);
                                    if (ageMatch) {
                                        result.age = ageMatch[1];
                                    }
                                    
                                    // –ò—â–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
                                    for (const platform of platformKeywords) {
                                        if (text.includes(platform)) {
                                            result.platform = (platform === 'iOS' || platform === 'iPhone' || platform === 'iPad') ? 'iOS' : 'Android';
                                            break;
                                        }
                                    }
                                    
                                    // –ò—â–µ–º —Å—Ç—Ä–∞–Ω—É
                                    for (const country of countryKeywords) {
                                        if (text.includes(country)) {
                                            result.country = country;
                                            break;
                                        }
                                    }
                                    
                                    if (result.age !== 'N/A' || result.platform !== 'N/A' || result.country !== 'N/A') {
                                        return result;
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if result:
                    audience_data.update(result)
                    return audience_data
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ audience —á–µ—Ä–µ–∑ JS: {e}")
            
            return audience_data
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –∞—É–¥–∏—Ç–æ—Ä–∏–∏: {e}")
            return None
    
    async def _extract_country(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å —Å—Ç—Ä–∞–Ω—É –∏–∑ –ø–æ–ª—è 'Country/Region' –∏–ª–∏ '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω' (–û–¢–î–ï–õ–¨–ù–û –æ—Ç Audience!)"""
        try:
            # –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            try:
                await self.page.wait_for_selector('div.addel-info-item', timeout=5000, state="visible")
            except:
                log.debug(f"      ‚Üí –≠–ª–µ–º–µ–Ω—Ç—ã div.addel-info-item –Ω–µ –ø–æ—è–≤–∏–ª–∏—Å—å –∑–∞ 5 —Å–µ–∫—É–Ω–¥")
            
            country_keywords = ["Country/Region", "–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω", "Country", "–°—Ç—Ä–∞–Ω–∞", "Region", "–†–µ–≥–∏–æ–Ω"]
            
            # –ú–ï–¢–û–î 0: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
            try:
                country_items = await self.page.query_selector_all('div.addel-info-item')
                
                for item in country_items:
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –±–ª–æ–∫ —Å Country/Region
                    name_elem = await item.query_selector('div.name')
                    if name_elem:
                        name_text = await name_elem.inner_text()
                        if 'Country/Region' in name_text or '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω' in name_text or 'Country' in name_text or '–°—Ç—Ä–∞–Ω–∞' in name_text:
                            # –ù–∞—à–ª–∏ –Ω—É–∂–Ω—ã–π –±–ª–æ–∫, –∏–∑–≤–ª–µ–∫–∞–µ–º —Å—Ç—Ä–∞–Ω—É
                            value_elem = await item.query_selector('div.ellipsis, div.value')
                            if value_elem:
                                country_text = await value_elem.inner_text()
                                # –£–±–∏—Ä–∞–µ–º (1) –∏ —Ç.–¥.
                                country = re.sub(r'\([0-9]+\)', '', country_text).strip()
                                if country and len(country) > 0:
                                    log.info(f"      ‚úÖ Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä: {country}")
                                    return country
            except Exception as e:
                log.debug(f"      ‚Üí –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–º –ø–æ–∏—Å–∫–µ country: {e}")
            
            for keyword in country_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω—ã —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º —Å—Ç—Ä–∞–Ω—É (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫)
                        country_patterns = [
                            r'United States(?:\([0-9]+\))?',  # United States(1)
                            r'USA(?:\([0-9]+\))?',
                            r'US(?:\([0-9]+\))?',
                            r'Philippines(?:\([0-9]+\))?',
                            r'–§–∏–ª–∏–ø–ø–∏–Ω—ã(?:\([0-9]+\))?',
                            r'Russia(?:\([0-9]+\))?',
                            r'–†–æ—Å—Å–∏—è(?:\([0-9]+\))?',
                            r'China(?:\([0-9]+\))?',
                            r'–ö–∏—Ç–∞–π(?:\([0-9]+\))?',
                            r'India(?:\([0-9]+\))?',
                            r'–ò–Ω–¥–∏—è(?:\([0-9]+\))?',
                            r'Brazil(?:\([0-9]+\))?',
                            r'–ë—Ä–∞–∑–∏–ª–∏—è(?:\([0-9]+\))?',
                            r'Germany(?:\([0-9]+\))?',
                            r'–ì–µ—Ä–º–∞–Ω–∏—è(?:\([0-9]+\))?',
                            r'France(?:\([0-9]+\))?',
                            r'–§—Ä–∞–Ω—Ü–∏—è(?:\([0-9]+\))?',
                            r'UK(?:\([0-9]+\))?',
                            r'United Kingdom(?:\([0-9]+\))?',
                        ]
                        
                        for pattern in country_patterns:
                            match = re.search(pattern, text, re.IGNORECASE)
                            if match:
                                country = match.group(0)
                                # –£–±–∏—Ä–∞–µ–º (1) –∏ —Ç.–¥.
                                country = re.sub(r'\([0-9]+\)', '', country).strip()
                                log.debug(f"Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}': {country}")
                                return country
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript
            try:
                country = await self.page.evaluate("""
                    () => {
                        const keywords = ['Country/Region', '–°—Ç—Ä–∞–Ω–∞/—Ä–µ–≥–∏–æ–Ω', 'Country', '–°—Ç—Ä–∞–Ω–∞'];
                        const countryPatterns = [
                            /United States(?:\\([0-9]+\\))?/i,
                            /USA(?:\\([0-9]+\\))?/i,
                            /Philippines(?:\\([0-9]+\\))?/i,
                            /Russia(?:\\([0-9]+\\))?/i,
                            /China(?:\\([0-9]+\\))?/i,
                            /India(?:\\([0-9]+\\))?/i
                        ];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    for (const pattern of countryPatterns) {
                                        const match = text.match(pattern);
                                        if (match) {
                                            return match[0].replace(/\\([0-9]+\\)/g, '').trim();
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if country:
                    log.debug(f"Country –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript: {country}")
                    return country.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ country —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ country: {e}")
            return None
    
    async def _extract_first_seen(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á—å First seen –≤ —Ñ–æ—Ä–º–∞—Ç–µ 'Oct 27 2025' - —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ 'Oct 28 2025 ~ Nov 10 2025'"""
        try:
            # –ú–µ—Ç–æ–¥ 1: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –ª–æ–∫–∞—Ç–æ—Ä—ã
            first_seen_keywords = ["First seen - Last seen", "First seen", "–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ", "First Seen"]
            
            for keyword in first_seen_keywords:
                try:
                    locator = self.page.locator(f'text=/{keyword}/i').first
                    if await locator.count() > 0:
                        # –ò—â–µ–º —Ç–µ–∫—Å—Ç –¥–∞—Ç—ã —Ä—è–¥–æ–º
                        text = await locator.locator("..").inner_text()
                        
                        # –ò—â–µ–º –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ "Oct 27 2025" –∏–ª–∏ "Oct 27, 2025"
                        # –ò—â–µ–º –ø–µ—Ä–≤—É—é –¥–∞—Ç—É –∏–∑ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ "Oct 28 2025 ~ Nov 10 2025"
                        date_patterns = [
                            r'([A-Z][a-z]{2}\s+\d{1,2}\s+\d{4})',  # Oct 27 2025
                            r'([A-Z][a-z]{2}\s+\d{1,2},\s+\d{4})',  # Oct 27, 2025
                            r'(\d{1,2}\s+[A-Z][a-z]{2}\s+\d{4})',  # 27 Oct 2025
                        ]
                        
                        for pattern in date_patterns:
                            # –ò—â–µ–º –ø–µ—Ä–≤—É—é –¥–∞—Ç—É (–¥–æ ~ –∏–ª–∏ –∫–æ–Ω—Ü–∞ —Å—Ç—Ä–æ–∫–∏)
                            date_match = re.search(pattern, text)
                            if date_match:
                                date_str = date_match.group(1)
                                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Ñ–æ—Ä–º–∞—Ç (—É–±–∏—Ä–∞–µ–º –∑–∞–ø—è—Ç—É—é –µ—Å–ª–∏ –µ—Å—Ç—å)
                                date_str = date_str.replace(',', '').strip()
                                log.debug(f"First seen –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ '{keyword}': {date_str}")
                                return date_str
                        
                        # –¢–∞–∫–∂–µ –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –¥–∞—Ç—É –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
                        if keyword in text:
                            parts = text.split(keyword, 1)
                            if len(parts) > 1:
                                # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–æ ~ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω)
                                after_keyword = parts[1].split('~')[0].strip()
                                for pattern in date_patterns:
                                    date_match = re.search(pattern, after_keyword)
                                    if date_match:
                                        date_str = date_match.group(1).replace(',', '').strip()
                                        log.debug(f"First seen –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ '{keyword}': {date_str}")
                                        return date_str
                except:
                    continue
            
            # –ú–µ—Ç–æ–¥ 2: –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ JavaScript (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π - –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ DOM)
            try:
                first_seen = await self.page.evaluate("""
                    () => {
                        const keywords = ['First seen - Last seen', 'First seen', '–í–ø–µ—Ä–≤—ã–µ –∑–∞–º–µ—á–µ–Ω–æ', 'First Seen'];
                        const datePatterns = [
                            /([A-Z][a-z]{2}\\s+\\d{1,2}\\s+\\d{4})/,  // Oct 27 2025
                            /([A-Z][a-z]{2}\\s+\\d{1,2},\\s+\\d{4})/,  // Oct 27, 2025
                            /(\\d{1,2}\\s+[A-Z][a-z]{2}\\s+\\d{4})/   // 27 Oct 2025
                        ];
                        
                        const allElements = document.querySelectorAll('*');
                        for (const el of allElements) {
                            const text = el.innerText || '';
                            
                            for (const keyword of keywords) {
                                if (text.includes(keyword)) {
                                    // –ò—â–µ–º –¥–∞—Ç—É –ø–æ—Å–ª–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                                    const index = text.indexOf(keyword);
                                    let afterKeyword = text.substring(index + keyword.length);
                                    
                                    // –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –¥–æ ~ (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω)
                                    if (afterKeyword.includes('~')) {
                                        afterKeyword = afterKeyword.split('~')[0];
                                    }
                                    
                                    for (const pattern of datePatterns) {
                                        const match = afterKeyword.match(pattern);
                                        if (match) {
                                            const dateStr = match[1].replace(',', '').trim();
                                            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–≤—É—é –Ω–∞–π–¥–µ–Ω–Ω—É—é –¥–∞—Ç—É (–±–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫ - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç –≤ _filter_videos)
                                            return dateStr;
                                        }
                                    }
                                }
                            }
                        }
                        return null;
                    }
                """)
                if first_seen:
                    log.debug(f"First seen –Ω–∞–π–¥–µ–Ω —á–µ—Ä–µ–∑ JavaScript: {first_seen}")
                    return first_seen.strip()
            except Exception as e:
                log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ first_seen —á–µ—Ä–µ–∑ JS: {e}")
            
            return None
            
        except Exception as e:
            log.debug(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ first_seen: {e}")
            return None


```

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞.

## –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞: —Ç–æ–≤–∞—Ä –∏—Å–∫–∞–ª—Å—è –ø–æ –∏–Ω–¥–µ–∫—Å—É, –∞ –Ω–µ –ø–æ URL
- –ë—ã–ª–æ: –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è `product_index`, —Ç–æ–≤–∞—Ä –∏—Å–∫–∞–ª—Å—è –ø–æ –∏–Ω–¥–µ–∫—Å—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- –ü—Ä–æ–±–ª–µ–º–∞: –ø–æ—Ä—è–¥–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –º–æ–≥ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å–æ —Å–ø–∏—Å–∫–æ–º `products`
- –†–µ—à–µ–Ω–∏–µ: —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è `product_url`, —Ç–æ–≤–∞—Ä –∏—â–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ URL

### –ò–∑–º–µ–Ω–µ–Ω–∏—è:
1. `get_product_details_with_return()` —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `product_url` –≤–º–µ—Å—Ç–æ `product_index`
2. –¢–æ–≤–∞—Ä –∏—â–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º—É URL
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ ban-list –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ –ø–æ–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ

## –ò—Ç–æ–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

1. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ ‚Äî –ø–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º—É URL
2. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –≤–∏–¥–µ–æ ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç `ad_search_url`
3. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ Script/Hook ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω retry (3 –ø–æ–ø—ã—Ç–∫–∏)
4. –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞ ‚Äî –ø–æ URL –≤–º–µ—Å—Ç–æ –∏–Ω–¥–µ–∫—Å–∞

## –ß—Ç–æ –¥–∞–ª—å—à–µ

–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –µ—â–µ —Ä–∞–∑. –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
- –¢–æ–≤–∞—Ä—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è
- –ö–∞–∂–¥—ã–π —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑
- –í–∏–¥–µ–æ –Ω–µ –¥–æ–ª–∂–Ω—ã –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è

–ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ (—É–±—Ä–∞—Ç—å –≤–æ–∑–≤—Ä–∞—Ç –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ).

–ó–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç –∏ –ø—Ä–∏—à–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

---

**User**

–æ–Ω —É–∂–µ –¥–∞–∂–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –∑–∞—Ö–æ–¥–∏—Ç. –Ø –Ω–∞–¥–µ—é—Å—å –±–∞–Ω —Å–ø–∏—Å–æ–∫ –æ—á–∏—â–∞–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏? 



–ø–æ–ø—ã—Ç–∫–∞:

PS C:\Users\Acer\Downloads\ProductRadar-main\ProductRadar-main> python test_parser_engine.py

2025-11-14 21:21:15 - BrowserManager - INFO - ============================================================

2025-11-14 21:21:15 - BrowserManager - INFO - –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï PARSER ENGINE

2025-11-14 21:21:15 - BrowserManager - INFO - ============================================================

2025-11-14 21:21:15 - BrowserManager - INFO -

1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞...

2025-11-14 21:21:15 - BrowserManager - INFO - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Playwright...

2025-11-14 21:21:16 - BrowserManager - INFO - ‚úÖ –ë—Ä–∞—É–∑–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω

2025-11-14 21:21:16 - BrowserManager - INFO - 

2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies...

2025-11-14 21:21:16 - BrowserManager - INFO - ‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ 21 cookies

2025-11-14 21:21:16 - BrowserManager - INFO -

3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads...

2025-11-14 21:21:16 - BrowserManager - INFO - –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc (–ø–æ–ø—ã—Ç–∫–∞ 1/3)

2025-11-14 21:21:23 - BrowserManager - INFO - ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ

2025-11-14 21:21:26 - BrowserManager - INFO - 

4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...

2025-11-14 21:21:26 - BrowserManager - INFO - ‚úÖ –£–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

2025-11-14 21:21:26 - BrowserManager - INFO - 

5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine...

2025-11-14 21:21:26 - BrowserManager - INFO -

6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets...

2025-11-14 21:21:26 - BrowserManager - INFO - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets...

2025-11-14 21:21:26 - BrowserManager - INFO - ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞

2025-11-14 21:21:29 - BrowserManager - INFO - ‚úÖ –¢–∞–±–ª–∏—Ü–∞ –æ—Ç–∫—Ä—ã—Ç–∞: Airtop –≤—ã–≥—Ä—É–∑–∫–∏

2025-11-14 21:21:30 - BrowserManager - INFO - ‚úÖ –õ–∏—Å—Ç '–ß–µ—Ä–Ω–æ–≤–∏–∫' –æ—Ç–∫—Ä—ã—Ç

2025-11-14 21:21:31 - BrowserManager - INFO - ‚úÖ –õ–∏—Å—Ç '–£—Å–ø–µ—à–Ω—ã–µ' –æ—Ç–∫—Ä—ã—Ç

2025-11-14 21:21:31 - BrowserManager - INFO - ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets —É—Å–ø–µ—à–Ω–æ

2025-11-14 21:21:31 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:31 - BrowserManager - INFO - 7. –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–û–í

2025-11-14 21:21:31 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:31 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:31 - BrowserManager - INFO - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã...

2025-11-14 21:21:31 - BrowserManager - INFO - –ü—Ä–æ–≥—Ä–µ—Å—Å: 0/3 —Ç–æ–≤–∞—Ä–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ, 0/15 –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ

2025-11-14 21:21:31 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:31 - BrowserManager - INFO - –ü–æ–ª—É—á–µ–Ω–∏–µ 20 —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–∏—Å–∫–∞...

2025-11-14 21:21:34 - BrowserManager - INFO - –°–∫—Ä–æ–ª–ª–∏–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç–æ–≤–∞—Ä–æ–≤...

2025-11-14 21:21:42 - BrowserManager - INFO - üîç –ù–∞–π–¥–µ–Ω–æ 60 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º 'a[href*="/tiktok-shop-product/"]'

2025-11-14 21:21:42 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #1: product_id=1729732622305364547, url=https://www.pipiads.com/tiktok-shop-product/1729732622305364547

2025-11-14 21:21:42 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 1: N/A... (ID: 1729732622305364547)

2025-11-14 21:21:42 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729732622305364547): https://www.pipiads.com/tiktok-shop-produuct/1729732622305364547

2025-11-14 21:21:42 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729732622305364547): https://www.pipiads.com/tiktok-shop-produuct/1729732622305364547

2025-11-14 21:21:42 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #2: product_id=1729992925351939069, url=https://www.pipiads.com/tiktok-shop-product/1729992925351939069

2025-11-14 21:21:42 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 2: N/A... (ID: 1729992925351939069)

2025-11-14 21:21:42 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729992925351939069): https://www.pipiads.com/tiktok-shop-produuct/1729992925351939069

2025-11-14 21:21:42 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729992925351939069): https://www.pipiads.com/tiktok-shop-produuct/1729992925351939069

2025-11-14 21:21:42 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #3: product_id=1730994090387212243, url=https://www.pipiads.com/tiktok-shop-product/1730994090387212243

2025-11-14 21:21:42 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 3: N/A... (ID: 1730994090387212243)

2025-11-14 21:21:42 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1730994090387212243): https://www.pipiads.com/tiktok-shop-produuct/1730994090387212243

2025-11-14 21:21:42 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1730994090387212243): https://www.pipiads.com/tiktok-shop-produuct/1730994090387212243

2025-11-14 21:21:42 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #4: product_id=1729882321617586962, url=https://www.pipiads.com/tiktok-shop-product/1729882321617586962

2025-11-14 21:21:42 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 4: N/A... (ID: 1729882321617586962)

2025-11-14 21:21:42 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729882321617586962): https://www.pipiads.com/tiktok-shop-produuct/1729882321617586962

2025-11-14 21:21:42 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729882321617586962): https://www.pipiads.com/tiktok-shop-produuct/1729882321617586962

2025-11-14 21:21:42 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #5: product_id=1731837917544875595, url=https://www.pipiads.com/tiktok-shop-product/1731837917544875595

2025-11-14 21:21:42 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 5: N/A... (ID: 1731837917544875595)

2025-11-14 21:21:42 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731837917544875595): https://www.pipiads.com/tiktok-shop-produuct/1731837917544875595

2025-11-14 21:21:42 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731837917544875595): https://www.pipiads.com/tiktok-shop-produuct/1731837917544875595

2025-11-14 21:21:42 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #6: product_id=1729603031836231024, url=https://www.pipiads.com/tiktok-shop-product/1729603031836231024

2025-11-14 21:21:43 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 6: N/A... (ID: 1729603031836231024)

2025-11-14 21:21:43 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729603031836231024): https://www.pipiads.com/tiktok-shop-produuct/1729603031836231024

2025-11-14 21:21:43 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729603031836231024): https://www.pipiads.com/tiktok-shop-produuct/1729603031836231024

2025-11-14 21:21:43 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #7: product_id=1730886966965209424, url=https://www.pipiads.com/tiktok-shop-product/1730886966965209424

2025-11-14 21:21:43 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 7: N/A... (ID: 1730886966965209424)

2025-11-14 21:21:43 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1730886966965209424): https://www.pipiads.com/tiktok-shop-produuct/1730886966965209424

2025-11-14 21:21:43 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1730886966965209424): https://www.pipiads.com/tiktok-shop-produuct/1730886966965209424

2025-11-14 21:21:43 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #8: product_id=1732177304007247394, url=https://www.pipiads.com/tiktok-shop-product/1732177304007247394

2025-11-14 21:21:43 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 8: N/A... (ID: 1732177304007247394)

2025-11-14 21:21:43 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1732177304007247394): https://www.pipiads.com/tiktok-shop-produuct/1732177304007247394

2025-11-14 21:21:43 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1732177304007247394): https://www.pipiads.com/tiktok-shop-produuct/1732177304007247394

2025-11-14 21:21:43 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #9: product_id=1730336399083801362, url=https://www.pipiads.com/tiktok-shop-product/1730336399083801362

2025-11-14 21:21:43 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 9: N/A... (ID: 1730336399083801362)

2025-11-14 21:21:43 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1730336399083801362): https://www.pipiads.com/tiktok-shop-produuct/1730336399083801362

2025-11-14 21:21:43 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1730336399083801362): https://www.pipiads.com/tiktok-shop-produuct/1730336399083801362

2025-11-14 21:21:43 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #10: product_id=1732278462162634274, url=https://www.pipiads.com/tiktok-shop-product/1732278462162634274

2025-11-14 21:21:43 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 10: N/A... (ID: 1732278462162634274)

2025-11-14 21:21:43 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1732278462162634274): https://www.pipiads.com/tiktok-shop-produuct/1732278462162634274

2025-11-14 21:21:43 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1732278462162634274): https://www.pipiads.com/tiktok-shop-produuct/1732278462162634274

2025-11-14 21:21:43 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #11: product_id=1732312451214640391, url=https://www.pipiads.com/tiktok-shop-product/1732312451214640391

2025-11-14 21:21:43 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 11: N/A... (ID: 1732312451214640391)

2025-11-14 21:21:43 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1732312451214640391): https://www.pipiads.com/tiktok-shop-produuct/1732312451214640391

2025-11-14 21:21:44 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1732312451214640391): https://www.pipiads.com/tiktok-shop-produuct/1732312451214640391

2025-11-14 21:21:44 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #12: product_id=1729870157239192011, url=https://www.pipiads.com/tiktok-shop-product/1729870157239192011

2025-11-14 21:21:44 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 12: N/A... (ID: 1729870157239192011)

2025-11-14 21:21:44 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729870157239192011): https://www.pipiads.com/tiktok-shop-produuct/1729870157239192011

2025-11-14 21:21:44 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729870157239192011): https://www.pipiads.com/tiktok-shop-produuct/1729870157239192011

2025-11-14 21:21:44 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #13: product_id=1731705908683179674, url=https://www.pipiads.com/tiktok-shop-product/1731705908683179674

2025-11-14 21:21:44 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 13: N/A... (ID: 1731705908683179674)

2025-11-14 21:21:44 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731705908683179674): https://www.pipiads.com/tiktok-shop-produuct/1731705908683179674

2025-11-14 21:21:44 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731705908683179674): https://www.pipiads.com/tiktok-shop-produuct/1731705908683179674

2025-11-14 21:21:44 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #14: product_id=1731158139588413926, url=https://www.pipiads.com/tiktok-shop-product/1731158139588413926

2025-11-14 21:21:44 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 14: N/A... (ID: 1731158139588413926)

2025-11-14 21:21:44 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731158139588413926): https://www.pipiads.com/tiktok-shop-produuct/1731158139588413926

2025-11-14 21:21:44 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731158139588413926): https://www.pipiads.com/tiktok-shop-produuct/1731158139588413926

2025-11-14 21:21:44 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #15: product_id=1731536666924188931, url=https://www.pipiads.com/tiktok-shop-product/1731536666924188931

2025-11-14 21:21:44 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 15: N/A... (ID: 1731536666924188931)

2025-11-14 21:21:44 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731536666924188931): https://www.pipiads.com/tiktok-shop-produuct/1731536666924188931

2025-11-14 21:21:44 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731536666924188931): https://www.pipiads.com/tiktok-shop-produuct/1731536666924188931

2025-11-14 21:21:44 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #16: product_id=1730186392032938533, url=https://www.pipiads.com/tiktok-shop-product/1730186392032938533

2025-11-14 21:21:44 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 16: N/A... (ID: 1730186392032938533)

2025-11-14 21:21:44 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1730186392032938533): https://www.pipiads.com/tiktok-shop-produuct/1730186392032938533

2025-11-14 21:21:44 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1730186392032938533): https://www.pipiads.com/tiktok-shop-produuct/1730186392032938533

2025-11-14 21:21:44 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #17: product_id=1731101132193432912, url=https://www.pipiads.com/tiktok-shop-product/1731101132193432912

2025-11-14 21:21:44 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 17: N/A... (ID: 1731101132193432912)

2025-11-14 21:21:44 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731101132193432912): https://www.pipiads.com/tiktok-shop-produuct/1731101132193432912

2025-11-14 21:21:44 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731101132193432912): https://www.pipiads.com/tiktok-shop-produuct/1731101132193432912

2025-11-14 21:21:45 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #18: product_id=1729606769780232427, url=https://www.pipiads.com/tiktok-shop-product/1729606769780232427

2025-11-14 21:21:45 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 18: N/A... (ID: 1729606769780232427)

2025-11-14 21:21:45 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729606769780232427): https://www.pipiads.com/tiktok-shop-produuct/1729606769780232427

2025-11-14 21:21:45 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1729606769780232427): https://www.pipiads.com/tiktok-shop-produuct/1729606769780232427

2025-11-14 21:21:45 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #19: product_id=1731287359289985573, url=https://www.pipiads.com/tiktok-shop-product/1731287359289985573

2025-11-14 21:21:45 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 19: N/A... (ID: 1731287359289985573)

2025-11-14 21:21:45 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731287359289985573): https://www.pipiads.com/tiktok-shop-produuct/1731287359289985573

2025-11-14 21:21:45 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–∞ (product_id=1731287359289985573): https://www.pipiads.com/tiktok-shop-produuct/1731287359289985573

2025-11-14 21:21:45 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ç–æ–≤–∞—Ä #20: product_id=1732278517077542434, url=https://www.pipiads.com/tiktok-shop-product/1732278517077542434

2025-11-14 21:21:45 - BrowserManager - INFO -    üì¶ –¢–æ–≤–∞—Ä 20: N/A... (ID: 1732278517077542434)

2025-11-14 21:21:45 - BrowserManager - INFO - ‚úÖ –ü–æ–ª—É—á–µ–Ω–æ 20 —Ç–æ–≤–∞—Ä–æ–≤

2025-11-14 21:21:45 - BrowserManager - INFO - ‚úÖ –ü–æ–ª—É—á–µ–Ω–æ 20 —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ

2025-11-14 21:21:45 - BrowserManager - INFO - ‚úÖ –ü–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏: 20 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

2025-11-14 21:21:45 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1729732622305364547

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 1/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:21:45 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:21:45 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1729732622305364547

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê: https://www.pipiads.com/tiktok-shop-product/1729732622305364547

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:21:45 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1729732622305364547

2025-11-14 21:21:45 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:21:45 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1729732622305364547

2025-11-14 21:21:45 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1729992925351939069

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 2/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:21:45 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:21:45 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1729992925351939069

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê: https://www.pipiads.com/tiktok-shop-product/1729992925351939069

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:21:45 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1729992925351939069

2025-11-14 21:21:45 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:21:45 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1729992925351939069

2025-11-14 21:21:45 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1730994090387212243

2025-11-14 21:21:45 - BrowserManager - INFO - 

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 3/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:21:45 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:21:45 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1730994090387212243

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê: https://www.pipiads.com/tiktok-shop-product/1730994090387212243

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:21:45 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1730994090387212243

2025-11-14 21:21:45 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:21:45 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1730994090387212243

2025-11-14 21:21:45 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1729882321617586962

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 4/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:21:45 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:21:45 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1729882321617586962

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê: https://www.pipiads.com/tiktok-shop-product/1729882321617586962

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:21:45 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1729882321617586962

2025-11-14 21:21:45 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:21:45 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1729882321617586962

2025-11-14 21:21:45 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1731837917544875595

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 5/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:21:45 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:21:45 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1731837917544875595

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê: https://www.pipiads.com/tiktok-shop-product/1731837917544875595

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:21:45 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1731837917544875595

2025-11-14 21:21:45 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:21:45 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1731837917544875595

2025-11-14 21:21:45 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1729603031836231024

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 6/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:21:45 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:21:45 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1729603031836231024

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê: https://www.pipiads.com/tiktok-shop-product/1729603031836231024

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:21:45 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1729603031836231024

2025-11-14 21:21:45 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:21:45 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1729603031836231024

2025-11-14 21:21:45 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1730886966965209424

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 7/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:21:45 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:21:45 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1730886966965209424

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê: https://www.pipiads.com/tiktok-shop-product/1730886966965209424

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:21:45 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1730886966965209424

2025-11-14 21:21:45 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:21:45 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1730886966965209424

2025-11-14 21:21:45 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1732177304007247394

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 8/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:21:45 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:21:45 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1732177304007247394

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê: https://www.pipiads.com/tiktok-shop-product/1732177304007247394

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:21:45 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1732177304007247394

2025-11-14 21:21:45 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:21:45 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1732177304007247394

2025-11-14 21:21:45 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1730336399083801362

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 9/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:21:45 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:21:45 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1730336399083801362

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê: https://www.pipiads.com/tiktok-shop-product/1730336399083801362

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:21:45 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1730336399083801362

2025-11-14 21:21:45 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:21:45 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1730336399083801362

2025-11-14 21:21:45 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1732278462162634274

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 10/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:21:45 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:21:45 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1732278462162634274

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê: https://www.pipiads.com/tiktok-shop-product/1732278462162634274

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:21:45 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1732278462162634274

2025-11-14 21:21:45 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:21:45 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1732278462162634274

2025-11-14 21:21:45 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1732312451214640391

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 11/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:21:45 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:21:45 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1732312451214640391

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê: https://www.pipiads.com/tiktok-shop-product/1732312451214640391

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:21:45 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1732312451214640391

2025-11-14 21:21:45 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:21:45 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1732312451214640391

2025-11-14 21:21:45 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1729870157239192011

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 12/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:21:45 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:21:45 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1729870157239192011

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê: https://www.pipiads.com/tiktok-shop-product/1729870157239192011

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:21:45 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1729870157239192011

2025-11-14 21:21:45 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:21:45 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1729870157239192011

2025-11-14 21:21:45 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1731705908683179674

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 13/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:21:45 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:21:45 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1731705908683179674

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê: https://www.pipiads.com/tiktok-shop-product/1731705908683179674

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:21:45 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1731705908683179674

2025-11-14 21:21:45 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:21:45 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1731705908683179674

2025-11-14 21:21:45 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1731158139588413926

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 14/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:21:45 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:21:45 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1731158139588413926

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê: https://www.pipiads.com/tiktok-shop-product/1731158139588413926

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:21:45 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1731158139588413926

2025-11-14 21:21:45 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:21:45 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1731158139588413926

2025-11-14 21:21:45 - BrowserManager - INFO -    ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π: https://www.pipiads.com/tiktok-shop-product/1731536666924188931

2025-11-14 21:21:45 - BrowserManager - INFO - 

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üì¶ –¢–û–í–ê–† 15/15 (—É—Å–ø–µ—à–Ω—ã—Ö: 0/3)

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - –ù–∞–∑–≤–∞–Ω–∏–µ: N/A...

2025-11-14 21:21:45 - BrowserManager - INFO - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: N/A

2025-11-14 21:21:45 - BrowserManager - INFO - URL: https://www.pipiads.com/tiktok-shop-product/1731536666924188931

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üîÑ –û–ë–†–ê–ë–û–¢–ö–ê –¢–û–í–ê–†–ê: https://www.pipiads.com/tiktok-shop-product/1731536666924188931

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO -   ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω URL –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã: https://www.pipiads.com/ru/tiktok-shop-product?time=7&categorize=601595,601733,873480,601613,601615,601616,601619,601602,601608,601609,601611,601610,601646,873736,601506,601511,2169232,978056,601490,601493,601492,601495,601494,601498,1003784,873864,873608,601686,601565,1004808,601627,601681,601644,601513,601516,981512,601469,806160,700789,1004168,601582,601585,601587,601586,601588,853264,601558,601560,601550,601552,601554,601556,601555,601529,601534,853520,601618,875144,601462,601461,601463,601737,874888&search_type=1&sales_trend=1&current_page=1&page_size=20&sort=5&sort_type=desc

2025-11-14 21:21:45 - BrowserManager - WARNING -   üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: https://www.pipiads.com/tiktok-shop-product/1731536666924188931

2025-11-14 21:21:45 - BrowserManager - WARNING -      –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.

2025-11-14 21:21:45 - BrowserManager - WARNING - üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): https://www.pipiads.com/tiktok-shop-product/1731536666924188931

2025-11-14 21:21:45 - BrowserManager - WARNING -

‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ (15 —Ç–æ–≤–∞—Ä–æ–≤)

2025-11-14 21:21:45 - BrowserManager - INFO -

================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üìä –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO - ‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: 0

2025-11-14 21:21:45 - BrowserManager - INFO - ‚è≠Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: 0

2025-11-14 21:21:45 - BrowserManager - INFO - üîç –í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: 15

2025-11-14 21:21:45 - BrowserManager - INFO - üö´ –¢–æ–≤–∞—Ä–æ–≤ –≤ ban-list: 15

2025-11-14 21:21:45 - BrowserManager - INFO - ================================================================================

2025-11-14 21:21:45 - BrowserManager - INFO -

üö´ BAN-LIST (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã):

2025-11-14 21:21:45 - BrowserManager - INFO -    1. https://www.pipiads.com/tiktok-shop-product/1729603031836231024

2025-11-14 21:21:45 - BrowserManager - INFO -    2. https://www.pipiads.com/tiktok-shop-product/1729732622305364547

2025-11-14 21:21:45 - BrowserManager - INFO -    3. https://www.pipiads.com/tiktok-shop-product/1729870157239192011

2025-11-14 21:21:45 - BrowserManager - INFO -    4. https://www.pipiads.com/tiktok-shop-product/1729882321617586962

2025-11-14 21:21:45 - BrowserManager - INFO -    5. https://www.pipiads.com/tiktok-shop-product/1729992925351939069

2025-11-14 21:21:45 - BrowserManager - INFO -    6. https://www.pipiads.com/tiktok-shop-product/1730336399083801362

2025-11-14 21:21:45 - BrowserManager - INFO -    7. https://www.pipiads.com/tiktok-shop-product/1730886966965209424

2025-11-14 21:21:45 - BrowserManager - INFO -    8. https://www.pipiads.com/tiktok-shop-product/1730994090387212243

2025-11-14 21:21:45 - BrowserManager - INFO -    9. https://www.pipiads.com/tiktok-shop-product/1731158139588413926

2025-11-14 21:21:45 - BrowserManager - INFO -    10. https://www.pipiads.com/tiktok-shop-product/1731536666924188931

2025-11-14 21:21:45 - BrowserManager - INFO -    11. https://www.pipiads.com/tiktok-shop-product/1731705908683179674

2025-11-14 21:21:45 - BrowserManager - INFO -    12. https://www.pipiads.com/tiktok-shop-product/1731837917544875595

2025-11-14 21:21:45 - BrowserManager - INFO -    13. https://www.pipiads.com/tiktok-shop-product/1732177304007247394

2025-11-14 21:21:45 - BrowserManager - INFO -    14. https://www.pipiads.com/tiktok-shop-product/1732278462162634274

2025-11-14 21:21:45 - BrowserManager - INFO -    15. https://www.pipiads.com/tiktok-shop-product/1732312451214640391

2025-11-14 21:21:45 - BrowserManager - WARNING -

‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ (15 —Ç–æ–≤–∞—Ä–æ–≤)

2025-11-14 21:21:45 - BrowserManager - WARNING -    –°–æ–±—Ä–∞–Ω–æ —Ç–æ–ª—å–∫–æ 0 —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ 3

2025-11-14 21:21:45 - BrowserManager - INFO -

============================================================

2025-11-14 21:21:45 - BrowserManager - INFO - üìù –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –≤–∏–¥–µ–æ...

2025-11-14 21:21:45 - BrowserManager - INFO - ============================================================

2025-11-14 21:21:45 - BrowserManager - INFO - ‚úÖ Summary —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω: logs/summaries/iteration_2025-11-14_21-21-45.md

2025-11-14 21:21:45 - BrowserManager - INFO -

============================================================

2025-11-14 21:21:45 - BrowserManager - INFO - ‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û

2025-11-14 21:21:45 - BrowserManager - INFO - ============================================================

2025-11-14 21:21:45 - BrowserManager - INFO -

‚è∏Ô∏è –û–∂–∏–¥–∞–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –±—Ä–∞—É–∑–µ—Ä–∞ (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)...

2025-11-14 21:21:45 - BrowserManager - INFO -    –ù–∞–∂–º–∏—Ç–µ Ctrl+C, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å —Ä–∞–Ω—å—à–µ

2025-11-14 21:21:56 - BrowserManager - INFO - –ë—Ä–∞—É–∑–µ—Ä –∑–∞–∫—Ä—ã—Ç

PS C:\Users\Acer\Downloads\ProductRadar-main\ProductRadar-main> 

---

**Cursor**

–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ ban-list –¥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `get_product_details_with_return` –æ–Ω —É–∂–µ —Ç–∞–º –∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è. –£–±–∏—Ä–∞—é –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ ban-list –¥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø–µ—Ä–µ–Ω–æ—à—É –µ–≥–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.


–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ ban-list –¥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `get_product_details_with_return` –æ–Ω —É–∂–µ —Ç–∞–º –∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è. –ü–µ—Ä–µ–Ω–æ—à—É –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ ban-list –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.


```python
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Parser Engine
"""

import asyncio
import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ src
sys.path.insert(0, str(Path(__file__).parent))

from src.browser_manager import BrowserManager
from src.parser_engine import ParserEngine, ProductData
from src.sheets_writer import SheetsWriter
from src import config
from src import logger

log = logger.get_logger("TestParserEngine")


async def test_parser_engine():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Parser Engine"""
    
    browser_manager = None
    try:
        log.info("=" * 60)
        log.info("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï PARSER ENGINE")
        log.info("=" * 60)
        
        # 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
        log.info("\n1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞...")
        browser_manager = BrowserManager()
        success = await browser_manager.initialize(headless=False)  # headful –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä")
            return
        
        # 2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies (–µ—Å–ª–∏ –µ—Å—Ç—å)
        log.info("\n2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies...")
        await browser_manager.load_cookies()
        
        # 3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–∞—á–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads
        log.info("\n3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads...")
        success = await browser_manager.navigate_with_retry(
            config.PIPIADS_INITIAL_URL,
            wait_until="domcontentloaded",
            timeout=30000
        )
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É")
            return
        
        await browser_manager.human_delay(2, 3)
        
        # 4. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
        log.info("\n4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...")
        is_logged_in = await browser_manager._check_logged_in_strict()
        if not is_logged_in:
            log.info("–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...")
            success = await browser_manager.login_to_pipiads()
            if not success:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è")
                return
            await browser_manager.save_cookies()
        else:
            log.info("‚úÖ –£–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω")
        
        # 5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine
        log.info("\n5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine...")
        parser = ParserEngine(browser_manager.page)
        parser.set_browser_manager(browser_manager)
        
        # 6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets (–¥–æ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤)
        log.info("\n6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets...")
        sheets_writer = None
        try:
            sheets_writer = SheetsWriter()
            if sheets_writer.connect():
                log.info("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets —É—Å–ø–µ—à–Ω–æ")
            else:
                log.warning("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Google Sheets, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        except Exception as e:
            log.warning(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Google Sheets: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        
        # 7. –¶–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        log.info("\n" + "=" * 80)
        log.info("7. –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–û–í")
        log.info("=" * 80)
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        # –£–°–õ–ê–ë–õ–ï–ù–û –¥–ª—è —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏: —Å–Ω–∏–∂–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
        MIN_PRODUCTS_TO_COLLECT = 3   # –¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–º–æ–∂–Ω–æ —Å–Ω–∏–∑–∏—Ç—å –¥–æ 1-2)
        MAX_PRODUCTS_TO_CHECK = 15     # –ú–∞–∫—Å–∏–º—É–º —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é (—É–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –≤—ã–±–æ—Ä–∞)
        PRODUCTS_PER_PAGE = 20         # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        
        successful_products = 0  # –°—á–µ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        checked_products = 0      # –°—á–µ—Ç—á–∏–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        skipped_products = []     # –°–ø–∏—Å–æ–∫ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        banned_products = set()   # Ban-list: URL —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ)
        all_products_analytics = []  # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –í–°–ï–• —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è summary-—Ñ–∞–π–ª–∞
        
        def normalize_url(url: str) -> str:
            """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL (—É–±—Ä–∞—Ç—å —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É)"""
            if not url:
                return ""
            url = url.strip().rstrip('/')
            # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if '?' in url:
                url = url.split('?')[0]
            return url
        
        # –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏
        while successful_products < MIN_PRODUCTS_TO_COLLECT and checked_products < MAX_PRODUCTS_TO_CHECK:
            
            # 7.1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
            log.info(f"\n{'='*80}")
            log.info(f"–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã...")
            log.info(f"–ü—Ä–æ–≥—Ä–µ—Å—Å: {successful_products}/{MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ, "
                    f"{checked_products}/{MAX_PRODUCTS_TO_CHECK} –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ")
            log.info(f"{'='*80}")
            
            try:
                products = await parser.get_products_from_search_page(count=PRODUCTS_PER_PAGE)
            except Exception as e:
                log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
                break
            
            if not products:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã, –∑–∞–≤–µ—Ä—à–∞–µ–º")
                break
            
            log.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
            
            # 7.1.5. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ URL (–ø—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è)
            # –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º banned_products –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
            unique_products = []
            duplicate_count = 0
            seen_urls = set()  # –î–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
            
            for product in products:
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ü—Ä–æ–ø—É—Å–∫ —Ç–æ–≤–∞—Ä–∞ –±–µ–∑ URL")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ç–∏–≤ banned_products (—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)
                if product_url in banned_products:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (—É–∂–µ –≤ ban-list): {product_url}")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
                if product_url in seen_urls:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (–≤ —Ç–µ–∫—É—â–µ–º —Å–ø–∏—Å–∫–µ): {product_url}")
                    continue
                
                seen_urls.add(product_url)
                # –û–±–Ω–æ–≤–ª—è–µ–º URL –≤ —Å–ª–æ–≤–∞—Ä–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π
                product['url'] = product_url
                unique_products.append(product)
            
            if duplicate_count > 0:
                log.info(f"üîç –ù–∞–π–¥–µ–Ω–æ {duplicate_count} –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, –æ—Å—Ç–∞–≤–ª–µ–Ω–æ {len(unique_products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤")
            
            products = unique_products  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
            log.info(f"‚úÖ –ü–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏: {len(products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            
            # 7.2. –¶–∏–∫–ª –ø–æ —Ç–æ–≤–∞—Ä–∞–º –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            for product_index, product in enumerate(products):
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    log.info(f"\nüéØ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
                    break
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
                if checked_products >= MAX_PRODUCTS_TO_CHECK:
                    log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
                    break
                
                # ‚ö†Ô∏è –ü–†–û–í–ï–†–ö–ê BAN-LIST: –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                    continue
                
                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
                if product_url in banned_products:
                    log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: {product_url}")
                    log.warning(f"   –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.")
                    continue
                
                checked_products += 1
                
                # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–∞
                log.info(f"\n{'='*80}")
                log.info(f"üì¶ –¢–û–í–ê–† {checked_products}/{MAX_PRODUCTS_TO_CHECK} "
                        f"(—É—Å–ø–µ—à–Ω—ã—Ö: {successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                log.info(f"{'='*80}")
                log.info(f"–ù–∞–∑–≤–∞–Ω–∏–µ: {product.get('name', 'N/A')[:70]}...")
                log.info(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {product.get('category', 'N/A')}")
                log.info(f"URL: {product_url}")
                
                try:
                    # 7.3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ (–ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ URL)
                    # –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥–∞–µ–º banned_products –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
                    product_data = await parser.get_product_details_with_return(
                        product_url=product_url,
                        sheets_writer=sheets_writer,
                        banned_products=banned_products
                    )
                    
                    # 7.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    if product_data is None:
                        # –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
                        log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞")
                        
                        skipped_products.append({
                            "name": product.get('name', 'N/A'),
                            "reason": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ",
                            "videos_found": 0
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ)
                        all_products_analytics.append({
                            "product_name": product.get('name', 'N/A'),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": 0,
                            "top_3_videos": []
                        })
                        continue
                    
                    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç (–µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª—Å—è —Å—Ç–∞—Ç—É—Å "duplicate")
                    if isinstance(product_data, dict) and product_data.get("status") == "duplicate":
                        duplicate_url = product_data.get('product_url', 'N/A')
                        log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): {duplicate_url}")
                        duplicate_count += 1
                        continue
                    
                    if isinstance(product_data, dict) and product_data.get("status") == "insufficient_videos":
                        # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                        log.warning(f"‚è≠Ô∏è  –ü–†–û–ü–£–°–ö: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù–∞–π–¥–µ–Ω–æ: {product_data.get('videos_found', 0)} –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù—É–∂–Ω–æ: {product_data.get('videos_required', 3)} –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": product_data.get('product_name', product.get('name', 'N/A')),
                            "reason": product_data.get('reason', '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ'),
                            "videos_found": product_data.get('videos_found', 0)
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ - —Ç–æ–≤–∞—Ä –≤–µ—Ä–Ω—É–ª insufficient_videos)
                        all_products_analytics.append({
                            "product_name": product_data.get('product_name', product.get('name', 'N/A')),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": product_data.get('videos_found', 0),
                            "top_3_videos": []  # –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–ø-3
                        })
                        continue
                    
                    # 7.5. –°–±–æ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è summary
                    analytics_entry = {
                        "product_name": getattr(product_data, 'product_name', 'N/A'),
                        "product_url": getattr(product_data, 'pipiads_link', product_url),
                        "success": False,
                        "videos_found": len(getattr(product_data, 'videos', [])),
                        "top_3_videos": []
                    }
                    
                    # –ò–∑–≤–ª–µ–∫–∞–µ–º –¢–û–ü-3 –≤–∏–¥–µ–æ (–ø–æ impression) –∏–∑ –í–°–ï–• –≤–∏–¥–µ–æ
                    if hasattr(product_data, '_all_videos_raw'):
                        all_videos = product_data._all_videos_raw
                        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ impression (desc) –∏ –±–µ—Ä–µ–º —Ç–æ–ø-3
                        sorted_videos = sorted(all_videos, key=lambda v: v.get('impression', 0), reverse=True)
                        for i, video in enumerate(sorted_videos[:3], 1):
                            analytics_entry["top_3_videos"].append({
                                "rank": i,
                                "impression": video.get('impression', 0),
                                "first_seen": video.get('first_seen', 'N/A'),
                                "ad_search_url": video.get('ad_search_url', 'N/A')
                            })
                    
                    # 7.6. –£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞
                    if hasattr(product_data, 'videos') and len(product_data.videos) >= 3:
                        successful_products += 1
                        analytics_entry["success"] = True
                        
                        log.info(f"\n‚úÖ –£–°–ü–ï–•! –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω ({successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                        log.info(f"   –ù–∞–∑–≤–∞–Ω–∏–µ: {product_data.product_name[:70]}...")
                        log.info(f"   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ: {len(product_data.videos)}")
                        
                        # –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                        for i, video in enumerate(product_data.videos[:3], 1):
                            log.info(f"   –í–∏–¥–µ–æ {i}: {video.get('impression', 0)} impressions, "
                                    f"{video.get('country', 'N/A')}, {video.get('audience_age', 'N/A')}")
                        
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ –∏ –∫–æ–ø–∏—Ä—É–µ–º –≤ "–£—Å–ø–µ—à–Ω—ã–µ" –µ—Å–ª–∏ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                        if sheets_writer and hasattr(product_data, '_sheets_row'):
                            try:
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã A-Z (–∫—Ä–æ–º–µ C) –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                                if sheets_writer.is_row_complete(product_data._sheets_row):
                                    sheets_writer.copy_to_success_sheet(product_data._sheets_row)
                                    log.info(f"  ‚úÖ –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ ‚Üí —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ '–£—Å–ø–µ—à–Ω—ã–µ'")
                                else:
                                    log.warning(f"  ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ (–µ—Å—Ç—å –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏)")
                            except Exception as e:
                                log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ '–£—Å–ø–µ—à–Ω—ã–µ': {e}")
                    
                    # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
                    all_products_analytics.append(analytics_entry)
                    
                    # 7.7. –ï—Å–ª–∏ –≤–∏–¥–µ–æ –º–µ–Ω—å—à–µ 3 - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                    if not analytics_entry["success"]:
                        log.warning(f"‚ö†Ô∏è –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω, –Ω–æ –º–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": getattr(product_data, 'product_name', product.get('name', 'N/A')),
                            "reason": "–ú–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏",
                            "videos_found": len(getattr(product_data, 'videos', []))
                        })
                
                except Exception as e:
                    log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞: {e}")
                    import traceback
                    log.error(traceback.format_exc())
                    
                    skipped_products.append({
                        "name": product.get('name', 'N/A'),
                        "reason": f"–ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {str(e)[:50]}",
                        "videos_found": 0
                    })
            
            # 7.6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –≤—ã—Ö–æ–¥–∞ –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
            if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                break
            
            if checked_products >= MAX_PRODUCTS_TO_CHECK:
                break
        
        # 8. –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç
        log.info(f"\n{'='*80}")
        log.info("üìä –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢")
        log.info(f"{'='*80}")
        log.info(f"‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {successful_products}")
        log.info(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {len(skipped_products)}")
        log.info(f"üîç –í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {checked_products}")
        log.info(f"üö´ –¢–æ–≤–∞—Ä–æ–≤ –≤ ban-list: {len(banned_products)}")
        log.info(f"{'='*80}")
        
        # –í—ã–≤–æ–¥ ban-list
        if banned_products:
            log.info(f"\nüö´ BAN-LIST (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã):")
            for i, product_url in enumerate(sorted(banned_products), 1):
                log.info(f"   {i}. {product_url}")
        
        if skipped_products:
            log.info(f"\n‚è≠Ô∏è  –°–ü–ò–°–û–ö –ü–†–û–ü–£–©–ï–ù–ù–´–• –¢–û–í–ê–†–û–í:")
            for i, skipped in enumerate(skipped_products, 1):
                log.info(f"   {i}. {skipped['name'][:60]}...")
                log.info(f"      –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}")
                log.info(f"      –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}")
        
        if successful_products >= MIN_PRODUCTS_TO_COLLECT:
            log.info(f"\nüéâ –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
        elif checked_products >= MAX_PRODUCTS_TO_CHECK:
            log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
            log.warning(f"   –°–æ–±—Ä–∞–Ω–æ —Ç–æ–ª—å–∫–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ {MIN_PRODUCTS_TO_COLLECT}")
        
        # 9. –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
        log.info("\n" + "=" * 60)
        log.info("üìù –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –≤–∏–¥–µ–æ...")
        log.info("=" * 60)
        try:
            from datetime import datetime
            import os
            
            summary_dir = "logs/summaries"
            os.makedirs(summary_dir, exist_ok=True)
            
            timestamp = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
            summary_file = f"{summary_dir}/iteration_{timestamp}.md"
            
            with open(summary_file, "w", encoding="utf-8") as f:
                f.write(f"# üìä –ò—Ç–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
                
                f.write("## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã\n\n")
                f.write(f"- **–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ:** {successful_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–ø—É—â–µ–Ω–æ:** {len(skipped_products)} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** {checked_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **Ban-list:** {len(banned_products)} —Ç–æ–≤–∞—Ä–æ–≤\n\n")
                
                if successful_products > 0:
                    f.write("### üéâ SUCCESS\n\n")
                    f.write(f"‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ —Å >= 3 –≤–∏–¥–µ–æ\n\n")
                
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                # –ù–û–í–´–ô –ë–õ–û–ö: –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                if all_products_analytics:
                    f.write("---\n\n")
                    f.write("## üìπ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º\n\n")
                    f.write(f"**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:** >= 5K impressions, –≤–æ–∑—Ä–∞—Å—Ç <= 30 –¥–Ω–µ–π\n\n")
                    
                    for idx, product in enumerate(all_products_analytics, 1):
                        status_icon = "‚úÖ" if product["success"] else "‚ùå"
                        f.write(f"### {status_icon} –¢–æ–≤–∞—Ä #{idx}: {product['product_name'][:80]}\n\n")
                        f.write(f"- **–°—Å—ã–ª–∫–∞:** [{product['product_url']}]({product['product_url']})\n")
                        f.write(f"- **–°—Ç–∞—Ç—É—Å:** {'–£–°–ü–ï–• (>= 3 –≤–∏–¥–µ–æ)' if product['success'] else '–ü–†–û–ü–£–©–ï–ù (< 3 –≤–∏–¥–µ–æ)'}\n")
                        f.write(f"- **–ù–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ:** {product['videos_found']}\n\n")
                        
                        # –¢–û–ü-3 –≤–∏–¥–µ–æ (–¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –∫—Ä–∏—Ç–µ—Ä–∏–∏)
                        if product['top_3_videos']:
                            f.write("#### üèÜ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ impression:\n\n")
                            for video in product['top_3_videos']:
                                impression = video['impression']
                                first_seen = video['first_seen']
                                ad_url = video['ad_search_url']
                                
                                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
                                meets_criteria = impression >= 5000  # –ü—Ä–æ–≤–µ—Ä–∫–∞ impression
                                criteria_icon = "‚úÖ" if meets_criteria else "‚ö†Ô∏è"
                                
                                f.write(f"{video['rank']}. {criteria_icon} **{impression:,} impressions** | "
                                       f"First seen: {first_seen}\n")
                                if ad_url and ad_url != 'N/A':
                                    f.write(f"   - –°—Å—ã–ª–∫–∞: [{ad_url}]({ad_url})\n")
                                f.write("\n")
                        else:
                            f.write("   ‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ (–≤–æ–∑–º–æ–∂–Ω–æ, –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞)\n\n")
                        
                        f.write("---\n\n")
                
                # –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
                if skipped_products:
                    f.write("### ‚è≠Ô∏è –ü–†–û–ü–£–©–ï–ù–ù–´–ï –¢–û–í–ê–†–´ (–∫—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫)\n\n")
                    for i, skipped in enumerate(skipped_products, 1):
                        f.write(f"{i}. **{skipped['name'][:60]}...**\n")
                        f.write(f"   - –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}\n")
                        f.write(f"   - –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}\n\n")
                
                # Ban-list
                if banned_products:
                    f.write("### üö´ Ban-list (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)\n\n")
                    for i, product_url in enumerate(sorted(banned_products), 1):
                        f.write(f"{i}. `{product_url}`\n")
                    f.write("\n")
                
                f.write("## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏\n\n")
                f.write(f"- **–¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:** {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–õ–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫:** {MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤–∏–¥–µ–æ:** >= 5K impressions, <= 30 –¥–Ω–µ–π\n\n")
                
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    f.write("## üéØ –°—Ç–∞—Ç—É—Å: –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê ‚úÖ\n\n")
                elif checked_products >= MAX_PRODUCTS_TO_CHECK:
                    f.write("## ‚ö†Ô∏è –°—Ç–∞—Ç—É—Å: –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫\n\n")
                else:
                    f.write("## ‚ùå –°—Ç–∞—Ç—É—Å: –ü—Ä–µ—Ä–≤–∞–Ω–æ\n\n")
            
            log.info(f"‚úÖ Summary —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {summary_file}")
        except Exception as e:
            log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ summary: {e}")
            import traceback
            log.error(traceback.format_exc())
        
        log.info("\n" + "=" * 60)
        log.info("‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û")
        log.info("=" * 60)
        
        # –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)
        log.info("\n‚è∏Ô∏è –û–∂–∏–¥–∞–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –±—Ä–∞—É–∑–µ—Ä–∞ (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)...")
        log.info("   –ù–∞–∂–º–∏—Ç–µ Ctrl+C, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å —Ä–∞–Ω—å—à–µ")
        try:
            await asyncio.sleep(10)
        except KeyboardInterrupt:
            log.info("   –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        
    except KeyboardInterrupt:
        log.warning("\n‚ö†Ô∏è –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Ctrl+C)")
    except Exception as e:
        log.error(f"\n{'='*60}")
        log.error(f"‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}")
        log.error(f"{'='*60}")
        import traceback
        log.error("–ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:")
        log.error(traceback.format_exc())
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
        if browser_manager and browser_manager.page:
            try:
                screenshot_path = config.SCREENSHOTS_DIR / f"error_test_{int(asyncio.get_event_loop().time())}.png"
                await browser_manager.page.screenshot(path=str(screenshot_path), full_page=True)
                log.info(f"üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {screenshot_path}")
            except Exception as e2:
                log.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç: {e2}")
        
        log.error("\n‚ö†Ô∏è –ë—Ä–∞—É–∑–µ—Ä –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞ 30 —Å–µ–∫—É–Ω–¥...")
        try:
            await asyncio.sleep(30)
        except:
            pass
    
    finally:
        if browser_manager:
            await browser_manager.close()


if __name__ == "__main__":
    asyncio.run(test_parser_engine())


```

–î–æ–±–∞–≤–ª—è—é —Ç–æ–≤–∞—Ä –≤ ban-list –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞):


```python
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Parser Engine
"""

import asyncio
import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ src
sys.path.insert(0, str(Path(__file__).parent))

from src.browser_manager import BrowserManager
from src.parser_engine import ParserEngine, ProductData
from src.sheets_writer import SheetsWriter
from src import config
from src import logger

log = logger.get_logger("TestParserEngine")


async def test_parser_engine():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Parser Engine"""
    
    browser_manager = None
    try:
        log.info("=" * 60)
        log.info("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï PARSER ENGINE")
        log.info("=" * 60)
        
        # 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
        log.info("\n1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞...")
        browser_manager = BrowserManager()
        success = await browser_manager.initialize(headless=False)  # headful –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä")
            return
        
        # 2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies (–µ—Å–ª–∏ –µ—Å—Ç—å)
        log.info("\n2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies...")
        await browser_manager.load_cookies()
        
        # 3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–∞—á–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads
        log.info("\n3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads...")
        success = await browser_manager.navigate_with_retry(
            config.PIPIADS_INITIAL_URL,
            wait_until="domcontentloaded",
            timeout=30000
        )
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É")
            return
        
        await browser_manager.human_delay(2, 3)
        
        # 4. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
        log.info("\n4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...")
        is_logged_in = await browser_manager._check_logged_in_strict()
        if not is_logged_in:
            log.info("–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...")
            success = await browser_manager.login_to_pipiads()
            if not success:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è")
                return
            await browser_manager.save_cookies()
        else:
            log.info("‚úÖ –£–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω")
        
        # 5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine
        log.info("\n5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine...")
        parser = ParserEngine(browser_manager.page)
        parser.set_browser_manager(browser_manager)
        
        # 6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets (–¥–æ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤)
        log.info("\n6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets...")
        sheets_writer = None
        try:
            sheets_writer = SheetsWriter()
            if sheets_writer.connect():
                log.info("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets —É—Å–ø–µ—à–Ω–æ")
            else:
                log.warning("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Google Sheets, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        except Exception as e:
            log.warning(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Google Sheets: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        
        # 7. –¶–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        log.info("\n" + "=" * 80)
        log.info("7. –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–û–í")
        log.info("=" * 80)
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        # –£–°–õ–ê–ë–õ–ï–ù–û –¥–ª—è —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏: —Å–Ω–∏–∂–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
        MIN_PRODUCTS_TO_COLLECT = 3   # –¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–º–æ–∂–Ω–æ —Å–Ω–∏–∑–∏—Ç—å –¥–æ 1-2)
        MAX_PRODUCTS_TO_CHECK = 15     # –ú–∞–∫—Å–∏–º—É–º —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é (—É–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –≤—ã–±–æ—Ä–∞)
        PRODUCTS_PER_PAGE = 20         # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        
        successful_products = 0  # –°—á–µ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        checked_products = 0      # –°—á–µ—Ç—á–∏–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        skipped_products = []     # –°–ø–∏—Å–æ–∫ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        banned_products = set()   # Ban-list: URL —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ)
        all_products_analytics = []  # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –í–°–ï–• —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è summary-—Ñ–∞–π–ª–∞
        
        def normalize_url(url: str) -> str:
            """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL (—É–±—Ä–∞—Ç—å —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É)"""
            if not url:
                return ""
            url = url.strip().rstrip('/')
            # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if '?' in url:
                url = url.split('?')[0]
            return url
        
        # –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏
        while successful_products < MIN_PRODUCTS_TO_COLLECT and checked_products < MAX_PRODUCTS_TO_CHECK:
            
            # 7.1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
            log.info(f"\n{'='*80}")
            log.info(f"–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã...")
            log.info(f"–ü—Ä–æ–≥—Ä–µ—Å—Å: {successful_products}/{MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ, "
                    f"{checked_products}/{MAX_PRODUCTS_TO_CHECK} –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ")
            log.info(f"{'='*80}")
            
            try:
                products = await parser.get_products_from_search_page(count=PRODUCTS_PER_PAGE)
            except Exception as e:
                log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
                break
            
            if not products:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã, –∑–∞–≤–µ—Ä—à–∞–µ–º")
                break
            
            log.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
            
            # 7.1.5. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ URL (–ø—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è)
            # –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º banned_products –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
            unique_products = []
            duplicate_count = 0
            seen_urls = set()  # –î–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
            
            for product in products:
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ü—Ä–æ–ø—É—Å–∫ —Ç–æ–≤–∞—Ä–∞ –±–µ–∑ URL")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ç–∏–≤ banned_products (—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)
                if product_url in banned_products:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (—É–∂–µ –≤ ban-list): {product_url}")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
                if product_url in seen_urls:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (–≤ —Ç–µ–∫—É—â–µ–º —Å–ø–∏—Å–∫–µ): {product_url}")
                    continue
                
                seen_urls.add(product_url)
                # –û–±–Ω–æ–≤–ª—è–µ–º URL –≤ —Å–ª–æ–≤–∞—Ä–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π
                product['url'] = product_url
                unique_products.append(product)
            
            if duplicate_count > 0:
                log.info(f"üîç –ù–∞–π–¥–µ–Ω–æ {duplicate_count} –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, –æ—Å—Ç–∞–≤–ª–µ–Ω–æ {len(unique_products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤")
            
            products = unique_products  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
            log.info(f"‚úÖ –ü–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏: {len(products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            
            # 7.2. –¶–∏–∫–ª –ø–æ —Ç–æ–≤–∞—Ä–∞–º –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            for product_index, product in enumerate(products):
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    log.info(f"\nüéØ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
                    break
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
                if checked_products >= MAX_PRODUCTS_TO_CHECK:
                    log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
                    break
                
                # ‚ö†Ô∏è –ü–†–û–í–ï–†–ö–ê BAN-LIST: –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                    continue
                
                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
                if product_url in banned_products:
                    log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: {product_url}")
                    log.warning(f"   –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.")
                    continue
                
                checked_products += 1
                
                # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–∞
                log.info(f"\n{'='*80}")
                log.info(f"üì¶ –¢–û–í–ê–† {checked_products}/{MAX_PRODUCTS_TO_CHECK} "
                        f"(—É—Å–ø–µ—à–Ω—ã—Ö: {successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                log.info(f"{'='*80}")
                log.info(f"–ù–∞–∑–≤–∞–Ω–∏–µ: {product.get('name', 'N/A')[:70]}...")
                log.info(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {product.get('category', 'N/A')}")
                log.info(f"URL: {product_url}")
                
                try:
                    # 7.3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ (–ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ URL)
                    # –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥–∞–µ–º banned_products –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
                    product_data = await parser.get_product_details_with_return(
                        product_url=product_url,
                        sheets_writer=sheets_writer,
                        banned_products=banned_products
                    )
                    
                    # –ö–†–ò–¢–ò–ß–ù–û: –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä –≤ ban-list –ü–û–°–õ–ï –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)
                    banned_products.add(product_url)
                    log.info(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–û–°–õ–ï –æ–±—Ä–∞–±–æ—Ç–∫–∏: {product_url}")
                    
                    # 7.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    if product_data is None:
                        # –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
                        log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞")
                        
                        skipped_products.append({
                            "name": product.get('name', 'N/A'),
                            "reason": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ",
                            "videos_found": 0
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ)
                        all_products_analytics.append({
                            "product_name": product.get('name', 'N/A'),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": 0,
                            "top_3_videos": []
                        })
                        continue
                    
                    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç (–µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª—Å—è —Å—Ç–∞—Ç—É—Å "duplicate")
                    if isinstance(product_data, dict) and product_data.get("status") == "duplicate":
                        duplicate_url = product_data.get('product_url', 'N/A')
                        log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): {duplicate_url}")
                        duplicate_count += 1
                        continue
                    
                    if isinstance(product_data, dict) and product_data.get("status") == "insufficient_videos":
                        # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                        log.warning(f"‚è≠Ô∏è  –ü–†–û–ü–£–°–ö: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù–∞–π–¥–µ–Ω–æ: {product_data.get('videos_found', 0)} –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù—É–∂–Ω–æ: {product_data.get('videos_required', 3)} –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": product_data.get('product_name', product.get('name', 'N/A')),
                            "reason": product_data.get('reason', '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ'),
                            "videos_found": product_data.get('videos_found', 0)
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ - —Ç–æ–≤–∞—Ä –≤–µ—Ä–Ω—É–ª insufficient_videos)
                        all_products_analytics.append({
                            "product_name": product_data.get('product_name', product.get('name', 'N/A')),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": product_data.get('videos_found', 0),
                            "top_3_videos": []  # –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–ø-3
                        })
                        continue
                    
                    # 7.5. –°–±–æ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è summary
                    analytics_entry = {
                        "product_name": getattr(product_data, 'product_name', 'N/A'),
                        "product_url": getattr(product_data, 'pipiads_link', product_url),
                        "success": False,
                        "videos_found": len(getattr(product_data, 'videos', [])),
                        "top_3_videos": []
                    }
                    
                    # –ò–∑–≤–ª–µ–∫–∞–µ–º –¢–û–ü-3 –≤–∏–¥–µ–æ (–ø–æ impression) –∏–∑ –í–°–ï–• –≤–∏–¥–µ–æ
                    if hasattr(product_data, '_all_videos_raw'):
                        all_videos = product_data._all_videos_raw
                        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ impression (desc) –∏ –±–µ—Ä–µ–º —Ç–æ–ø-3
                        sorted_videos = sorted(all_videos, key=lambda v: v.get('impression', 0), reverse=True)
                        for i, video in enumerate(sorted_videos[:3], 1):
                            analytics_entry["top_3_videos"].append({
                                "rank": i,
                                "impression": video.get('impression', 0),
                                "first_seen": video.get('first_seen', 'N/A'),
                                "ad_search_url": video.get('ad_search_url', 'N/A')
                            })
                    
                    # 7.6. –£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞
                    if hasattr(product_data, 'videos') and len(product_data.videos) >= 3:
                        successful_products += 1
                        analytics_entry["success"] = True
                        
                        log.info(f"\n‚úÖ –£–°–ü–ï–•! –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω ({successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                        log.info(f"   –ù–∞–∑–≤–∞–Ω–∏–µ: {product_data.product_name[:70]}...")
                        log.info(f"   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ: {len(product_data.videos)}")
                        
                        # –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                        for i, video in enumerate(product_data.videos[:3], 1):
                            log.info(f"   –í–∏–¥–µ–æ {i}: {video.get('impression', 0)} impressions, "
                                    f"{video.get('country', 'N/A')}, {video.get('audience_age', 'N/A')}")
                        
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ –∏ –∫–æ–ø–∏—Ä—É–µ–º –≤ "–£—Å–ø–µ—à–Ω—ã–µ" –µ—Å–ª–∏ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                        if sheets_writer and hasattr(product_data, '_sheets_row'):
                            try:
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã A-Z (–∫—Ä–æ–º–µ C) –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                                if sheets_writer.is_row_complete(product_data._sheets_row):
                                    sheets_writer.copy_to_success_sheet(product_data._sheets_row)
                                    log.info(f"  ‚úÖ –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ ‚Üí —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ '–£—Å–ø–µ—à–Ω—ã–µ'")
                                else:
                                    log.warning(f"  ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ (–µ—Å—Ç—å –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏)")
                            except Exception as e:
                                log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ '–£—Å–ø–µ—à–Ω—ã–µ': {e}")
                    
                    # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
                    all_products_analytics.append(analytics_entry)
                    
                    # 7.7. –ï—Å–ª–∏ –≤–∏–¥–µ–æ –º–µ–Ω—å—à–µ 3 - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                    if not analytics_entry["success"]:
                        log.warning(f"‚ö†Ô∏è –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω, –Ω–æ –º–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": getattr(product_data, 'product_name', product.get('name', 'N/A')),
                            "reason": "–ú–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏",
                            "videos_found": len(getattr(product_data, 'videos', []))
                        })
                
                except Exception as e:
                    log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞: {e}")
                    import traceback
                    log.error(traceback.format_exc())
                    
                    skipped_products.append({
                        "name": product.get('name', 'N/A'),
                        "reason": f"–ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {str(e)[:50]}",
                        "videos_found": 0
                    })
            
            # 7.6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –≤—ã—Ö–æ–¥–∞ –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
            if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                break
            
            if checked_products >= MAX_PRODUCTS_TO_CHECK:
                break
        
        # 8. –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç
        log.info(f"\n{'='*80}")
        log.info("üìä –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢")
        log.info(f"{'='*80}")
        log.info(f"‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {successful_products}")
        log.info(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {len(skipped_products)}")
        log.info(f"üîç –í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {checked_products}")
        log.info(f"üö´ –¢–æ–≤–∞—Ä–æ–≤ –≤ ban-list: {len(banned_products)}")
        log.info(f"{'='*80}")
        
        # –í—ã–≤–æ–¥ ban-list
        if banned_products:
            log.info(f"\nüö´ BAN-LIST (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã):")
            for i, product_url in enumerate(sorted(banned_products), 1):
                log.info(f"   {i}. {product_url}")
        
        if skipped_products:
            log.info(f"\n‚è≠Ô∏è  –°–ü–ò–°–û–ö –ü–†–û–ü–£–©–ï–ù–ù–´–• –¢–û–í–ê–†–û–í:")
            for i, skipped in enumerate(skipped_products, 1):
                log.info(f"   {i}. {skipped['name'][:60]}...")
                log.info(f"      –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}")
                log.info(f"      –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}")
        
        if successful_products >= MIN_PRODUCTS_TO_COLLECT:
            log.info(f"\nüéâ –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
        elif checked_products >= MAX_PRODUCTS_TO_CHECK:
            log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
            log.warning(f"   –°–æ–±—Ä–∞–Ω–æ —Ç–æ–ª—å–∫–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ {MIN_PRODUCTS_TO_COLLECT}")
        
        # 9. –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
        log.info("\n" + "=" * 60)
        log.info("üìù –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –≤–∏–¥–µ–æ...")
        log.info("=" * 60)
        try:
            from datetime import datetime
            import os
            
            summary_dir = "logs/summaries"
            os.makedirs(summary_dir, exist_ok=True)
            
            timestamp = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
            summary_file = f"{summary_dir}/iteration_{timestamp}.md"
            
            with open(summary_file, "w", encoding="utf-8") as f:
                f.write(f"# üìä –ò—Ç–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
                
                f.write("## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã\n\n")
                f.write(f"- **–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ:** {successful_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–ø—É—â–µ–Ω–æ:** {len(skipped_products)} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** {checked_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **Ban-list:** {len(banned_products)} —Ç–æ–≤–∞—Ä–æ–≤\n\n")
                
                if successful_products > 0:
                    f.write("### üéâ SUCCESS\n\n")
                    f.write(f"‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ —Å >= 3 –≤–∏–¥–µ–æ\n\n")
                
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                # –ù–û–í–´–ô –ë–õ–û–ö: –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                if all_products_analytics:
                    f.write("---\n\n")
                    f.write("## üìπ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º\n\n")
                    f.write(f"**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:** >= 5K impressions, –≤–æ–∑—Ä–∞—Å—Ç <= 30 –¥–Ω–µ–π\n\n")
                    
                    for idx, product in enumerate(all_products_analytics, 1):
                        status_icon = "‚úÖ" if product["success"] else "‚ùå"
                        f.write(f"### {status_icon} –¢–æ–≤–∞—Ä #{idx}: {product['product_name'][:80]}\n\n")
                        f.write(f"- **–°—Å—ã–ª–∫–∞:** [{product['product_url']}]({product['product_url']})\n")
                        f.write(f"- **–°—Ç–∞—Ç—É—Å:** {'–£–°–ü–ï–• (>= 3 –≤–∏–¥–µ–æ)' if product['success'] else '–ü–†–û–ü–£–©–ï–ù (< 3 –≤–∏–¥–µ–æ)'}\n")
                        f.write(f"- **–ù–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ:** {product['videos_found']}\n\n")
                        
                        # –¢–û–ü-3 –≤–∏–¥–µ–æ (–¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –∫—Ä–∏—Ç–µ—Ä–∏–∏)
                        if product['top_3_videos']:
                            f.write("#### üèÜ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ impression:\n\n")
                            for video in product['top_3_videos']:
                                impression = video['impression']
                                first_seen = video['first_seen']
                                ad_url = video['ad_search_url']
                                
                                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
                                meets_criteria = impression >= 5000  # –ü—Ä–æ–≤–µ—Ä–∫–∞ impression
                                criteria_icon = "‚úÖ" if meets_criteria else "‚ö†Ô∏è"
                                
                                f.write(f"{video['rank']}. {criteria_icon} **{impression:,} impressions** | "
                                       f"First seen: {first_seen}\n")
                                if ad_url and ad_url != 'N/A':
                                    f.write(f"   - –°—Å—ã–ª–∫–∞: [{ad_url}]({ad_url})\n")
                                f.write("\n")
                        else:
                            f.write("   ‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ (–≤–æ–∑–º–æ–∂–Ω–æ, –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞)\n\n")
                        
                        f.write("---\n\n")
                
                # –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
                if skipped_products:
                    f.write("### ‚è≠Ô∏è –ü–†–û–ü–£–©–ï–ù–ù–´–ï –¢–û–í–ê–†–´ (–∫—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫)\n\n")
                    for i, skipped in enumerate(skipped_products, 1):
                        f.write(f"{i}. **{skipped['name'][:60]}...**\n")
                        f.write(f"   - –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}\n")
                        f.write(f"   - –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}\n\n")
                
                # Ban-list
                if banned_products:
                    f.write("### üö´ Ban-list (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)\n\n")
                    for i, product_url in enumerate(sorted(banned_products), 1):
                        f.write(f"{i}. `{product_url}`\n")
                    f.write("\n")
                
                f.write("## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏\n\n")
                f.write(f"- **–¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:** {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–õ–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫:** {MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤–∏–¥–µ–æ:** >= 5K impressions, <= 30 –¥–Ω–µ–π\n\n")
                
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    f.write("## üéØ –°—Ç–∞—Ç—É—Å: –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê ‚úÖ\n\n")
                elif checked_products >= MAX_PRODUCTS_TO_CHECK:
                    f.write("## ‚ö†Ô∏è –°—Ç–∞—Ç—É—Å: –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫\n\n")
                else:
                    f.write("## ‚ùå –°—Ç–∞—Ç—É—Å: –ü—Ä–µ—Ä–≤–∞–Ω–æ\n\n")
            
            log.info(f"‚úÖ Summary —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {summary_file}")
        except Exception as e:
            log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ summary: {e}")
            import traceback
            log.error(traceback.format_exc())
        
        log.info("\n" + "=" * 60)
        log.info("‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û")
        log.info("=" * 60)
        
        # –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)
        log.info("\n‚è∏Ô∏è –û–∂–∏–¥–∞–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –±—Ä–∞—É–∑–µ—Ä–∞ (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)...")
        log.info("   –ù–∞–∂–º–∏—Ç–µ Ctrl+C, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å —Ä–∞–Ω—å—à–µ")
        try:
            await asyncio.sleep(10)
        except KeyboardInterrupt:
            log.info("   –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        
    except KeyboardInterrupt:
        log.warning("\n‚ö†Ô∏è –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Ctrl+C)")
    except Exception as e:
        log.error(f"\n{'='*60}")
        log.error(f"‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}")
        log.error(f"{'='*60}")
        import traceback
        log.error("–ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:")
        log.error(traceback.format_exc())
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
        if browser_manager and browser_manager.page:
            try:
                screenshot_path = config.SCREENSHOTS_DIR / f"error_test_{int(asyncio.get_event_loop().time())}.png"
                await browser_manager.page.screenshot(path=str(screenshot_path), full_page=True)
                log.info(f"üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {screenshot_path}")
            except Exception as e2:
                log.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç: {e2}")
        
        log.error("\n‚ö†Ô∏è –ë—Ä–∞—É–∑–µ—Ä –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞ 30 —Å–µ–∫—É–Ω–¥...")
        try:
            await asyncio.sleep(30)
        except:
            pass
    
    finally:
        if browser_manager:
            await browser_manager.close()


if __name__ == "__main__":
    asyncio.run(test_parser_engine())


```

```python
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Parser Engine
"""

import asyncio
import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ src
sys.path.insert(0, str(Path(__file__).parent))

from src.browser_manager import BrowserManager
from src.parser_engine import ParserEngine, ProductData
from src.sheets_writer import SheetsWriter
from src import config
from src import logger

log = logger.get_logger("TestParserEngine")


async def test_parser_engine():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Parser Engine"""
    
    browser_manager = None
    try:
        log.info("=" * 60)
        log.info("–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï PARSER ENGINE")
        log.info("=" * 60)
        
        # 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
        log.info("\n1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞...")
        browser_manager = BrowserManager()
        success = await browser_manager.initialize(headless=False)  # headful –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä")
            return
        
        # 2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies (–µ—Å–ª–∏ –µ—Å—Ç—å)
        log.info("\n2. –ó–∞–≥—Ä—É–∑–∫–∞ cookies...")
        await browser_manager.load_cookies()
        
        # 3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–∞—á–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads
        log.info("\n3. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Pipiads...")
        success = await browser_manager.navigate_with_retry(
            config.PIPIADS_INITIAL_URL,
            wait_until="domcontentloaded",
            timeout=30000
        )
        if not success:
            log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É")
            return
        
        await browser_manager.human_delay(2, 3)
        
        # 4. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
        log.info("\n4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...")
        is_logged_in = await browser_manager._check_logged_in_strict()
        if not is_logged_in:
            log.info("–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...")
            success = await browser_manager.login_to_pipiads()
            if not success:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è")
                return
            await browser_manager.save_cookies()
        else:
            log.info("‚úÖ –£–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω")
        
        # 5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine
        log.info("\n5. –°–æ–∑–¥–∞–Ω–∏–µ Parser Engine...")
        parser = ParserEngine(browser_manager.page)
        parser.set_browser_manager(browser_manager)
        
        # 6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets (–¥–æ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤)
        log.info("\n6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets...")
        sheets_writer = None
        try:
            sheets_writer = SheetsWriter()
            if sheets_writer.connect():
                log.info("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets —É—Å–ø–µ—à–Ω–æ")
            else:
                log.warning("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Google Sheets, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        except Exception as e:
            log.warning(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ Google Sheets: {e}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –∑–∞–ø–∏—Å–∏")
        
        # 7. –¶–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        log.info("\n" + "=" * 80)
        log.info("7. –ù–ê–ß–ê–õ–û –û–ë–†–ê–ë–û–¢–ö–ò –¢–û–í–ê–†–û–í")
        log.info("=" * 80)
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        # –£–°–õ–ê–ë–õ–ï–ù–û –¥–ª—è —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏: —Å–Ω–∏–∂–µ–Ω—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
        MIN_PRODUCTS_TO_COLLECT = 3   # –¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–º–æ–∂–Ω–æ —Å–Ω–∏–∑–∏—Ç—å –¥–æ 1-2)
        MAX_PRODUCTS_TO_CHECK = 15     # –ú–∞–∫—Å–∏–º—É–º —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é (—É–≤–µ–ª–∏—á–µ–Ω–æ –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –≤—ã–±–æ—Ä–∞)
        PRODUCTS_PER_PAGE = 20         # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        
        successful_products = 0  # –°—á–µ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        checked_products = 0      # –°—á–µ—Ç—á–∏–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        skipped_products = []     # –°–ø–∏—Å–æ–∫ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        banned_products = set()   # Ban-list: URL —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ)
        all_products_analytics = []  # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –í–°–ï–• —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è summary-—Ñ–∞–π–ª–∞
        
        def normalize_url(url: str) -> str:
            """–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL (—É–±—Ä–∞—Ç—å —Å–ª—ç—à –≤ –∫–æ–Ω—Ü–µ, –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –µ–¥–∏–Ω–æ–º—É –≤–∏–¥—É)"""
            if not url:
                return ""
            url = url.strip().rstrip('/')
            # –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if '?' in url:
                url = url.split('?')[0]
            return url
        
        # –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏
        while successful_products < MIN_PRODUCTS_TO_COLLECT and checked_products < MAX_PRODUCTS_TO_CHECK:
            
            # 7.1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
            log.info(f"\n{'='*80}")
            log.info(f"–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã...")
            log.info(f"–ü—Ä–æ–≥—Ä–µ—Å—Å: {successful_products}/{MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ, "
                    f"{checked_products}/{MAX_PRODUCTS_TO_CHECK} –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ")
            log.info(f"{'='*80}")
            
            try:
                products = await parser.get_products_from_search_page(count=PRODUCTS_PER_PAGE)
            except Exception as e:
                log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
                break
            
            if not products:
                log.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã, –∑–∞–≤–µ—Ä—à–∞–µ–º")
                break
            
            log.info(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ")
            
            # 7.1.5. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ URL (–ø—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è)
            # –í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º banned_products –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã
            unique_products = []
            duplicate_count = 0
            seen_urls = set()  # –î–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
            
            for product in products:
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ü—Ä–æ–ø—É—Å–∫ —Ç–æ–≤–∞—Ä–∞ –±–µ–∑ URL")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ç–∏–≤ banned_products (—É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)
                if product_url in banned_products:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (—É–∂–µ –≤ ban-list): {product_url}")
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
                if product_url in seen_urls:
                    duplicate_count += 1
                    log.info(f"‚è≠Ô∏è  –î—É–±–ª–∏–∫–∞—Ç —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–ø—É—â–µ–Ω (–≤ —Ç–µ–∫—É—â–µ–º —Å–ø–∏—Å–∫–µ): {product_url}")
                    continue
                
                seen_urls.add(product_url)
                # –û–±–Ω–æ–≤–ª—è–µ–º URL –≤ —Å–ª–æ–≤–∞—Ä–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π
                product['url'] = product_url
                unique_products.append(product)
            
            if duplicate_count > 0:
                log.info(f"üîç –ù–∞–π–¥–µ–Ω–æ {duplicate_count} –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, –æ—Å—Ç–∞–≤–ª–µ–Ω–æ {len(unique_products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤")
            
            products = unique_products  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
            log.info(f"‚úÖ –ü–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏: {len(products)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏")
            
            # 7.2. –¶–∏–∫–ª –ø–æ —Ç–æ–≤–∞—Ä–∞–º –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            for product_index, product in enumerate(products):
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    log.info(f"\nüéØ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
                    break
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
                if checked_products >= MAX_PRODUCTS_TO_CHECK:
                    log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
                    break
                
                # ‚ö†Ô∏è –ü–†–û–í–ï–†–ö–ê BAN-LIST: –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å
                product_url = normalize_url(product.get('url', ''))
                
                if not product_url:
                    log.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL —Ç–æ–≤–∞—Ä–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
                    continue
                
                # –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º ban-list –ü–ï–†–ï–î –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
                if product_url in banned_products:
                    log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –≤ ban-list: {product_url}")
                    log.warning(f"   –≠—Ç–æ –¥—É–±–ª–∏–∫–∞—Ç! –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É.")
                    continue
                
                checked_products += 1
                
                # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–≤–∞—Ä–∞
                log.info(f"\n{'='*80}")
                log.info(f"üì¶ –¢–û–í–ê–† {checked_products}/{MAX_PRODUCTS_TO_CHECK} "
                        f"(—É—Å–ø–µ—à–Ω—ã—Ö: {successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                log.info(f"{'='*80}")
                log.info(f"–ù–∞–∑–≤–∞–Ω–∏–µ: {product.get('name', 'N/A')[:70]}...")
                log.info(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {product.get('category', 'N/A')}")
                log.info(f"URL: {product_url}")
                
                try:
                    # 7.3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ (–ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –ø–æ URL)
                    # –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥–∞–µ–º banned_products –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
                    product_data = await parser.get_product_details_with_return(
                        product_url=product_url,
                        sheets_writer=sheets_writer,
                        banned_products=banned_products
                    )
                    
                    # –ö–†–ò–¢–ò–ß–ù–û: –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä –≤ ban-list –ü–û–°–õ–ï –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)
                    banned_products.add(product_url)
                    log.info(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ü–û–°–õ–ï –æ–±—Ä–∞–±–æ—Ç–∫–∏: {product_url}")
                    
                    # 7.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    if product_data is None:
                        # –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
                        log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞")
                        
                        skipped_products.append({
                            "name": product.get('name', 'N/A'),
                            "reason": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ",
                            "videos_found": 0
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ)
                        all_products_analytics.append({
                            "product_name": product.get('name', 'N/A'),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": 0,
                            "top_3_videos": []
                        })
                        continue
                    
                    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç (–µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª—Å—è —Å—Ç–∞—Ç—É—Å "duplicate")
                    if isinstance(product_data, dict) and product_data.get("status") == "duplicate":
                        duplicate_url = product_data.get('product_url', 'N/A')
                        log.warning(f"üö´ –ü–†–û–ü–£–°–ö: –¢–æ–≤–∞—Ä —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (–¥—É–±–ª–∏–∫–∞—Ç): {duplicate_url}")
                        duplicate_count += 1
                        continue
                    
                    if isinstance(product_data, dict) and product_data.get("status") == "insufficient_videos":
                        # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                        log.warning(f"‚è≠Ô∏è  –ü–†–û–ü–£–°–ö: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù–∞–π–¥–µ–Ω–æ: {product_data.get('videos_found', 0)} –≤–∏–¥–µ–æ")
                        log.warning(f"   –ù—É–∂–Ω–æ: {product_data.get('videos_required', 3)} –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": product_data.get('product_name', product.get('name', 'N/A')),
                            "reason": product_data.get('reason', '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ'),
                            "videos_found": product_data.get('videos_found', 0)
                        })
                        
                        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ - —Ç–æ–≤–∞—Ä –≤–µ—Ä–Ω—É–ª insufficient_videos)
                        all_products_analytics.append({
                            "product_name": product_data.get('product_name', product.get('name', 'N/A')),
                            "product_url": product_url,
                            "success": False,
                            "videos_found": product_data.get('videos_found', 0),
                            "top_3_videos": []  # –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–ø-3
                        })
                        continue
                    
                    # 7.5. –°–±–æ—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –¥–ª—è summary
                    analytics_entry = {
                        "product_name": getattr(product_data, 'product_name', 'N/A'),
                        "product_url": getattr(product_data, 'pipiads_link', product_url),
                        "success": False,
                        "videos_found": len(getattr(product_data, 'videos', [])),
                        "top_3_videos": []
                    }
                    
                    # –ò–∑–≤–ª–µ–∫–∞–µ–º –¢–û–ü-3 –≤–∏–¥–µ–æ (–ø–æ impression) –∏–∑ –í–°–ï–• –≤–∏–¥–µ–æ
                    if hasattr(product_data, '_all_videos_raw'):
                        all_videos = product_data._all_videos_raw
                        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ impression (desc) –∏ –±–µ—Ä–µ–º —Ç–æ–ø-3
                        sorted_videos = sorted(all_videos, key=lambda v: v.get('impression', 0), reverse=True)
                        for i, video in enumerate(sorted_videos[:3], 1):
                            analytics_entry["top_3_videos"].append({
                                "rank": i,
                                "impression": video.get('impression', 0),
                                "first_seen": video.get('first_seen', 'N/A'),
                                "ad_search_url": video.get('ad_search_url', 'N/A')
                            })
                    
                    # 7.6. –£—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞
                    if hasattr(product_data, 'videos') and len(product_data.videos) >= 3:
                        successful_products += 1
                        analytics_entry["success"] = True
                        
                        log.info(f"\n‚úÖ –£–°–ü–ï–•! –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω ({successful_products}/{MIN_PRODUCTS_TO_COLLECT})")
                        log.info(f"   –ù–∞–∑–≤–∞–Ω–∏–µ: {product_data.product_name[:70]}...")
                        log.info(f"   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ: {len(product_data.videos)}")
                        
                        # –ö—Ä–∞—Ç–∫–∏–π –≤—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
                        for i, video in enumerate(product_data.videos[:3], 1):
                            log.info(f"   –í–∏–¥–µ–æ {i}: {video.get('impression', 0)} impressions, "
                                    f"{video.get('country', 'N/A')}, {video.get('audience_age', 'N/A')}")
                        
                        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ –∏ –∫–æ–ø–∏—Ä—É–µ–º –≤ "–£—Å–ø–µ—à–Ω—ã–µ" –µ—Å–ª–∏ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                        if sheets_writer and hasattr(product_data, '_sheets_row'):
                            try:
                                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã A-Z (–∫—Ä–æ–º–µ C) –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
                                if sheets_writer.is_row_complete(product_data._sheets_row):
                                    sheets_writer.copy_to_success_sheet(product_data._sheets_row)
                                    log.info(f"  ‚úÖ –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ ‚Üí —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ '–£—Å–ø–µ—à–Ω—ã–µ'")
                                else:
                                    log.warning(f"  ‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ {product_data._sheets_row} –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ (–µ—Å—Ç—å –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏)")
                            except Exception as e:
                                log.warning(f"  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ '–£—Å–ø–µ—à–Ω—ã–µ': {e}")
                    
                    # –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
                    all_products_analytics.append(analytics_entry)
                    
                    # 7.7. –ï—Å–ª–∏ –≤–∏–¥–µ–æ –º–µ–Ω—å—à–µ 3 - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                    if not analytics_entry["success"]:
                        log.warning(f"‚ö†Ô∏è –¢–æ–≤–∞—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω, –Ω–æ –º–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ")
                        
                        skipped_products.append({
                            "name": getattr(product_data, 'product_name', product.get('name', 'N/A')),
                            "reason": "–ú–µ–Ω—å—à–µ 3 –≤–∏–¥–µ–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏",
                            "videos_found": len(getattr(product_data, 'videos', []))
                        })
                
                except Exception as e:
                    log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–æ–≤–∞—Ä–∞: {e}")
                    import traceback
                    log.error(traceback.format_exc())
                    
                    # –î–æ–±–∞–≤–ª—è–µ–º –≤ ban-list –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ, —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ
                    banned_products.add(product_url)
                    log.info(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ban-list –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏: {product_url}")
                    
                    skipped_products.append({
                        "name": product.get('name', 'N/A'),
                        "reason": f"–ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {str(e)[:50]}",
                        "videos_found": 0
                    })
            
            # 7.6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –≤—ã—Ö–æ–¥–∞ –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
            if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                break
            
            if checked_products >= MAX_PRODUCTS_TO_CHECK:
                break
        
        # 8. –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç
        log.info(f"\n{'='*80}")
        log.info("üìä –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢")
        log.info(f"{'='*80}")
        log.info(f"‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {successful_products}")
        log.info(f"‚è≠Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {len(skipped_products)}")
        log.info(f"üîç –í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {checked_products}")
        log.info(f"üö´ –¢–æ–≤–∞—Ä–æ–≤ –≤ ban-list: {len(banned_products)}")
        log.info(f"{'='*80}")
        
        # –í—ã–≤–æ–¥ ban-list
        if banned_products:
            log.info(f"\nüö´ BAN-LIST (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã):")
            for i, product_url in enumerate(sorted(banned_products), 1):
                log.info(f"   {i}. {product_url}")
        
        if skipped_products:
            log.info(f"\n‚è≠Ô∏è  –°–ü–ò–°–û–ö –ü–†–û–ü–£–©–ï–ù–ù–´–• –¢–û–í–ê–†–û–í:")
            for i, skipped in enumerate(skipped_products, 1):
                log.info(f"   {i}. {skipped['name'][:60]}...")
                log.info(f"      –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}")
                log.info(f"      –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}")
        
        if successful_products >= MIN_PRODUCTS_TO_COLLECT:
            log.info(f"\nüéâ –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê! –°–æ–±—Ä–∞–Ω–æ {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤")
        elif checked_products >= MAX_PRODUCTS_TO_CHECK:
            log.warning(f"\n‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ ({MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤)")
            log.warning(f"   –°–æ–±—Ä–∞–Ω–æ —Ç–æ–ª—å–∫–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ {MIN_PRODUCTS_TO_COLLECT}")
        
        # 9. –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
        log.info("\n" + "=" * 60)
        log.info("üìù –°–æ–∑–¥–∞–Ω–∏–µ summary-—Ñ–∞–π–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –≤–∏–¥–µ–æ...")
        log.info("=" * 60)
        try:
            from datetime import datetime
            import os
            
            summary_dir = "logs/summaries"
            os.makedirs(summary_dir, exist_ok=True)
            
            timestamp = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
            summary_file = f"{summary_dir}/iteration_{timestamp}.md"
            
            with open(summary_file, "w", encoding="utf-8") as f:
                f.write(f"# üìä –ò—Ç–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
                
                f.write("## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã\n\n")
                f.write(f"- **–£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ:** {successful_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–ø—É—â–µ–Ω–æ:** {len(skipped_products)} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** {checked_products} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **Ban-list:** {len(banned_products)} —Ç–æ–≤–∞—Ä–æ–≤\n\n")
                
                if successful_products > 0:
                    f.write("### üéâ SUCCESS\n\n")
                    f.write(f"‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ {successful_products} —Ç–æ–≤–∞—Ä–æ–≤ —Å >= 3 –≤–∏–¥–µ–æ\n\n")
                
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                # –ù–û–í–´–ô –ë–õ–û–ö: –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º
                # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                if all_products_analytics:
                    f.write("---\n\n")
                    f.write("## üìπ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤–∏–¥–µ–æ –ø–æ —Ç–æ–≤–∞—Ä–∞–º\n\n")
                    f.write(f"**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:** >= 5K impressions, –≤–æ–∑—Ä–∞—Å—Ç <= 30 –¥–Ω–µ–π\n\n")
                    
                    for idx, product in enumerate(all_products_analytics, 1):
                        status_icon = "‚úÖ" if product["success"] else "‚ùå"
                        f.write(f"### {status_icon} –¢–æ–≤–∞—Ä #{idx}: {product['product_name'][:80]}\n\n")
                        f.write(f"- **–°—Å—ã–ª–∫–∞:** [{product['product_url']}]({product['product_url']})\n")
                        f.write(f"- **–°—Ç–∞—Ç—É—Å:** {'–£–°–ü–ï–• (>= 3 –≤–∏–¥–µ–æ)' if product['success'] else '–ü–†–û–ü–£–©–ï–ù (< 3 –≤–∏–¥–µ–æ)'}\n")
                        f.write(f"- **–ù–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ:** {product['videos_found']}\n\n")
                        
                        # –¢–û–ü-3 –≤–∏–¥–µ–æ (–¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –∫—Ä–∏—Ç–µ—Ä–∏–∏)
                        if product['top_3_videos']:
                            f.write("#### üèÜ –¢–û–ü-3 –≤–∏–¥–µ–æ –ø–æ impression:\n\n")
                            for video in product['top_3_videos']:
                                impression = video['impression']
                                first_seen = video['first_seen']
                                ad_url = video['ad_search_url']
                                
                                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
                                meets_criteria = impression >= 5000  # –ü—Ä–æ–≤–µ—Ä–∫–∞ impression
                                criteria_icon = "‚úÖ" if meets_criteria else "‚ö†Ô∏è"
                                
                                f.write(f"{video['rank']}. {criteria_icon} **{impression:,} impressions** | "
                                       f"First seen: {first_seen}\n")
                                if ad_url and ad_url != 'N/A':
                                    f.write(f"   - –°—Å—ã–ª–∫–∞: [{ad_url}]({ad_url})\n")
                                f.write("\n")
                        else:
                            f.write("   ‚ö†Ô∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤–∏–¥–µ–æ (–≤–æ–∑–º–æ–∂–Ω–æ, –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞)\n\n")
                        
                        f.write("---\n\n")
                
                # –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
                if skipped_products:
                    f.write("### ‚è≠Ô∏è –ü–†–û–ü–£–©–ï–ù–ù–´–ï –¢–û–í–ê–†–´ (–∫—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫)\n\n")
                    for i, skipped in enumerate(skipped_products, 1):
                        f.write(f"{i}. **{skipped['name'][:60]}...**\n")
                        f.write(f"   - –ü—Ä–∏—á–∏–Ω–∞: {skipped['reason']}\n")
                        f.write(f"   - –í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ: {skipped['videos_found']}\n\n")
                
                # Ban-list
                if banned_products:
                    f.write("### üö´ Ban-list (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)\n\n")
                    for i, product_url in enumerate(sorted(banned_products), 1):
                        f.write(f"{i}. `{product_url}`\n")
                    f.write("\n")
                
                f.write("## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏\n\n")
                f.write(f"- **–¶–µ–ª–µ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:** {MIN_PRODUCTS_TO_COLLECT} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–õ–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫:** {MAX_PRODUCTS_TO_CHECK} —Ç–æ–≤–∞—Ä–æ–≤\n")
                f.write(f"- **–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤–∏–¥–µ–æ:** >= 5K impressions, <= 30 –¥–Ω–µ–π\n\n")
                
                if successful_products >= MIN_PRODUCTS_TO_COLLECT:
                    f.write("## üéØ –°—Ç–∞—Ç—É—Å: –¶–ï–õ–¨ –î–û–°–¢–ò–ì–ù–£–¢–ê ‚úÖ\n\n")
                elif checked_products >= MAX_PRODUCTS_TO_CHECK:
                    f.write("## ‚ö†Ô∏è –°—Ç–∞—Ç—É—Å: –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫\n\n")
                else:
                    f.write("## ‚ùå –°—Ç–∞—Ç—É—Å: –ü—Ä–µ—Ä–≤–∞–Ω–æ\n\n")
            
            log.info(f"‚úÖ Summary —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {summary_file}")
        except Exception as e:
            log.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ summary: {e}")
            import traceback
            log.error(traceback.format_exc())
        
        log.info("\n" + "=" * 60)
        log.info("‚úÖ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û –£–°–ü–ï–®–ù–û")
        log.info("=" * 60)
        
        # –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)
        log.info("\n‚è∏Ô∏è –û–∂–∏–¥–∞–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –±—Ä–∞—É–∑–µ—Ä–∞ (–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)...")
        log.info("   –ù–∞–∂–º–∏—Ç–µ Ctrl+C, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å —Ä–∞–Ω—å—à–µ")
        try:
            await asyncio.sleep(10)
        except KeyboardInterrupt:
            log.info("   –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
        
    except KeyboardInterrupt:
        log.warning("\n‚ö†Ô∏è –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Ctrl+C)")
    except Exception as e:
        log.error(f"\n{'='*60}")
        log.error(f"‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}")
        log.error(f"{'='*60}")
        import traceback
        log.error("–ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:")
        log.error(traceback.format_exc())
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
        if browser_manager and browser_manager.page:
            try:
                screenshot_path = config.SCREENSHOTS_DIR / f"error_test_{int(asyncio.get_event_loop().time())}.png"
                await browser_manager.page.screenshot(path=str(screenshot_path), full_page=True)
                log.info(f"üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {screenshot_path}")
            except Exception as e2:
                log.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç: {e2}")
        
        log.error("\n‚ö†Ô∏è –ë—Ä–∞—É–∑–µ—Ä –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –Ω–∞ 30 —Å–µ–∫—É–Ω–¥...")
        try:
            await asyncio.sleep(30)
        except:
            pass
    
    finally:
        if browser_manager:
            await browser_manager.close()


if __name__ == "__main__":
    asyncio.run(test_parser_engine())


```

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ. –ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ —Ç–æ–º, —á—Ç–æ —Ç–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª—è–ª—Å—è –≤ ban-list –¥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `get_product_details_with_return` –æ–Ω —É–∂–µ –±—ã–ª —Ç–∞–º –∏ –ø—Ä–æ–ø—É—Å–∫–∞–ª—Å—è.

## –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

1. –£–±—Ä–∞–ª –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ ban-list –¥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ‚Äî —Ç–æ–≤–∞—Ä –±–æ–ª—å—à–µ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `get_product_details_with_return`.
2. –î–æ–±–∞–≤–∏–ª –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ ban-list –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ‚Äî —Ç–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞: —É—Å–ø–µ—Ö, –æ—à–∏–±–∫–∞ –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–∏–¥–µ–æ).
3. Ban-list –æ—á–∏—â–∞–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ ‚Äî `banned_products = set()` —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ –≤ —Å—Ç—Ä–æ–∫–µ 99, —Ç–∞–∫ —á—Ç–æ –∫–∞–∂–¥—ã–π –∑–∞–ø—É—Å–∫ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —á–∏—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞.

## –ö–∞–∫ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä–∫–∞ ban-list –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π (–≤ `test_parser_engine.py`) ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã.
2. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ `get_product_details_with_return`.
3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ ban-list –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ‚Äî —Ç–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.

–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –µ—â–µ —Ä–∞–∑. –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:
- –¢–æ–≤–∞—Ä—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è (–Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è —Å—Ä–∞–∑—É).
- –ö–∞–∂–¥—ã–π —Ç–æ–≤–∞—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑.
- Ban-list –æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º –∑–∞–ø—É—Å–∫–µ.

–ó–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç –∏ –ø—Ä–∏—à–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

---

**User**

—Ç–∞–∫ –¥–∞–≤–∞–π –∑–∞–∫—Ä–µ–ø–∏–º —Ü–µ–ª–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞, —á—Ç–æ–±—ã —è –Ω–µ –∑–∞–±—ã–ª:

- –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–∏–¥–µ–æ —Ç–æ–≤–∞—Ä–∞, –∞ –Ω–µ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ, –∫–∞–∫ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–ø—ã—Ç–∫–µ





–ù–æ —Å–µ–π—á–∞—Å —Å–∫—Ä–∏–ø—Ç –æ—Ç–ª–∏—á–Ω–æ —Ö–æ–¥–∏—Ç –ø–æ —Ç–æ–≤–∞—Ä–∞–º –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–æ—Ö—Ä–∞–Ω–∏ —ç—Ç–æ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ –ø–∞–º—è—Ç–∏. –ê —è –∑–∞–ø—É—à—É –Ω–∞ –≥–∏—Ç—Ö–∞–±

---

**Cursor**

–°–æ—Ö—Ä–∞–Ω—è—é –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ —Ü–µ–ª—å –Ω–∞ –∑–∞–≤—Ç—Ä–∞.


–í–∏–∂—É –ø—Ä–æ–±–ª–µ–º—É: –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –≤–∏–¥–µ–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ `ad_search_url`). –°–æ—Ö—Ä–∞–Ω—è—é –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ —Ü–µ–ª—å –Ω–∞ –∑–∞–≤—Ç—Ä–∞.


–°–æ—Ö—Ä–∞–Ω—è—é –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ —Ü–µ–ª—å –Ω–∞ –∑–∞–≤—Ç—Ä–∞.


–°–æ—Ö—Ä–∞–Ω—è—é –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ —Ü–µ–ª—å –Ω–∞ –∑–∞–≤—Ç—Ä–∞.


–°–æ—Ö—Ä–∞–Ω—è—é –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ —Ü–µ–ª—å –Ω–∞ –∑–∞–≤—Ç—Ä–∞.

## –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –ø–∞–º—è—Ç–∏

### –¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å (—Ä–∞–±–æ—Ç–∞–µ—Ç)
1. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ç–æ–≤–∞—Ä—ã –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è
2. –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ç–æ–≤–∞—Ä–∞–º ‚Äî —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–æ–≤–∞—Ä–æ–≤
3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ ‚Äî —Ç–æ–≤–∞—Ä—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
4. Ban-list ‚Äî –æ—á–∏—â–∞–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
5. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –≤–∏–¥–µ–æ ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏

### –ü—Ä–æ–±–ª–µ–º–∞, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∑–∞–≤—Ç—Ä–∞
–û–¥–Ω–æ –∏ —Ç–æ –∂–µ –≤–∏–¥–µ–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞.

–ü—Ä–∏–º–µ—Ä—ã –∏–∑ –ª–æ–≥–æ–≤:
- –¢–æ–≤–∞—Ä #3: –≤–∏–¥–µ–æ 1 –∏ 2 ‚Äî –æ–±–∞ —Å `ad_search_url = 830e981c72e63bf0a587`
- –¢–æ–≤–∞—Ä #4: –≤–∏–¥–µ–æ 1 –∏ 2 ‚Äî –æ–±–∞ —Å `ad_search_url = fd56711214418a5f37c3`
- –¢–æ–≤–∞—Ä #5: –≤–∏–¥–µ–æ 1 –∏ 2 ‚Äî –æ–±–∞ —Å `ad_search_url = cbc3c722e969a3ab476f`

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∑–∞–≤—Ç—Ä–∞
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –≤–∏–¥–µ–æ ‚Äî –ø–æ—á–µ–º—É –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ `ad_search_url` –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Ç–æ–ø-3
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è `ad_search_url` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ ‚Äî –∫–∞–∫–∏–µ –≤–∏–¥–µ–æ —Å—á–∏—Ç–∞—é—Ç—Å—è –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞ –Ω–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–∏–¥–µ–æ

### –ì–¥–µ –∏—Å–∫–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É
- `src/parser_engine.py` —Å—Ç—Ä–æ–∫–∏ 1592-1609 ‚Äî –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –≤–∏–¥–µ–æ
- `src/parser_engine.py` —Å—Ç—Ä–æ–∫–∏ 1497-1511 ‚Äî –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ `ad_search_url` –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏
- –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å `ad_search_url` —Å—Ä–∞–∑—É –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏

–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω. –ó–∞–≤—Ç—Ä–∞ –∏—Å–ø—Ä–∞–≤–∏–º –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –≤–∏–¥–µ–æ, —á—Ç–æ–±—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å —Ä–∞–∑–Ω—ã–µ –≤–∏–¥–µ–æ —Ç–æ–≤–∞—Ä–∞.

